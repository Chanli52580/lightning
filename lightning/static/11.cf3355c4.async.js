(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{RsOY:function(e,t,n){"use strict";(function(n){function a(e){return"object"!=typeof e||"toString"in e?e:Object.prototype.toString.call(e).slice(8,-1)}Object.defineProperty(t,"__esModule",{value:!0});var r="object"==typeof n&&!0;function l(e,t){if(!e){if(r)throw new Error("Invariant failed");throw new Error(t())}}t.invariant=l;var i=Object.prototype.hasOwnProperty,o=Array.prototype.splice,c=Object.prototype.toString;function u(e){return c.call(e).slice(8,-1)}var f=Object.assign||function(e,t){return s(t).forEach(function(n){i.call(t,n)&&(e[n]=t[n])}),e},s="function"==typeof Object.getOwnPropertySymbols?function(e){return Object.keys(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.keys(e)};function m(e){return Array.isArray(e)?f(e.constructor(e.length),e):"Map"===u(e)?new Map(e):"Set"===u(e)?new Set(e):e&&"object"==typeof e?f(Object.create(Object.getPrototypeOf(e)),e):e}var d=function(){function e(){this.commands=f({},p),this.update=this.update.bind(this),this.update.extend=this.extend=this.extend.bind(this),this.update.isEquals=function(e,t){return e===t},this.update.newContext=function(){return(new e).update}}return Object.defineProperty(e.prototype,"isEquals",{get:function(){return this.update.isEquals},set:function(e){this.update.isEquals=e},enumerable:!0,configurable:!0}),e.prototype.extend=function(e,t){this.commands[e]=t},e.prototype.update=function(e,t){var n=this,a="function"==typeof t?{$apply:t}:t;Array.isArray(e)&&Array.isArray(a)||l(!Array.isArray(a),function(){return"update(): You provided an invalid spec to update(). The spec may not contain an array except as the value of $set, $push, $unshift, $splice or any custom command allowing an array value."}),l("object"==typeof a&&null!==a,function(){return"update(): You provided an invalid spec to update(). The spec and every included key path must be plain objects containing one of the following commands: "+Object.keys(n.commands).join(", ")+"."});var r=e;return s(a).forEach(function(t){if(i.call(n.commands,t)){var l=e===r;r=n.commands[t](a[t],r,a,e),l&&n.isEquals(r,e)&&(r=e)}else{var o="Map"===u(e)?n.update(e.get(t),a[t]):n.update(e[t],a[t]),c="Map"===u(r)?r.get(t):r[t];n.isEquals(o,c)&&(void 0!==o||i.call(e,t))||(r===e&&(r=m(e)),"Map"===u(r)?r.set(t,o):r[t]=o)}}),r},e}();t.Context=d;var p={$push:function(e,t,n){return h(t,n,"$push"),e.length?t.concat(e):t},$unshift:function(e,t,n){return h(t,n,"$unshift"),e.length?e.concat(t):t},$splice:function(e,t,n,r){return function(e,t){l(Array.isArray(e),function(){return"Expected $splice target to be an array; got "+a(e)}),y(t.$splice)}(t,n),e.forEach(function(e){y(e),t===r&&e.length&&(t=m(r)),o.apply(t,e)}),t},$set:function(e,t,n){return function(e){l(1===Object.keys(e).length,function(){return"Cannot have more than one key in an object with $set"})}(n),e},$toggle:function(e,t){g(e,"$toggle");var n=e.length?m(t):t;return e.forEach(function(e){n[e]=!t[e]}),n},$unset:function(e,t,n,a){return g(e,"$unset"),e.forEach(function(e){Object.hasOwnProperty.call(t,e)&&(t===a&&(t=m(a)),delete t[e])}),t},$add:function(e,t,n,a){return E(t,"$add"),g(e,"$add"),"Map"===u(t)?e.forEach(function(e){var n=e[0],r=e[1];t===a&&t.get(n)!==r&&(t=m(a)),t.set(n,r)}):e.forEach(function(e){t!==a||t.has(e)||(t=m(a)),t.add(e)}),t},$remove:function(e,t,n,a){return E(t,"$remove"),g(e,"$remove"),e.forEach(function(e){t===a&&t.has(e)&&(t=m(a)),t.delete(e)}),t},$merge:function(e,t,n,r){var i,o;return i=t,l((o=e)&&"object"==typeof o,function(){return"update(): $merge expects a spec of type 'object'; got "+a(o)}),l(i&&"object"==typeof i,function(){return"update(): $merge expects a target of type 'object'; got "+a(i)}),s(e).forEach(function(n){e[n]!==t[n]&&(t===r&&(t=m(r)),t[n]=e[n])}),t},$apply:function(e,t){var n;return l("function"==typeof(n=e),function(){return"update(): expected spec of $apply to be a function; got "+a(n)+"."}),e(t)}},v=new d;function h(e,t,n){l(Array.isArray(e),function(){return"update(): expected target of "+a(n)+" to be an array; got "+a(e)+"."}),g(t[n],n)}function g(e,t){l(Array.isArray(e),function(){return"update(): expected spec of "+a(t)+" to be an array; got "+a(e)+". Did you forget to wrap your parameter in an array?"})}function y(e){l(Array.isArray(e),function(){return"update(): expected spec of $splice to be an array of arrays; got "+a(e)+". Did you forget to wrap your parameters in an array?"})}function E(e,t){var n=u(e);l("Map"===n||"Set"===n,function(){return"update(): "+a(t)+" expects a target of type Set or Map; got "+a(n)})}t.isEquals=v.update.isEquals,t.extend=v.extend,t.default=v.update,t.default.default=e.exports=f(t.default,t)}).call(this,n("Q2Ig"))},SWtE:function(e,t,n){},"U/ol":function(e,t,n){e.exports={divider:"antd-pro-bsm-pages-config-editor-inline-actions-editor-divider"}},fscj:function(e,t,n){},yPhJ:function(e,t,n){"use strict";n.r(t);n("IzEo");var a=n("bx4M"),r=(n("+L6B"),n("2/Rp")),l=n("p0pE"),i=n.n(l),o=n("qIgq"),c=n.n(o),u=n("q1tI"),f=n.n(u),s=n("MuoO"),m=n("jfUH"),d=(n("sRBo"),n("kaz8")),p=(n("7Kak"),n("9yH6")),v=(n("y8nQ"),n("Vl3Y")),h=(n("5NDa"),n("5rEg")),g=(n("miYZ"),n("tsqr")),y=n("gWZ8"),E=n.n(y),b=(n("fu2T"),n("gK9i")),C=n("LvDl"),O=n.n(C),w={version:"v2",name:"",file_type:"csv",merge_bref:!1,fields:[],collapseActiveKey:[]};var S=function(e){var t=e.modelName,n=e.adminConfig,r=e.schemas,l=Object(u.useState)(_.cloneDeep(n[t].exportable)||w),o=c()(l,2),s=o[0],m=o[1],y=Object(u.useState)("success"),O=c()(y,2),S=O[0],D=O[1],j=Object(u.useState)(s.collapseActiveKey||[]),F=c()(j,2),k=F[0],N=F[1],x=Object(u.useState)([]),I=c()(x,2),A=I[0],P=I[1],T=Object(u.useState)([]),R=c()(T,2),$=R[0],M=R[1],V=Object(u.useState)([]),L=c()(V,2),Y=L[0],q=L[1],K=b.a.Panel;function W(e,t){var n=E()(s.fields||[]);t?n.includes(e)||n.push(e):n=n.filter(function(t){return t!==e}),m(i()({},s,{fields:n}))}function G(e,t){var n=k||[];e.length>0?n.includes(t)||n.push(t):n=n.filter(function(e){return e!==t}),N(n)}Object(u.useEffect)(function(){var e=[],n=[],a=[];r[t].fields.forEach(function(t){if("ref"===t.type){var l=t,i=[];r[t.ref].fields.forEach(function(e){"mref"!==e.type&&"ref"!==e.type&&"bref"!==e.type&&i.push({displayName:e.displayName,name:e.name})}),n.push({parenField:l,fieldxs:i})}else if("bref"===t.type||"mref"===t.type){var o=t,c=[],u=[];r[t.ref]&&r[t.ref].fields.forEach(function(e){if("mref"!==e.type&&"bref"!==e.type&&"ref"!==e.type)c.push({displayName:e.displayName,name:e.name});else if("ref"===e.type){var t=e,n=[];r[e.ref].fields.forEach(function(e){"mref"!==e.type&&"bref"!==e.type&&"ref"!==e.type&&n.push({displayName:e.displayName,name:e.name})}),u.push({shildParenField:t,shildDieldxs:n})}}),a.push({parenField:o,fieldxs:c,shildRefFiledsData:u})}else e.push({displayName:t.displayName,name:t.name})}),P(e),M(n),q(a)},[]);var z={background:"white",border:0};return[f.a.createElement(v.a,{labelCol:{xs:{span:18},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:18}}},f.a.createElement(v.a.Item,{label:"名称：",required:!0,validateStatus:S},f.a.createElement(h.a,{placeholder:"请输入导出按钮的名称",onChange:function(e){var t=e.target.value;""===t&&D("error"),m(i()({},s,{name:t}))},value:s.name})),f.a.createElement(v.a.Item,{label:"格式："},f.a.createElement(p.a.Group,{value:s.file_type,onChange:function(e){var t=e.target.value;m(i()({},s,{file_type:t}))}},f.a.createElement(p.a,{value:"csv"},"CSV"))),f.a.createElement(v.a.Item,{label:"合并子项："},f.a.createElement(p.a.Group,{value:s.merge_bref||!1,onChange:function(e){var t=e.target.value;m(i()({},s,{merge_bref:t}))}},f.a.createElement(p.a,{value:!0},"是"),f.a.createElement(p.a,{value:!1},"否")),f.a.createElement("br",null),"合并子项会把多条子项的数据拼接成一条来显示。"),f.a.createElement(v.a.Item,null,f.a.createElement(a.a,{bordered:!1,title:"导出字段：",style:{marginLeft:50,width:800}},f.a.createElement("div",{style:{marginLeft:70}},f.a.createElement(d.a.Group,{value:s.fields},A.map(function(e){return f.a.createElement(d.a,{onChange:function(t){W(e.name,t.target.checked)},style:{marginLeft:8},value:e.name},e.displayName)})),$.map(function(e){var t=e.parenField,n=e.fieldxs;return f.a.createElement(b.a,{style:{border:0},defaultActiveKey:s.collapseActiveKey},f.a.createElement(K,{header:"".concat(t.displayName,"(父项)"),key:t.displayName,style:z},f.a.createElement(d.a.Group,{value:s.fields,onChange:function(e){G(e,t.displayName)}},n.map(function(e){return f.a.createElement(d.a,{onChange:function(e){var t=e.target;W(t.value,t.checked)},value:"".concat(t.name,".").concat(e.name),style:{marginLeft:8}},"".concat(t.displayName,".").concat(e.displayName))}))))}),Y&&Y.map(function(e){var t=e.parenField,n=e.fieldxs,a=e.shildRefFiledsData;return f.a.createElement(b.a,{style:{border:0},defaultActiveKey:s.collapseActiveKey},f.a.createElement(K,{header:"".concat(t.displayName,"(子项)"),key:t.displayName,style:z},f.a.createElement(d.a.Group,{value:s.fields,onChange:function(e){G(e,t.displayName)}},n.map(function(e){return f.a.createElement(d.a,{onChange:function(e){var t=e.target;W(t.value,t.checked)},value:"".concat(t.name,".").concat(e.name),style:{marginLeft:8}},"".concat(t.displayName,".").concat(e.displayName))})),a&&a.map(function(e){var n=e.shildParenField,a=e.shildDieldxs;return f.a.createElement(b.a,{style:{border:0,marginLeft:20},defaultActiveKey:s.collapseActiveKey},f.a.createElement(K,{header:"".concat(t.displayName,".").concat(n.displayName,"(父项)"),key:"".concat(t.displayName,".").concat(n.displayName),style:z},f.a.createElement(d.a.Group,{value:s.fields,onChange:function(e){G(e,"".concat(t.displayName,".").concat(n.displayName))}},a.map(function(e){return f.a.createElement(d.a,{onChange:function(e){var t=e.target;W(t.value,t.checked)},value:"".concat(t.name,".").concat(n.name,".").concat(e.name),style:{marginLeft:8}},"".concat(t.displayName,".").concat(n.displayName,".").concat(e.displayName))}))))})))}))))),s,function(){m(n[t].exportable||w)},function(){return s.collapseActiveKey=k,m(s),!!Object(C.isEmpty)(s.fields)||!!s.name||(D("error"),g.a.error("请输入导出配置的名称"),!1)}]},D=(n("/zsF"),n("PArb")),j=(n("2qtc"),n("kLXV")),F=(n("nRaC"),n("5RzL")),k=n("RsOY"),N=n.n(k),x=n("4b23"),I=n.n(x),A=(n("OaEy"),n("2fM7")),P=(n("g9YV"),n("wCAj")),T=(n("Pwec"),n("CtXQ")),R=n("jehZ"),$=n.n(R),M=n("Y/ft"),V=n.n(M),L=n("jA2l"),Y=n("jkD3"),q=n("kvAW"),K=n("qJlv"),W=n("wiuW");n("SWtE");var G=function(e){var t=e.modelName,n=e.onChange,a=e.value,r=Object(m.O)(),l=Object(u.useState)([]),i=c()(l,2),o=i[0],s=i[1];return f.a.createElement(F.a,{treeExpandedKeys:o,onTreeExpand:s,treeDefaultExpandAll:!0,onChange:function(e){return n(e.map(function(e){return e.value}))},value:a&&a.map(function(e){return{label:(n=e,Object(m.l)(r,n,t).map(function(e){return e.displayName}).join(".")),value:e};var n}),showCheckedStrategy:F.a.SHOW_ALL,treeNodeLabelProp:"displayName",treeCheckable:!0,treeCheckStrictly:!0,style:{width:"100%"}},function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return r[t].fields.map(function(t){var a=t.ref,r=n.map(function(e){return e.name}).join("."),l=[].concat(E()(n),[t]),i=l.map(function(e){return e.name}).join("."),c=l.map(function(e){return e.displayName}).join(".");return f.a.createElement(F.a.TreeNode,{displayName:c,title:t.displayName,value:i,key:i},(!n.length||o.includes(r))&&a&&e(a,l))})}(t))},z=-1,B=-1;function H(e,t,n){var a=e;return n.forEach(function(e,n){n<t&&(a+=e)}),a}function U(e){var t=e.isOver,n=e.connectDragSource,a=e.connectDropTarget,r=(e.moveRow,V()(e,["isOver","connectDragSource","connectDropTarget","moveRow"])),l=i()({},r.style,{cursor:"move"}),o=r.className;return t&&((r.sectionindex>B||B===r.sectionindex&&r.index>z)&&(o+=" drop-item-over-downward"),(r.sectionindex<B||B===r.sectionindex&&r.index<z)&&(o+=" drop-item-over-upward")),n(a(f.a.createElement("tr",$()({},r,{className:o,style:l}))))}var J={beginDrag:function(e){return z=e.index,B=e.sectionindex,{index:e.index,sectionindex:e.sectionindex}}},Z={drop:function(e,t){var n=t.getItem(),a=n.index,r=n.sectionindex,l=e.index,i=e.sectionindex;r===i&&a===l||e.moveRow(a,l,r,i)}},Q=function(e){return Object(L.a)(e,Z,function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver()}})(Object(Y.a)(e,J,function(e){return{connectDragSource:e.dragSource()}})(U))},X=function(e){return Object(L.a)(e,{drop:function(e,t){var n=t.getItem(),a=n.index,r=n.sectionindex,l=e.sectionindex;r!==l&&e.addRow(a,r,l)}},function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver()}})(function(e){var t=e.connectDropTarget,n=e.isOver,a=e.sectionindex,r=n&&B!==a;return t(f.a.createElement("div",{style:{display:"flex",alignItems:"center",marginRight:18,color:"#1890ff"}},"加入本组: ",f.a.createElement(T.a,{type:r?"fullscreen-exit":"plus",style:{fontSize:20}})))})};function ee(e){var t=e.setData,n=e.allData,r=e.sections,l=e.addAndDeleteView,o=e.styleView,c=e.cardTitle,u=e.footer,s=e.columns,m=e.expandedRowRender,d=e.tableTitle,p=e.setSections,v=e.key,h=void 0===v?I()(5):v,g=e.sectionStyle,y=e.detailStyle,E=X(h),b={body:{row:Q(h)}};function C(e,a,l,i){var o=H(e,l,r),c=H(a,i,r),u=n[o];t(N()(n,{$splice:[[o,1],[c,0,u]]})),p&&l!==i&&p(N()(r,{$splice:[[l,1,r[l]-1],[i,1,r[i]+1]]}))}function O(e,a,l){var i=H(e,a,r),o=n[i];t(N()(n,{$splice:[[i,1],[H(0,l,r),0,o]]})),p(N()(r,{$splice:[[a,1,r[a]-1],[l,1,r[l]+1]]}))}return f.a.createElement(q.a,{backend:K.a},f.a.createElement(a.a,{title:c,bodyStyle:{padding:0},extra:o&&o()},r.map(function(t,o){var c,p,v,h,w,S=(v=o,h=0,w=0,r.forEach(function(e,t){t<v&&(h+=e),t===v&&(w=e)}),null===n||void 0===n?void 0:n.slice(h,h+w));return f.a.createElement(a.a,{title:d&&d(o),bodyStyle:{padding:0},extra:!!l&&f.a.createElement("div",{style:{display:"flex",alignItems:"center"}},_.isEmpty(S)&&!(g&&(null===(c=g[o])||void 0===c?void 0:c.widget)in W.c)&&f.a.createElement(E,{addRow:O,sectionindex:o}),l(o)),bordered:l,style:{marginBottom:14}},"default"!==y&&g&&(null===(p=g[o])||void 0===p?void 0:p.widget)in W.c||f.a.createElement(P.a,$()({},e,{dataSource:S,components:b,onRow:function(e,t){return{index:t,moveRow:C,sectionindex:o}},footer:function(){return u(o)},columns:function(e){return s.map(function(t){var n=i()({},t);if(n.render){var a=n.render;n.render=function(t,n,r){return a(t,n,r,e)}}return n})}(o),expandedRowRender:m&&function(e){return function(t,n,a,r){return m(t,n,a,r,e)}}(o)})))})))}function te(e){var t=e.onChange,n=e.value,a=e.layouts,r=void 0===a?{}:a;return f.a.createElement("div",null,"排列方式 :   ",f.a.createElement(p.a.Group,{value:n,onChange:function(e){return t(e.target.value)}},f.a.createElement(p.a,{value:"default"},"默认"),_.map(r,function(e,t){return f.a.createElement(p.a,{value:t},e)})))}function ne(e){var t=e.addSections,n=e.deleteSections,a=e.hiddenDelete,l=e.sectionindex;return f.a.createElement(f.a.Fragment,null,f.a.createElement(r.a,{icon:"plus",onClick:function(){return t(l)},style:{marginRight:10}},"添加一组"),!a&&f.a.createElement(r.a,{icon:"delete",onClick:function(){return n(l)}},"删除"))}function ae(e,t){return e.toLowerCase().includes(t.toLowerCase())}function re(e){var t=e.modelName,n=e.schemas,a=e.fieldDisabled,r=V()(e,["modelName","schemas","fieldDisabled"]),l=Object(u.useState)([]),i=c()(l,2),o=i[0],s=i[1],m=Object(u.useState)(!1),d=c()(m,2),p=d[0],h=d[1];var g=f.a.createElement(v.a.Item,{label:"选择字段",labelCol:{span:6},wrapperCol:{span:18}},f.a.createElement(G,{modelName:t,value:o,onChange:s})),y=f.a.createElement("div",null,f.a.createElement(v.a.Item,{label:"选择字段",labelCol:{span:6},wrapperCol:{span:18}},f.a.createElement(A.a,{mode:"multiple",defaultValue:[],value:o,onChange:s,style:{minWidth:160},filterOption:function(e,t){var n=t.props,a=n.value,r=n.children;return ae(a,e)||ae(r,e)}},n[t].fields.map(function(e){return f.a.createElement(A.a.Option,{value:e.name,key:e.name,disabled:a&&a(e)},e.displayName)})))),E=r.expand;return[f.a.createElement(j.a,{title:"添加字段",visible:p,onOk:function(){h(!1),r.onOk&&r.onOk()},onCancel:function(){return h(!1)},afterClose:function(){h(!1),s([])},okText:"确认",cancelText:"取消"},E?g:y),o,function(){h(!0)}]}var le=function(e){var t=e.sections,n=void 0===t?[{}]:t,a=e.setData,r=e.columns,l=e.footer,i=e.expandedRowRender,o=e.hiddenAdd,c=void 0!==o&&o,u=e.addAndDeleteView,s=e.styleView,m=e.title,d=e.modalView,p=e.allData,v=e.tableTitle,h=e.setSections,g=e.sectionStyle,y=e.style;return[f.a.createElement("div",null,d,f.a.createElement(ee,{modalView:d,columns:r,expandedRowRender:i,sections:n,allData:p,setData:a,size:"middle",bordered:!0,pagination:!1,footer:l,styleView:s,addAndDeleteView:u,hiddenAdd:c,cardTitle:m,tableTitle:v,setSections:h,sectionStyle:g,detailStyle:y})),n]},ie=n("MU2A"),oe=n("HP82"),ce=n("8YRU");var ue=function(e){var t=e.groupsValue,n=e.groupsOnChange,a=e.userValue,r=e.userOnChange,l=e.staffModelFields,i=e.staffModel,o=e.defauldGroupValue,c=void 0===o?{}:o;return Object(u.useEffect)(function(){O.a.isEmpty(c.groups)||Object(oe.queryContent)({model:"auth__group",filters:[{field:"id",operator:"in",value:c.groups}]}).then(function(e){var t=e.list;n(t)})},[]),f.a.createElement(f.a.Fragment,null,f.a.createElement(v.a.Item,{label:"仅指定角色可见"},f.a.createElement(ce.a,{value:t,field:{displayName:"角色",name:"group",ref:"auth__group",refField:"permissions",refTo:"id",required:!1,type:"mref"},onChange:n})),!O.a.isEmpty(l)&&i&&f.a.createElement(v.a.Item,{label:"该字段值为当前用户时可见"},f.a.createElement(A.a,{style:{width:"100%"},placeholder:"未选择",value:a,onChange:r},l.map(function(e){return f.a.createElement(A.a.Option,{key:e.name},e.displayName)}))))},fe=n("U/ol"),se=n.n(fe),me=function(e){return e.name?e:{name:e}};function de(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{id:0},a=n.id,r=n.title,l=void 0===r?"":r,i=[];return t[e].fields.forEach(function(e){if("bref"!==e.type){var t=a?"".concat(a,".").concat(e.name):e.name,n={id:t,pId:a,value:t,title:"".concat(l?"".concat(l,"."):"").concat(e.displayName)};e.ref&&(n.fieldRef=e.ref),i.push(n)}}),i}var pe,ve=function(e){var t=e.modelName,n=e.adminConfig,a=e.schemas,l=e.bsmSetting,o=Object(u.useState)([]),s=c()(o,2),m=s[0],d=s[1],p=Object(u.useState)(!1),h=c()(p,2),g=h[0],y=h[1],b=Object(u.useState)([]),C=c()(b,2),w=C[0],S=C[1],D=function(e){var t=e.modelName,n=e.schemas,a=e.adminConfig,r=e.bsmSetting.staff_model,l=Object(u.useState)(function(){var e;return(null===(e=a[t].filter)||void 0===e?void 0:e.map(me))||[]}),o=c()(l,2),s=o[0],m=o[1],d=Object(u.useState)([]),p=c()(d,2),h=p[0],g=p[1];return Object(u.useEffect)(function(){if(r){var e=[];n[t].fields.forEach(function(t){t.ref===r&&e.push(t)}),g(e)}},[]),[function(e){var n,l;if(void 0===e)return null;var i=s[e];return f.a.createElement(v.a,{labelCol:{span:6},wrapperCol:{span:8}},f.a.createElement("div",{className:se.a.divider,style:{marginBottom:16}},"权限设置"),f.a.createElement(ue,{groupsValue:null!==(n=null===(l=i.groups)||void 0===l?void 0:l.filter(function(e){return!("number"==typeof e)}))&&void 0!==n?n:[],groupsOnChange:function(t){var n=O.a.cloneDeep(s);n[e].groups=t,m(E()(n))},userValue:i.userField,userOnChange:function(t){var n=O.a.cloneDeep(s);n[e].userField=t,m(E()(n))},staffModelFields:h,staffModel:r,defauldGroupValue:a[t].filter[e]}))},s,function(){return m(a[t].filter)},function(){return O.a.cloneDeep(s).map(function(e){var t=i()({},e);return O.a.isEmpty(e.groups)||(t.groups=t.groups.filter(function(e){return e}).map(function(e){return e.id||e})),e.id||(t.id=I()(6)),t})},{handleTitleChange:function(e,t){var n=O.a.cloneDeep(s);n[e].name=t,m(n)},handleAdd:function(){m([].concat(E()(s),[{}]))},setFilters:m}]}({modelName:t,schemas:a,adminConfig:n,bsmSetting:l}),_=c()(D,5),k=_[0],x=_[1],A=_[2],P=_[3],T=_[4].setFilters,R=le({allData:x,setData:T,title:"筛选字段",sections:[x.length||0],columns:[{title:"字段",key:"name",render:function(e,n,a){return f.a.createElement(ie.a,{value:e.name||e,onChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,t){T(N()(x,{$splice:[[e,1,{name:t}]]}))}.apply(void 0,[a].concat(t))},model:t,layer:2})}},{title:"操作",key:"operation",render:function(e,t,n){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return e=n,(t=E()(x)).splice(e,1),void T(t);var e,t}},"删除"))}}],footer:function(){return f.a.createElement("div",null,f.a.createElement(r.a,{onClick:function(){return y(!0)}},"添加字段"))},expandedRowRender:function(e,t){return k(t)}}),$=c()(R,1)[0];Object(u.useEffect)(function(){var e=de(t,a);e.forEach(function(t){t.fieldRef&&e.push.apply(e,E()(de(t.fieldRef,a,t)))}),d(e)},[]);var M=f.a.createElement(F.a,{treeDataSimpleMode:!0,style:{width:"100%"},value:w,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"请选择",onChange:S,multiple:!0,treeData:m.map(function(e){return N()(e,{disabled:{$set:x.some(function(t){return t.name===e.value})}})}),filterTreeNode:function(e,t){var n=t.props;return["title","value"].some(function(t){return n[t].toLowerCase().includes(e.toLowerCase())})}});return[f.a.createElement(f.a.Fragment,null,f.a.createElement(j.a,{title:"添加字段",visible:g,onOk:function(){var e;e=w,T([].concat(E()(x),E()(e.map(me)))),y(!1)},onCancel:function(){return y(!1)},afterClose:function(){y(!1),S([])},okText:"确认",cancelText:"取消"},M),$),x,A,P]},he=n("eHn4"),ge=n.n(he),ye=(n("+BJd"),n("mr32")),Ee=(n("BoS7"),n("Sdc0")),be=n("VW+w"),Ce=n("Wd+Q"),Oe=(n("fscj"),[{label:"magenta",value:"magenta"},{label:"red",value:"red"},{label:"orange",value:"orange"},{label:"gold",value:"gold"},{label:"lime",value:"lime"},{label:"green",value:"green"},{label:"cyan",value:"cyan"},{label:"blue",value:"blue"},{label:"purple",value:"purple"}]),we=[{label:"YYYY-MM-DD HH:mm:ss",value:"YYYY-MM-DD HH:mm:ss"},{label:"YYYY年MM月DD日",value:"YYYY年MM月DD日"},{label:"YYYY/MM/DD",value:"YYYY/MM/DD"}],Se=[{label:"longText",value:"长文本"},{label:"richText",value:"富文本"},{label:"jsonText",value:"JSON"}],De={labelCol:{span:4},wrapperCol:{span:10}};function je(e){var t=e;return t.params||(t.params={}),"tag"!==t.widget||t.params.tagSetting||(t.params.tagSetting={}),t}function _e(e){var t=e.modelName,n=e.adminConfig,a=e.schemas,r=e.bsmSetting.staff_model,l=n[t].display.map(je),o=Object(u.useState)(l),s=c()(o,2),m=s[0],d=s[1],p=Object(u.useState)([]),g=c()(p,2),y=g[0],b=g[1],C=Object(u.useState)(n[t].sortable?n[t].sortable:[]),O=c()(C,2),w=O[0],S=O[1],D=Object(Ce.d)(),j=Object(Ce.e)();function F(e,t){var n=_.cloneDeep(m);return t?n[e].alias=t:delete n[e].alias,d(n),n}Object(u.useEffect)(function(){if(r){var e=[];a[t].fields.forEach(function(t){t.ref===r&&e.push(t)}),b(e)}},[]);return[function(e){var l,i,o,u,s,p;if(void 0===e)return null;var g,b=m[e],C=a[t].fields.find(function(e){var t;return e.name===b.name||e.name===(null===(t=b.fields)||void 0===t?void 0:t.value)});C&&(g=_.isArray(D[C.type]));var O=[];C&&D[C.type]&&(O=g?D[C.type]:D[C.type].split(","));var k=b.name,N=b.type;"combo"===N&&(O=Ce.a);var x=[];return"mref"===(null===C||void 0===C?void 0:C.type)&&a[C.ref].fields.forEach(function(e){["string","image","file"].includes(e.type)&&x.push({label:e.name,value:e.displayName})}),f.a.createElement(v.a,$()({},De,{name:"basic"}),f.a.createElement(v.a.Item,{label:"列名"},f.a.createElement(h.a,{allowClear:!0,value:b.alias,placeholder:b.name&&Object(be.b)([_.cloneDeep(b)],t,a)[0].alias,onChange:function(t){return F(e,t.target.value)}})),!N&&f.a.createElement(v.a.Item,{label:"开启排序"},f.a.createElement(Ee.a,{defaultChecked:!1,checked:w.includes(k),onChange:function(e){var t=_.cloneDeep(w);if(!0===e)t.push(k),S(t);else{var n=t.filter(function(e){return e!==k});S(n)}}})),"combo"!==N&&!_.isEmpty(O)&&f.a.createElement(v.a.Item,{label:"选择组件"},f.a.createElement(A.a,{showSearch:!0,style:{width:200},placeholder:"请选择要显示的组件",optionFilterProp:"children",value:b.widget?b.widget:null,onChange:function(n){return function(e,n){var r=_.cloneDeep(m),l=r[n];if(l.params={},l.name){var i=a[t].fields.find(function(e){return e.name===l.name});"tag"===e&&(l.params.tagSetting={}),"timeStamp"===e&&(l.params.timeFormat=we[0].value),l.fields={value:i.name}}l.widget=e,d(r)}(n,e)}},!C||_.uniq(O.concat(C.choices?["tag"]:[])).map(function(e){return f.a.createElement(A.a.Option,{value:e},j[e]||e)}))),"combo"===N&&!_.isEmpty(O)&&f.a.createElement(v.a.Item,{label:"选择模板组件"},f.a.createElement(A.a,{showSearch:!0,style:{width:200},placeholder:"请选择要显示的组件",optionFilterProp:"children",value:b.widget?b.widget:null,onChange:function(t){var n=_.cloneDeep(m),a=n[e];a.params={},a.widget=t,d(n)}},C||_.uniq(O).map(function(e){return f.a.createElement(A.a.Option,{value:e},j[e]||e)}))),b.widget&&"timeStamp"===b.widget&&f.a.createElement(v.a.Item,{label:"配置时间格式"},f.a.createElement("div",{onMouseDown:function(e){return e.preventDefault(),!1}},f.a.createElement(A.a,{style:{width:240},placeholder:"请配置时间格式",value:b.params.timeFormat,onChange:function(t){var n=_.cloneDeep(m);n[e].params.timeFormat=t,d(n)}},we.map(function(e){return f.a.createElement(A.a.Option,{value:e.value},e.label)})))),b.widget&&"timeStamp"===b.widget&&f.a.createElement(v.a.Item,{label:"自定义时间格式"},f.a.createElement(h.a,{style:{flex:"auto",width:"50%"},value:b.params.customFormat,onChange:function(t){var n=_.cloneDeep(m);n[e].params.customFormat=t.target.value,d(n)}})),b.widget&&"tag"===b.widget&&f.a.createElement(v.a.Item,{label:"配置颜色"},C.choices.map(function(t){var n=c()(t,2),a=n[0],r=n[1],l=b.params.tagSetting[a];return f.a.createElement("div",null,f.a.createElement(ye.a,{color:l},r),f.a.createElement(A.a,{showSearch:!0,style:{width:200},placeholder:"请配置颜色",value:l,onChange:function(t){var n=_.cloneDeep(m);n[e].params.tagSetting[a]=t,d(n)}},Oe.map(function(e){return f.a.createElement(A.a.Option,{className:"tagSetting".concat(e.value),value:e.value},e.label)})))})),b.widget&&"longtext"===b.widget&&f.a.createElement(v.a.Item,{label:"配置字段类型"},f.a.createElement("div",{onMouseDown:function(e){return e.preventDefault(),!1}},f.a.createElement(A.a,{style:{width:240},placeholder:"请配置字段类型",value:b.params.textType?Se.filter(function(e){return e.label===b.params.textType}).map(function(e){return e.label}):null,onChange:function(t){var n=_.cloneDeep(m);n[e].params.textType=t,d(n)}},Se.map(function(e){return f.a.createElement(A.a.Option,{value:e.label},e.value)})))),b.widget&&"textimg"===b.widget&&f.a.createElement(f.a.Fragment,null,f.a.createElement(v.a.Item,{label:"标题字段"},f.a.createElement(A.a,{style:{width:240},placeholder:"请配置标题字段",value:null===(l=b.fields)||void 0===l?void 0:l.title,onChange:function(t){if(t){var n=_.cloneDeep(m);n[e].fields.title=t,d(n)}}},a[t].fields.map(function(e){return f.a.createElement(A.a.Option,{value:e.name}," ",e.displayName)}))),f.a.createElement(v.a.Item,{label:"图片字段"},f.a.createElement(A.a,{style:{width:240},placeholder:"请配置图片字段",value:null===(i=b.fields)||void 0===i?void 0:i.avatar,onChange:function(t){if(t){var n=_.cloneDeep(m);n[e].fields.avatar=t,d(n)}}},a[t].fields.map(function(e){return f.a.createElement(A.a.Option,{value:e.name}," ",e.displayName)}))),f.a.createElement(v.a.Item,{label:"内容字段"},f.a.createElement(A.a,{style:{width:240},placeholder:"请配置内容字段",value:null===(o=b.fields)||void 0===o?void 0:o.text,onChange:function(t){if(t){var n=_.cloneDeep(m);n[e].fields.text=t,d(n)}}},a[t].fields.map(function(e){return f.a.createElement(A.a.Option,{value:e.name}," ",e.displayName)})))),b.widget&&"urlImg"===b.widget&&"mref"===C.type&&f.a.createElement(v.a.Item,{label:"图片字段",help:"该字段存储图片的URL"},f.a.createElement("div",{onMouseDown:function(e){return e.preventDefault(),!1}},f.a.createElement(A.a,{style:{width:240},placeholder:"请配置图片字段",value:null===(u=b.params)||void 0===u?void 0:u.urlImgName,onChange:function(t){var n=_.cloneDeep(m);n[e].params.urlImgName=t,d(n)}},x.map(function(e){return f.a.createElement(A.a.Option,{value:e.label},e.value)})))),f.a.createElement("div",{className:se.a.divider,style:{marginBottom:16}},"权限设置"),f.a.createElement(ue,{groupsValue:null!==(s=null===(p=b.groups)||void 0===p?void 0:p.filter(function(e){return!("number"==typeof e)}))&&void 0!==s?s:[],groupsOnChange:function(t){var n=_.cloneDeep(m);n[e].groups=t,d(E()(n))},userValue:b.userField,userOnChange:function(t){var n=_.cloneDeep(m);n[e].userField=t,d(E()(n))},staffModelFields:y,staffModel:r,defauldGroupValue:n[t].display[e]}))},m,function(){d(n[t].display)},w,function(){return _.cloneDeep(m).map(function(e){var t=i()({},e);return _.isEmpty(e.groups)||(t.groups=t.groups.filter(function(e){return e}).map(function(e){return e.id||e})),e.id||(t.id=I()(6)),t})},{handleFieldChange:function(e,t){var n=_.cloneDeep(m);n[e]={name:t},d(n)},handleAliasChange:F,handleFieldDelete:function(e){var t=_.cloneDeep(m);t.splice(e,1),d(t)},handleFieldAdd:function(){var e=[].concat(E()(m),[{params:{}}]);return d(e),e},setDisplay:d,handletemp:function(){d([].concat(E()(m),[{type:"combo",fields:{},params:{}}]))}}]}var Fe,ke=(pe={},ge()(pe,"v1",function(e){var t=e.modelName,n=e.adminConfig,a=e.schemas,l=e.bsmSetting,i=Object(u.useState)(!1),o=c()(i,2),s=o[0],m=o[1],d=Object(u.useState)(0),p=c()(d,2),v=p[0],g=p[1],y=_e({modelName:t,adminConfig:n,schemas:a,FieldIndex:v,bsmSetting:l}),E=c()(y,6),b=E[0],C=E[1],O=E[2],w=E[3],S=E[4],F=E[5],k=F.handleFieldChange,N=F.handleAliasChange,x=F.handleFieldDelete,I=F.handleFieldAdd,A=F.setDisplay,T=F.handletemp;return[f.a.createElement(f.a.Fragment,null,f.a.createElement(j.a,{title:f.a.createElement("span",null,!C[v]||C[v].name,"字段配置"),width:"60%",visible:s,closable:!0,onOk:function(){return m(!1)},onCancel:function(){return m(!1)}},b(v)),f.a.createElement(P.a,{dataSource:C,size:"middle",bordered:!0,pagination:!1,columns:[{title:"字段",key:"name",render:function(e,n,a){return f.a.createElement(ie.a,{value:e.name,onChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.apply(void 0,[a].concat(t))},model:t,disabled:"combo"===e.type})}},{title:"列名",key:"alias",render:function(e,n,r){return f.a.createElement(h.a,{allowClear:!0,value:e.alias,placeholder:e.name&&Object(be.b)([_.cloneDeep(e)],t,a)[0].alias,onChange:function(e){return N(r,e.target.value)}})}},{title:"操作",key:"operation",render:function(e,t,n){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return g(n),m(!0),void(C[v].inplaceEdit||(C[v].inplaceEdit=!1))}},"更多"),f.a.createElement(D.a,{type:"vertical"}),f.a.createElement("a",{onClick:function(){return x(n)}},"删除"),n>0&&f.a.createElement(f.a.Fragment,null,f.a.createElement(D.a,{type:"vertical"}),f.a.createElement("a",{onClick:function(){return e=n,t=_.cloneDeep(C),a=e-1,r=[t[e],t[a]],t[a]=r[0],t[e]=r[1],void A(t);var e,t,a,r}},"上移")),n<C.length-1&&f.a.createElement(f.a.Fragment,null,f.a.createElement(D.a,{type:"vertical"}),f.a.createElement("a",{onClick:function(){return e=n,t=_.cloneDeep(C),a=e+1,r=[t[e],t[a]],t[a]=r[0],t[e]=r[1],void A(t);var e,t,a,r}},"下移")))}}],footer:function(){return f.a.createElement("div",null,f.a.createElement(r.a,{onClick:I},"添加一列"),f.a.createElement(r.a,{style:{margin:5},onClick:T},"添加组合字段"))}})),C,O,w,S]}),ge()(pe,"v2",function(e){var t=e.modelName,n=e.adminConfig,a=e.schemas,l=e.bsmSetting,i=_e({modelName:t,adminConfig:n,schemas:a,bsmSetting:l}),o=c()(i,6),u=o[0],s=o[1],m=o[2],d=o[3],p=o[4],v=o[5],h=v.handleFieldChange,g=v.handleFieldDelete,y=v.handleFieldAdd,E=v.setDisplay,b=v.handletemp,C=le({allData:s,setData:E,title:"列表字段",sections:[s.length||0],setSections:function(e){E(e[0].fields)},columns:[{title:"字段",key:"name",render:function(e,n,a){return f.a.createElement(ie.a,{value:e.name,onChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return h.apply(void 0,[a].concat(t))},model:t,disabled:"combo"===e.type})}},{title:"操作",key:"operation",render:function(e,t,n){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return g(n)}},"删除"))}}],footer:function(){return f.a.createElement("div",null,f.a.createElement(r.a,{onClick:y},"添加一列"),f.a.createElement(r.a,{style:{margin:5},onClick:b},"添加组合字段"))},expandedRowRender:function(e,t){return u(t)}});return[c()(C,1)[0],s,m,d,p]}),pe).v2,Ne=(n("Znn+"),n("ZTPi")),xe=n("556t"),Ie=n("O/S9"),Ae=n("9Ndd"),Pe=["ref","mref","bref"];function Te(e){var t={action:e,title:xe.a[e],params:{},showIf:[],groups:[],id:I()(6)};return["partEdit","nowEdit"].includes(e)&&(t.params.fields=[]),"partEdit"===e&&(t.params.editFields=[]),["refEdit","refDetail"].includes(e)&&(t.showInModal=!0),t}function Re(e){var t=e.modelName,n=e.schemas,a=e.adminConfig,l=e.bsmSetting.staff_model,o=Object(u.useState)(a[t].inlineActions),s=c()(o,2),m=s[0],d=s[1],p=Object(u.useState)([]),g=c()(p,2),y=g[0],b=g[1];function C(e,t){var n=_.cloneDeep(m);n[e].title=t,d(n)}function O(e,t,n){var a=_.cloneDeep(m);a[e].params[t]=n,d(a)}return Object(u.useEffect)(function(){var e=_.cloneDeep(a[t].inlineActions);if(e.forEach(function(e){_.isObject(e.showIf)&&!_.isArray(e.showIf)&&(e.showIf=[e.showIf])}),l){var r=[];n[t].fields.forEach(function(e){e.ref===l&&r.push(e)}),b(r)}var i=new Set;(a[t].inlineActions||[]).forEach(function(e){_.isEmpty(e.groups)||e.groups.forEach(function(e){return i.add(e)})}),d(e)},[]),[function(e){var i,o;if(void 0===e)return null;var c=m[e];return f.a.createElement(v.a,{labelCol:{span:6},wrapperCol:{span:8}},f.a.createElement(v.a.Item,{label:"操作类型"},f.a.createElement(A.a,{value:c.action,onChange:function(t){return function(e,t){var n=_.cloneDeep(m);n[e]=Te(t),d(n)}(e,t)}},_.map(xe.a,function(e,t){return f.a.createElement(A.a.Option,{value:t},e)}))),f.a.createElement(v.a.Item,{label:"操作名称"},f.a.createElement(h.a,{value:c.title,onChange:function(t){return C(e,t.target.value)}})),"action"===c.action&&f.a.createElement(f.a.Fragment,null,f.a.createElement(v.a.Item,{label:"函数名"},f.a.createElement(h.a,{value:c.params.action,onChange:function(t){return O(e,"action",t.target.value)}})),f.a.createElement(v.a.Item,{label:"请求体"},f.a.createElement(h.a.TextArea,{defaultValue:JSON.stringify(c.params.payload),autosize:{minRows:5},onChange:function(t){try{O(e,"payload",JSON.parse(t.target.value))}catch(e){}}}))),"info"===c.action&&f.a.createElement(f.a.Fragment,null,f.a.createElement(v.a.Item,{label:"标题"},f.a.createElement(h.a,{value:c.params.title,onChange:function(t){return O(e,"title",t.target.value)}})),f.a.createElement(v.a.Item,{label:"正文"},f.a.createElement(h.a,{value:c.params.content,onChange:function(t){return O(e,"content",t.target.value)}}))),"link"===c.action&&f.a.createElement(f.a.Fragment,null,f.a.createElement(v.a.Item,{label:"网址"},f.a.createElement(h.a,{value:c.params.link,onChange:function(t){return O(e,"link",t.target.value)}}))),xe.b.includes(c.action)&&f.a.createElement(f.a.Fragment,null,f.a.createElement(v.a.Item,{label:"关联字段"},f.a.createElement(ie.a,{value:c.params.field||c.field,onChange:function(t){var n=_.cloneDeep(m);n[e].params.field=t,d(n)},layer:1,fieldFilter:function(e){return"refAdd"===c.action?["mref","bref"].includes(e.type):"ref"===e.type},model:t})),"refAdd"!==c.action&&f.a.createElement(v.a.Item,{label:"弹窗显示"},f.a.createElement(Ee.a,{checked:c.showInModal,onChange:function(t){var n=_.cloneDeep(m);n[e].showInModal=t,d(n)}}))),["partEdit","nowEdit"].includes(c.action)&&f.a.createElement(f.a.Fragment,null,"partEdit"===c.action&&f.a.createElement(v.a.Item,{label:"可编辑字段"},f.a.createElement(A.a,{mode:"multiple",style:{width:"100%"},placeholder:"请添加可编辑字段",value:c.params.editFields,onChange:function(t){var n=_.cloneDeep(m);n[e].params.editFields=t,d(E()(n))}},n[t].fields.map(function(e){return f.a.createElement(A.a.Option,{key:e.name},e.displayName)}))),f.a.createElement(v.a.Item,{label:"设置属性值",wrapperCol:{span:10}},f.a.createElement("div",null,(c.params.fields||[]).map(function(a,r){var l=Ae.a.TextInput,i={};if(a.name){var o=n[t].fields.find(function(e){return e.name===a.name});if(!o)return null;i.field=o,l=Ae.a[Ae.d[o.type]]}return f.a.createElement("div",{style:{display:"flex"}},f.a.createElement("div",{style:{marginRight:8}},f.a.createElement(ie.a,{value:a.name,onChange:function(t){var n=_.cloneDeep(m);n[e].params.fields[r].name=t,n[e].params.fields[r].value=void 0,d(n)},fieldDisable:function(e){return c.params.fields.map(function(e){return e.name}).includes(e.name)},fieldFilter:function(e){return!Pe.includes(e.type)&&!e.primaryKey},model:t})),f.a.createElement("div",{style:{marginRight:8}},f.a.createElement(l,$()({value:a.value,onChange:function(t){var n=_.cloneDeep(m);n[e].params.fields[r].value=t,d(n)}},i))),f.a.createElement("div",null,f.a.createElement("a",{onClick:function(){var t=_.cloneDeep(m);t[e].params.fields=t[e].params.fields.filter(function(e,t){return t!==r}),d(t)},style:{marginLeft:8}},f.a.createElement(T.a,{type:"delete",style:{fontSize:20}}))))})),f.a.createElement("div",null,f.a.createElement(r.a,{type:"dashed",style:{width:"100%"},onClick:function(){var t=_.cloneDeep(m);t[e].params.fields.push({}),d(t)}},f.a.createElement(T.a,{type:"plus"}))))),f.a.createElement("div",{className:se.a.divider,style:{marginBottom:16}},"权限设置"),f.a.createElement(ue,{groupsValue:null!==(i=null===(o=c.groups)||void 0===o?void 0:o.filter(function(e){return!("number"==typeof e)}))&&void 0!==i?i:[],groupsOnChange:function(t){var n=_.cloneDeep(m);n[e].groups=t,d(E()(n))},userValue:c.userField,userOnChange:function(t){var n=_.cloneDeep(m);n[e].userField=t,d(E()(n))},staffModelFields:y,staffModel:l,defauldGroupValue:a[t].inlineActions[e]}),f.a.createElement(v.a.Item,{label:"满足条件显示",wrapperCol:{span:15}},f.a.createElement("div",null,f.a.createElement(Ie.a,{fields:n[t].fields,value:c.showIf||[],onChange:function(t){var n=_.cloneDeep(m);n[e].showIf=t,d(n)},disabledField:function(e){return c.showIf.map(function(e){return e.field}).filter(function(e){return e}).includes(e.name)}}))))},m,function(){d(a[t].inlineActions)},function(){return _.cloneDeep(m).filter(function(e){var t=!!e.action;return xe.b.includes(e.action)&&(t=t&&!(!e.params.field&&!e.field)),t}).map(function(e){var t,n,a=i()({},e);return["partEdit","nowEdit"].includes(e.action)&&(a.params.fields=null===(t=a.params.fields)||void 0===t?void 0:t.filter(function(e){return e.name&&void 0!==e.value}),a.showIf=null===(n=a.showIf)||void 0===n?void 0:n.filter(function(e){return e.field&&e.operator&&void 0!==e.value})),_.isEmpty(e.groups)||(a.groups=a.groups.filter(function(e){return e}).map(function(e){return e.id||e})),e.id||(a.id=I()(6)),a})},{handleParamsChange:O,handleTitleChange:C,handleDelete:function(e){var t=_.cloneDeep(m);t.splice(e,1),d(t)},handleAdd:function(){d([].concat(E()(m),[{}]))},setInlineActions:d,addActions:function(e){var t=e.map(Te);d([].concat(E()(m),E()(t)))}}]}var $e=(Fe={},ge()(Fe,"v1",function(e){var t=e.modelName,n=e.schemas,r=e.adminConfig,l=e.bsmSetting,i=Object(u.useState)(String(0)),o=c()(i,2),s=o[0],m=o[1],d=Re({modelName:t,schemas:n,adminConfig:r,bsmSetting:l}),p=c()(d,5),v=p[0],h=p[1],g=p[2],y=p[3],E=p[4],b=E.handleAdd,C=E.handleDelete;return[f.a.createElement(a.a,{title:"操作项",type:"inner"},f.a.createElement(Ne.a,{tabBarStyle:{minWidth:48},activeKey:s,tabPosition:"left",type:"editable-card",onChange:m,onEdit:function(e,t){switch(t){case"add":b();break;case"remove":C(e)}}},h.map(function(e,t){return f.a.createElement(Ne.a.TabPane,{tab:e.title,key:t},v(t))}))),h,g,y]}),ge()(Fe,"v2",function(e){var t=e.modelName,n=e.adminConfig,a=Re({modelName:t,schemas:e.schemas,adminConfig:n,bsmSetting:e.bsmSetting}),l=c()(a,5),i=l[0],o=l[1],s=l[2],m=l[3],d=l[4],p=Object(u.useState)([]),h=c()(p,2),g=h[0],y=h[1],E=Object(u.useState)(!1),b=c()(E,2),C=b[0],O=b[1],w=d.addActions,S=d.handleDelete,D=d.setInlineActions,_=le({allData:o,setData:D,sections:[o.length||0],title:"操作项",setSections:function(e){D(e[0].fields)},columns:[{title:"操作项",key:"name",render:function(e){return e.title||xe.a[e.action]}},{title:"操作",key:"operation",render:function(e,t,n){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return S(n)}},"删除"))}}],footer:function(){return f.a.createElement(r.a,{onClick:function(){return O(!0)}},"添加操作项")},expandedRowRender:function(e,t){return i(t)}}),F=c()(_,1)[0],k=f.a.createElement("div",null,f.a.createElement(v.a.Item,{label:"选择类型",labelCol:{span:6},wrapperCol:{span:18}},f.a.createElement(A.a,{mode:"multiple",defaultValue:[],value:g,onChange:y,style:{minWidth:160}},Object.keys(xe.a).map(function(e,t){return f.a.createElement(A.a.Option,{value:e,key:"".concat(e,"__").concat(t+1)},xe.a[e])}))));return[f.a.createElement(f.a.Fragment,null,f.a.createElement(j.a,{title:"添加操作项",visible:C,onOk:function(){w(g),O(!1)},onCancel:function(){return O(!1)},afterClose:function(){O(!1),y([])},okText:"确认",cancelText:"取消"},k),F),o,s,m]}),Fe).v2,Me=n("EBSl"),Ve=n("xNPh");var Le,Ye=Object(s.connect)(function(e){return{schemas:e.content.schemas}})(function(e){var t=e.schemas,n=e.model,a=e.onChange,l=e.fieldFilter,i=e.value,o=void 0===i?[]:i;if(!O.a.isArray(o))return null;var c=Ae.a.TextInput,u={};return f.a.createElement(f.a.Fragment,null,o.map(function(e,r){if(e.name){var i=t[n].fields.find(function(t){return t.name===e.name});c=Ae.a[Ae.d[i.type]]}return f.a.createElement("div",null,f.a.createElement("div",{style:{display:"flex"}},f.a.createElement("div",{style:{marginRight:8}},f.a.createElement(ie.a,{value:e.name,fieldFilter:l,onChange:function(e){var t=O.a.cloneDeep(o);t[r].name=e,t[r].value&&(t[r].value=void 0),a(t)},model:n})),f.a.createElement("div",{style:{marginRight:8}},f.a.createElement(c,$()({onChange:function(e){var t=O.a.cloneDeep(o);t[r].value=e,a(t)},value:e.value},u))),f.a.createElement("a",{onClick:function(){return function(e){var t=O.a.cloneDeep(o);t.splice(e,1),a(t)}(r)},style:{marginLeft:8}},f.a.createElement(T.a,{type:"delete",style:{fontSize:20}}))))}),f.a.createElement(r.a,{type:"dashed",style:{width:354},onClick:function(){var e=O.a.cloneDeep(o);e.push({}),a(e)}},f.a.createElement(T.a,{type:"plus"})))}),qe="Form_winght_new",Ke=["choices","default","displayName","editable","help","maxDigits","maxLength","name","precision","primaryKey","readonly","ref","refField","refTo","required","type","validators"],We=Object(Ve.a)();function Ge(e){return O.a.pick(e,Ke)}function ze(e){var t=e.paramsDef,n=void 0===t?[]:t,a=e.onChange,r=e.model,l=e.values,o=ge()({},qe,{fields:n.map(Ge)}),c=ge()({},qe,{formFields:n.map(function(e){return function(e,t){var n=t.model,a=t.values,r=i()({},O.a.omit(e,Ke),{name:e.name}),l=r.params;return l&&"function"==typeof l&&(r.params=l({model:n,values:a})),r}(e,{model:r,values:l})})});return f.a.createElement(We,{hideCard:!0,model:qe,schemas:o,admins:c,showButtons:!1,object:l,onValuesChange:a})}Object(Ae.e)("FieldsSet",Ye,"字段配置器");var Be=Me.a.ACTION_TYPE_BATCH;function He(e){return{action:e,name:Be[e].name,params:{},groups:[]}}function Ue(e){var t=e.modelName,n=e.schemas,a=e.adminConfig,r=e.bsmSetting.staff_model,l=Object(u.useState)(a[t].actions),o=c()(l,2),s=o[0],m=void 0===s?[]:s,d=o[1],p=Object(u.useState)([]),g=c()(p,2),y=g[0],b=g[1];function C(e,t){var n=O.a.cloneDeep(m);n[e].name=t,d(n)}Object(u.useEffect)(function(){if(r){var e=[];n[t].fields.forEach(function(t){t.ref===r&&e.push(t)}),b(e)}},[]);return[function(e){var n,l,i;if(void 0===e)return null;var o=m[e];return f.a.createElement(v.a,{labelCol:{span:6},wrapperCol:{span:8}},f.a.createElement(v.a.Item,{label:"批量操作类型"},f.a.createElement(A.a,{value:o.action,onChange:function(t){return function(e,t){var n=O.a.cloneDeep(m);n[e].action=t,n[e].name=Be[t].name,n[e].params={},d(n)}(e,t)}},Object.keys(Be).map(function(e){return f.a.createElement(A.a.Option,{value:e},Be[e].name)}))),f.a.createElement(v.a.Item,{label:"批量操作名称"},f.a.createElement(h.a,{value:o.name,onChange:function(t){return C(e,t.target.value)}})),f.a.createElement(ze,{paramsDef:Be[o.action].paramsDef,model:t,values:o.params,onChange:function(t,n){var a=E()(m);a[e].params[t]=n,d(a)}}),f.a.createElement("div",{className:se.a.divider,style:{marginBottom:16}},"权限设置"),f.a.createElement(ue,{groupsValue:null!==(n=null===(l=o.groups)||void 0===l?void 0:l.filter(function(e){return!("number"==typeof e)}))&&void 0!==n?n:[],groupsOnChange:function(t){var n=O.a.cloneDeep(m);n[e].groups=t,d(E()(n))},userValue:o.userField,userOnChange:function(t){var n=O.a.cloneDeep(m);n[e].userField=t,d(E()(n))},staffModelFields:y,staffModel:r,defauldGroupValue:null===(i=a[t].actions)||void 0===i?void 0:i[e]}))},m,function(){d(a[t].actions)},function(){return O.a.cloneDeep(m).map(function(e){var t=i()({},e);return O.a.isEmpty(e.groups)||(t.groups=t.groups.filter(function(e){return e}).map(function(e){return e.id||e})),e.id||(t.id=I()(6)),t})},{handleTitleChange:C,handleDelete:function(e){var t=O.a.cloneDeep(m);t.splice(e,1),d(t)},handleAdd:function(){d([].concat(E()(m),[{}]))},setActions:d,addActions:function(e){var t=e.map(He);d([].concat(E()(m),E()(t)))}}]}var Je=(Le={},ge()(Le,"v1",function(e){var t=e.modelName,n=e.schemas,r=e.adminConfig,l=e.bsmSetting,i=Object(u.useState)(String(0)),o=c()(i,2),s=o[0],m=o[1],d=Ue({modelName:t,schemas:n,adminConfig:r,bsmSetting:l}),p=c()(d,5),v=p[0],h=p[1],g=p[2],y=p[3],E=p[4],b=E.handleAdd,C=E.handleDelete;return[f.a.createElement(a.a,{title:"批量操作",type:"inner"},f.a.createElement(Ne.a,{tabBarStyle:{minWidth:48},activeKey:s,tabPosition:"left",type:"editable-card",onChange:m,onEdit:function(e,t){switch(t){case"add":b();break;case"remove":C(e)}}},h.map(function(e,t){return f.a.createElement(Ne.a.TabPane,{tab:e.name,key:t},v(t))}))),h,g,y]}),ge()(Le,"v2",function(e){var t=e.modelName,n=e.adminConfig,a=Ue({modelName:t,schemas:e.schemas,adminConfig:n,bsmSetting:e.bsmSetting}),l=c()(a,5),i=l[0],o=l[1],s=l[2],m=l[3],d=l[4],p=Object(u.useState)([]),h=c()(p,2),g=h[0],y=h[1],E=Object(u.useState)(!1),b=c()(E,2),C=b[0],O=b[1],w=d.addActions,S=d.handleDelete,D=d.setActions,_=le({allData:o,setData:D,sections:[o.length||0],title:"批量操作",setSections:function(e){D(e[0].fields)},columns:[{title:"批量操作",key:"name",render:function(e){return e.name||Be[e.action].name}},{title:"操作",key:"operation",render:function(e,t,n){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return S(n)}},"删除"))}}],footer:function(){return f.a.createElement(r.a,{onClick:function(){return O(!0)}},"添加操作项")},expandedRowRender:function(e,t){return i(t)}}),F=c()(_,1)[0],k=f.a.createElement("div",null,f.a.createElement(v.a.Item,{label:"选择类型",labelCol:{span:6},wrapperCol:{span:18}},f.a.createElement(A.a,{mode:"multiple",defaultValue:[],value:g,onChange:y,style:{minWidth:160}},Object.keys(Be).map(function(e,t){return f.a.createElement(A.a.Option,{value:e,key:"".concat(e,"__").concat(t+1)},Be[e].name)}))));return[f.a.createElement(f.a.Fragment,null,f.a.createElement(j.a,{title:"添加操作项",visible:C,onOk:function(){w(g),O(!1)},onCancel:function(){return O(!1)},afterClose:function(){O(!1),y([])},okText:"确认",cancelText:"取消"},k),F),o,s,m]}),Le).v2;var Ze=function(e){var t=e.modelName,n=e.schemas,r=e.adminConfig,l=e.bsmSetting,i=ve({modelName:t,schemas:n,adminConfig:r,bsmSetting:l}),o=c()(i,4),s=o[0],m=o[1],d=o[2],h=o[3],g=ke({modelName:t,schemas:n,adminConfig:r,bsmSetting:l}),y=c()(g,5),E=y[0],b=y[1],C=y[2],O=y[3],w=y[4],S=$e({modelName:t,schemas:n,adminConfig:r,bsmSetting:l}),j=c()(S,4),_=j[0],F=j[1],k=j[2],N=j[3],x=Je({modelName:t,schemas:n,adminConfig:r,bsmSetting:l}),I=c()(x,4),A=I[0],P=I[1],T=I[2],R=I[3],$=Object(u.useState)(r[t].filterLayout||"default"),M=c()($,2),V=M[0],L=M[1],Y={display:b,filter:m,inlineActions:F,actions:P,sortable:O,filterLayout:V};return[f.a.createElement(f.a.Fragment,null,E,f.a.createElement(D.a,null),s,f.a.createElement("div",null,f.a.createElement(a.a,{type:"inner"},f.a.createElement(v.a,{layout:"inline"},f.a.createElement(v.a.Item,{label:"位置"},f.a.createElement(p.a.Group,{value:V,onChange:function(e){return L(e.target.value)}},f.a.createElement(p.a,{value:"default"},"顶部"),f.a.createElement(p.a,{value:"drawer"},"侧拉")))))),f.a.createElement(D.a,null),_,f.a.createElement(D.a,null),A),Y,function(){C(),k(),T(),d()},function(){var e=N();Y.inlineActions=e;var t=R();Y.actions=t;var n=w();Y.display=n;var a=h();return Y.filter=a,Y}]},Qe=(n("giR+"),n("fyUT")),Xe=n("d6i3"),et=n.n(Xe),tt=n("1l/V"),nt=n.n(tt),at={group:"分组",tab:"标签",step:"分步"};var rt,lt,it=function(e){var t=e.schemas,n=e.modelName,a=e.adminConfig,l=e.formFields,i="default",o=[];a[n].formLayout&&(i=a[n].formLayout.style||i,o=_.cloneDeep(a[n].formLayout.sections));var s=Object(u.useState)(i),m=c()(s,2),d=m[0],g=m[1],y=Object(u.useState)(o),b=c()(y,2),C=b[0],O=b[1];return[f.a.createElement(v.a,{layout:"inline"},f.a.createElement(v.a.Item,{label:"排列方式"},f.a.createElement(p.a.Group,{value:d,onChange:function(e){return g(e.target.value)}},f.a.createElement(p.a,{value:"default"},"默认"),_.map(at,function(e,t){return f.a.createElement(p.a,{value:t},e)}))),"default"!==d&&f.a.createElement(f.a.Fragment,null,f.a.createElement(P.a,{style:{marginTop:24},size:"middle",bordered:!0,dataSource:C,pagination:!1,columns:[{title:"".concat(at[d],"名称"),key:"title",render:function(e,t,n){return f.a.createElement(h.a,{value:e.title,onChange:function(e){return t=n,a=e.target.value,(r=_.cloneDeep(C))[t].title=a,void O(r);var t,a,r}})}},{title:"所含字段",key:"fields",render:function(e,a,r){return f.a.createElement(A.a,{mode:"multiple",value:e.fields,onChange:function(e){return t=r,n=e,(a=_.cloneDeep(C))[t].fields=n,void O(a);var t,n,a}},l.filter(function(e){return e.name}).map(function(a){return f.a.createElement(A.a.Option,{value:a.name,disabled:C.map(function(e){return e.fields}).flat().includes(a.name)&&!(e.fields||[]).includes(a.name)},t[n].fields.find(function(e){return e.name===a.name}).displayName)}))}},{title:"操作",key:"option",render:function(e,t,n){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return e=n,(t=_.cloneDeep(C)).splice(e,1),void O(t);var e,t}},"删除"),n>0&&f.a.createElement(f.a.Fragment,null,f.a.createElement(D.a,{type:"vertical"}),f.a.createElement("a",{onClick:function(){return e=n,t=_.cloneDeep(C),a=e-1,r=[t[e],t[a]],t[a]=r[0],t[e]=r[1],void O(t);var e,t,a,r}},"上移")),n<C.length-1&&f.a.createElement(f.a.Fragment,null,f.a.createElement(D.a,{type:"vertical"}),f.a.createElement("a",{onClick:function(){return e=n,t=_.cloneDeep(C),a=e+1,r=[t[e],t[a]],t[a]=r[0],t[e]=r[1],void O(t);var e,t,a,r}},"下移")))}}],footer:function(){return f.a.createElement(r.a,{onClick:function(){return O([].concat(E()(C),[{}]))}},"添加",at[d])}}))),"default"===d?void 0:{style:d,sections:C},function(){g(i),O(o)}]},ot={group:"分组",tab:"标签",step:"分步"};function ct(e){var t=e.schemas,n=e.modelName,a=e.adminConfig,r=e.bsmSetting.staff_model,l=Object(u.useState)(_.cloneDeep(a[n].formFields)),o=c()(l,2),s=o[0],p=o[1],h=Object(u.useState)([]),g=c()(h,2),y=g[0],b=g[1],C=Object(u.useState)(!1),O=c()(C,2),w=O[0],S=O[1],D=t[n].fields,j=Object(Ae.g)(),F=Object(Ae.f)(),k={};function N(e){return{name:e,params:{}}}function x(e,t){var n=_.cloneDeep(s);n[e]={name:t,params:{}},p(n)}function P(e,t,n){var a=_.cloneDeep(s);a[e][n]=t,p(a)}function T(e,t,n){var a=_.cloneDeep(s);a[e].params[t]=n,p(a)}return Object(u.useEffect)(function(){if(r){var e=[];t[n].fields.forEach(function(t){t.ref===r&&e.push(t)}),b(e)}!function(e,t){var n=[],a=[];e.forEach(function(e,t){var r=e;r.showIf&&(_.isArray(r.showIf)?r.showIf:[r.showIf]).forEach(function(e,r){if(_.isObject(e.value)){var l=D.find(function(t){return t.name===e.field}),i=new Promise(function(a){Object(oe.queryContent)({model:l.ref,filters:[{field:Object(m.D)(l.ref),operator:"in",value:e.value}]}).then(function(e){var l=e.list;n.push([t,r,l]),a()})});a.push(i)}})});var r=e;_.isEmpty(a)?t&&t(r):Promise.all(a).then(function(){n.forEach(function(e){var t=c()(e,3),n=t[0],a=t[1],l=t[2];r[n].showIf[a].value=l}),p(r),t&&t(r)})}(s,function(e){return function(e,t){var a=[],r=[];e.forEach(function(e,t){e.choicesFilter&&e.choicesFilter.forEach(function(l,i){if(_.isArray(l.value)){var o=Object(m.t)(n,"".concat(e.name,".").concat(l.field)),c=new Promise((u=nt()(et.a.mark(function e(n){return et.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Object(oe.queryContent)({model:o.ref,filters:[{field:Object(m.D)(o.ref),operator:"in",value:l.value}]}).then(function(e){var r=e.list;a.push([t,i,r]),n()});case 1:case"end":return e.stop()}},e)})),function(e){return u.apply(this,arguments)}));r.push(c)}var u})});var l=_.cloneDeep(e);_.isEmpty(r)?t&&t(l):Promise.all(r).then(function(){a.forEach(function(e){var t=c()(e,3),n=t[0],a=t[1],r=t[2];l[n].choicesFilter[a].value=r}),p(l),t&&t(l)})}(e,function(){return S(!0)})})},[]),[function(e){var l,i;if(void 0===e)return null;var o=s[e];if(!o.name)return null;var c=D.find(function(e){return e.name===o.name}),u=o.name&&Object(be.c)([_.cloneDeep(o)],[_.cloneDeep(c)])[0].widget;return f.a.createElement(v.a,{labelCol:{span:5},wrapperCol:{span:19}},f.a.createElement(v.a.Item,{label:"字段"},f.a.createElement(A.a,{value:o.name,onChange:function(t){return x(e,t)},showSearch:!0,filterOption:function(e,t){var n=t.props,a=n.value,r=n.children,l=e.toLowerCase();return a.replace(/_/g,"").toLowerCase().includes(l)||r.toLowerCase().includes(l)}},D.map(function(e){return f.a.createElement(A.a.Option,{value:e.name,disabled:s.map(function(e){return e.name}).includes(e.name)&&e.name!==o.name},e.displayName)}))),o.name&&f.a.createElement(v.a.Item,{label:"组件"},f.a.createElement(A.a,{value:o.widget||null,onChange:function(a){return function(e,a){var r=_.cloneDeep(s);if(a){r[e].widget=a;var l=t[n].fields.find(function(t){return t.name===r[e].name});if(["TreeSelect","Cascader"].includes(a)){var i=t[l.ref].fields.find(function(e){return"ref"===e.type&&e.ref===l.ref});i&&(r[e].params.parent=i.name)}if(["Gallery"].includes(a)){var o=t[l.ref].fields.find(function(e){return["string","text","image","file"].includes(e.type)});o&&(r[e].params.urlField=o.name)}}else delete r[e].widget;p(r)}(e,a)}},f.a.createElement(A.a.Option,{value:null},"默认（",j[Ae.d[c.type]]||Ae.d[c.type],"）"),_.uniq(F[c.type].concat(c.choices?["Select"]:[])).map(function(e){return f.a.createElement(A.a.Option,{value:e,disabled:k[e]},j[e]||e)}))),["TreeSelect","Cascader"].includes(u)&&f.a.createElement(v.a.Item,{label:"父级字段",help:"这个字段用于指向父级记录"},f.a.createElement(A.a,{value:o.params.parent,onChange:function(t){return T(e,"parent",t)}},t[c.ref].fields.filter(function(e){return"ref"===e.type&&e.ref===c.ref}).map(function(e){return f.a.createElement(A.a.Option,{value:e.name},e.displayName)}))),["GroupCascader"].includes(u)&&f.a.createElement(v.a.Item,{label:"分组字段",required:!0},f.a.createElement(ie.a,{value:o.params.groupBy,model:c.ref,onChange:function(t){return T(e,"groupBy",t)},fieldFilter:function(e){return"ref"===e.type}})),["Gallery"].includes(u)&&f.a.createElement(v.a.Item,{label:"图片地址字段",help:"这个字段用于存放图片链接地址"},f.a.createElement(A.a,{value:o.params.urlField,onChange:function(t){return T(e,"urlField",t)}},t[c.ref].fields.filter(function(e){return["string","text","image","file"].includes(e.type)}).map(function(e){return f.a.createElement(A.a.Option,{value:e.name},e.displayName)}))),[("InlineForm"===u||"InnerTable"===u||"Select"===u&&"mref"===c.type)&&f.a.createElement(v.a.Item,{label:"允许新增"},f.a.createElement(d.a,{checked:o.params.canAdd,onChange:function(t){return T(e,"canAdd",t.target.checked)}}))],"Select"===u&&["ref","mref"].includes(c.type)&&f.a.createElement(v.a.Item,{label:"选项个数",help:"下拉选择框选择时显示的个数"},f.a.createElement(Qe.a,{min:1,placeholder:"默认为7",value:o.params.optionSize,onChange:function(t){return T(e,"optionSize",t)}})),f.a.createElement("div",{className:se.a.divider,style:{marginBottom:16}},"权限设置"),f.a.createElement(ue,{groupsValue:null!==(l=null===(i=o.groups)||void 0===i?void 0:i.filter(function(e){return!("number"==typeof e)}))&&void 0!==l?l:[],groupsOnChange:function(t){var n=_.cloneDeep(s);n[e].groups=t,p(E()(n))},userValue:o.userField,userOnChange:function(t){var n=_.cloneDeep(s);n[e].userField=t,p(E()(n))},staffModelFields:y,staffModel:r,defauldGroupValue:a[n].formFields[e]}),f.a.createElement(v.a.Item,{label:"满足条件显示"},f.a.createElement(Ie.a,{fields:D,onChange:function(t){return P(e,t,"showIf")},value:o.showIf,disabledField:function(e){return o.showIf.filter(function(e){return e.field}).map(function(e){return e.field}).includes(e.name)}})),[!_.isEmpty(c)&&["ref","mref"].includes(c.type)&&f.a.createElement(v.a.Item,{label:"过滤条件："},f.a.createElement(Ie.a,{fields:t[n].fields,onChange:function(t){return P(e,t,"choicesFilter")},value:o.choicesFilter,disabledFilte:o.choicesFilter}))])},s,function(){p(a[n].formFields)},function(){return!0},function(){return _.cloneDeep(s).filter(function(e){return e.name}).map(function(e){var t=e;return t.showIf&&(t.showIf=t.showIf.filter(function(e){return e.field&&e.operator&&void 0!==e.value}).map(function(e){var t=i()({},e);if(_.isObject(t.value)){var n=D.find(function(t){return t.name===e.field});_.isArray(t.value)&&(t.value=t.value.map(function(e){return Object(m.C)(e,n.ref)}))}return t}),t.choicesFilter&&(t.choicesFilter=t.choicesFilter.filter(function(e){return e.field&&e.operator&&void 0!==e.value}).map(function(t){var a=i()({},t);if(_.isObject(a.value)){var r=Object(m.t)(n,"".concat(e.name,".").concat(t.field));_.isArray(a.value)&&(a.value=a.value.map(function(e){return Object(m.C)(e,r.ref)}))}return a}))),_.isEmpty(e.groups)||(t.groups=t.groups.filter(function(e){return e}).map(function(e){return e.id||e})),e.id||(t.id=I()(6)),t})},{handleAdd:function(){p([].concat(E()(s),[{params:{}}]))},handleDelete:function(e){var t=_.cloneDeep(s);t.splice(e,1),p(t)},setFormFields:p,changeFieldName:x,addFields:function(e){var t=e.map(N);p([].concat(E()(s),E()(t)))},getField:N},w]}var ut=(rt={},ge()(rt,"v1",function(e){var t=e.schemas,n=e.modelName,r=e.adminConfig,l=e.bsmSetting,i=Object(u.useState)(String(0)),o=c()(i,2),s=o[0],m=o[1],d=ct({schemas:t,modelName:n,adminConfig:r,bsmSetting:l}),p=c()(d,6),v=p[0],h=p[1],g=p[2],y=p[3],E=p[4],b=p[5],C=it({modelName:n,schemas:t,adminConfig:r,formFields:h}),O=c()(C,3),w=O[0],S=O[1],j=O[2],_=b.handleAdd,F=b.handleDelete,k=t[n].fields;return[f.a.createElement(f.a.Fragment,null,f.a.createElement(a.a,{title:"表单字段",type:"inner"},f.a.createElement(Ne.a,{tabBarStyle:{minWidth:48},activeKey:s,tabPosition:"left",type:"editable-card",onChange:m,onEdit:function(e,t){switch(t){case"add":_(),m(String(h.length));break;case"remove":F(e)}}},h.map(function(e,t){var n=k.find(function(t){return t.name===e.name});return f.a.createElement(Ne.a.TabPane,{tab:(n||{}).displayName||"字段".concat(t+1),key:t,closable:!n||!n.required||h.filter(function(t){return t.name===e.name}).length>=2},v(t))}))),f.a.createElement(D.a,null),w),h,function(){g(),j()},y,E,S]}),ge()(rt,"v2",function(e){var t,n=e.modelName,a=e.adminConfig,l=e.schemas,i=e.bsmSetting,o=ct({schemas:l,modelName:n,adminConfig:a,bsmSetting:i}),s=c()(o,7),m=s[0],d=s[1],p=s[2],v=s[3],g=s[4],y=s[5],b=s[6],C=Object(u.useState)([d.length]),O=c()(C,2),w=O[0],S=O[1],D=Object(u.useState)([]),j=c()(D,2),F=j[0],k=j[1],x=y.handleDelete,I=y.setFormFields,A=y.changeFieldName,P=y.getField,T=re({modelName:n,schemas:l,onOk:function(){return function(e){var t=0,n=e.length+w[lt];w.forEach(function(e,n){n<=lt&&(t+=e)});var a=e.map(P),r=N()(d,{$splice:[[t,0].concat(E()(a))]});I(r),S(N()(w,{$splice:[[lt,1,n]]}))}(M)},fieldDisabled:function(e){return d.map(function(e){return e.name}).includes(e.name)},expand:!1}),R=c()(T,3),$=R[0],M=R[1],V=R[2],L=a[n].formLayout,Y=Object(u.useState)((null===L||void 0===L?void 0:L.style)||"default"),q=c()(Y,2),K=q[0],W=q[1];function G(){S([].concat(E()(w),[0]))}function z(e){var t=w.reduce(function(t,n,a){return a<e?t+n:t},0);I(N()(d,{$splice:[[t,w[e]]]})),S(N()(w,{$splice:[[e,1]]})),k(N()(F,{$splice:[[e,1]]}))}function B(e){W(e),"default"===e&&(S([d.length]),k([F[0]]))}var U=le({sections:w,setSections:S,allData:d,setData:I,title:"表单字段",modalView:$,columns:[{title:"字段",key:"name",render:function(e,t,a,r){return f.a.createElement(ie.a,{value:e.name,onChange:function(e){return function(e,t,n){A(H(e,t,w),n)}(a,r,e)},model:n})}},{title:"操作",key:"operation",render:function(e,t,n,a){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return function(e,t){x(H(e,t,w)),S(N()(w,{$splice:[[t,1,w[t]-1]]}))}(n,a)}},"删除"))}}],footer:function(e){return f.a.createElement(r.a,{onClick:function(){lt=e,V()}},"添加字段")},expandedRowRender:function(e,t,n,a,r){return m(H(t,r,w))},addAndDeleteView:"default"!==K?function(e){return f.a.createElement(ne,{sectionindex:e,addSections:G,deleteSections:z,hiddenDelete:0===e})}:null,styleView:function(){return f.a.createElement(te,{onChange:B,value:K,layouts:ot})},tableTitle:function(e){return"default"!==K&&f.a.createElement("div",null,"".concat(ot[K],"名称"),"  ",f.a.createElement(h.a,{style:{width:100},value:F[e],onChange:function(t){return function(e,t){k(N()(F,{$splice:[[e,1,t]]}))}(e,t.target.value)},placeholder:"第".concat(e+1,"组")}))}}),J=c()(U,1)[0];function Z(){if(L&&"default"!==L.style&&!_.isEmpty(L.sections)){var e=[],t=[],n=[];L.sections.forEach(function(a){var r=[];a.fields.forEach(function(e){var t=d.find(function(t){return t.name===e});t&&r.push(t)}),n.push.apply(n,r),t.push(r.length),a.title&&e.push(a.title)}),I(n),S(t),k(e)}}if(Object(u.useEffect)(function(){b&&Z()},[b]),"default"!==K){t={style:K,sections:[]};var Q=0;w.forEach(function(e,n){e&&(t.sections.push({title:F[n],fields:d.slice(Q,Q+e).map(function(e){return e.name})}),Q+=e)})}else t=void 0;return[J,d,function(){p(),Z()},v,g,t]}),rt).v2;var ft=function(e){var t=e.modelName,n=e.schemas,r=e.adminConfig,l=e.bsmSetting,i=ut({modelName:t,schemas:n,adminConfig:r,bsmSetting:l}),o=c()(i,6),s=o[0],m=o[1],d=o[2],h=o[3],g=o[4],y=o[5],E=Object(u.useState)(r[t].modalForm),b=c()(E,2),C=b[0],O=b[1],w={formFields:m,formLayout:y,modalForm:C};return[f.a.createElement(f.a.Fragment,null,s,f.a.createElement(a.a,{title:"基本设置",type:"inner"},f.a.createElement(v.a,{layout:"inline"},f.a.createElement(v.a.Item,{label:"表单界面"},f.a.createElement(p.a.Group,{value:C,onChange:function(e){return O(e.target.value)}},f.a.createElement(p.a,{value:!0},"弹窗编辑"),f.a.createElement(p.a,{value:!1},"新页面编辑")))))),w,function(){d()},function(){var e=g();return w.formFields=e,w},function(){return h()}]};function st(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];throw Error("[Immer] minified error nr: "+e+(n.length?" "+n.map(function(e){return"'"+e+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function mt(e){return!!e&&!!e[Xt]}function dt(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);return!t||t===Object.prototype}(e)||Array.isArray(e)||!!e[Qt]||!!e.constructor[Qt]||bt(e)||Ct(e))}function pt(e,t,n){void 0===n&&(n=!1),0===vt(e)?(n?Object.keys:en)(e).forEach(function(a){n&&"symbol"==typeof a||t(a,e[a],e)}):e.forEach(function(n,a){return t(a,n,e)})}function vt(e){var t=e[Xt];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:bt(e)?2:Ct(e)?3:0}function ht(e,t){return 2===vt(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function gt(e,t){return 2===vt(e)?e.get(t):e[t]}function yt(e,t,n){var a=vt(e);2===a?e.set(t,n):3===a?(e.delete(t),e.add(n)):e[t]=n}function Et(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function bt(e){return Ht&&e instanceof Map}function Ct(e){return Ut&&e instanceof Set}function Ot(e){return e.o||e.t}function wt(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=tn(e);delete t[Xt];for(var n=en(t),a=0;a<n.length;a++){var r=n[a],l=t[r];!1===l.writable&&(l.writable=!0,l.configurable=!0),(l.get||l.set)&&(t[r]={configurable:!0,writable:!0,enumerable:l.enumerable,value:e[r]})}return Object.create(Object.getPrototypeOf(e),t)}function St(e,t){jt(e)||mt(e)||!dt(e)||(vt(e)>1&&(e.set=e.add=e.clear=e.delete=Dt),Object.freeze(e),t&&pt(e,function(e,t){return St(t,!0)},!0))}function Dt(){st(2)}function jt(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function _t(e){var t=nn[e];return t||st(18,e),t}function Ft(){return zt}function kt(e,t){t&&(_t("Patches"),e.u=[],e.s=[],e.v=t)}function Nt(e){xt(e),e.p.forEach(At),e.p=null}function xt(e){e===zt&&(zt=e.l)}function It(e){return zt={p:[],l:zt,h:e,m:!0,_:0}}function At(e){var t=e[Xt];0===t.i||1===t.i?t.j():t.g=!0}function Pt(e,t){t._=t.p.length;var n=t.p[0],a=void 0!==e&&e!==n;return t.h.O||_t("ES5").S(t,e,a),a?(n[Xt].P&&(Nt(t),st(4)),dt(e)&&(e=Tt(t,e),t.l||$t(t,e)),t.u&&_t("Patches").M(n[Xt],e,t.u,t.s)):e=Tt(t,n,[]),Nt(t),t.u&&t.v(t.u,t.s),e!==Zt?e:void 0}function Tt(e,t,n){if(jt(t))return t;var a=t[Xt];if(!a)return pt(t,function(r,l){return Rt(e,a,t,r,l,n)},!0),t;if(a.A!==e)return t;if(!a.P)return $t(e,a.t,!0),a.t;if(!a.I){a.I=!0,a.A._--;var r=4===a.i||5===a.i?a.o=wt(a.k):a.o;pt(3===a.i?new Set(r):r,function(t,l){return Rt(e,a,r,t,l,n)}),$t(e,r,!1),n&&e.u&&_t("Patches").R(a,n,e.u,e.s)}return a.o}function Rt(e,t,n,a,r,l){if(mt(r)){var i=Tt(e,r,l&&t&&3!==t.i&&!ht(t.D,a)?l.concat(a):void 0);if(yt(n,a,i),!mt(i))return;e.m=!1}if(dt(r)&&!jt(r)){if(!e.h.N&&e._<1)return;Tt(e,r),t&&t.A.l||$t(e,r)}}function $t(e,t,n){void 0===n&&(n=!1),e.h.N&&e.m&&St(t,n)}function Mt(e,t){var n=e[Xt];return(n?Ot(n):e)[t]}function Vt(e,t){if(t in e)for(var n=Object.getPrototypeOf(e);n;){var a=Object.getOwnPropertyDescriptor(n,t);if(a)return a;n=Object.getPrototypeOf(n)}}function Lt(e){e.P||(e.P=!0,e.l&&Lt(e.l))}function Yt(e){e.o||(e.o=wt(e.t))}function qt(e,t,n){var a=bt(t)?_t("MapSet").T(t,n):Ct(t)?_t("MapSet").F(t,n):e.O?function(e,t){var n=Array.isArray(e),a={i:n?1:0,A:t?t.A:Ft(),P:!1,I:!1,D:{},l:t,t:e,k:null,o:null,j:null,C:!1},r=a,l=an;n&&(r=[a],l=rn);var i=Proxy.revocable(r,l),o=i.revoke,c=i.proxy;return a.k=c,a.j=o,c}(t,n):_t("ES5").J(t,n);return(n?n.A:Ft()).p.push(a),a}function Kt(e){return mt(e)||st(22,e),function e(t){if(!dt(t))return t;var n,a=t[Xt],r=vt(t);if(a){if(!a.P&&(a.i<4||!_t("ES5").K(a)))return a.t;a.I=!0,n=Wt(t,r),a.I=!1}else n=Wt(t,r);return pt(n,function(t,r){a&&gt(a.t,t)===r||yt(n,t,e(r))}),3===r?new Set(n):n}(e)}function Wt(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return wt(e)}var Gt,zt,Bt="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),Ht="undefined"!=typeof Map,Ut="undefined"!=typeof Set,Jt="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,Zt=Bt?Symbol.for("immer-nothing"):((Gt={})["immer-nothing"]=!0,Gt),Qt=Bt?Symbol.for("immer-draftable"):"__$immer_draftable",Xt=Bt?Symbol.for("immer-state"):"__$immer_state",en=("undefined"!=typeof Symbol&&Symbol.iterator,"undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames),tn=Object.getOwnPropertyDescriptors||function(e){var t={};return en(e).forEach(function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)}),t},nn={},an={get:function(e,t){if(t===Xt)return e;var n=Ot(e);if(!ht(n,t))return function(e,t,n){var a,r=Vt(t,n);return r?"value"in r?r.value:null===(a=r.get)||void 0===a?void 0:a.call(e.k):void 0}(e,n,t);var a=n[t];return e.I||!dt(a)?a:a===Mt(e.t,t)?(Yt(e),e.o[t]=qt(e.A.h,a,e)):a},has:function(e,t){return t in Ot(e)},ownKeys:function(e){return Reflect.ownKeys(Ot(e))},set:function(e,t,n){var a=Vt(Ot(e),t);if(null==a?void 0:a.set)return a.set.call(e.k,n),!0;if(!e.P){var r=Mt(Ot(e),t),l=null==r?void 0:r[Xt];if(l&&l.t===n)return e.o[t]=n,e.D[t]=!1,!0;if(Et(n,r)&&(void 0!==n||ht(e.t,t)))return!0;Yt(e),Lt(e)}return e.o[t]=n,e.D[t]=!0,!0},deleteProperty:function(e,t){return void 0!==Mt(e.t,t)||t in e.t?(e.D[t]=!1,Yt(e),Lt(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var n=Ot(e),a=Reflect.getOwnPropertyDescriptor(n,t);return a?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:a.enumerable,value:n[t]}:a},defineProperty:function(){st(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){st(12)}},rn={};pt(an,function(e,t){rn[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),rn.deleteProperty=function(e,t){return an.deleteProperty.call(this,e[0],t)},rn.set=function(e,t,n){return an.set.call(this,e[0],t,n,e[0])};var ln,on,cn=new(function(){function e(e){this.O=Jt,this.N=!1,"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),this.produce=this.produce.bind(this),this.produceWithPatches=this.produceWithPatches.bind(this)}var t=e.prototype;return t.produce=function(e,t,n){if("function"==typeof e&&"function"!=typeof t){var a=t;t=e;var r=this;return function(e){var n=this;void 0===e&&(e=a);for(var l=arguments.length,i=Array(l>1?l-1:0),o=1;o<l;o++)i[o-1]=arguments[o];return r.produce(e,function(e){var a;return(a=t).call.apply(a,[n,e].concat(i))})}}var l;if("function"!=typeof t&&st(6),void 0!==n&&"function"!=typeof n&&st(7),dt(e)){var i=It(this),o=qt(this,e,void 0),c=!0;try{l=t(o),c=!1}finally{c?Nt(i):xt(i)}return"undefined"!=typeof Promise&&l instanceof Promise?l.then(function(e){return kt(i,n),Pt(e,i)},function(e){throw Nt(i),e}):(kt(i,n),Pt(l,i))}if(!e||"object"!=typeof e){if((l=t(e))===Zt)return;return void 0===l&&(l=e),this.N&&St(l,!0),l}st(21,e)},t.produceWithPatches=function(e,t){var n,a,r=this;return"function"==typeof e?function(t){for(var n=arguments.length,a=Array(n>1?n-1:0),l=1;l<n;l++)a[l-1]=arguments[l];return r.produceWithPatches(t,function(t){return e.apply(void 0,[t].concat(a))})}:[this.produce(e,t,function(e,t){n=e,a=t}),n,a]},t.createDraft=function(e){dt(e)||st(8),mt(e)&&(e=Kt(e));var t=It(this),n=qt(this,e,void 0);return n[Xt].C=!0,xt(t),n},t.finishDraft=function(e,t){var n=(e&&e[Xt]).A;return kt(n,t),Pt(void 0,n)},t.setAutoFreeze=function(e){this.N=e},t.setUseProxies=function(e){e&&!Jt&&st(20),this.O=e},t.applyPatches=function(e,t){var n;for(n=t.length-1;n>=0;n--){var a=t[n];if(0===a.path.length&&"replace"===a.op){e=a.value;break}}var r=_t("Patches").$;return mt(e)?r(e,t):this.produce(e,function(e){return r(e,t.slice(n+1))})},e}()),un=cn.produce,fn=(cn.produceWithPatches.bind(cn),cn.setAutoFreeze.bind(cn),cn.setUseProxies.bind(cn),cn.applyPatches.bind(cn),cn.createDraft.bind(cn),cn.finishDraft.bind(cn),un),sn={group:"分组"};function mn(e){return e&&(null===e||void 0===e?void 0:e.map(function(e){return _.isString(e)?{name:e}:e}))}function dn(e){var t,n=e.modelName,a=e.detailValue,l=e.schemas,i=e.useLayout,o=void 0!==i&&i,s=e.style,d=void 0===s?"group":s,g=e.bsmSetting.staff_model,y=[],b=[];a&&(y=null!==(t=(_.cloneDeep(a.sections)||[]).map(function(e){var t=e;return t.fields=mn(t.fields),t}))&&void 0!==t?t:[],b=mn(_.cloneDeep(a.fields))||y.filter(function(e){return!_.isEmpty(e.fields)}).reduce(function(e,t){return e.concat(t.fields)},[]));var C=Object(u.useState)(y),O=c()(C,2),w=O[0],S=O[1],j=Object(u.useState)(b),F=c()(j,2),k=F[0],N=F[1],x=Object(u.useState)([]),I=c()(x,2),T=I[0],R=I[1];function $(e,t,n){var a=_.cloneDeep(k);a[e][n]=t,N(a)}Object(u.useEffect)(function(){var e,t,a=[],r=[];if(g){var i=[];l[n].fields.forEach(function(e){e.ref===g&&i.push(e)}),R(i)}var o=null===(e=_.cloneDeep(k))||void 0===e?void 0:e.filter(function(e){return Object(m.t)(n,e.name)});o.forEach(function(e,t){var l=e;l.showIf&&l.showIf.forEach(function(e,l){var i=e;if(_.isArray(i.value)){var o=Object(m.t)(n,i.field),c=new Promise(function(e){Object(oe.queryContent)({model:o.ref,filters:[{field:Object(m.D)(o.ref),operator:"in",value:i.value}]}).then(function(n){var r=n.list;a.push([t,l,r]),e()})});r.push(c)}})});var u=null===(t=_.cloneDeep(w))||void 0===t?void 0:t.map(function(e){var t=e;return t.fields&&(t.fields=t.fields.filter(function(e){return o.map(function(e){return e.name}).includes(e.name)})),t});Promise.all(r).then(function(){a.forEach(function(e){var t=c()(e,3),n=t[0],a=t[1],r=t[2];o[n].showIf[a].value=r})}),N(o),S(u)},[]);var M=function(e,t){N(fn(k,function(n){t?n[e].alias=t:delete n[e].alias}))},V={handleDisPlayName:M,handleFieldChange:$,deleteField:function(e){var t=_.cloneDeep(k);t.splice(e,1);var n=(_.cloneDeep(w)||[]).map(function(e){var n,a=e;return a.fields&&(a.fields=null===(n=a.fields)||void 0===n?void 0:n.filter(function(e){return t.map(function(e){return e.name}).includes(e.name)})),a});S(n),N(t)},addField:function(){N([].concat(E()(k),[{}]))},reset:function(){S(y),N(b)},setFields:N,getField:function(e){return{name:e}}};return[function(e){var t,r;if(void 0===e)return null;var i=k[e];return f.a.createElement(v.a,{labelCol:{span:5},wrapperCol:{span:19}},f.a.createElement(v.a.Item,{label:"显示名"},f.a.createElement(h.a,{allowClear:!0,value:i.alias,onChange:function(t){return M(e,t.target.value)},placeholder:i.name&&Object(be.b)([_.cloneDeep(i)],n,l)[0].alias})),f.a.createElement("div",{className:se.a.divider,style:{marginBottom:16}},"权限设置"),f.a.createElement(ue,{groupsValue:null!==(t=null===(r=i.groups)||void 0===r?void 0:r.filter(function(e){return!("number"==typeof e)}))&&void 0!==t?t:[],groupsOnChange:function(t){var n=_.cloneDeep(k);n[e].groups=t,N(E()(n))},userValue:i.userField,userOnChange:function(t){var n=_.cloneDeep(k);n[e].userField=t,N(E()(n))},staffModelFields:T,staffModel:g,defauldGroupValue:a.fields[e]}),f.a.createElement(v.a.Item,{label:"满足条件显示"},f.a.createElement(Ie.a,{fields:l[n].fields,onChange:function(t){return $(e,t,"showIf")},value:i.showIf,disabledField:function(e){return i.showIf.filter(function(e){return e.field}).map(function(e){return e.field}).includes(e.name)}})))},o&&f.a.createElement(v.a,{layout:"inline"},"default"!==d&&f.a.createElement(f.a.Fragment,null,f.a.createElement(P.a,{style:{marginTop:24},size:"middle",bordered:!0,dataSource:w,pagination:!1,columns:[{title:"".concat(sn[d],"名称"),key:"title",render:function(e,t,n){return f.a.createElement(h.a,{value:e.title,onChange:function(e){return t=n,a=e.target.value,(r=_.cloneDeep(w))[t].title=a,void S(r);var t,a,r}})}},{title:"所含字段",key:"fields",render:function(e,t,a){var r;return f.a.createElement(A.a,{mode:"multiple",value:null===(r=e.fields)||void 0===r?void 0:r.map(function(e){return e.name}),onChange:function(e){var t,n,r;t=a,n=e,(r=_.cloneDeep(w))[t].fields=n.map(function(e){return k.find(function(t){return t.name===e})}),S(r)}},k.filter(function(e){return e.name}).map(function(t){var a;return f.a.createElement(A.a.Option,{value:t.name,key:t.name,disabled:w.map(function(e){var t;return null===(t=e.fields)||void 0===t?void 0:t.map(function(e){return e.name})}).flat().includes(t.name)&&!(e.fields||[]).map(function(e){return e.name}).includes(t.name)},null===(a=l[n].fields.find(function(e){return e.name===t.name}))||void 0===a?void 0:a.displayName)}))}},{title:"显示风格",key:"style.widget",render:function(e,t,n){return f.a.createElement(p.a.Group,{value:e.style&&e.style.widget||"cell",onChange:function(e){return t=n,a=e.target.value,(r=_.cloneDeep(w))[t].style||(r[t].style={}),r[t].style.widget=a,void S(r);var t,a,r}},f.a.createElement(p.a,{value:"cell"},"列表"),f.a.createElement(p.a,{value:"table"},"表格"))}},{title:"操作",key:"option",render:function(e,t,n){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return e=n,(t=_.cloneDeep(w)).splice(e,1),void S(t);var e,t}},"删除"),n>0&&f.a.createElement(f.a.Fragment,null,f.a.createElement(D.a,{type:"vertical"}),f.a.createElement("a",{onClick:function(){return e=n,t=_.cloneDeep(w),a=e-1,r=[t[e],t[a]],t[a]=r[0],t[e]=r[1],void S(t);var e,t,a,r}},"上移")),n<w.length-1&&f.a.createElement(f.a.Fragment,null,f.a.createElement(D.a,{type:"vertical"}),f.a.createElement("a",{onClick:function(){return e=n,t=_.cloneDeep(w),a=e+1,r=[t[e],t[a]],t[a]=r[0],t[e]=r[1],void S(t);var e,t,a,r}},"下移")))}}],footer:function(){return f.a.createElement(r.a,{onClick:function(){return S([].concat(E()(w),[{}]))}},"添加",sn[d])}}))),k,w,V]}var pn=(ln={},ge()(ln,"v1",function(e){var t=e.modelName,n=e.adminConfig,r=e.schemas,l=e.bsmSetting,i="default";n[t].detail&&(i=n[t].detail.style||i);var o=Object(u.useState)(i),s=c()(o,2),m=s[0],d=s[1],h=Object(u.useState)(String(0)),g=c()(h,2),y=g[0],E=g[1],b=dn({modelName:t,adminConfig:n,schemas:r,useLayout:!0,style:m,bsmSetting:l}),C=c()(b,5),O=C[0],w=C[1],S=C[2],j=C[3],F=C[4],k=F.deleteField,N=F.addField,x=F.check,I=F.detailReset;function A(){N(),E(String(S.length))}var P={style:m,sections:"default"!==m&&j,fields:"default"===m&&S},T=f.a.createElement(Ne.a,{tabBarStyle:{minWidth:48},activeKey:y,tabPosition:"left",type:"editable-card",onChange:E,onEdit:function(e,t){({add:A,remove:function(){return k(e)}})[t]()}},S.map(function(e,n){var a=r[t].fields.find(function(t){return t.name===e.name});return f.a.createElement(Ne.a.TabPane,{tab:(a||{}).displayName||"字段".concat(n+1),key:n,closable:!a||!a.required||S.filter(function(t){return t.name===e.name}).length>=2},O(n))}));return[f.a.createElement(f.a.Fragment,null,f.a.createElement(a.a,{title:"详情字段",type:"inner"},T),f.a.createElement(D.a,null),f.a.createElement(v.a,{layout:"inline"},f.a.createElement(v.a.Item,{label:"排列方式"},f.a.createElement(p.a.Group,{value:m,onChange:function(e){return d(e.target.value)}},f.a.createElement(p.a,{value:"default"},"默认"),_.map(sn,function(e,t){return f.a.createElement(p.a,{value:t},e)}))))),w,P,function(){I(),d(i)},x]}),ge()(ln,"v2",function(e){var t,n,a=e.schemas,l=e.modelName,o=e.detailValue,s=e.bsmSetting,m=e.onChange,d=[],p=[],v=[];"default"===(null===o||void 0===o?void 0:o.style)||_.isEmpty(null===o||void 0===o?void 0:o.sections)?d=[(null===o||void 0===o?void 0:null===(t=o.fields)||void 0===t?void 0:t.length)||0]:null===o||void 0===o||null===(n=o.sections)||void 0===n||n.forEach(function(e){e.fields&&d.push(e.fields.length),p.push(e.title),v.push(e.style)});var g=Object(u.useState)(d),y=c()(g,2),b=y[0],C=y[1],O=Object(u.useState)(p),w=c()(O,2),S=w[0],D=w[1],j=Object(u.useState)(v),F=c()(j,2),k=F[0],x=F[1],I="group",P=dn({modelName:l,detailValue:o,schemas:a,style:I,bsmSetting:s}),T=c()(P,5),R=T[0],$=T[2],M=T[4],V=M.deleteField,L=M.setFields,Y=M.getField,q=M.handleFieldChange,K=re({modelName:l,schemas:a,onOk:function(){return function(e){var t=0,n=e.length+b[on];b.forEach(function(e,n){n<=on&&(t+=e)});var a=e.map(Y),r=N()($,{$splice:[[t,0].concat(E()(a))]});L(r),C(N()(b,{$splice:[[on,1,n]]}))}(B)},fieldDisabled:function(e){return $.map(function(e){return e.name}).includes(e.name)},expand:!0}),G=c()(K,3),z=G[0],B=G[1],U=G[2];function J(){C([].concat(E()(b),[0]))}function Z(e){var t=b.reduce(function(t,n,a){return a<e?t+n:t},0);L(N()($,{$splice:[[t,b[e]]]})),C(N()(b,{$splice:[[e,1]]})),D(N()(S,{$splice:[[e,1]]})),x(N()(k,{$splice:[[e,1]]}))}var Q=le({sectionStyle:k,style:I,sections:b,setSections:C,allData:$,setData:L,modalView:z,columns:[{title:"字段",key:"name",render:function(e,t,n,a){return f.a.createElement(ie.a,{value:e.name,onChange:function(e){return function(e,t,n){q(H(e,t,b),n,"name")}(n,a,e)},model:l})}},{title:"操作",key:"operation",render:function(e,t,n,a){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return function(e,t){V(H(e,t,b)),C(N()(b,{$splice:[[t,1,b[t]-1]]}))}(n,a)}},"删除"))}}],footer:function(e){return f.a.createElement(r.a,{onClick:function(){on=e,U()}},"添加字段")},expandedRowRender:function(e,t,n,a,r){return R(H(t,r,b))},addAndDeleteView:function(e){var t;return f.a.createElement("div",null,"显示组件：",f.a.createElement(A.a,{value:(null===(t=k[e])||void 0===t?void 0:t.widget)||"cell",onChange:function(t){return function(e,t){if(t in W.c){var n=b.reduce(function(t,n,a){return a<e?t+n:t},0),a=_.cloneDeep(b);a[e]=0,L(N()($,{$splice:[[n,b[e]]]})),C(a)}x(N()(k,{$splice:[[e,1,{widget:t}]]}))}(e,t)},style:{minWidth:80,maxWidth:200}},f.a.createElement(A.a.Option,{value:"cell"},"列表"),f.a.createElement(A.a.Option,{value:"tiles"},"平铺"),f.a.createElement(A.a.Option,{value:"table"},"表格"),f.a.createElement(A.a.Option,{value:"table-v"},"垂直表格"),Object.keys(W.e).map(function(e){return W.e[e].includes(l)&&f.a.createElement(A.a.Option,{value:e},W.d[e])})),f.a.createElement(ne,{sectionindex:e,addSections:J,deleteSections:Z,hiddenDelete:0===e}))},tableTitle:function(e){return f.a.createElement("div",null,"".concat(sn.group,"名称"),"  ",f.a.createElement(h.a,{style:{width:100},value:S[e],onChange:function(t){return function(e,t){D(N()(S,{$splice:[[e,1,t]]}))}(e,t.target.value)},placeholder:"第".concat(e+1,"组")}))}}),X=c()(Q,1)[0],ee=i()({},o,{style:I,fields:!1}),te=0;return ee.sections=[],b.forEach(function(e,t){ee.sections.push({title:S[t],fields:$.slice(te,te+e),style:k[t]}),te+=e}),Object(u.useEffect)(function(){m(ee)},[b,S,k,I,$]),X}),ln).v2;var vn=_.debounce(function(e,t){e(t)},100),hn=function(e){var t,n=e.modelName,a=e.adminConfig,r=e.schemas,l=e.bsmSetting,o=function(){return E()(a[n].details||[])},s=Object(u.useState)(o),d=c()(s,2),p=d[0],v=d[1],g=Object(u.useState)(),y=c()(g,2),b=y[0],C=y[1],O=Object(u.useState)(),w=c()(O,2),S=w[0],D=w[1],F=Object(u.useState)(null===(t=p[0])||void 0===t?void 0:t.key),k=c()(F,2),N=k[0],x=k[1];return[f.a.createElement("div",null,f.a.createElement(j.a,{title:"添加标签",visible:b,okButtonProps:{disabled:!S},destroyOnClose:!0,onOk:function(){var e=p,t=I()(6);e.push({key:t,sections:[],title:S,style:"group"}),v(e),x(t),C(!1)},onCancel:function(){return C(!1)}},f.a.createElement("span",null,"标签名称："),f.a.createElement(h.a,{onChange:function(e){return vn(D,e.target.value)},style:{width:300}})),f.a.createElement(Ne.a,{type:"editable-card",activeKey:N,onChange:function(e){return x(e)},onEdit:function(e,t){if("add"===t&&C(!0),"remove"===t){var n,a,r=p.filter(function(t,n){return t.key!==e||((a=n-1)<0&&(a=0),!1)});e===N&&x(null===(n=r[a])||void 0===n?void 0:n.key),v(r)}}},p.map(function(e,t){return f.a.createElement(Ne.a.TabPane,{tab:e.title||"详情".concat(t+1),key:e.key},f.a.createElement(pn,{modelName:n,schemas:r,detailValue:e,bsmSetting:l,onChange:function(e){var n=p;n[t]=e,v(n)}}))}))),void 0,p,function(){v(o())},function(){return p.map(function(e){return function(e){var t=e;function a(e){return e.map(function(e){return _.isString(e)?{name:e}:e}).filter(function(e){return e.name}).map(function(e){var t=i()({},e);return t.showIf&&(t.showIf=Object(m.z)(e.showIf,n)),_.isEmpty(e.groups)||(t.groups=t.groups.filter(function(e){return e}).map(function(e){return e.id||e})),e.id||(t.id=I()(6)),t})}return"default"!==e.style&&e.sections?t.sections=t.sections.filter(function(e){var t;return(null===(t=e.style)||void 0===t?void 0:t.widget)in W.c||!_.isEmpty(e.fields)}).map(function(e){var t,n=e;return(null===(t=e.style)||void 0===t?void 0:t.widget)in W.c?n.fields=[]:n.fields=a(n.fields),n}):t.fields=a(t.fields),t}(e)})}]};var gn=function(e){var t=e.modelName,n=e.schemas,r=e.adminConfig,l=e.bsmSetting,i=hn({modelName:t,schemas:n,adminConfig:r,bsmSetting:l}),o=c()(i,5),s=o[0],m=o[1],d=o[2],h=o[3],g=o[4],y=Object(u.useState)(r[t].modalDetail),E=c()(y,2),b=E[0],C=E[1],O={detail:void 0,details:d,modalDetail:b};return[f.a.createElement(f.a.Fragment,null,s,f.a.createElement(a.a,{title:"基本设置",type:"inner"},f.a.createElement(v.a,{layout:"inline"},f.a.createElement(v.a.Item,{label:"详情界面"},f.a.createElement(p.a.Group,{value:!!b,onChange:function(e){return C(e.target.value)}},f.a.createElement(p.a,{value:!0},"弹窗"),f.a.createElement(p.a,{value:!1},"新页面"))))),m),O,function(){h()},function(){var e=g();return O.details=e,O}]};var yn=Object(s.connect)(function(e){return{bsmSetting:e.bsmSetting}})(Object(m.d)(function(e){var t=e.schemas,n=e.modelName,l=e.adminWithoutDefault,o=e.updateAdmin,s=e.afterSubmit,m=e.defaultTab,d=void 0===m?"list":m,p=e.bsmSetting;if(!t[n])return null;var v=Ze({modelName:n,schemas:t,adminConfig:l,bsmSetting:p}),h=c()(v,4),g=h[0],y=h[1],E=h[2],b=h[3],C=ft({modelName:n,schemas:t,adminConfig:l,bsmSetting:p}),O=c()(C,5),w=O[0],D=O[1],j=O[2],F=O[3],k=O[4],N=gn({modelName:n,schemas:t,adminConfig:l,bsmSetting:p}),x=c()(N,4),I=x[0],A=x[1],P=x[2],T=x[3],R=S({modelName:n,schemas:t,adminConfig:l}),$=c()(R,4),M=$[0],V=$[1],L=$[2],Y=$[3],q=i()({},l[n],{exportable:V},y,D,A),K={list:function(){return g},form:function(){return w},detail:function(){return I},export:function(){return M}},W=Object(u.useState)(d),G=c()(W,2),z=G[0],B=G[1];return f.a.createElement(a.a,{activeTabKey:z,tabList:[{key:"list",tab:"列表页设置"},{key:"form",tab:"表单设置"},{key:"detail",tab:"详情页设置"},{key:"export",tab:"导出设置"}],onTabChange:B,actions:[f.a.createElement("div",{style:{textAlign:"left",marginTop:12,marginBottom:12}},f.a.createElement(r.a,{onClick:function(){if(k()&&Y()){_.mapValues(b(),function(e,t){q[t]=e}),_.mapValues(F(),function(e,t){q[t]=e}),_.mapValues(T(),function(e,t){q[t]=e});var e=_.cloneDeep(q);o({model:n,config:e}),s&&s({model:n,config:e})}},type:"primary",style:{marginLeft:24}},"更新"),f.a.createElement(r.a,{onClick:function(){L(),E(),j(),P()},style:{marginLeft:24}},"重置"))]},K[z]())}));t.default=yn}}]);