(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{S0Qd:function(e,t,a){"use strict";a.r(t);a("DAWX");var r,n,l,i=a("USTd"),s=(a("1DiQ"),a("o2ao")),c=(a("2zJo"),a("EpZc")),u=a("CxVk"),o=a.n(u),p=(a("FtyQ"),a("WvG8")),m=(a("8keV"),a("IhqU")),d=(a("Ti7s"),a("t/Nd")),f=(a("NxO5"),a("Hcx2")),h=a("uVek"),b=a.n(h),E=a("sXdV"),y=a.n(E),v=a("AxL8"),g=a.n(v),k=a("q847"),x=a.n(k),_=a("dLrW"),j=a.n(_),O=a("cjXc"),V=a.n(O),w=a("o9sT"),q=a.n(w),D=a("3m6/"),S=a.n(D),C=a("CIpT"),R=a.n(C),F=a("QetK"),T=a.n(F),z=(a("vypk"),a("k/ax")),A=(a("HqD5"),a("4sAw")),P=(a("2eh7"),a("T37F")),I=(a("pO4F"),a("Xaj1")),N=a("qE61"),M=a.n(N),U=a("qlT2"),X=a("s98/"),K=a.n(X),Q=a("OaWn"),B=a.n(Q),J=a("zQXf"),L=a("BSml"),W=a("9Ndd"),G=a("rr6D"),H=a("I2cA"),Z=a("3Rrz"),Y=a("KNTv"),$=a("zHco"),ee=a("JYAO");function te(e){var t=ae();return function(){var a,r=T()(e);if(t){var n=T()(this).constructor;a=Reflect.construct(r,arguments,n)}else a=r.apply(this,arguments);return R()(this,a)}}function ae(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var re={labelCol:{xs:{span:24},sm:{span:4},lg:{span:3},xl:{span:3},xxl:{span:2}},wrapperCol:{xs:{span:24},sm:{span:20},md:{span:15},lg:{span:15},xl:{span:10},xxl:{span:7}}},ne=W["b"].Select,le=W["b"].TextArea,ie=W["b"].Switch,se=I["a"].TabPane,ce=P["a"].Option,ue=A["a"].Item,oe=z["a"].Step,pe=(r=Object(J["connect"])(function(e){var t=e.content,a=t.schemas,r=t.adminConfig,n=e.loading;return{schemas:a,adminConfig:r,loading:n.models.content}}),K()(n=r((l=function(e){S()(a,e);var t=te(a);function a(){var e;j()(this,a);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return e=t.call.apply(t,[this].concat(n)),e.state={appModels:[],operation:void 0,model:void 0,current:0,checkValues:!1},e.schemasData=function(){return new Promise(function(t){var a=[],r=0,n=function n(){r>10&&t("schemas\u6570\u636e\u9519\u8bef"),setTimeout(function(){var l=e.props.schemas;a=l,Object(U["isEmpty"])(a)?(r+=1,n()):t(a)},500)};n()})},e.handleSubmit=x()(y.a.mark(function t(){var a,r,n,l,i,s,c,u,o,p,m,d,f,h,b,E,v,k,x,_,j,O,V,w,D,S,C,R,F,T;return y.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return a=e.props.form,r=a.getFieldValue,n=a.getFieldsValue,l=a.validateFields,e.setState({checkValues:!0}),t.next=4,l();case 4:if(Object(H["f"])(r("parameter"))&&Object(H["g"])(r("setfield"))&&Object(H["d"])(r("filter"))){t.next=6;break}return t.abrupt("return");case 6:if(i=q()(e),s=i.operation,c=i.isUpdate,u=r("app__model"),s&&u){t.next=10;break}return t.abrupt("return");case 10:if(o=n(),p=o.app__model,m=o.parameter,d=o.ordering,f=o.displayfield,h=o.paging,b=o.page,E=o.size,v=o.pk,k=o.setfield,x=o.func_name,_=o.filter,j=g()(p,2),O=j[0],V=j[1],w={app:O,model:V},G["a"].default.forEach(function(e){w[e]=o[e]}),w.disable=!w.disable,w.operation=s,w.groups&&(w.groups=w.groups.map(function(e){return e.id})),D=function(){var e={name:v,default:void 0,desc:"\u4e3b\u952e",required:!0,is_array:!1,type:"pk"};w.parameter.push(e)},"list"===s&&(w.parameter=Object(H["i"])(m),w.ordering=d,w.displayfield=f,h&&(S=E.name,C=E.default,R={name:b,default:1,desc:"\u9875\u7801\u53c2\u6570",required:!1,is_array:!1,type:"PAGE_IDX"},F={name:S,default:C,desc:"\u9875\u957f\u53c2\u6570",required:!1,is_array:!1,type:"PAGE_SIZE"},w.parameter.push(R),w.parameter.push(F)),w.filter=Object(H["h"])(_)),"retrieve"===s&&(w.displayfield=f,w.parameter=[],D()),"create"===s&&(w.parameter=Object(H["i"])(m),w.displayfield=f,w.setfield=Object(H["j"])(k)),"update"!==s&&"replace"!==s||(w.parameter=Object(H["i"])(m),D(),w.displayfield=f,w.setfield=Object(H["j"])(k)),"delete"===s&&(w.parameter=[],D()),"update_by_condition"===s&&(w.parameter=Object(H["i"])(m),w.setfield=Object(H["j"])(k),w.filter=Object(H["h"])(_)),"delete_by_condition"===s&&(w.parameter=Object(H["i"])(m),w.filter=Object(H["h"])(_)),"func"===s&&(w.parameter=Object(H["i"])(m),w.func_name=x),!c){t.next=33;break}return T=e.props.match.params.id,t.next=31,Object(Y["a"])(w,parseInt(T,0));case 31:return B.a.push("/content/api_db__api"),t.abrupt("return");case 33:return t.next=35,Object(Y["a"])(w);case 35:B.a.push("/content/api_db__api");case 36:case"end":return t.stop()}},t)})),e}return V()(a,[{key:"componentDidMount",value:function(){this.getModelData();var e=this.props.match.params.id;(0===e||e)&&this.setDefaultValues(e)}},{key:"setDefaultValues",value:function(){var e=x()(y.a.mark(function e(t){var a,r,n,l,i,s,c,u,o,p,m,d,f,h,E;return y.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=this.props,r=a.form.setFieldsValue,n=a.dispatch,l=this.props.schemas,e.next=4,n({type:"content/detail",payload:{model:"api_db__api",id:t}});case 4:return i=e.sent,s=i.operation,c=i.slug,e.next=8,Object(Y["b"])(c);case 8:if(u=e.sent,this.setState({operation:s,model:u.app__model}),!Object(U["isEmpty"])(l)){e.next=14;break}return e.next=13,this.schemasData();case 13:l=e.sent;case 14:return e.next=16,Object(H["c"])(u,l);case 16:o=e.sent,p=o.displayfield,m=o.filter,d=o.parameter,f=o.setfield,h=o.pk,E={displayfield:p,filter:m,parameter:d,setfield:f,pk:h},delete o.displayfield,delete o.filter,delete o.parameter,delete o.setfield,delete o.pk,r(b()({},o),function(){setTimeout(function(){return r(E)},2e3)});case 25:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"getModelData",value:function(){var e=x()(y.a.mark(function e(){var t,a;return y.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.props.schemas,!Object(U["isEmpty"])(t)){e.next=5;break}return e.next=4,this.schemasData();case 4:t=e.sent;case 5:a=Object(ee["m"])(t),this.setState({appModels:a});case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"schemas",value:function(){var e=this.props.schemas;return e.api_db__api||[]}},{key:"next",value:function(){var e=x()(y.a.mark(function e(){var t,a,r,n,l;return y.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.state.current,a=this.props.form,r=a.validateFields,n=a.getFieldValue,0!==t){e.next=5;break}return e.next=5,r(["func_name","slug","app__model","size","page","pk"]);case 5:if(1!==t){e.next=11;break}return this.setState({checkValues:!0}),e.next=9,r();case 9:if(Object(H["f"])(n("parameter"))&&Object(H["g"])(n("setfield"))&&Object(H["d"])(n("filter"))){e.next=11;break}return e.abrupt("return");case 11:l=t+1,this.setState({current:l});case 13:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"prev",value:function(){var e=this.state.current,t=e-1;this.setState({current:t})}},{key:"render",value:function(){var e=this,t=this.props,a=t.form,r=a.getFieldDecorator,n=a.getFieldValue,l=a.resetFields,u=t.schemas,h=this.state,b=h.appModels,E=h.current,y=h.checkValues,v=this.operation,g=this.isUpdate;if(Object(U["isEmpty"])(u))return M.a.createElement(f["a"],null);var k=function(e){return v&&G["a"][v].includes(e)},x=this.model,_=function(){return Object(Z["a"])({dollarData:n("parameter")})},j=M.a.createElement("div",null,M.a.createElement(p["a"],null,M.a.createElement(m["a"],{sm:{offset:2},xl:{offset:1}},M.a.createElement(d["a"],{size:"large",style:{marginRight:15},onClick:l},"\u53d6\u6d88"),M.a.createElement(d["a"],{size:"large",type:"primary",onClick:this.handleSubmit},"\u63d0\u4ea4")))),O=M.a.createElement("div",null,M.a.createElement(ue,o()({label:"\u64cd\u4f5c"},re),r("operation",{initialValue:v})(M.a.createElement(ne,{field:this.schemas().fields.find(function(e){return"operation"===e.name}),choices:this.schemas().fields.find(function(e){return"operation"===e.name}).choices,options:{disable:!0},disabled:!0}))),k("func_name")&&M.a.createElement(ue,o()({required:!0,label:"\u4e91\u51fd\u6570\u540d"},re),r("func_name",{rules:[{message:"\u8bf7\u8f93\u5165\u4e91\u51fd\u6570\u540d",required:!0}]})(M.a.createElement(c["a"],{placeholder:"\u8bf7\u8f93\u5165"}))),M.a.createElement(ue,o()({label:"\u540d\u79f0"},re),r("name",{})(M.a.createElement(c["a"],{placeholder:"\u8bf7\u8f93\u5165"}))),M.a.createElement(ue,o()({required:!0,label:"\u8def\u5f84"},re),r("slug",{rules:[{message:"\u8bf7\u8f93\u5165\u8def\u5f84",required:!0}]})(M.a.createElement(c["a"],{placeholder:"\u8bf7\u8f93\u5165"}))),M.a.createElement(ue,o()({required:!0,label:"\u6a21\u578b"},re),r("app__model",{rules:[{message:"\u8bf7\u9009\u62e9\u6a21\u578b",required:!0}]})(M.a.createElement(s["a"],{options:b,placeholder:"\u8bf7\u9009\u62e9",displayRender:function(e){return e.join("__")}}))),k("paging")&&M.a.createElement(ue,o()({label:"\u5206\u9875"},re),r("paging",{initialValue:!1})(M.a.createElement(ie,null))),n("paging")&&k("size")&&M.a.createElement("div",null,M.a.createElement(ue,o()({required:!0,label:"\u9875\u957f\u53c2\u6570"},re),r("size",{initialValue:{name:"pageSize",default:30},rules:[{validator:H["e"]}]})(M.a.createElement(L["b"],null))),M.a.createElement(ue,o()({required:!0,label:"\u9875\u7801\u53c2\u6570"},re),r("page",{initialValue:"pageNumber",rules:[{message:"\u8bf7\u8f93\u5165\u9875\u7801\u53c2\u6570",required:!0}]})(M.a.createElement(c["a"],null)))),k("pk")&&M.a.createElement(ue,o()({required:!0,label:"\u4e3b\u952e"},re),r("pk",{initialValue:"id",rules:[{message:"\u8bf7\u8f93\u5165\u4e3b\u952e",required:!0}]})(M.a.createElement(c["a"],null))),M.a.createElement(ue,o()({label:"\u8bf4\u660e"},re,{wrapperCol:{xs:{span:24},sm:{span:20},xxl:{span:15}}}),r("summary",{})(M.a.createElement(le,{placeholder:"\u8bf7\u8f93\u5165\u5907\u6ce8",field:this.schemas().fields.find(function(e){return"summary"===e.name})}))),M.a.createElement(ue,o()({label:"\u542f\u7528"},re),r("disable",{initialValue:!1})(M.a.createElement(ie,null)))),V=M.a.createElement("div",null,k("parameter")&&x&&M.a.createElement(ue,null,r("parameter",{initialValue:{}})(M.a.createElement(L["c"],{schemas:u,model:x,operation:v,isNew:!g}))),k("setfield")&&x&&M.a.createElement(ue,null,r("setfield",{initialValue:{}})(M.a.createElement(L["e"],{schemas:u,model:x,operation:v,getParameterValue:function(){return n("parameter")},isNew:!g}))),k("displayfield")&&x&&M.a.createElement(ue,null,r("displayfield",{initialValue:[]})(M.a.createElement(L["a"],{schemas:u,model:x}))),k("filter")&&x&&M.a.createElement("div",null,M.a.createElement("div",{style:{paddingBottom:2}},M.a.createElement("span",{style:{fontSize:26}},"\u8fc7\u6ee4\u89c4\u5219")),M.a.createElement(ue,null,r("filter",{initialValue:[]})(M.a.createElement(L["d"],{columns:Object(H["k"])(u,x),getVariableData:_,systemData:G["b"]})))),k("ordering")&&M.a.createElement(ue,o()({label:"\u6392\u5e8f"},re,{labelCol:{xs:{span:24},sm:{span:2},xl:{span:1}}}),r("ordering",{})(M.a.createElement(P["a"],{placeholder:"\u8bf7\u9009\u62e9",mode:"multiple",allowClear:!0},Object(H["l"])(u,x).map(function(e){return M.a.createElement(ce,{key:e.key,value:e.key},e.label)}))))),w=M.a.createElement("div",null,M.a.createElement(ue,o()({label:"\u8981\u6c42\u767b\u5f55"},re),r("logined",{initialValue:!1})(M.a.createElement(ie,null))),M.a.createElement(ue,o()({label:"\u89d2\u8272"},re),r("groups",{})(M.a.createElement(ne,{field:this.schemas().fields.find(function(e){return"groups"===e.name})})))),q=function(){return M.a.createElement(z["a"],{current:E,style:{marginBottom:30}},M.a.createElement(oe,{key:0,title:"\u57fa\u672c\u4fe1\u606f"}),M.a.createElement(oe,{key:1,title:"\u64cd\u4f5c\u914d\u7f6e"}),M.a.createElement(oe,{key:2,title:"\u6743\u9650\u914d\u7f6e"}))},D=M.a.createElement("div",null,M.a.createElement(A["a"],null,M.a.createElement(i["a"],null,g?M.a.createElement("div",null,M.a.createElement(I["a"],{defaultActiveKey:"1"},M.a.createElement(se,{tab:"\u57fa\u672c\u4fe1\u606f",key:"1",forceRender:!0},O),M.a.createElement(se,{tab:"\u64cd\u4f5c\u914d\u7f6e",key:"2",forceRender:!0},V),M.a.createElement(se,{tab:"\u6743\u9650\u914d\u7f6e",key:"3",forceRender:!0},w)),j):M.a.createElement("div",null,M.a.createElement("div",{style:{marginTop:30}},M.a.createElement(I["a"],{defaultActiveKey:"0",renderTabBar:q,activeKey:"".concat(E)},M.a.createElement(se,{key:"0",forceRender:!0},O),M.a.createElement(se,{key:"1",forceRender:!0},V),M.a.createElement(se,{key:"2",forceRender:!0},w))),M.a.createElement(p["a"],null,M.a.createElement(m["a"],{sm:{offset:2},xl:{offset:1}},E<2&&M.a.createElement(d["a"],{type:"primary",onClick:function(){return e.next()}},"\u4e0b\u4e00\u6b65"),E>0&&M.a.createElement(d["a"],{style:{marginLeft:8,marginRight:8},onClick:function(){return e.prev()}},"\u4e0a\u4e00\u6b65"),2===E&&M.a.createElement(d["a"],{style:{marginLeft:8,marginRight:8},onClick:l},"\u53d6\u6d88"),2===E&&M.a.createElement(d["a"],{type:"primary",onClick:this.handleSubmit},"\u63d0\u4ea4")))))));return M.a.createElement(H["a"].Provider,{value:y},D)}},{key:"operation",get:function(){var e=this.props.location.query.operation,t=this.isUpdate;return!e&&t?this.state.operation:e}},{key:"isUpdate",get:function(){var e=this.props,t=e.match.params.id,a=e.location.query.operation;return!(a||0!==t&&!t)}},{key:"model",get:function(){var e=this.props.form.getFieldValue,t=e("app__model"),a=this.state.model;if(Object(U["isEmpty"])(t))return a;var r="".concat(t[0],"__").concat(t[1]);return r}}]),a}(N["PureComponent"]),n=l))||n)||n),me=A["a"].create()(pe);t["default"]=function(e){return M.a.createElement($["a"],null,M.a.createElement(me,e))}}}]);