(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{S0Qd:function(e,t,a){"use strict";a.r(t);a("DAWX");var r,n,l,i,c=a("USTd"),s=(a("1DiQ"),a("o2ao")),u=(a("2zJo"),a("EpZc")),o=a("CxVk"),p=a.n(o),m=(a("FtyQ"),a("WvG8")),d=(a("8keV"),a("IhqU")),f=(a("Ti7s"),a("t/Nd")),h=(a("NxO5"),a("Hcx2")),b=a("uVek"),E=a.n(b),y=a("sXdV"),g=a.n(y),v=a("AxL8"),k=a.n(v),x=a("q847"),_=a.n(x),j=a("dLrW"),O=a.n(j),V=a("cjXc"),w=a.n(V),q=a("o9sT"),S=a.n(q),C=a("3m6/"),D=a.n(C),R=a("CIpT"),F=a.n(R),T=a("QetK"),z=a.n(T),A=(a("vypk"),a("k/ax")),P=(a("HqD5"),a("4sAw")),I=(a("2eh7"),a("T37F")),N=(a("pO4F"),a("Xaj1")),U=a("qE61"),X=a.n(U),K=a("qlT2"),Q=a("s98/"),B=a.n(Q),G=a("OaWn"),L=a.n(G),W=a("zQXf"),H=a("BSml"),J=a("9Ndd"),M=a("rr6D"),Z=a("I2cA"),Y=a("3Rrz"),$=a("KNTv"),ee=a("zHco"),te=a("8hbc");function ae(e){var t=re();return function(){var a,r=z()(e);if(t){var n=z()(this).constructor;a=Reflect.construct(r,arguments,n)}else a=r.apply(this,arguments);return F()(this,a)}}function re(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var ne={labelCol:{xs:{span:24},sm:{span:4},lg:{span:3},xl:{span:3},xxl:{span:2}},wrapperCol:{xs:{span:24},sm:{span:20},md:{span:15},lg:{span:15},xl:{span:10},xxl:{span:7}}},le=J["b"].Select,ie=J["b"].TextArea,ce=J["b"].Switch,se=N["a"].TabPane,ue=I["a"].Option,oe=P["a"].Item,pe=A["a"].Step,me=(r=Object(W["connect"])(function(e){var t=e.content,a=t.schemas,r=t.adminConfig,n=e.loading;return{schemas:a,adminConfig:r,loading:n.models.content}}),n=Object(te["d"])(function(){return{appModels:Object(te["G"])()}}),B()(l=r(l=n((i=function(e){D()(a,e);var t=ae(a);function a(){var e;O()(this,a);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return e=t.call.apply(t,[this].concat(n)),e.state={operation:void 0,model:void 0,current:0,checkValues:!1},e.schemasData=function(){return new Promise(function(t){var a=[],r=0,n=function n(){r>10&&t("schemas\u6570\u636e\u9519\u8bef"),setTimeout(function(){var l=e.props.schemas;a=l,Object(K["isEmpty"])(a)?(r+=1,n()):t(a)},500)};n()})},e.handleSubmit=_()(g.a.mark(function t(){var a,r,n,l,i,c,s,u,o,p,m,d,f,h,b,E,y,v,x,_,j,O,V,w,q,C,D,R,F,T;return g.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return a=e.props.form,r=a.getFieldValue,n=a.getFieldsValue,l=a.validateFields,e.setState({checkValues:!0}),t.next=4,l();case 4:if(Object(Z["f"])(r("parameter"))&&Object(Z["g"])(r("setfield"))&&Object(Z["d"])(r("filter"))){t.next=6;break}return t.abrupt("return");case 6:if(i=S()(e),c=i.operation,s=i.isUpdate,u=r("app__model"),c&&u){t.next=10;break}return t.abrupt("return");case 10:if(o=n(),p=o.app__model,m=o.parameter,d=o.ordering,f=o.displayfield,h=o.paging,b=o.page,E=o.size,y=o.pk,v=o.setfield,x=o.func_name,_=o.filter,j=k()(p,2),O=j[0],V=j[1],w={app:O,model:V},M["a"].default.forEach(function(e){w[e]=o[e]}),w.disable=!w.disable,w.operation=c,w.groups&&(w.groups=w.groups.map(function(e){return e.id})),q=function(){var e={name:y,default:void 0,desc:"\u4e3b\u952e",required:!0,is_array:!1,type:"pk"};w.parameter.push(e)},"list"===c&&(w.parameter=Object(Z["i"])(m),w.ordering=d,w.displayfield=f,h&&(C=E.name,D=E.default,R={name:b,default:1,desc:"\u9875\u7801\u53c2\u6570",required:!1,is_array:!1,type:"PAGE_IDX"},F={name:C,default:D,desc:"\u9875\u957f\u53c2\u6570",required:!1,is_array:!1,type:"PAGE_SIZE"},w.parameter.push(R),w.parameter.push(F)),w.filter=Object(Z["h"])(_)),"retrieve"===c&&(w.displayfield=f,w.parameter=[],q()),"create"===c&&(w.parameter=Object(Z["i"])(m),w.displayfield=f,w.setfield=Object(Z["j"])(v)),"update"!==c&&"replace"!==c||(w.parameter=Object(Z["i"])(m),q(),w.displayfield=f,w.setfield=Object(Z["j"])(v)),"delete"===c&&(w.parameter=[],q()),"update_by_condition"===c&&(w.parameter=Object(Z["i"])(m),w.setfield=Object(Z["j"])(v),w.filter=Object(Z["h"])(_)),"delete_by_condition"===c&&(w.parameter=Object(Z["i"])(m),w.filter=Object(Z["h"])(_)),"func"===c&&(w.parameter=Object(Z["i"])(m),w.func_name=x),!s){t.next=33;break}return T=e.props.match.params.id,t.next=31,Object($["a"])(w,parseInt(T,0));case 31:return L.a.push("/content/api_db__api"),t.abrupt("return");case 33:return t.next=35,Object($["a"])(w);case 35:L.a.push("/content/api_db__api");case 36:case"end":return t.stop()}},t)})),e}return w()(a,[{key:"componentDidMount",value:function(){var e=this.props.match.params.id;(0===e||e)&&this.setDefaultValues(e)}},{key:"setDefaultValues",value:function(){var e=_()(g.a.mark(function e(t){var a,r,n,l,i,c,s,u,o,p,m,d,f,h,b;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=this.props,r=a.form.setFieldsValue,n=a.dispatch,l=this.props.schemas,e.next=4,n({type:"content/detail",payload:{model:"api_db__api",id:t}});case 4:return i=e.sent,c=i.operation,s=i.slug,e.next=8,Object($["b"])(s);case 8:if(u=e.sent,this.setState({operation:c,model:u.app__model}),!Object(K["isEmpty"])(l)){e.next=14;break}return e.next=13,this.schemasData();case 13:l=e.sent;case 14:return e.next=16,Object(Z["c"])(u,l);case 16:o=e.sent,p=o.displayfield,m=o.filter,d=o.parameter,f=o.setfield,h=o.pk,b={displayfield:p,filter:m,parameter:d,setfield:f,pk:h},delete o.displayfield,delete o.filter,delete o.parameter,delete o.setfield,delete o.pk,r(E()({},o),function(){setTimeout(function(){return r(b)},2e3)});case 25:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"schemas",value:function(){var e=this.props.schemas;return e.api_db__api||[]}},{key:"next",value:function(){var e=_()(g.a.mark(function e(){var t,a,r,n,l;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.state.current,a=this.props.form,r=a.validateFields,n=a.getFieldValue,0!==t){e.next=5;break}return e.next=5,r(["func_name","slug","app__model","size","page","pk"]);case 5:if(1!==t){e.next=11;break}return this.setState({checkValues:!0}),e.next=9,r();case 9:if(Object(Z["f"])(n("parameter"))&&Object(Z["g"])(n("setfield"))&&Object(Z["d"])(n("filter"))){e.next=11;break}return e.abrupt("return");case 11:l=t+1,this.setState({current:l});case 13:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"prev",value:function(){var e=this.state.current,t=e-1;this.setState({current:t})}},{key:"render",value:function(){var e=this,t=this.props,a=t.form,r=a.getFieldDecorator,n=a.getFieldValue,l=a.resetFields,i=t.schemas,o=t.appModels,b=this.state,E=b.current,y=b.checkValues,g=this.operation,v=this.isUpdate;if(Object(K["isEmpty"])(i))return X.a.createElement(h["a"],null);var k=function(e){return g&&M["a"][g].includes(e)},x=this.model,_=function(){return Object(Y["a"])({dollarData:n("parameter")})},j=X.a.createElement("div",null,X.a.createElement(m["a"],null,X.a.createElement(d["a"],{sm:{offset:2},xl:{offset:1}},X.a.createElement(f["a"],{size:"large",style:{marginRight:15},onClick:l},"\u53d6\u6d88"),X.a.createElement(f["a"],{size:"large",type:"primary",onClick:this.handleSubmit},"\u63d0\u4ea4")))),O=X.a.createElement("div",null,X.a.createElement(oe,p()({label:"\u64cd\u4f5c"},ne),r("operation",{initialValue:g})(X.a.createElement(le,{field:this.schemas().fields.find(function(e){return"operation"===e.name}),choices:this.schemas().fields.find(function(e){return"operation"===e.name}).choices,options:{disable:!0},disabled:!0}))),k("func_name")&&X.a.createElement(oe,p()({required:!0,label:"\u4e91\u51fd\u6570\u540d"},ne),r("func_name",{rules:[{message:"\u8bf7\u8f93\u5165\u4e91\u51fd\u6570\u540d",required:!0}]})(X.a.createElement(u["a"],{placeholder:"\u8bf7\u8f93\u5165"}))),X.a.createElement(oe,p()({label:"\u540d\u79f0"},ne),r("name",{})(X.a.createElement(u["a"],{placeholder:"\u8bf7\u8f93\u5165"}))),X.a.createElement(oe,p()({required:!0,label:"\u8def\u5f84"},ne),r("slug",{rules:[{message:"\u8bf7\u8f93\u5165\u8def\u5f84",required:!0}]})(X.a.createElement(u["a"],{placeholder:"\u8bf7\u8f93\u5165"}))),X.a.createElement(oe,p()({required:!0,label:"\u6a21\u578b"},ne),r("app__model",{rules:[{message:"\u8bf7\u9009\u62e9\u6a21\u578b",required:!0}]})(X.a.createElement(s["a"],{options:o,placeholder:"\u8bf7\u9009\u62e9",displayRender:function(e){return e.join("__")}}))),k("paging")&&X.a.createElement(oe,p()({label:"\u5206\u9875"},ne),r("paging",{initialValue:!1})(X.a.createElement(ce,null))),n("paging")&&k("size")&&X.a.createElement("div",null,X.a.createElement(oe,p()({required:!0,label:"\u9875\u957f\u53c2\u6570"},ne),r("size",{initialValue:{name:"pageSize",default:30},rules:[{validator:Z["e"]}]})(X.a.createElement(H["b"],null))),X.a.createElement(oe,p()({required:!0,label:"\u9875\u7801\u53c2\u6570"},ne),r("page",{initialValue:"pageNumber",rules:[{message:"\u8bf7\u8f93\u5165\u9875\u7801\u53c2\u6570",required:!0}]})(X.a.createElement(u["a"],null)))),k("pk")&&X.a.createElement(oe,p()({required:!0,label:"\u4e3b\u952e"},ne),r("pk",{initialValue:"id",rules:[{message:"\u8bf7\u8f93\u5165\u4e3b\u952e",required:!0}]})(X.a.createElement(u["a"],null))),X.a.createElement(oe,p()({label:"\u8bf4\u660e"},ne,{wrapperCol:{xs:{span:24},sm:{span:20},xxl:{span:15}}}),r("summary",{})(X.a.createElement(ie,{placeholder:"\u8bf7\u8f93\u5165\u5907\u6ce8",field:this.schemas().fields.find(function(e){return"summary"===e.name})}))),X.a.createElement(oe,p()({label:"\u542f\u7528"},ne),r("disable",{initialValue:!1})(X.a.createElement(ce,null)))),V=X.a.createElement("div",null,k("parameter")&&x&&X.a.createElement(oe,null,r("parameter",{initialValue:{}})(X.a.createElement(H["c"],{schemas:i,model:x,operation:g,isNew:!v}))),k("setfield")&&x&&X.a.createElement(oe,null,r("setfield",{initialValue:{}})(X.a.createElement(H["e"],{schemas:i,model:x,operation:g,getParameterValue:function(){return n("parameter")},isNew:!v}))),k("displayfield")&&x&&X.a.createElement(oe,null,r("displayfield",{initialValue:[]})(X.a.createElement(H["a"],{schemas:i,model:x}))),k("filter")&&x&&X.a.createElement("div",null,X.a.createElement("div",{style:{paddingBottom:2}},X.a.createElement("span",{style:{fontSize:26}},"\u8fc7\u6ee4\u89c4\u5219")),X.a.createElement(oe,null,r("filter",{initialValue:[]})(X.a.createElement(H["d"],{columns:Object(Z["k"])(i,x),getVariableData:_,systemData:M["b"]})))),k("ordering")&&X.a.createElement(oe,p()({label:"\u6392\u5e8f"},ne,{labelCol:{xs:{span:24},sm:{span:2},xl:{span:1}}}),r("ordering",{})(X.a.createElement(I["a"],{placeholder:"\u8bf7\u9009\u62e9",mode:"multiple",allowClear:!0},Object(Z["l"])(i,x).map(function(e){return X.a.createElement(ue,{key:e.key,value:e.key},e.label)}))))),w=X.a.createElement("div",null,X.a.createElement(oe,p()({label:"\u8981\u6c42\u767b\u5f55"},ne),r("logined",{initialValue:!1})(X.a.createElement(ce,null))),X.a.createElement(oe,p()({label:"\u89d2\u8272"},ne),r("groups",{})(X.a.createElement(le,{field:this.schemas().fields.find(function(e){return"groups"===e.name})})))),q=function(){return X.a.createElement(A["a"],{current:E,style:{marginBottom:30}},X.a.createElement(pe,{key:0,title:"\u57fa\u672c\u4fe1\u606f"}),X.a.createElement(pe,{key:1,title:"\u64cd\u4f5c\u914d\u7f6e"}),X.a.createElement(pe,{key:2,title:"\u6743\u9650\u914d\u7f6e"}))},S=X.a.createElement("div",null,X.a.createElement(P["a"],null,X.a.createElement(c["a"],null,v?X.a.createElement("div",null,X.a.createElement(N["a"],{defaultActiveKey:"1"},X.a.createElement(se,{tab:"\u57fa\u672c\u4fe1\u606f",key:"1",forceRender:!0},O),X.a.createElement(se,{tab:"\u64cd\u4f5c\u914d\u7f6e",key:"2",forceRender:!0},V),X.a.createElement(se,{tab:"\u6743\u9650\u914d\u7f6e",key:"3",forceRender:!0},w)),j):X.a.createElement("div",null,X.a.createElement("div",{style:{marginTop:30}},X.a.createElement(N["a"],{defaultActiveKey:"0",renderTabBar:q,activeKey:"".concat(E)},X.a.createElement(se,{key:"0",forceRender:!0},O),X.a.createElement(se,{key:"1",forceRender:!0},V),X.a.createElement(se,{key:"2",forceRender:!0},w))),X.a.createElement(m["a"],null,X.a.createElement(d["a"],{sm:{offset:2},xl:{offset:1}},E<2&&X.a.createElement(f["a"],{type:"primary",onClick:function(){return e.next()}},"\u4e0b\u4e00\u6b65"),E>0&&X.a.createElement(f["a"],{style:{marginLeft:8,marginRight:8},onClick:function(){return e.prev()}},"\u4e0a\u4e00\u6b65"),2===E&&X.a.createElement(f["a"],{style:{marginLeft:8,marginRight:8},onClick:l},"\u53d6\u6d88"),2===E&&X.a.createElement(f["a"],{type:"primary",onClick:this.handleSubmit},"\u63d0\u4ea4")))))));return X.a.createElement(Z["a"].Provider,{value:y},S)}},{key:"operation",get:function(){var e=this.props.location.query.operation,t=this.isUpdate;return!e&&t?this.state.operation:e}},{key:"isUpdate",get:function(){var e=this.props,t=e.match.params.id,a=e.location.query.operation;return!(a||0!==t&&!t)}},{key:"model",get:function(){var e=this.props.form.getFieldValue,t=e("app__model"),a=this.state.model;if(Object(K["isEmpty"])(t))return a;var r="".concat(t[0],"__").concat(t[1]);return r}}]),a}(U["PureComponent"]),l=i))||l)||l)||l),de=P["a"].create()(me),fe=function(e){return X.a.createElement(ee["a"],null,X.a.createElement(de,e))};a.d(t,"default",function(){return fe})}}]);