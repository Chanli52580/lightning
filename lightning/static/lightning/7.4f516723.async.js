(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[7],{r7nV:function(e,a,t){"use strict";t.r(a);t("SePM");var r,n,l,i=t("PMX6"),c=(t("lNFX"),t("VE2L")),s=(t("4X2C"),t("xvon")),u=t("0Owb"),p=(t("e+1C"),t("Nd5c")),m=(t("ER8q"),t("Ai5L")),o=(t("eNCU"),t("pjJH")),d=(t("smr7"),t("DlTu")),f=t("k1fw"),b=t("tJVT"),h=t("9og8"),E=t("fWQN"),y=t("mtLc"),g=t("tS8v"),j=t("yKVA"),v=t("879j"),O=(t("5RCp"),t("a82I")),k=(t("vmZS"),t("NjVP")),_=(t("yavW"),t("WuMn")),x=(t("Ahcs"),t("k0dM")),V=t("WmNS"),w=t.n(V),S=t("q1tI"),q=t.n(S),C=t("LvDl"),D=t("Ty5D"),R=t("RLxJ"),F=t("Hx5s"),N=t("/MKj"),A=t("BSml"),P=t("9Ndd"),T=t("rr6D"),z=t("I2cA"),M=t("3Rrz"),I=t("KNTv"),L=t("jfUH"),K={labelCol:{xs:{span:24},sm:{span:4},lg:{span:3},xl:{span:3},xxl:{span:2}},wrapperCol:{xs:{span:24},sm:{span:20},md:{span:15},lg:{span:15},xl:{span:10},xxl:{span:7}}},U=P["a"].Select,J=P["a"].TextArea,B=P["a"].Switch,W=x["a"].TabPane,X=_["a"].Option,H=k["a"].Item,G=O["a"].Step,Z=(r=Object(N["c"])((function(e){var a=e.content,t=a.schemas,r=a.adminConfig,n=e.loading;return{schemas:t,adminConfig:r,loading:n.models.content}})),n=Object(L["d"])((function(){return{appModels:Object(L["gb"])()}})),Object(D["n"])(l=r(l=n(l=function(e){Object(j["a"])(t,e);var a=Object(v["a"])(t);function t(){var e;Object(E["a"])(this,t);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return e=a.call.apply(a,[this].concat(n)),e.state={operation:void 0,model:void 0,current:0,checkValues:!1},e.schemasData=function(){return new Promise((function(a){var t=[],r=0,n=function n(){r>10&&a("schemas\u6570\u636e\u9519\u8bef"),setTimeout((function(){var l=e.props.schemas;t=l,Object(C["isEmpty"])(t)?(r+=1,n()):a(t)}),500)};n()}))},e.handleSubmit=Object(h["a"])(w.a.mark((function a(){var t,r,n,l,i,c,s,u,p,m,o,d,f,h,E,y,j,v,O,k,_,x,V,S,q,C,D,F,N,A;return w.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t=e.props.form,r=t.getFieldValue,n=t.getFieldsValue,l=t.validateFields,e.setState({checkValues:!0}),a.next=4,l();case 4:if(Object(z["f"])(r("parameter"))&&Object(z["g"])(r("setfield"))&&Object(z["d"])(r("filter"))){a.next=6;break}return a.abrupt("return");case 6:if(i=Object(g["a"])(e),c=i.operation,s=i.isUpdate,u=r("app__model"),c&&u){a.next=10;break}return a.abrupt("return");case 10:if(p=n(),m=p.app__model,o=p.parameter,d=p.ordering,f=p.displayfield,h=p.paging,E=p.page,y=p.size,j=p.pk,v=p.setfield,O=p.func_name,k=p.filter,_=Object(b["a"])(m,2),x=_[0],V=_[1],S={app:x,model:V},T["a"].default.forEach((function(e){S[e]=p[e]})),S.disable=!S.disable,S.operation=c,S.groups&&(S.groups=S.groups.map((function(e){return e.id}))),q=function(){var e={name:j,default:void 0,desc:"\u4e3b\u952e",required:!0,is_array:!1,type:"pk"};S.parameter.push(e)},"list"===c&&(S.parameter=Object(z["i"])(o),S.ordering=d,S.displayfield=f,h&&(C=y.name,D=y.default,F={name:E,default:1,desc:"\u9875\u7801\u53c2\u6570",required:!1,is_array:!1,type:"PAGE_IDX"},N={name:C,default:D,desc:"\u9875\u957f\u53c2\u6570",required:!1,is_array:!1,type:"PAGE_SIZE"},S.parameter.push(F),S.parameter.push(N)),S.filter=Object(z["h"])(k)),"retrieve"===c&&(S.displayfield=f,S.parameter=[],q()),"create"===c&&(S.parameter=Object(z["i"])(o),S.displayfield=f,S.setfield=Object(z["j"])(v)),"update"!==c&&"replace"!==c||(S.parameter=Object(z["i"])(o),q(),S.displayfield=f,S.setfield=Object(z["j"])(v)),"delete"===c&&(S.parameter=[],q()),"update_by_condition"===c&&(S.parameter=Object(z["i"])(o),S.setfield=Object(z["j"])(v),S.filter=Object(z["h"])(k)),"delete_by_condition"===c&&(S.parameter=Object(z["i"])(o),S.filter=Object(z["h"])(k)),"func"===c&&(S.parameter=Object(z["i"])(o),S.func_name=O),!s){a.next=33;break}return A=e.props.match.params.id,a.next=31,Object(I["a"])(S,parseInt(A,10));case 31:return R["a"].push("/content/api_db__api"),a.abrupt("return");case 33:return a.next=35,Object(I["a"])(S);case 35:R["a"].push("/content/api_db__api");case 36:case"end":return a.stop()}}),a)}))),e}return Object(y["a"])(t,[{key:"componentDidMount",value:function(){var e=this.props.match.params.id;(0===e||e)&&this.setDefaultValues(e)}},{key:"setDefaultValues",value:function(){var e=Object(h["a"])(w.a.mark((function e(a){var t,r,n,l,i,c,s,u,p,m,o,d,b,h,E;return w.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.props,r=t.form.setFieldsValue,n=t.dispatch,l=this.props.schemas,e.next=4,n({type:"content/detail",payload:{model:"api_db__api",id:a}});case 4:return i=e.sent,c=i.operation,s=i.slug,e.next=8,Object(I["b"])(s);case 8:if(u=e.sent,this.setState({operation:c,model:u.app__model}),!Object(C["isEmpty"])(l)){e.next=14;break}return e.next=13,this.schemasData();case 13:l=e.sent;case 14:return e.next=16,Object(z["c"])(u,l);case 16:p=e.sent,m=p.displayfield,o=p.filter,d=p.parameter,b=p.setfield,h=p.pk,E={displayfield:m,filter:o,parameter:d,setfield:b,pk:h},delete p.displayfield,delete p.filter,delete p.parameter,delete p.setfield,delete p.pk,r(Object(f["a"])({},p),(function(){setTimeout((function(){return r(E)}),2e3)}));case 25:case"end":return e.stop()}}),e,this)})));function a(a){return e.apply(this,arguments)}return a}()},{key:"operation",get:function(){var e=this.props.location.query.operation,a=this.isUpdate;return!e&&a?this.state.operation:e}},{key:"isUpdate",get:function(){var e=this.props,a=e.match.params.id,t=e.location.query.operation;return!(t||0!==a&&!a)}},{key:"model",get:function(){var e=this.props.form.getFieldValue,a=e("app__model"),t=this.state.model;if(Object(C["isEmpty"])(a))return t;var r="".concat(a[0],"__").concat(a[1]);return r}},{key:"schemas",value:function(){var e=this.props.schemas;return e.api_db__api||[]}},{key:"next",value:function(){var e=Object(h["a"])(w.a.mark((function e(){var a,t,r,n,l;return w.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=this.state.current,t=this.props.form,r=t.validateFields,n=t.getFieldValue,0!==a){e.next=5;break}return e.next=5,r(["func_name","slug","app__model","size","page","pk"]);case 5:if(1!==a){e.next=11;break}return this.setState({checkValues:!0}),e.next=9,r();case 9:if(Object(z["f"])(n("parameter"))&&Object(z["g"])(n("setfield"))&&Object(z["d"])(n("filter"))){e.next=11;break}return e.abrupt("return");case 11:l=a+1,this.setState({current:l});case 13:case"end":return e.stop()}}),e,this)})));function a(){return e.apply(this,arguments)}return a}()},{key:"prev",value:function(){var e=this.state.current,a=e-1;this.setState({current:a})}},{key:"render",value:function(){var e=this,a=this.props,t=a.form,r=t.getFieldDecorator,n=t.getFieldValue,l=t.resetFields,f=a.schemas,b=a.appModels,h=this.state,E=h.current,y=h.checkValues,g=this.operation,j=this.isUpdate;if(Object(C["isEmpty"])(f))return q.a.createElement(d["a"],null);var v=function(e){return g&&T["a"][g].includes(e)},V=this.model,w=function(){return Object(M["a"])({dollarData:n("parameter")})},S=q.a.createElement("div",null,q.a.createElement(p["a"],null,q.a.createElement(m["a"],{sm:{offset:2},xl:{offset:1}},q.a.createElement(o["a"],{size:"large",style:{marginRight:15},onClick:l},"\u53d6\u6d88"),q.a.createElement(o["a"],{size:"large",type:"primary",onClick:this.handleSubmit},"\u63d0\u4ea4")))),D=q.a.createElement("div",null,q.a.createElement(H,Object(u["a"])({label:"\u64cd\u4f5c"},K),r("operation",{initialValue:g})(q.a.createElement(U,{field:this.schemas().fields.find((function(e){return"operation"===e.name})),choices:this.schemas().fields.find((function(e){return"operation"===e.name})).choices,options:{disable:!0},disabled:!0}))),v("func_name")&&q.a.createElement(H,Object(u["a"])({required:!0,label:"\u4e91\u51fd\u6570\u540d"},K),r("func_name",{rules:[{message:"\u8bf7\u8f93\u5165\u4e91\u51fd\u6570\u540d",required:!0}]})(q.a.createElement(s["a"],{placeholder:"\u8bf7\u8f93\u5165"}))),q.a.createElement(H,Object(u["a"])({label:"\u540d\u79f0"},K),r("name",{})(q.a.createElement(s["a"],{placeholder:"\u8bf7\u8f93\u5165"}))),q.a.createElement(H,Object(u["a"])({required:!0,label:"\u8def\u5f84"},K),r("slug",{rules:[{message:"\u8bf7\u8f93\u5165\u8def\u5f84",required:!0}]})(q.a.createElement(s["a"],{placeholder:"\u8bf7\u8f93\u5165"}))),q.a.createElement(H,Object(u["a"])({required:!0,label:"\u6a21\u578b"},K),r("app__model",{rules:[{message:"\u8bf7\u9009\u62e9\u6a21\u578b",required:!0}]})(q.a.createElement(c["a"],{options:b,placeholder:"\u8bf7\u9009\u62e9",displayRender:function(e){return e.join("__")}}))),v("paging")&&q.a.createElement(H,Object(u["a"])({label:"\u5206\u9875"},K),r("paging",{initialValue:!1})(q.a.createElement(B,null))),n("paging")&&v("size")&&q.a.createElement("div",null,q.a.createElement(H,Object(u["a"])({required:!0,label:"\u9875\u957f\u53c2\u6570"},K),r("size",{initialValue:{name:"pageSize",default:30},rules:[{validator:z["e"]}]})(q.a.createElement(A["b"],null))),q.a.createElement(H,Object(u["a"])({required:!0,label:"\u9875\u7801\u53c2\u6570"},K),r("page",{initialValue:"pageNumber",rules:[{message:"\u8bf7\u8f93\u5165\u9875\u7801\u53c2\u6570",required:!0}]})(q.a.createElement(s["a"],null)))),v("pk")&&q.a.createElement(H,Object(u["a"])({required:!0,label:"\u4e3b\u952e"},K),r("pk",{initialValue:"id",rules:[{message:"\u8bf7\u8f93\u5165\u4e3b\u952e",required:!0}]})(q.a.createElement(s["a"],null))),q.a.createElement(H,Object(u["a"])({label:"\u8bf4\u660e"},K,{wrapperCol:{xs:{span:24},sm:{span:20},xxl:{span:15}}}),r("summary",{})(q.a.createElement(J,{placeholder:"\u8bf7\u8f93\u5165\u5907\u6ce8",field:this.schemas().fields.find((function(e){return"summary"===e.name}))}))),q.a.createElement(H,Object(u["a"])({label:"\u542f\u7528"},K),r("disable",{initialValue:!1})(q.a.createElement(B,null)))),R=q.a.createElement("div",null,v("parameter")&&V&&q.a.createElement(H,null,r("parameter",{initialValue:{}})(q.a.createElement(A["c"],{schemas:f,model:V,operation:g,isNew:!j}))),v("setfield")&&V&&q.a.createElement(H,null,r("setfield",{initialValue:{}})(q.a.createElement(A["e"],{schemas:f,model:V,operation:g,getParameterValue:function(){return n("parameter")},isNew:!j}))),v("displayfield")&&V&&q.a.createElement(H,null,r("displayfield",{initialValue:[]})(q.a.createElement(A["a"],{schemas:f,model:V}))),v("filter")&&V&&q.a.createElement("div",null,q.a.createElement("div",{style:{paddingBottom:2}},q.a.createElement("span",{style:{fontSize:26}},"\u8fc7\u6ee4\u89c4\u5219")),q.a.createElement(H,null,r("filter",{initialValue:[]})(q.a.createElement(A["d"],{columns:Object(z["k"])(f,V),getVariableData:w,systemData:T["b"]})))),v("ordering")&&q.a.createElement(H,Object(u["a"])({label:"\u6392\u5e8f"},K,{labelCol:{xs:{span:24},sm:{span:2},xl:{span:1}}}),r("ordering",{})(q.a.createElement(_["a"],{placeholder:"\u8bf7\u9009\u62e9",mode:"multiple",allowClear:!0},Object(z["l"])(f,V).map((function(e){return q.a.createElement(X,{key:e.key,value:e.key},e.label)})))))),F=q.a.createElement("div",null,q.a.createElement(H,Object(u["a"])({label:"\u8981\u6c42\u767b\u5f55"},K),r("logined",{initialValue:!1})(q.a.createElement(B,null))),q.a.createElement(H,Object(u["a"])({label:"\u89d2\u8272"},K),r("groups",{})(q.a.createElement(U,{field:this.schemas().fields.find((function(e){return"groups"===e.name}))})))),N=function(){return q.a.createElement(O["a"],{current:E,style:{marginBottom:30}},q.a.createElement(G,{key:0,title:"\u57fa\u672c\u4fe1\u606f"}),q.a.createElement(G,{key:1,title:"\u64cd\u4f5c\u914d\u7f6e"}),q.a.createElement(G,{key:2,title:"\u6743\u9650\u914d\u7f6e"}))},P=q.a.createElement("div",null,q.a.createElement(k["a"],null,q.a.createElement(i["a"],null,j?q.a.createElement("div",null,q.a.createElement(x["a"],{defaultActiveKey:"1"},q.a.createElement(W,{tab:"\u57fa\u672c\u4fe1\u606f",key:"1",forceRender:!0},D),q.a.createElement(W,{tab:"\u64cd\u4f5c\u914d\u7f6e",key:"2",forceRender:!0},R),q.a.createElement(W,{tab:"\u6743\u9650\u914d\u7f6e",key:"3",forceRender:!0},F)),S):q.a.createElement("div",null,q.a.createElement("div",{style:{marginTop:30}},q.a.createElement(x["a"],{defaultActiveKey:"0",renderTabBar:N,activeKey:"".concat(E)},q.a.createElement(W,{key:"0",forceRender:!0},D),q.a.createElement(W,{key:"1",forceRender:!0},R),q.a.createElement(W,{key:"2",forceRender:!0},F))),q.a.createElement(p["a"],null,q.a.createElement(m["a"],{sm:{offset:2},xl:{offset:1}},E<2&&q.a.createElement(o["a"],{type:"primary",onClick:function(){return e.next()}},"\u4e0b\u4e00\u6b65"),E>0&&q.a.createElement(o["a"],{style:{marginLeft:8,marginRight:8},onClick:function(){return e.prev()}},"\u4e0a\u4e00\u6b65"),2===E&&q.a.createElement(o["a"],{style:{marginLeft:8,marginRight:8},onClick:l},"\u53d6\u6d88"),2===E&&q.a.createElement(o["a"],{type:"primary",onClick:this.handleSubmit},"\u63d0\u4ea4")))))));return q.a.createElement(z["a"].Provider,{value:y},P)}}]),t}(S["PureComponent"]))||l)||l)||l),Q=k["a"].create()(Z);a["default"]=function(e){return q.a.createElement(F["b"],null,q.a.createElement(Q,e))}}}]);