(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{JlTr:function(e,t,n){e.exports={header:"antd-pro-bsm-layouts-index-header",logo:"antd-pro-bsm-layouts-index-logo",menu:"antd-pro-bsm-layouts-index-menu",trigger:"antd-pro-bsm-layouts-index-trigger",right:"antd-pro-bsm-layouts-index-right",action:"antd-pro-bsm-layouts-index-action",search:"antd-pro-bsm-layouts-index-search",account:"antd-pro-bsm-layouts-index-account",avatar:"antd-pro-bsm-layouts-index-avatar",dark:"antd-pro-bsm-layouts-index-dark",name:"antd-pro-bsm-layouts-index-name"}},K3Pb:function(e,t,n){"use strict";n.r(t);n("fOrg");var a,r=n("+KLJ"),o=n("Y/ft"),i=n.n(o),c=n("gWZ8"),s=n.n(c),u=n("d6i3"),l=n.n(u),d=n("qIgq"),f=n.n(d),p=(n("+L6B"),n("2/Rp")),m=(n("/xke"),n("TeRw")),h=n("p0pE"),v=n.n(h),b=n("1l/V"),g=n.n(b),y=n("2Taf"),w=n.n(y),E=n("vZ4D"),k=n.n(E),C=n("MhPg"),S=n.n(C),R=n("l4Ni"),x=n.n(R),_=n("ujKo"),O=n.n(_),P=n("q1tI"),V=n.n(P),D=n("Hx5s"),$=n("3a4m"),M=n.n($),N=n("55Ip"),j=n("MuoO"),W=n("HP82"),I=n("vbsh"),T=n("jfUH"),K=n("CVtM"),U=(n("2qtc"),n("kLXV")),z=(n("5NDa"),n("5rEg")),F=(n("miYZ"),n("tsqr")),q=(n("y8nQ"),n("Vl3Y")),H=n("tl1k"),L=n.n(H);function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=O()(e);if(t){var r=O()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return x()(this,n)}}var B,Q=q.a.Item,J=Object(j.connect)(function(e){return{currentUser:e.user.currentUser}})(a=q.a.create()(a=function(e){S()(n,e);var t=A(n);function n(){var e;w()(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).setBaseInfo=function(){var t=e.props,n=t.currentUser,a=t.form;Object.keys(a.getFieldsValue()).forEach(function(e){var t={};t[e]=n[e]||null,a.setFieldsValue(t)})},e.getViewDom=function(t){e.view=t},e.handleCancel=function(){(0,e.props.handleCancel)()},e.handleSubmit=g()(l.a.mark(function t(){var n,a,r,o,i,c,s;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.props,a=n.form,r=a.validateFields,o=a.getFieldsValue,i=n.currentUser.id,t.next=3,r(function(e){});case 3:return t.next=5,Object(W.cloudFunction)({model:"bsm_config__setting",functionName:"update_user_password",params:v()({id:i},o())});case 5:if("9000"!==(c=t.sent).error_code){t.next=9;break}return F.a.error(c.error_data),t.abrupt("return");case 9:"0"!==(s=c.error_code)&&"403"!==s||((0,e.props.handleOk)(),M.a.push("/user/login"));case 11:case"end":return t.stop()}},t)})),e}return k()(n,[{key:"componentDidMount",value:function(){this.setBaseInfo()}},{key:"render",value:function(){var e=this.props,t=e.form.getFieldDecorator,n=e.visible;return V.a.createElement(U.a,{visible:n,title:"密码设置",onOk:this.handleSubmit,onCancel:this.handleCancel},V.a.createElement("div",{className:L.a.baseView,ref:this.getViewDom},V.a.createElement("div",{className:L.a.left},V.a.createElement(q.a,{layout:"vertical",onSubmit:this.handleSubmit,hideRequiredMark:!0},V.a.createElement(Q,{label:"旧密码"},t("oldPassWord",{rules:[{required:!0,message:"请输入旧密码!"}]})(V.a.createElement(z.a.Password,{placeholder:"请输入旧密码"}))),V.a.createElement(Q,{label:"新密码"},t("newPassWord",{rules:[{required:!0,message:"请输入新密码!"}]})(V.a.createElement(z.a.Password,{placeholder:"请输入新密码"})))))))}}]),n}(P.Component))||a)||a,Y=(n("T2oS"),n("W9HT")),G=(n("Telt"),n("Tckk")),Z=(n("lUTK"),n("BvKs")),X=(n("Pwec"),n("CtXQ")),ee=n("Y2fQ"),te=n("fVK0"),ne=(n("qVdP"),n("jsC+")),ae=n("TSYQ"),re=n.n(ae),oe=n("QyDn"),ie=n.n(oe),ce=function(e){var t=e.overlayClassName,n=i()(e,["overlayClassName"]);return V.a.createElement(ne.a,Object.assign({overlayClassName:re()(ie.a.container,t)},n))},se=n("JlTr"),ue=n.n(se);function le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=O()(e);if(t){var r=O()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return x()(this,n)}}var de,fe=Object(j.connect)(function(e){return{currentUser:e.user.currentUser}})(B=function(e){S()(n,e);var t=le(n);function n(){var e;w()(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={visible:!1},e}return k()(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.onMenuClick,a=t.currentUser,r=t.theme,o=a.permissions,i=void 0===o?[]:o,c=this.state.visible,s=V.a.createElement(Z.a,{className:ue.a.menu,selectedKeys:[],onClick:function(t){n(t),e.setState({visible:!1})}},V.a.createElement(Z.a.Item,{key:"changePassword"},V.a.createElement(X.a,{type:"form"}),"修改密码"),V.a.createElement(Z.a.Divider,null),i.includes(te.a.CHANGE_SETTING)&&V.a.createElement(Z.a.Item,{key:"webSettings"},V.a.createElement(X.a,{type:"setting"}),V.a.createElement(ee.FormattedMessage,{id:"menu.account.webSettings",defaultMessage:"webSettings"})),i.includes(te.a.CHANGE_SETTING)&&V.a.createElement(Z.a.Divider,null),V.a.createElement(Z.a.Item,{key:"about"},V.a.createElement(X.a,{type:"info-circle"}),V.a.createElement(ee.FormattedMessage,{id:"menu.about",defaultMessage:"about"})),V.a.createElement(Z.a.Divider,null),V.a.createElement(Z.a.Item,{key:"logout"},V.a.createElement(X.a,{type:"logout"}),V.a.createElement(ee.FormattedMessage,{id:"menu.account.logout",defaultMessage:"logout"}))),u=ue.a.right;return"dark"===r&&(u="".concat(ue.a.right,"  ").concat(ue.a.dark)),V.a.createElement("div",{className:u},a.username?V.a.createElement(ce,{overlay:s,visible:c,onVisibleChange:function(t){return e.setState({visible:t})}},V.a.createElement("span",{className:"".concat(ue.a.action," ").concat(ue.a.account)},V.a.createElement(G.a,{size:"small",className:ue.a.avatar,src:a.avatar,alt:"avatar",icon:!a.avatar&&"user"}),V.a.createElement("span",{className:ue.a.name},a.nick_name||a.name||a.username),V.a.createElement(X.a,{type:c?"caret-up":"caret-down",style:{marginLeft:8,fontSize:16,color:"#595959"}}))):V.a.createElement(Y.a,{size:"small",style:{marginLeft:8,marginRight:24}}))}}]),n}(P.Component))||B,pe=n("53l0");function me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=O()(e);if(t){var r=O()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return x()(this,n)}}var he=Object(j.connect)(function(e){var t=e.content;return{release:t.release,build:t.build}})(de=function(e){S()(n,e);var t=me(n);function n(){var e;w()(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={passWordVisible:!1,aboutVisible:!1},e.handleMenuClick=function(t){var n=t.key,a=e.props.dispatch;"logout"===n&&a({type:"content/logout"}),"webSettings"===n&&M.a.push("/account/settings"),"changePassword"===n&&e.showPassWord(),"about"===n&&e.setState({aboutVisible:!0})},e.handleOkPassWord=function(){e.setState({passWordVisible:!1})},e.handleCancelPassWord=function(){e.setState({passWordVisible:!1})},e.showPassWord=function(){e.setState({passWordVisible:!0})},e}return k()(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.release,a=t.build,r=this.state,o=r.passWordVisible,i=r.aboutVisible;return V.a.createElement(V.a.Fragment,null,V.a.createElement(fe,{onMenuClick:this.handleMenuClick}),V.a.createElement(J,{visible:o,handleCancel:this.handleCancelPassWord,handleOk:this.handleOkPassWord}),V.a.createElement(U.a,{title:"关于",visible:i,onOk:function(){e.setState({aboutVisible:!1})},onCancel:function(){e.setState({aboutVisible:!1})}},V.a.createElement("div",null,V.a.createElement("p",null,pe.f,"系统。由杰明科技荣誉出品。"),V.a.createElement("p",null,"发行版本号：",n),V.a.createElement("p",null,"前端构建版本：","NA"),V.a.createElement("p",null,"后端构建版本：",a))))}}]),n}(P.Component))||de,ve={adminConfig:function(){return"/config/admin"},chart:function(){return"/dashboard/charts"},puzzle:function(e){var t=e.puzzle;return"/puzzle/".concat(t)},list:function(e){var t=e.model;return{path:"/content/".concat(t),name:"".concat(Object(T.o)(t),"管理")}},detail:function(e){return"/content/".concat(e.model,"/detail/").concat(e.id||"__index__")},add:function(e){return"/content/".concat(e.model,"/add").concat(e.redirectPath?"?redirect_path=".concat(e.redirectPath):"")},auto:function(e){return e.path},iframe:function(e){return"/iframe/".concat(encodeURIComponent(e.path))},map:function(e){var t=e.model;return{path:"/content/".concat(t,"/map"),name:"".concat(Object(T.o)(t),"管理")}}},be={},ge={};var ye=0;function we(e){var t=e.icon,n=e.name,a=e.page,r=e.children,o=void 0===r?[]:r,c=e.params,s=i()(e,["icon","name","page","children","params"]),u="".concat(ye+=1,"/");o.length||(u=ve[a]?ve[a](v()({},s,c)):"/exception/404");for(var l=t||u.icon||null,d=["outlined","filled","twoTone"],f=0;f<d.length;f+=1){var p="__".concat(d[f]);if(l&&l.endsWith(p)){l=V.a.createElement(X.a,{type:l.slice(0,-p.length),theme:"outlined"});break}}return{icon:l,name:n||u.name||"无名菜单",path:u.path||u,children:o.map(we)}}function Ee(e){ye=0;var t=e.map(we);return t.forEach(function(e){return function e(t,n,a){t.children.length||(be[t.path]=n,ge[t.path]=a.concat({breadcrumbName:t.name,path:t.path})),t.children.forEach(function(r){return e(r,n.concat(t.path),a.concat({breadcrumbName:t.name,path:t.path}))})}(e,[],[])}),t}function ke(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=O()(e);if(t){var r=O()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return x()(this,n)}}var Ce=function(e,t,n,a){var r,o=arguments.length,i=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,a);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(o<3?r(i):o>3?r(t,n,i):r(t,n))||i);return o>3&&i&&Object.defineProperty(t,n,i),i},Se=function(e){var t={},n="";e.forEach(function e(a){n||0!==a.children.length||(n=a.path),a.children.forEach(function(n){t[n.path]=a.path,e(n)})});var a=[],r=location.pathname;for("/"===r&&(r=n);r in t;)r=t[r],a.push(r);return{openKeys:a,first:n}},Re=function(e){S()(n,e);var t=ke(n);function n(){var e;return w()(this,n),(e=t.apply(this,arguments)).state={visible:!0,passWordVisible:!1,aboutVisible:!1,openKeys:[],first:""},e.updateMenus=function(t){var n=Ee(t);e.setState({menus:n}),e.setState(Se(n))},e.onOpenChange=function(t){var n=e.state,a=n.menus,r=void 0===a?[]:a,o=n.openKeys,i=t.find(function(e){return-1===o.indexOf(e)});if(void 0!==i){var c={};r.forEach(function e(t){t.children.forEach(function(n){c[n.path]=t.path,e(n)})});var s=t.filter(function(e){return t=i,c[e]!==c[t];var t}).concat([i]);e.setState({openKeys:s})}else e.setState({openKeys:t})},e}return k()(n,[{key:"componentDidMount",value:function(){var e=g()(l.a.mark(function e(){var t,n,a,r,o,i,c,s=this;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.props,n=t.dispatch,a=t.route,r=a.routes,o=a.path,i=a.authority,Promise.all([n(window.$$userinfo&&window.$$permissions?{type:"user/saveCurrentUser",payload:v()({},window.$$userinfo,{permissions:window.$$permissions.map(T.B)})}:{type:"user/fetchCurrent"}),n(window.$$settings?{type:"bsmSetting/changeSettings",payload:window.$$settings}:{type:"bsmSetting/getSettings"})]).then(function(){var e,t,n=s.props,a=n.user,r=n.bsmSetting;(null===a||void 0===a?void 0:null===(e=a.currentUser)||void 0===e?void 0:null===(t=e.permissions)||void 0===t?void 0:t.includes("can_web_setting__bsm_config"))&&null===(null===r||void 0===r?void 0:r.DB_TIMEZONE)&&m.a.warn({duration:null,placement:"bottomRight",message:"版本兼容性警告",description:"未设置时区，当前版本需要设置数据库时区",key:"timezone-warning",onClick:function(){M.a.push("/account/settings/website"),m.a.close("timezone-warning")},btn:V.a.createElement(p.a,{type:"primary"},"前往设置")})}),n({type:"setting/getSetting"}),c=[],window.$$schemas&&window.$$admins||c.push(n({type:"content/getConfig"})),window.$$menus?this.updateMenus(window.$$menus):Promise.all([Object(W.getMenus)()].concat(c)).then(function(e){var t=f()(e,1)[0];return s.updateMenus(t)}),n({type:"menu/getMenuData",payload:{routes:r,path:o,authority:i}}),Object(I.c)("bsm_config__menu",[I.b.afterCreate,I.b.afterUpdate,I.b.afterDelete],function(){n({type:"user/fetchCurrent"}),Object(W.getMenus)().then(s.updateMenus)}),["menus","permissions","schemas","admins","userinfo","settings"].forEach(function(e){window["$".concat(e)]=window["$$".concat(e)],delete window["$$".concat(e)]});case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props,t=e.children,n=e.location.pathname,a=this.state,o=a.menus,c=a.openKeys,u=n.split("/").filter(function(e){return e}),l=[],d=u.map(function(e,t){return"/".concat(u.slice(0,t+1).join("/"))}).reverse().find(function(e){return e in ge});if(d){var f=[{breadcrumbName:"首页",path:"/"}].concat(s()(ge[d]));f=f.map(function(e){if(ge[d].length>1){var t=f.indexOf(e),n=f.length-1;if(0!==t&&t!==n){e.path;return i()(e,["path"])}}return e}),l.push.apply(l,s()(f))}var p={onOpenChange:this.onOpenChange,openKeys:c},m=this.props,h=m.logo,v=m.title,b=Object(T.v)(h,{mode:"lfit"}),g=V.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}},V.a.createElement(r.a,{message:"您没有任何菜单的权限，可以联系管理员给您配置角色",type:"warning"}));return V.a.createElement(D.c,{logo:b||pe.b,title:v||pe.f,fixSiderbar:!0,siderWidth:256,menuHeaderRender:function(e,t){return V.a.createElement(N.Link,{to:"/"},e,t)},menuItemRender:function(e,t){return e.isUrl||e.children||!e.path?t:V.a.createElement(N.Link,{to:e.path},t)},menuDataRender:function(e){return e.concat(o||[])},menuProps:p,breadcrumbRender:function(){return l},rightContentRender:function(){return V.a.createElement(he,null)},footerRender:function(){return K.a}},o&&0===o.length&&"/"===n?g:t)}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.location.pathname,a=t.first,r=t.menus,o=void 0===r?[]:r;return a&&"/"===n?(M.a.replace(a),Se(o)):null}}]),n}(P.Component);Re=Ce([T.a,Object(j.connect)(function(e){var t=e.setting;return v()({},t)})],Re);t.default=Re},QyDn:function(e,t,n){e.exports={container:"antd-pro-components-header-dropdown-index-container"}},tl1k:function(e,t,n){e.exports={baseView:"antd-pro-bsm-business-pages-account-settings-base-view-baseView",left:"antd-pro-bsm-business-pages-account-settings-base-view-left",right:"antd-pro-bsm-business-pages-account-settings-base-view-right",avatar_title:"antd-pro-bsm-business-pages-account-settings-base-view-avatar_title",avatar:"antd-pro-bsm-business-pages-account-settings-base-view-avatar",button_view:"antd-pro-bsm-business-pages-account-settings-base-view-button_view"}}}]);