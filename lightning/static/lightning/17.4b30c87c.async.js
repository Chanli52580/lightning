(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[17],{gmOI:function(e,t,n){"use strict";var a=n("g09b"),i=n("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.actionPermission=void 0;var r=a(n("qIgq"));n("SePM");var o,l,s=a(n("PMX6")),u=a(n("2Taf")),c=a(n("vZ4D")),d=a(n("MhPg")),f=a(n("l4Ni")),p=a(n("ujKo")),m=i(n("q1tI")),h=a(n("bKel")),y=n("Hg0r"),v=a(n("wd/R")),g=n("Hx5s"),I=n("sMR+"),b=n("C2ml"),k=a(n("pjZx")),E=n("jfUH");function S(e){var t=A();return function(){var n,a=(0,p.default)(e);if(t){var i=(0,p.default)(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return(0,f.default)(this,n)}}function A(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var D={edit:"change",delete:"delete",detail:"view"};t.actionPermission=D;var P=(o=(0,y.connect)(function(e){var t=e.content,n=t.schemas,a=t.adminConfig,i=t.data,r=e.loading,o=e.user.currentUser;return{schemas:n,adminConfig:a,data:i,loading:r.effects["content/fetch"]||r.effects["content/fetchAll"],currentUser:o}}),(0,h.default)(l=o(l=function(e){(0,d.default)(n,e);var t=S(n);function n(){return(0,u.default)(this,n),t.apply(this,arguments)}return(0,c.default)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.match.params.model,n=e.schemas,a=e.adminConfig;_.isEmpty(n)||_.isEmpty(a)||this.getList(this.displayInTree,t)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.match.params.model,a=t.adminConfig,i=e.match.params.model;n!==i&&this.getList((a[i]||{}).displayInTree,i)}},{key:"componentDidUpdate",value:function(e){var t=e.schemas,n=e.adminConfig,a=this.props,i=a.schemas,r=a.adminConfig,o=a.match.params.model;!_.isEmpty(t)&&!_.isEmpty(n)||_.isEmpty(i)||_.isEmpty(r)||this.getList(this.displayInTree,o)}},{key:"getList",value:function(e,t){var n=this.filters,a=this.props.dispatch;a(e?{type:"content/fetchAll",payload:{model:t,filters:n}}:{type:"content/fetch",payload:{model:t,filters:n,page:1,size:30}}),a({type:"content/statistics",payload:{model:t,filters:n}})}},{key:"render",value:function(){var e=this.props,t=e.data,n=e.schemas,a=e.loading,i=e.match.params.model,r=t[i]?t[i]:{list:[],pagination:{}};r.pagination&&(r.pagination.showTotal=function(e){return"\u5171".concat(e,"\u6761\u6570\u636e")});var o=this.modelAdmin,l=o.display,u=void 0===l?[(0,E.pkField)(i)]:l,c=o.editable,d=o.modalForm,f=void 0===d||d,p=o.actions,h=o.listStyle,y=o.exportable,v=o.sortable,S=o.tableActions,A=o.sortKey,D=o.modalDetail,P=o.inlineActions,R=o.maxInlineActions,_=n[i]?n[i].displayName:"",T=(0,I.getTable)(i);return m.default.createElement(g.PageHeaderWrapper,{title:"".concat(_,"\u5217\u8868"),key:_},m.default.createElement(b.DocumentTitle,null,_),m.default.createElement(s.default,null,this.permissions&&m.default.createElement(m.default.Fragment,null,this.permissions.includes("view")?m.default.createElement(T,{tableActions:S,data:r,loading:a,model:i,display:u,editable:c||[],inlineActions:P,maxInlineActions:R,modalForm:f,actions:p,listStyle:h,displayInTree:this.displayInTree,displayInSort:this.displayInSort,sortKey:A,exportable:y,sortable:v,modalDetail:D}):m.default.createElement(k.default,null))))}},{key:"filters",get:function(){var e=this,t=this.props,n=t.location.query,a=t.schemas,i=[];if(_.isEmpty(a))return i;for(var o=function(){var t=s[l];u=(0,r.default)(t,2);var n=u[0],a=u[1],o=e.modelSchema.fields.find(function(e){return e.name===n});if("datetime"===o.type){var c="YYYY/MM/DD",d=a.split(","),f=(0,r.default)(d,2),p=f[0],m=f[1];i.push({field:n,value:[(0,v.default)(p,c).toISOString(),(0,v.default)(m,c).toISOString()],operator:"between"})}else i.push({field:n,value:a,operator:"="})},l=0,s=Object.entries(n);l<s.length;l++){var u;o()}return i}},{key:"model",get:function(){var e=this.props.match.params.model;return e}},{key:"modelAdmin",get:function(){var e=this.props.adminConfig;return e[this.model]||{}}},{key:"modelSchema",get:function(){var e=this.props,t=e.match.params.model,n=e.schemas;return n[t]}},{key:"displayInTree",get:function(){return!0===this.modelAdmin.displayInTree}},{key:"displayInSort",get:function(){return!0===this.modelAdmin.displayInSort}},{key:"permissions",get:function(){var e=this.props,t=e.currentUser.permissions,n=e.match.params.model;return!!t&&t.filter(function(e){return e.endsWith("_".concat(n))}).map(function(e){return e.split("_")[0]})}}]),n}(m.PureComponent))||l)||l),R=P;t.default=R},zrVq:function(e,t,n){"use strict";var a=n("g09b"),i=n("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,o=a(n("2Taf")),l=a(n("vZ4D")),s=a(n("MhPg")),u=a(n("l4Ni")),c=a(n("ujKo")),d=i(n("q1tI")),f=a(n("bKel")),p=a(n("gmOI")),m=a(n("7gdK"));function h(e){var t=y();return function(){var n,a=(0,c.default)(e);if(t){var i=(0,c.default)(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return(0,u.default)(this,n)}}function y(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var v=(0,f.default)(r=function(e){(0,s.default)(n,e);var t=h(n);function n(){return(0,o.default)(this,n),t.apply(this,arguments)}return(0,l.default)(n,[{key:"render",value:function(){var e=this.props.match.params.model;return d.default.createElement(d.default.Fragment,null,d.default.createElement(p.default,this.props),d.default.createElement(m.default,{key:e,model:e}))}}]),n}(d.Component))||r,g=v;t.default=g}}]);