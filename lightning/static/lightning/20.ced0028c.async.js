(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{zrVq:function(t,e,n){"use strict";n.r(e);var i,r,a=n("2Taf"),o=n.n(a),s=n("vZ4D"),c=n.n(s),l=n("MhPg"),p=n.n(l),u=n("l4Ni"),m=n.n(u),f=n("ujKo"),d=n.n(f),h=n("q1tI"),y=n.n(h),v=n("bKel"),g=n.n(v),b=n("qIgq"),I=n.n(b),k=(n("IzEo"),n("bx4M")),E=n("MuoO"),S=n("wd/R"),D=n.n(S),R=n("Hx5s"),A=n("sMR+"),C=n("C2ml"),w=n("pjZx"),x=n("jfUH");function M(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return m()(this,n)}}var T,Y=(i=Object(E.connect)(function(t){var e=t.content,n=e.schemas,i=e.adminConfig,r=e.data,a=t.loading,o=t.user.currentUser;return{schemas:n,adminConfig:i,data:r,loading:a.effects["content/fetch"]||a.effects["content/fetchAll"],currentUser:o}}),g()(r=i(r=function(t){p()(n,t);var e=M(n);function n(){return o()(this,n),e.apply(this,arguments)}return c()(n,[{key:"componentDidMount",value:function(){var t=this.props,e=t.match.params.model,n=t.schemas,i=t.adminConfig;_.isEmpty(n)||_.isEmpty(i)||this.getList(this.displayInTree,e)}},{key:"componentWillReceiveProps",value:function(t){var e=this.props,n=e.match.params.model,i=e.adminConfig,r=t.match.params.model;n!==r&&this.getList((i[r]||{}).displayInTree,r)}},{key:"componentDidUpdate",value:function(t){var e=t.schemas,n=t.adminConfig,i=this.props,r=i.schemas,a=i.adminConfig,o=i.match.params.model;!_.isEmpty(e)&&!_.isEmpty(n)||_.isEmpty(r)||_.isEmpty(a)||this.getList(this.displayInTree,o)}},{key:"getList",value:function(t,e){var n=this.filters,i=this.props.dispatch;i(t?{type:"content/fetchAll",payload:{model:e,filters:n}}:{type:"content/fetch",payload:{model:e,filters:n,page:1,size:30}}),i({type:"content/statistics",payload:{model:e,filters:n}})}},{key:"render",value:function(){var t=this.props,e=t.data,n=t.schemas,i=t.loading,r=t.match.params.model,a=e[r]?e[r]:{list:[],pagination:{}};a.pagination&&(a.pagination.showTotal=function(t){return"共".concat(t,"条数据")});var o=this.modelAdmin,s=o.display,c=void 0===s?[Object(x.C)(r)]:s,l=o.editable,p=o.modalForm,u=void 0===p||p,m=o.actions,f=o.listStyle,d=o.exportable,h=o.sortable,v=o.tableActions,g=o.sortKey,b=o.modalDetail,I=o.inlineActions,E=o.maxInlineActions,S=n[r]?n[r].displayName:"",D=Object(A.a)(r);return y.a.createElement(R.b,{title:"".concat(S,"列表"),key:S},y.a.createElement(C.a,null,S),y.a.createElement(k.a,null,this.permissions&&y.a.createElement(y.a.Fragment,null,this.permissions.includes("view")?y.a.createElement(D,{tableActions:v,data:a,loading:i,model:r,display:c,editable:l||[],inlineActions:I,maxInlineActions:E,modalForm:u,actions:m,listStyle:f,displayInTree:this.displayInTree,displayInSort:this.displayInSort,sortKey:g,exportable:d,sortable:h,modalDetail:b}):y.a.createElement(w.a,null))))}},{key:"filters",get:function(){var t=this,e=this.props,n=e.location.query,i=e.schemas,r=[];if(_.isEmpty(i))return r;for(var a=function(){var e=s[o],n=(c=I()(e,2))[0],i=c[1];if("datetime"===t.modelSchema.fields.find(function(t){return t.name===n}).type){var a=i.split(","),l=I()(a,2),p=l[0],u=l[1];r.push({field:n,value:[D()(p,"YYYY/MM/DD").toISOString(),D()(u,"YYYY/MM/DD").toISOString()],operator:"between"})}else r.push({field:n,value:i,operator:"="})},o=0,s=Object.entries(n);o<s.length;o++){var c;a()}return r}},{key:"model",get:function(){return this.props.match.params.model}},{key:"modelAdmin",get:function(){return this.props.adminConfig[this.model]||{}}},{key:"modelSchema",get:function(){var t=this.props,e=t.match.params.model;return t.schemas[e]}},{key:"displayInTree",get:function(){return!0===this.modelAdmin.displayInTree}},{key:"displayInSort",get:function(){return!0===this.modelAdmin.displayInSort}},{key:"permissions",get:function(){var t=this.props,e=t.currentUser.permissions,n=t.match.params.model;return!!e&&e.filter(function(t){return t.endsWith(n)}).map(function(t){return t.split("_")[0]})}}]),n}(h.PureComponent))||r)||r),j=n("7gdK");function O(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return m()(this,n)}}var q=g()(T=function(t){p()(n,t);var e=O(n);function n(){return o()(this,n),e.apply(this,arguments)}return c()(n,[{key:"render",value:function(){var t=this.props.match.params.model;return y.a.createElement(y.a.Fragment,null,y.a.createElement(Y,this.props),y.a.createElement(j.a,{key:t,model:t}))}}]),n}(h.Component))||T;e.default=q}}]);