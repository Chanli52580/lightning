(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{oIFs:function(e,t,n){},p5GZ:function(e,t,n){"use strict";n.r(t);n("OaEy");var r,a,o=n("2fM7"),c=n("q1tI"),i=n.n(c),u=n("9Ndd"),l=n("2mwZ"),s=n("ASN+"),f=n("d76M"),p=(n("2qtc"),n("kLXV")),d=n("eHn4"),m=n.n(d),y=["char","slug","url","image","email"],h=m()({},"text",["array","object"]),v=[["text","char","slug","image","email","uuid","ipaddr","int","bigint","smallint","positivesmallint","positiveint","decimal","float"],["o2o","fk","m2m"]],b=(r={},m()(r,"int","整数"),m()(r,"char","字符串"),m()(r,"text","长文本"),m()(r,"bool","布尔值"),m()(r,"fk","引用"),m()(r,"m2m","多对多"),m()(r,"o2o","一对一"),m()(r,"decimal","小数"),m()(r,"date","日期"),m()(r,"datetime","日期时间"),m()(r,"time","时间"),m()(r,"email","电子邮件"),m()(r,"auto","自增整数"),m()(r,"float","浮点数"),m()(r,"ipaddr","ip地址"),m()(r,"positiveint","非负整数"),m()(r,"slug","简短标识"),m()(r,"url","URL"),m()(r,"uuid","唯一标识符"),m()(r,"bigint","大整数"),m()(r,"smallint","小整数"),m()(r,"positivesmallint","小正整数"),m()(r,"image","图片"),m()(r,"object","对象"),m()(r,"array","数组"),r),g={fieldHandler:{validateTypeSelected:function(e){var t=e.name,n=e.value,r=e.initialValue,a=e.form;y.includes(n)&&y.includes(r)||r in h&&h[r].includes(n)||v[0].includes(r)&&v[1].includes(n)||(setTimeout(function(){a.resetFields([t])},1e3),p.a.warning({title:"不合法的字段类型转换",content:"不支持将“".concat(b[r],"”字段类型转换为“").concat(b[n],"”字段类型")}))}}},j=(n("fu2T"),n("gK9i")),O=(n("14J3"),n("BMrR")),w=(n("jCWc"),n("kPKH")),E=(n("sRBo"),n("kaz8")),S=n("qIgq"),k=n.n(S),C=n("gWZ8"),F=n.n(C),P=n("d6i3"),T=n.n(P),x=n("1l/V"),A=n.n(x),R=n("2Taf"),N=n.n(R),D=n("vZ4D"),I=n.n(D),M=n("MhPg"),q=n.n(M),V=n("l4Ni"),U=n.n(V),B=n("ujKo"),W=n.n(B),H=n("MuoO"),L=n("AAgL"),G=n("HP82");function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=W()(e);if(t){var a=W()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return U()(this,n)}}var K=Object(H.connect)(function(e){return{schemas:e.content.schemas}})(a=function(e){q()(n,e);var t=z(n);function n(){var e;N()(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).state={remoteChoices:[]},e.myProps=["titlefield"],e.doSearch=A()(T.a.mark(function t(){var n,r,a;return T.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(G.cloudFunction)({model:"auth__permission",functionName:"get_assign_permissions"});case 2:n=t.sent,r=n.result,a=r.map(function(e){return[e.id,e]}),e.setState({remoteChoices:a});case 6:case"end":return t.stop()}},t)})),e.permissionCheck=function(t){var n=e.props,r=n.value,a=n.onChange,o=r.map(function(e){return e.id||e}),c=t.id;o.includes(c)?a(o.filter(function(e){return e!==c})):a([].concat(F()(o),[c]))},e.modelCheck=function(t){var n=e.props,r=n.value,a=n.onChange,o=r.map(function(e){return e.id||e}),c=new Set(o),i=t.filter(function(e){return!c.has(e.id)});i.length?a([].concat(F()(o),F()(i.map(function(e){return e.id})))):a(o.filter(function(e){return!t.map(function(e){return e.id}).includes(e)}))},e}return I()(n,[{key:"componentDidMount",value:function(){this.doSearch()}},{key:"render",value:function(){var e=this,t=this.props,n=t.value,r=void 0===n?[]:n,a=t.schemas,o=this.state.remoteChoices;if(!o.length)return null;var c=new Set(r.map(function(e){return e.id||e})),u={},l={};return o.forEach(function(e){var t=k()(e,2),n=t[0],r=t[1],a=r.display_name,o=r.content_type,c=o.app_verbose_name,i=o.app_label,s=o.model;l[i]=c,u[i]||(u[i]={}),u[i][s]||(u[i][s]=[]),u[i][s].push({id:n,name:a,children:[]})}),i.a.createElement(j.a,{bordered:!1,defaultActiveKey:Object.keys(u).filter(function(e){return _.flatten(_.values(u[e])).find(function(e){return c.has(e.id)})})},Object.entries(u).map(function(t){var n=k()(t,2),r=n[0],o=n[1];return i.a.createElement(j.a.Panel,{key:r,header:l[r]},Object.entries(o).map(function(t){var n=k()(t,2),o=n[0],u=n[1];return i.a.createElement(O.a,{key:"".concat(r,"__").concat(o)},i.a.createElement(w.a,{span:5,style:{minWidth:100,height:32,overflowX:"auto",whiteSpace:"nowrap"}},i.a.createElement(E.a,{checked:u.every(function(e){return c.has(e.id)}),onChange:function(){return e.modelCheck(u)},indeterminate:u.some(function(e){return c.has(e.id)})&&!u.every(function(e){return c.has(e.id)})},i.a.createElement("strong",null,(a["".concat(r,"__").concat(o)]||{}).displayName||o))),i.a.createElement(w.a,{span:18},i.a.createElement(O.a,{type:"flex"},u.map(function(t){return i.a.createElement(w.a,{key:t.id,span:6,style:{minWidth:100,overflowX:"auto",overflowY:"hidden",whiteSpace:"nowrap"}},i.a.createElement(E.a,{checked:c.has(t.id),onChange:function(){return e.permissionCheck(t)}},t.name))}))))}))}))}},{key:"titleField",get:function(){return this.props.titlefield||this.refSchema.titleField}},{key:"refSchema",get:function(){return this.props.schemas[this.refModel]}},{key:"refModel",get:function(){return this.props.field.ref}}]),n}(L.a))||a,Y=n("K/pY"),J=n("fNJA");var Z=n("jfUH");function X(e,t,n,r,a){var o=r.watchFields,c=r.parameters,i=c.targetField,l=c.mapping,s=a.model,f=a.schemas,p=a.adminConfig,d=f[s],y=d.fields.filter(function(e){return-1!==o.indexOf(e.name)&&"mref"===e.type}),h=d.fields.find(function(e){return e.name===i&&"bref"===e.type});if(y&&h&&y.length===o.length){var v=o.map(function(r){return r===t?n:e.getFieldsValue([r])[r]});if(!(v.filter(function(e){return void 0!==e}).length<=1)){var b=function e(t){if(1===t.length)return t[0].map(function(e){return[e]});var n=[],r=t[0],a=t[1];if(r.forEach(function(e){a.forEach(function(t){n.push([e,t])})}),t.length>2){var o=t.splice(0,2),c=[n].concat(F()(o));n=e(c)}return n}(v),g=[],j=f[h.ref];b.forEach(function(e){var t=Object(u.b)(j,p[h.ref].formFields);o.forEach(function(n,r){var a=l[n];t[a]=e[r]}),g.push(t)});var O=e.getFieldsValue([i])[i];if(g.length>0){var w=[];if(O&&O.length>0){var E=_.values(l);g.forEach(function(e){var t=!1,n=E.map(function(t){return e[t][Object(Z.D)(j.fields.find(function(e){return e.name===t}).ref)]}).join("_");O.every(function(e){var r=E.map(function(t){return e[t][Object(Z.D)(j.fields.find(function(e){return e.name===t}).ref)]}).join("_");return n!==r||(t=!0,w.push(e),!1)}),t||w.push(e)}),e.setFieldsValue(m()({},i,w))}else e.setFieldsValue(m()({},i,g))}else O&&O.length>0&&e.setFieldsValue(m()({},i,[]))}}}var Q=n("jehZ"),$=n.n(Q),ee=n("IAeB"),te=n("EBSl"),ne=n("xNPh");function re(e){var t=e.model,n=e.currentActionObject,r=e.currentObject,a=e.currentActionParams,o=e.context,c=n.callback;return function(e){var t,n=e.model,r=e.onCreate,a=void 0===r?function(){}:r,o=e.onUpdate,c=void 0===o?function(){}:o,u=e.currentObject,l=void 0===u?{}:u,s=e.currentActionParams,f=void 0===s?{}:s,p=e.Id,d=e.formProps,y=void 0===d?{}:d;l&&(t=p||Object(Z.C)(l,n));var h=Object(ne.a)(n),v=f.isCopy,b=f.editFields,g=f.fields,j=void 0===g?[]:g,O={};v&&(O.isCopy=!0),_.isEmpty(j)||(O.hiddenvalues=j.reduce(function(e,t){var n=e;return n[t.name]=t.value,n},{}),O.partialupdate=!0),b&&(O.fields=b,O.partialupdate=!0);var w=n,E=t,S=l;if(f.field){var k=Object(Z.r)(n,f.field,l),C=k.id,F=k.schemaField,P=k.value;if(w=F.ref,"refAdd"===f.action){var T="bref"===F.type?t:[t];O.hiddenvalues=m()({},F.refField,T),O.hiddenFields=O.hiddenvalues,E=void 0,S=void 0}else E=C,S=P}return f.model&&(w=f.model),i.a.createElement(h,$()({model:w,objectid:E,currentObject:S,onCreate:a,onUpdate:c},y,O))}({model:t,currentObject:r,currentActionParams:a,onUpdate:function(){return c(o)},onCreate:function(){return c(o)},formProps:o.formProps})}function ae(e){var t=e.model,n=e.currentObject,r=e.currentActionParams,a=e.Schemas,o=(void 0===a?[]:a)[t]||{};if(r.field){var c=Object(Z.t)(t,r.field);return"编辑".concat(c.displayName)}return"".concat(n[o.titleField]?"【".concat(n[o.titleField],"】- "):"","编辑").concat(o.displayName)}function oe(e){return function(e){var t=e.model,n=e.currentObject,r=e.currentActionParams,a=t,o=Object(Z.C)(n,t),c=r.field,u=r.page;if(c){var l=Object(Z.r)(t,c,n),s=l.id;a=l.schemaField.ref,o=s}return i.a.createElement(ee.a,{model:a,page:u,id:o,custom:!0})}({model:e.model,currentObject:e.currentObject,currentActionParams:e.currentActionParams})}function ce(e){var t=e.model,n=e.currentActionParams,r=e.Schemas,a=(void 0===r?[]:r)[t]||{};if(n.field){var o=Object(Z.t)(t,n.field);return"".concat(o.displayName,"详情")}return"".concat(a.displayName,"详情")}function ie(e){var t=e.model,n=e.currentActionParams,r=e.Schemas,a=void 0===r?[]:r,o=a[t]||{};if(n.field){var c=Object(Z.t)(t,n.field);return"新建".concat(c.displayName)}return n.model?"新建".concat(a[n.model].displayName):"新建".concat(o.displayName)}function ue(e){(0,e.refresh)()}n("+L6B");var le=n("2/Rp"),se=(n("y8nQ"),n("Vl3Y")),fe=n("8YRU"),pe=n("0SIm"),de=Object(H.connect)()(function(e){var t=Object(c.useState)(),n=k()(t,2),r=n[0],a=n[1],o=e.field,u=e.refresh,l=e.dispatch,s=e.model,f=e.mode,p=e.widget,d=e.selectedRowIds,m=void 0===d?[]:d,y=e.groupBy,h=Object(Z.t)(s,o);var v=fe.a;"Cascader"===p&&(v=pe.a);var b={field:h,onChange:a,value:r,groupBy:y};return i.a.createElement(se.a,{labelCol:{span:5},wrapperCol:{span:19}},i.a.createElement(se.a.Item,{label:h.displayName},i.a.createElement(v,b)),i.a.createElement(se.a.Item,{wrapperCol:{offset:5}},i.a.createElement(le.a,{type:"primary",onClick:function(){var e=window.g_app._store.getState().content.schemas;if(r){var t={};t[h.refField]=m;var n={newValues:t,model:h.ref,id:Object(Z.C)(r,h.ref),schema:e[h.ref]};"append"===f&&(n.appendModeFields=[h.refField]),l({type:"content/patch",payload:n}).then(u)}}},"提交")))});var me=n("LvDl"),ye=n.n(me);n("cIOH"),n("oIFs");var he=n("TSYQ"),ve=n.n(he);function be(e){"@babel/helpers - typeof";return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ge(){return(ge=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _e(e,t){return(_e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function we(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Ee(e);if(t){var a=Ee(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===be(t)||"function"==typeof t))return t;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function Ee(e){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Se=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_e(e,t)}(o,c["Component"]);var t,n,r,a=we(o);function o(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),a.apply(this,arguments)}return t=o,(n=[{key:"render",value:function(){var e,t,n=this.props,r=n.prefixCls,a=n.className,o=n.style,i=n.size,u=n.shape,l=ve()((je(e={},"".concat(r,"-lg"),"large"===i),je(e,"".concat(r,"-sm"),"small"===i),e)),s=ve()((je(t={},"".concat(r,"-circle"),"circle"===u),je(t,"".concat(r,"-square"),"square"===u),t)),f="number"==typeof i?{width:i,height:i,lineHeight:"".concat(i,"px")}:{};return c.createElement("span",{className:ve()(r,a,l,s),style:ge(ge({},f),o)})}}])&&Oe(t.prototype,n),r&&Oe(t,r),o}();Se.defaultProps={size:"large"};var ke=Se;function Ce(){return(Ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var Fe=function(e){var t=e.prefixCls,n=e.className,r=e.width,a=e.style;return c.createElement("h3",{className:ve()(t,n),style:Ce({width:r},a)})};function Pe(e){"@babel/helpers - typeof";return(Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Te(e){return function(e){if(Array.isArray(e))return xe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return xe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xe(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Re(e,t){return(Re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=De(e);if(t){var a=De(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===Pe(t)||"function"==typeof t))return t;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function De(e){return(De=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ie=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Re(e,t)}(o,c["Component"]);var t,n,r,a=Ne(o);function o(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),a.apply(this,arguments)}return t=o,(n=[{key:"getWidth",value:function(e){var t=this.props,n=t.width,r=t.rows,a=void 0===r?2:r;return Array.isArray(n)?n[e]:a-1===e?n:void 0}},{key:"render",value:function(){var e=this,t=this.props,n=t.prefixCls,r=t.className,a=t.style,o=t.rows,i=Te(Array(o)).map(function(t,n){return c.createElement("li",{key:n,style:{width:e.getWidth(n)}})});return c.createElement("ul",{className:ve()(n,r),style:a},i)}}])&&Ae(t.prototype,n),r&&Ae(t,r),o}(),Me=n("H84U");function qe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ve(){return(Ve=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Be(e,t){return(Be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function We(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=He(e);if(t){var a=He(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===Le(t)||"function"==typeof t))return t;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function He(e){return(He=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Le(e){"@babel/helpers - typeof";return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ge(e){return e&&"object"===Le(e)?e:{}}var ze=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Be(e,t)}(o,c["Component"]);var t,n,r,a=We(o);function o(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(e=a.apply(this,arguments)).renderSkeleton=function(t){var n=t.getPrefixCls,r=e.props,a=r.prefixCls,o=r.loading,i=r.className,u=r.children,l=r.avatar,s=r.title,f=r.paragraph,p=r.active,d=n("skeleton",a);if(o||!("loading"in e.props)){var m,y,h,v=!!l,b=!!s,g=!!f;if(v){var j=Ve(Ve({prefixCls:"".concat(d,"-avatar")},function(e,t){return e&&!t?{shape:"square"}:{shape:"circle"}}(b,g)),Ge(l));y=c.createElement("div",{className:"".concat(d,"-header")},c.createElement(ke,j))}if(b||g){var O,_;if(b){var w=Ve(Ve({prefixCls:"".concat(d,"-title")},function(e,t){return!e&&t?{width:"38%"}:e&&t?{width:"50%"}:{}}(v,g)),Ge(s));O=c.createElement(Fe,w)}if(g){var E=Ve(Ve({prefixCls:"".concat(d,"-paragraph")},function(e,t){var n={};return e&&t||(n.width="61%"),n.rows=!e&&t?3:2,n}(v,b)),Ge(f));_=c.createElement(Ie,E)}h=c.createElement("div",{className:"".concat(d,"-content")},O,_)}var S=ve()(d,i,(qe(m={},"".concat(d,"-with-avatar"),v),qe(m,"".concat(d,"-active"),p),m));return c.createElement("div",{className:S},y,h)}return u},e}return t=o,(n=[{key:"render",value:function(){return c.createElement(Me.a,null,this.renderSkeleton)}}])&&Ue(t.prototype,n),r&&Ue(t,r),o}();ze.defaultProps={avatar:!1,title:!0,paragraph:!0};var Ke=ze;function Ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=W()(e);if(t){var a=W()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return U()(this,n)}}var Je=se.a.Item,Ze=o.a.Option,Xe={},Qe=function(e){q()(n,e);var t=Ye(n);function n(){var e;return N()(this,n),(e=t.call(this)).onFieldsChange=function(){var t=A()(T.a.mark(function t(n,r,a){var o,c,i;return T.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o=e.props.form,c=o.getFieldValue("through_field_1"),i=o.getFieldValue("through_field_2"),c===i&&a("请选择不同的外键"),a();case 5:case"end":return t.stop()}},t)}));return function(e,n,r){return t.apply(this,arguments)}}(),e.submit=A()(T.a.mark(function t(){var n,r,a,o,c;return T.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.props,r=n.form,a=n.record,o=n.closeModal,e.setState({loading:!0}),(c=r.getFieldsValue()).model_id=a.id,t.prev=4,t.next=7,Object(G.setIntermediaryTable)(c);case 7:e.setState({loading:!1}),o(),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(4);case 14:case"end":return t.stop()}},t,null,[[4,11]])})),e.check=function(){e.props.form.validateFields(function(t){t||e.submit()})},e.state={fkFields:[],loading:!1},e}return I()(n,[{key:"componentDidMount",value:function(){var e=A()(T.a.mark(function e(){var t,n,r,a;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.record,this.setState({loading:!0}),e.next=4,Object(G.queryContent)({model:"meta__field",filters:[{field:"model",value:t.id,operator:"="}]},1,1e3);case 4:n=e.sent,r=n.list,this.setState({loading:!1}),a=r.filter(function(e){return"fk"===e.type}),this.setState({fkFields:a});case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"renderForm",value:function(){var e=this.props,t=e.form,n=t.getFieldDecorator,r=t.getFieldValue,a=t.resetFields,c=t.getFieldsValue,u=e.closeModal,l=this.state,s=l.fkFields,f=l.loading,p=function(e){return s.map(function(t){return i.a.createElement(Ze,{disabled:e===t.name,key:t.name},t.verbose_name||t.name||t.db_column)})};return i.a.createElement("div",null,i.a.createElement(se.a,Xe,i.a.createElement(Je,{label:"主表外键"},n("through_field_1",{rules:[{required:!0,message:"主表外键是必填的"}]})(i.a.createElement(o.a,{allowClear:!0},p(r("through_field_2"))))),i.a.createElement(Je,{label:"次表外键"},n("through_field_2",{rules:[{required:!0,message:"次表外键是必填的"},{validator:this.onFieldsChange}]})(i.a.createElement(o.a,{allowClear:!0},p(r("through_field_1"))))),i.a.createElement(Je,null,i.a.createElement(O.a,null,i.a.createElement(w.a,null,i.a.createElement(le.a,{type:"primary",onClick:this.check,style:{marginRight:16},disabled:f},"保存"),i.a.createElement(le.a,{type:"default",onClick:function(){u()}},"取消"),_.values(c()).some(Boolean)&&i.a.createElement(le.a,{style:{marginLeft:16},onClick:function(){return a()}},"重设"))))))}},{key:"render",value:function(){var e=this.props.record;return!e.fk_field_count||e.fk_field_count<2?i.a.createElement("p",null,"不支持将该表设置为中间表"):this.renderForm()}}]),n}(c.PureComponent),$e=se.a.create({})(Qe),et=n("oORW");function tt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=W()(e);if(t){var a=W()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return U()(this,n)}}function nt(e){var t=e.username,n=e.is_active,r=e.handleOk,a=Object(c.useState)(),o=k()(a,2),u=o[0],l=o[1];function s(){return(s=A()(T.a.mark(function e(){return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(G.setUserPassword)({username:t,password:u,is_active:n});case 2:r();case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}return i.a.createElement("div",null,i.a.createElement("div",{style:{width:400,margin:"auto"}},i.a.createElement(se.a,{layout:"horizontal",labelCol:{span:4},wrapperCol:{span:19}},i.a.createElement(se.a.Item,{label:"密码",labelAlign:"right",required:!0},i.a.createElement(et.a,{value:u,onChange:function(e){return l(e)}}))),i.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:16}},i.a.createElement(le.a,{type:"primary",onClick:function(){return s.apply(this,arguments)}},"提交"))))}var rt,at,ot=function(e){q()(n,e);var t=tt(n);function n(){var e;N()(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).state={groups:[]},e.onSubmit=A()(T.a.mark(function t(){var n,r,a,o,c;return T.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.props,r=n.username,a=n.handleOk,o=n.is_active,c=e.state.groups,t.next=4,Object(G.setUserGroups)({username:r,groups:c.map(function(e){return e.id}),is_active:o});case 4:a();case 5:case"end":return t.stop()}},t)})),e}return I()(n,[{key:"componentWillMount",value:function(){var e=A()(T.a.mark(function e(){var t,n,r,a;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,n=t.username,r=t.is_active,e.next=3,Object(G.getUserGroups)({username:n,is_active:r});case 3:a=e.sent,this.setState({groups:a});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=window.g_app._store.getState().content.schemas,n=this.state.groups;return i.a.createElement("div",null,i.a.createElement("div",{style:{width:400,margin:"auto"}},i.a.createElement(se.a,{layout:"horizontal",labelCol:{span:4},wrapperCol:{span:19}},i.a.createElement(se.a.Item,{label:"角色",required:!0},i.a.createElement(fe.a,{field:t.member__user.fields.find(function(e){return"groups"===e.name}),onChange:function(t){return e.setState({groups:t})},value:n}))),i.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:16}},i.a.createElement(le.a,{type:"primary",onClick:this.onSubmit},"提交"))))}}]),n}(i.a.Component),ct=n("fVK0"),it=n("jmXY"),ut=n("vbsh"),lt=n("4kRQ"),st=Object(lt.c)(function(){return n.e(0).then(n.bind(null,"z2hv"))},{loading:i.a.createElement(Ke,{active:!0})});function ft(e){var t=e.model,n=e.value,r=e.onChange,a=e.schemas,u=a&&t&&a[t].fields||[];return Object(c.useEffect)(function(){rt=t,at=t},[]),Object(c.useEffect)(function(){rt===t&&at===t||r(""),at=t},[t]),i.a.createElement(o.a,{onChange:r,value:n,allowClear:!0},u.map(function(e){return i.a.createElement(o.a.Option,{key:e.name},e.name," (",e.displayName,")")}))}function pt(){var e;Object(u.e)("JSONCommonField",l.a),Object(u.e)("License",s.a),Object(f.b)("meta__field",g),Object(u.e)("PermissionSelect",K),Object(u.e)("ModelSelect",Y.a),Object(u.e)("FieldSelect",ft),Object(J.c)(J.a,"generate","生成数据",X),Object(te.o)({type:te.c,action:"edit",name:"编辑",rspType:te.j,title:ae,component:re,callback:ue}),Object(te.o)({type:te.c,action:"partEdit",name:"部份编辑",rspType:te.j,title:ae,component:re,callback:ue}),Object(te.o)({type:te.c,action:"refEdit",name:"关联编辑",rspType:te.j,title:ae,component:re,callback:ue}),Object(te.o)({type:te.c,action:"detail",name:"详情",rspType:te.j,title:ce,component:oe}),Object(te.o)({type:te.c,action:"refDetail",name:"关联详情",rspType:te.j,title:ce,component:oe}),Object(te.o)({type:te.c,action:"copy",name:"复制",rspType:te.j,title:ie,component:re,callback:ue}),Object(te.o)({type:te.c,action:"refAdd",name:"关联创建",rspType:te.j,title:ie,component:re,callback:ue}),Object(te.o)({type:te.d,action:"add",name:"新建",rspType:te.j,title:ie,component:re,callback:ue}),Object(te.o)({type:te.d,action:"link",name:"链接",rspType:te.i,title:"链接"}),Object(te.o)({type:te.d,action:"info",name:"弹窗消息",rspType:te.h,title:"弹窗消息"}),Object(te.o)({type:te.b,action:"delete",name:"删除",rspType:te.e,cloudFunc:"delete",confirm:!0}),Object(te.o)({type:te.b,action:"nowEdit",name:"更新",rspType:te.e,cloudFunc:"nowEdit",confirm:!0,paramsDef:[{name:"fields",displayName:"设置属性值",require:!0,default:[],widget:"FieldsSet",params:function(e){return{model:e.model,fieldFilter:function(e){return!["mref","bref","ref"].includes(e.type)}}}}]}),Object(te.o)({type:te.b,action:"batchRefAdd",name:"关联创建",rspType:te.j,component:function(e){var t=e.model,n=e.currentObject,r=e.currentActionParams,a=e.context.refresh,o=n.map(function(e){return Object(Z.C)(e,t)}),c=r.field,u=Object(Z.t)(t,c),l=null===u||void 0===u?void 0:u.ref,s=Object(ne.a)(l),f={};return f[u.refField]=o,i.a.createElement(s,{model:l,onCreate:function(){a()},hiddenvalues:f,hiddenFields:f})},title:function(e){var t=e.currentActionObject,n=e.model,r=e.currentActionParams.field,a=Object(Z.t)(n,r);return"".concat(t.name).concat(a.displayName)},paramsDef:[{name:"field",type:"string",require:!0,displayName:"字段",filter:[],widget:"FieldPicker",params:function(e){return{model:e.model,fieldFilter:function(e){return["ref"].includes(e.type)}}}}]}),Object(te.o)({type:te.b,action:"batchRefConnect",name:"建立关联",rspType:te.j,component:function(e){var t=e.model,n=e.currentObject,r=e.currentActionParams,a=e.context.refresh,o=n.map(function(e){return Object(Z.C)(e,t)}),c=r.field,u=r.mode,l=void 0===u?"append":u,s=r.widget,f=void 0===s?"Select":s,p=r.groupBy;return i.a.createElement(de,{field:c,selectedRowIds:o,mode:l,model:t,widget:f,refresh:a,groupBy:p})},title:function(e){var t=e.currentActionObject,n=e.model,r=e.currentActionParams.field,a=Object(Z.t)(n,r);return"".concat(t.name).concat(a.displayName)},paramsDef:[{name:"mode",displayName:"模式",type:"string",default:"append",require:!1,choices:[["append","添加"],["replace","覆盖"]]},{name:"field",displayName:"字段",type:"string",require:!0,widget:"FieldPicker",params:function(e){return{model:e.model,fieldFilter:function(e){return["ref"].includes(e.type)}}}},{name:"widget",displayName:"组件",type:"string",require:!1,choices:[["Select","下拉选择器"],["Cascader","级联选择器"]]},{name:"groupBy",displayName:"分组字段",type:"string",widget:"FieldPicker",require:!0,show:'${widget} === "Cascader" && ${field}',params:function(e){var t,n=e.model,r=e.values,a=void 0===r?{}:r;return a.field&&(t=Object(Z.t)(n,a.field).ref),{model:t,fieldFilter:function(e){return["ref"].includes(e.type)}}}}]}),Object(te.o)({type:te.d,action:"customAction",name:"云函数",rspType:te.e,description:"自定义模型级云函数，只能够指定函数名。",paramsDef:[{name:"action",type:"string"}]}),Object(te.o)({type:te.c,action:"link",name:"链接",rspType:te.i,title:"链接"}),Object(te.o)({type:te.c,action:"info",name:"弹窗消息",rspType:te.h,title:"弹窗消息"}),Object(te.o)({type:te.c,action:"delete",name:"删除",rspType:te.g,title:"删除",func:function(e,t,n,r){return(0,window.g_app._store.dispatch)({type:"content/delete",payload:{id:Object(Z.C)(e,t),model:t}}).then(function(){r.refresh()})}}),Object(te.o)({type:te.c,action:"patch",name:"部分更新",rspType:te.g,title:"部分更新",func:function(e,t,n,r){var a=window.g_app._store.dispatch,o=n.params.payload.fields,c=window.g_app._store.getState().content.schemas,i=o.reduce(function(e,t){var n=e;return n[t.name]=t.value,n},{});return ye.a.isEmpty(i)?null:a({type:"content/patch",payload:{model:t,id:Object(Z.C)(e,t),newValues:i,schema:c[t]}}).then(function(){r.refresh()})}}),Object(te.o)({type:te.c,action:"intermediaryConfig",name:"中间表设置",rspType:te.j,component:function(e){var t=e.currentObject,n=e.currentActionObject,r=e.context;return i.a.createElement($e,{record:t,action:n.action,closeModal:function(){return r.refresh()}})},model:"meta__model",title:"中间表设置"}),Object(te.o)({type:te.d,action:"install_database",name:"增加数据库",rspType:te.j,component:function(e){var t=e.context.refresh;return i.a.createElement(st,{appendMode:!0,onOk:t})},model:"db_tool__setting",title:"数据库安装向导",autoAdd:!0}),Object(te.o)({type:te.c,action:"setPassword",name:"重设密码",rspType:te.j,title:"重设密码",model:function(e){return e.setting.staff_model},permission:ct.a.SETTING_CUSTOM_STAFF,component:function(e){var t=e.currentObject,n=e.context.refresh,r=window.g_app._store.getState().bsmSetting;return i.a.createElement(nt,{username:t[r.staff_username],handleOk:n,is_active:t[r.staff_active]})},autoAdd:!0}),Object(te.o)({type:te.c,action:"setGroups",name:"设置角色",rspType:te.j,title:"设置角色",model:function(e){return e.setting.staff_model},permission:ct.a.SETTING_CUSTOM_STAFF,component:function(e){var t=e.currentObject,n=e.context.refresh,r=window.g_app._store.getState().bsmSetting;return i.a.createElement(ot,{username:t[r.staff_username],handleOk:n,is_active:t[r.staff_active]})},autoAdd:!0}),Object(te.o)({type:te.c,action:"syncAccountStatus",name:"更新有效状态",rspType:te.g,title:"更新有效状态",model:function(e){return e.setting.staff_model},permission:ct.a.SETTING_CUSTOM_STAFF,func:(e=A()(T.a.mark(function e(t){var n,r;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=window.g_app._store.getState(),r=n.bsmSetting,e.next=3,Object(G.upDateActive)({username:t[r.staff_username],is_active:t[r.staff_active]});case 3:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)}),autoAdd:!0}),Object(te.o)({type:te.d,action:"syncWechatAccounts",name:"同步企业微信用户",title:"同步企业微信用户",rspType:te.e,cloudFunc:"export_wechat_work_departmemt_user",model:"member__user",shouldShow:function(e){return"wechat"===e.setting.third_party_provider},autoAdd:!0}),Object(te.o)({type:te.d,rspType:te.e,action:"syncDingdingAccounts",name:"同步钉钉用户",title:"同步钉钉用户",cloudFunc:"export_dingding_departmemt_user",model:"member__user",shouldShow:function(e){return"dingding"===e.setting.third_party_provider},autoAdd:!0}),Object(te.o)({type:te.c,rspType:te.f,action:"pageConfig",name:"页面配置",title:"页面配置",model:"meta__model",component:function(e){var t=e.currentObject,n=e.context.hideDrawer,r="".concat(t.app_label,"__").concat(t.name).toLowerCase();return i.a.createElement(it.a,{afterSubmit:n,modelName:r,key:r})},autoAdd:!0}),Object(te.o)({type:te.d,action:"migrate",name:"应用",model:"meta__model",rspType:te.e,cloudFunc:"migrate",callback:function(){return(0,window.g_app._store.dispatch)({type:"content/getConfig"}).then(function(){Object(ut.d)("bsm_config__menu",ut.b.afterUpdate)})}}),Object(te.o)({type:te.d,action:"sync_models",name:"从数据库同步",model:"meta__model",rspType:te.e,cloudFunc:"sync_models",callback:function(){var e=window.g_app._store.dispatch;return e({type:"content/getConfig"}).then(function(){e({type:"user/fetchCurrent"}),Object(ut.d)("bsm_config__menu",ut.b.afterUpdate)})}})}n.d(t,"default",function(){return pt})}}]);