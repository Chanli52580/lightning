(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[26],{10:function(e,t){},11:function(e,t){},12:function(e,t){},13:function(e,t){},14:function(e,t){},"1hG1":function(e,t,n){"use strict";(function(e){n("c94q");var a,r,i=n("Y/eX"),c=(n("e+1C"),n("Nd5c")),o=(n("ER8q"),n("Ai5L")),l=(n("UvA9"),n("u4G2")),s=n("tJVT"),u=n("oBTY"),d=n("9og8"),p=n("fWQN"),m=n("mtLc"),f=n("yKVA"),h=n("879j"),v=n("WmNS"),b=n.n(v),g=n("q1tI"),y=n.n(g),j=n("/MKj"),O=n("AAgL"),E=n("mmaM"),k=(a=Object(j["c"])((function(e){var t=e.content.schemas;return{schemas:t}})),a(r=function(t){Object(f["a"])(a,t);var n=Object(h["a"])(a);function a(){var e;Object(p["a"])(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return e=n.call.apply(n,[this].concat(r)),e.state={remoteChoices:[]},e.myProps=["titlefield"],e.doSearch=Object(d["a"])(b.a.mark((function t(){var n,a,r;return b.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(E["cloudFunction"])({model:"auth__permission",functionName:"get_assign_permissions"});case 2:n=t.sent,a=n.result,r=a.map((function(e){return[e.id,e]})),e.setState({remoteChoices:r});case 6:case"end":return t.stop()}}),t)}))),e.permissionCheck=function(t){var n=e.props,a=n.value,r=n.onChange,i=a.map((function(e){return e.id||e})),c=t.id;i.includes(c)?r(i.filter((function(e){return e!==c}))):r([].concat(Object(u["a"])(i),[c]))},e.modelCheck=function(t){var n=e.props,a=n.value,r=n.onChange,i=a.map((function(e){return e.id||e})),c=new Set(i),o=t.filter((function(e){return!c.has(e.id)}));o.length?r([].concat(Object(u["a"])(i),Object(u["a"])(o.map((function(e){return e.id}))))):r(i.filter((function(e){return!t.map((function(e){return e.id})).includes(e)})))},e}return Object(m["a"])(a,[{key:"componentDidMount",value:function(){this.doSearch()}},{key:"titleField",get:function(){return this.props.titlefield||this.refSchema.titleField}},{key:"refSchema",get:function(){var e=this.props.schemas;return e[this.refModel]}},{key:"refModel",get:function(){var e=this.props.field;return e.ref}},{key:"render",value:function(){var t=this,n=this.props,a=n.value,r=void 0===a?[]:a,u=n.schemas,d=this.state.remoteChoices;if(!d.length)return null;var p=new Set(r.map((function(e){return e.id||e}))),m={},f={};return d.forEach((function(e){var t=Object(s["a"])(e,2),n=t[0],a=t[1],r=a.display_name,i=a.content_type,c=i.app_verbose_name,o=i.app_label,l=i.model;f[o]=c,m[o]||(m[o]={}),m[o][l]||(m[o][l]=[]),m[o][l].push({id:n,name:r,children:[]})})),y.a.createElement(i["a"],{bordered:!1,defaultActiveKey:Object.keys(m).filter((function(t){return e.flatten(e.values(m[t])).find((function(e){return p.has(e.id)}))}))},Object.entries(m).map((function(e){var n=Object(s["a"])(e,2),a=n[0],r=n[1];return y.a.createElement(i["a"].Panel,{key:a,header:f[a]},Object.entries(r).map((function(e){var n=Object(s["a"])(e,2),r=n[0],i=n[1];return y.a.createElement(c["a"],{key:"".concat(a,"__").concat(r)},y.a.createElement(o["a"],{span:5,style:{minWidth:100,height:32,overflowX:"auto",whiteSpace:"nowrap"}},y.a.createElement(l["a"],{checked:i.every((function(e){return p.has(e.id)})),onChange:function(){return t.modelCheck(i)},indeterminate:i.some((function(e){return p.has(e.id)}))&&!i.every((function(e){return p.has(e.id)}))},y.a.createElement("strong",null,(u["".concat(a,"__").concat(r)]||{}).displayName||r))),y.a.createElement(o["a"],{span:18},y.a.createElement(c["a"],{type:"flex"},i.map((function(e){return y.a.createElement(o["a"],{key:e.id,span:6,style:{minWidth:100,overflowX:"auto",overflowY:"hidden",whiteSpace:"nowrap"}},y.a.createElement(l["a"],{checked:p.has(e.id),onChange:function(){return t.permissionCheck(e)}},e.name))})))))})))})))}}]),a}(O["a"]))||r);t["a"]=k}).call(this,n("LvDl"))},4:function(e,t){},"4WK3":function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return g})),n.d(t,"d",(function(){return y})),n.d(t,"c",(function(){return j}));var a=n("0Owb"),r=n("k1fw"),i=n("jrin"),c=n("q1tI"),o=n.n(c),l=n("jfUH"),s=n("IAeB"),u=n("EBSl"),d=n("xNPh");function p(t){var n,c=t.model,s=t.onCreate,u=void 0===s?function(){}:s,p=t.onUpdate,m=void 0===p?function(){}:p,f=t.currentObject,h=void 0===f?{}:f,v=t.currentActionParams,b=void 0===v?{}:v,g=t.Id,y=t.formProps,j=void 0===y?{}:y;h&&(n=g||Object(l["K"])(h,c));var O=Object(d["a"])(c),E=b.isCopy,k=b.editFields,w=b.fields,_=void 0===w?[]:w,x={};E&&(x.isCopy=!0),e.isEmpty(_)||(x.hiddenvalues=_.reduce((function(e,t){var n=e;return n[t.name]=t.value,n}),{}),x.partialupdate=!0),k&&(x.fields=k,x.partialupdate=!0);var C=c,S=n,F=h;if(b.field){var A=Object(l["r"])(c,b.field,h),P=A.id,N=A.schemaField,D=A.value;if(C=N.ref,"refAdd"===b.action){var T="bref"===N.type?n:[n],M=Object(i["a"])({},N.refField,T);b.values&&(M=Object(r["a"])(Object(r["a"])({},M),b.values)),x.hiddenvalues=M,x.hiddenFields=x.hiddenvalues,S=void 0,F=void 0}else S=P,F=D}return b.model&&(C=b.model),o.a.createElement(O,Object(a["a"])({model:C,objectid:S,currentObject:F,onCreate:u,onUpdate:m},j,x))}function m(e){var t=e.model,n=e.currentObject,a=e.currentActionParams,r=t,i=Object(l["K"])(n,t),c=a.field,u=a.page;if(c){var d=Object(l["r"])(t,c,n),p=d.id,m=d.schemaField;r=m.ref,i=p}return o.a.createElement(s["a"],{model:r,page:u,id:i,custom:!0})}function f(e){var t=e.model,n=e.currentActionObject,a=e.currentObject,r=e.currentActionParams,i=e.context,c=n.callback;return p({model:t,currentObject:a,currentActionParams:r,onUpdate:function(){return c(i)},onCreate:function(){return c(i)},formProps:i.formProps})}function h(e){var t=e.model,n=e.currentObject,a=e.currentActionParams,r=e.Schemas,i=void 0===r?[]:r,c=i[t]||{};if(a.field){var o=Object(l["t"])(t,a.field);return"\u7f16\u8f91".concat(o.displayName)}return"".concat(n[c.titleField]?"\u3010".concat(n[c.titleField],"\u3011- "):"","\u7f16\u8f91").concat(c.displayName)}function v(e){var t=e.model,n=e.currentObject,a=e.currentActionParams;return m({model:t,currentObject:n,currentActionParams:a})}function b(e){var t=e.model,n=e.currentActionParams,a=e.Schemas,r=void 0===a?[]:a,i=r[t]||{};if(n.field){var c=Object(l["t"])(t,n.field);return"".concat(c.displayName,"\u8be6\u60c5")}return"".concat(i.displayName,"\u8be6\u60c5")}function g(e){var t=e.model,n=e.currentActionParams,a=e.Schemas,r=void 0===a?[]:a,i=r[t]||{};if(n.field){var c=Object(l["t"])(t,n.field);return"\u65b0\u5efa".concat(c.displayName)}return n.model?"\u65b0\u5efa".concat(r[n.model].displayName):"\u65b0\u5efa".concat(i.displayName)}function y(e){var t=e.refresh;t()}function j(){Object(u["p"])({type:u["c"],action:"edit",name:"\u7f16\u8f91",rspType:u["j"],title:h,component:f,callback:y}),Object(u["p"])({type:u["c"],action:"partEdit",name:"\u90e8\u4efd\u7f16\u8f91",rspType:u["j"],title:h,component:f,callback:y}),Object(u["p"])({type:u["c"],action:"refEdit",name:"\u5173\u8054\u7f16\u8f91",rspType:u["j"],title:h,component:f,callback:y}),Object(u["p"])({type:u["c"],action:"detail",name:"\u8be6\u60c5",rspType:u["j"],title:b,component:v}),Object(u["p"])({type:u["c"],action:"refDetail",name:"\u5173\u8054\u8be6\u60c5",rspType:u["j"],title:b,component:v}),Object(u["p"])({type:u["c"],action:"copy",name:"\u590d\u5236",rspType:u["j"],title:g,component:f,callback:y}),Object(u["p"])({type:u["c"],action:"refAdd",name:"\u5173\u8054\u521b\u5efa",rspType:u["j"],title:g,component:f,callback:y})}}).call(this,n("LvDl"))},5:function(e,t){},6:function(e,t){},7:function(e,t){},8:function(e,t){},9:function(e,t){},"9uep":function(e,t,n){"use strict";var a=n("Utjr");t["a"]=Object(a["d"])((function(){return Promise.all([n.e(3),n.e(2),n.e(4)]).then(n.bind(null,"yPhJ"))}))},"ASN+":function(e,t,n){"use strict";n.d(t,"b",(function(){return x}));n("eNCU");var a=n("pjJH"),r=(n("GPKB"),n("mFAc")),i=(n("WlnS"),n("7sSx")),c=(n("ascH"),n("GqlH")),o=(n("4X2C"),n("xvon")),l=n("tJVT"),s=n("q1tI"),u=n.n(s),d=n("ZlLr"),p=n.n(d),m=n("R1kb"),f=n.n(m),h=n("wd/R"),v=n.n(h),b=n("mmaM"),g=n("jfUH"),y=n("Z3Sq"),j=n.n(y);function O(e){return e&&e.replace(/\s/g,"")}function E(e){return Uint8Array.from(e,(function(e){return e.charCodeAt(0)}))}var k="MIIBojANBgkqhkiG9w0BAQEFAAOCAY8AMIIBigKCAYEAxR4BICJ+rc5vLVzMk5Z8AZTIbu26eclr6c/a6+5OphlZg16RRMc3ySZ5idB27Sr7Nj4ootV6F0nfBibqXBbQKOoAACF7EO7Js8p7cZFKv5QnDrAIbBbksFYSRGDE7A0E3PjYXht7BTNIUdvOzWlBMNMK3YdQsComvB8pOS14OZ6EUEgk4DNSB0GJUGZPJ9w5Wf2CY5eNgGHFjdI8rv9lIQqU2VDOkTVtyRlcrDbfBi68hoAm6zzLyUQEGEBkZybcCJW6yzXjrc/ade3NRIg81ZgG7Uo8hBsZSTHf3Y2T3y7Uto8KY+jini09/pRvwCqERiImZI+72ByhvBvgXUndyqhXo7CGP1lvYtwt9XjAf4gAe9Y2GZJGAoV8q4w2c4wsWEkijwSuTCOo1LtvprFyN9GQDI72NDpoxVGl4O6MKcMXGsO5Zb7NzYmnlteCf0Ug//gFbehPAIPPzpInKwn8yGA/gWaO8sjGC5vy3hhq5sofE9hhzxwNliZymkzourDTAgMBAAE=",w=new p.a.Key("der",E(window.atob(k))),_=w.jwk,x={},C=function(){var e=Object(s["useState"])(),t=Object(l["a"])(e,2),n=t[0],a=t[1],r=Object(s["useState"])(!1),i=Object(l["a"])(r,2),c=i[0],o=i[1];return Object(s["useEffect"])((function(){Object(b["cloudFunc"])({model:"bsm_config__setting",functionName:"get_code",params:{}}).then(a).catch((function(){return o(!0)}))}),[]),[n,c]};t["a"]=function(e){var t=e.value,n=e.onChange,d=C(),p=Object(l["a"])(d,2),m=p[0],h=p[1],y=Object(s["useState"])(),k=Object(l["a"])(y,2),w=k[0],S=k[1],F=Object(s["useState"])(null),A=Object(l["a"])(F,2),P=A[0],N=A[1],D=null!==P;Object(s["useEffect"])((function(){_.then(S)}),[]),Object(s["useEffect"])((function(){if(t&&m&&w){var e=O(t);e+="=".repeat((-e.length%4+4)%4);try{var n=window.atob(e.replace(/</g,"+").replace(/>/g,"/")).split("\n"),a=n[0],r=n.slice(1).join("\n");f.a.verify(E(m+a),E(r),w,"SHA-1",{name:"RSA-PSS",saltLength:20}).then(N).catch((function(){return Object(b["cloudFunc"])({model:"bsm_config__setting",functionName:"verify",params:{license:O(t)}}).then((function(e){var t=e.valid;return N(t)}))}))}catch(i){N(!1)}}else N(null)}),[w,t,m]),Object(s["useEffect"])((function(){D?x.valid=P:delete x.valid}));var T="License \u6b63\u786e";if(P&&t&&m&&w){var M=O(t);M+="=".repeat((-M.length%4+4)%4);try{var I=window.atob(M.replace(/</g,"+").replace(/>/g,"/")).split("\n"),L=I[0],B=JSON.parse(L);T={free:"\u514d\u8d39",standard:"\u6807\u51c6",pro:"\u4e13\u4e1a"}[B.type],T+="".concat(B.trial?"\u8bd5\u7528":"","\u7248\uff0c\u6388\u6743\u4e88"),T+=B.purchaser,B.trial&&(T+="\uff0c".concat(v.a.unix(B.register_time).add(B.trial_days,"days").format("YYYY-MM-DD HH:mm:ss")," \u5230\u671f"))}catch(U){}}return u.a.createElement(u.a.Fragment,null,u.a.createElement(o["a"].TextArea,{className:D&&(P?j.a.success:j.a.error),allowClear:!0,value:O(t),onChange:function(e){return n(O(e.target.value))},autosize:{minRows:5},disabled:h}),D&&(P?u.a.createElement(c["a"],{message:T,type:"success",showIcon:!0}):u.a.createElement(c["a"],{message:"License \u65e0\u6548",type:"error",showIcon:!0})),m&&u.a.createElement(u.a.Fragment,null,"\u60a8\u7684\u5e8f\u5217\u53f7\uff1a",u.a.createElement(i["a"],null,m),u.a.createElement(a["a"],{size:"small",onClick:function(){Object(g["f"])(m),r["a"].success("\u5e8f\u5217\u53f7 ".concat(m," \u5df2\u590d\u5236\u5230\u526a\u8d34\u677f"))}},"\u590d\u5236")),h&&u.a.createElement("span",{style:{color:"red"}},"\u65e0\u6cd5\u83b7\u53d6\u5e8f\u5217\u53f7"))}},C2ml:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return l}));var a=n("q1tI"),r=n.n(a),i=n("ZFw/"),c=n.n(i),o=n("jfUH"),l=function(t){var n=t.children,a=Object(o["wb"])("title"),i=e.isArray(n)?n.join(""):n,l=a&&i?" - ":"",s=a?i+l+a:i;return r.a.createElement(c.a,{title:s})}}).call(this,n("LvDl"))},CD42:function(e,t,n){e.exports={container:"container___3pl9V",content:"content___3e9Ph",content_box:"content_box___Uidox",select:"select___3x4xw"}},Cnxa:function(e,t,n){"use strict";(function(e){n("e+1C");var a=n("Nd5c"),r=(n("ER8q"),n("Ai5L")),i=(n("eNCU"),n("pjJH")),c=n("9og8"),o=n("fWQN"),l=n("mtLc"),s=n("yKVA"),u=n("879j"),d=(n("yavW"),n("WuMn")),p=(n("vmZS"),n("NjVP")),m=n("WmNS"),f=n.n(m),h=n("q1tI"),v=n.n(h),b=n("mmaM"),g=p["a"].Item,y=d["a"].Option,j={},O=function(t){Object(s["a"])(m,t);var n=Object(u["a"])(m);function m(){var e;return Object(o["a"])(this,m),e=n.call(this),e.onFieldsChange=function(){var t=Object(c["a"])(f.a.mark((function t(n,a,r){var i,c,o;return f.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:i=e.props.form,c=i.getFieldValue("through_field_1"),o=i.getFieldValue("through_field_2"),c===o&&r("\u8bf7\u9009\u62e9\u4e0d\u540c\u7684\u5916\u952e"),r();case 5:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}(),e.submit=Object(c["a"])(f.a.mark((function t(){var n,a,r,i,c;return f.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.props,a=n.form,r=n.record,i=n.closeModal,e.setState({loading:!0}),c=a.getFieldsValue(),c.model_id=r.id,t.prev=4,t.next=7,Object(b["setIntermediaryTable"])(c);case 7:e.setState({loading:!1}),i(),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](4),console.error(t.t0);case 14:case"end":return t.stop()}}),t,null,[[4,11]])}))),e.check=function(){var t=e.props.form;t.validateFields((function(t){t||e.submit()}))},e.state={fkFields:[],loading:!1},e}return Object(l["a"])(m,[{key:"componentDidMount",value:function(){var e=Object(c["a"])(f.a.mark((function e(){var t,n,a,r;return f.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.props.record,this.setState({loading:!0}),e.next=4,Object(b["queryContent"])({model:"meta__field",filters:[{field:"model",value:t.id,operator:"="}]},1,1e3);case 4:n=e.sent,a=n.list,this.setState({loading:!1}),r=a.filter((function(e){return"fk"===e.type})),this.setState({fkFields:r});case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"renderForm",value:function(){var t=this.props,n=t.form,c=n.getFieldDecorator,o=n.getFieldValue,l=n.resetFields,s=n.getFieldsValue,u=t.closeModal,m=this.state,f=m.fkFields,h=m.loading,b=function(e){return f.map((function(t){return v.a.createElement(y,{disabled:e===t.name,key:t.name},t.verbose_name||t.name||t.db_column)}))};return v.a.createElement("div",null,v.a.createElement(p["a"],j,v.a.createElement(g,{label:"\u4e3b\u8868\u5916\u952e"},c("through_field_1",{rules:[{required:!0,message:"\u4e3b\u8868\u5916\u952e\u662f\u5fc5\u586b\u7684"}]})(v.a.createElement(d["a"],{allowClear:!0},b(o("through_field_2"))))),v.a.createElement(g,{label:"\u6b21\u8868\u5916\u952e"},c("through_field_2",{rules:[{required:!0,message:"\u6b21\u8868\u5916\u952e\u662f\u5fc5\u586b\u7684"},{validator:this.onFieldsChange}]})(v.a.createElement(d["a"],{allowClear:!0},b(o("through_field_1"))))),v.a.createElement(g,null,v.a.createElement(a["a"],null,v.a.createElement(r["a"],null,v.a.createElement(i["a"],{type:"primary",onClick:this.check,style:{marginRight:16},disabled:h},"\u4fdd\u5b58"),v.a.createElement(i["a"],{type:"default",onClick:function(){u()}},"\u53d6\u6d88"),e.values(s()).some(Boolean)&&v.a.createElement(i["a"],{style:{marginLeft:16},onClick:function(){return l()}},"\u91cd\u8bbe"))))))}},{key:"render",value:function(){var e=this.props.record;return!e.fk_field_count||e.fk_field_count<2?v.a.createElement("p",null,"\u4e0d\u652f\u6301\u5c06\u8be5\u8868\u8bbe\u7f6e\u4e3a\u4e2d\u95f4\u8868"):this.renderForm()}}]),m}(h["PureComponent"]),E=p["a"].create({})(O);t["a"]=E}).call(this,n("LvDl"))},IAeB:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return V}));var a,r,i,c,o=n("PpiC"),l=(n("52nx"),n("7bDm")),s=n("0Owb"),u=n("tJVT"),d=(n("GPKB"),n("mFAc")),p=n("9og8"),m=n("fWQN"),f=n("mtLc"),h=n("tS8v"),v=n("yKVA"),b=n("879j"),g=(n("SePM"),n("PMX6")),y=(n("vifT"),n("nODz")),j=n("WmNS"),O=n.n(j),E=n("q1tI"),k=n.n(E),w=n("Ty5D"),_=n("RLxJ"),x=n("/MKj"),C=n("Hx5s"),S=n("UmlX"),F=n("leA8"),A=n("sC82"),P=n("jfUH"),N=n("BE/h"),D=n("flKx"),T=n("3i6F"),M=n("C2ml"),I=n("y/44"),L=n("G3ML"),B=A["a"].Description,U=k.a.createElement(g["a"],{style:{width:"100%"}},k.a.createElement(y["a"],{image:y["a"].PRESENTED_IMAGE_SIMPLE})),V=(a=Object(x["c"])((function(e){var t=e.content,n=t.schemas,a=t.adminConfig,r=t.data,i=e.loading,c=e.user.currentUser,o=e.bsmSetting;return{schemas:n,adminConfig:a,data:r,loading:i.models.content,currentUser:c,bsmSetting:o}})),Object(w["n"])(r=a((c=i=function(t){Object(v["a"])(a,t);var n=Object(b["a"])(a);function a(){var t;Object(m["a"])(this,a);for(var r=arguments.length,i=new Array(r),c=0;c<r;c++)i[c]=arguments[c];return t=n.call.apply(n,[this].concat(i)),t.state={showModal:!1,showDrawer:!1,currentObject:{},currentActionObject:{},currentActionParams:{},plainFormVisible:!1,plainFormFields:[],plainFormSubmit:void 0,plainFormCancel:void 0},t.getDetailList=function(){var n=t.getProps,a=n.model,r=n.adminConfig,i=r[a]||{},c=i.detailLayout,o=void 0===c?{}:c,l=i.details,s=void 0===l?[]:l,u=[],d=s;return o.tabs?o.tabs.forEach((function(e){var t=d.find((function(t){return t.key===e}));t&&u.push({tab:t.title,key:t.key})})):e.isEmpty(d)||d.forEach((function(e,t){u.push({tab:e.title||"\u8be6\u60c5".concat(t?t+1:""),key:e.key})})),{detailList:d,tabList:u}},t.init=Object(p["a"])(O.a.mark((function e(){return O.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.getDetail();case 1:case"end":return e.stop()}}),e)}))),t.getInlineActions=function(){var e=t.getProps,n=e.adminConfig,a=void 0===n?{}:n,r=e.model,i=a[r],c=i.inlineActions,o=i.maxInlineActions,l=i.modalForm,s=i.modalDetail;return k.a.createElement(L["a"],{type:"button",popPlacement:"bottomRight",modalForm:l,modalDetail:s,maxItem:o,model:r,onClick:t.handleInlineAction,record:t.detailObject,items:c.filter((function(e){return![e.type,e.action].includes("detail")}))})},t.handleInlineAction=function(){var e=Object(p["a"])(O.a.mark((function e(n,a,r){var i;return O.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return"action"===n.type&&(i=d["a"].loading({content:"".concat(n.title,"\u6267\u884c\u4e2d"),key:n.title,duration:0})),e.prev=1,e.next=4,r(n,a,{refresh:function(){var e=Object(p["a"])(O.a.mark((function e(){return O.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.getDetail({msgOption:!1});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e["catch"](0),404===e.t0.error_code&&(d["a"].info("\u6570\u636e\u5df2\u5220\u9664"),_["a"].push("/content/".concat(n.params.payload.model)));case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));function a(){return e.apply(this,arguments)}return a}(),showModal:t.handleShowModal.bind(Object(h["a"])(t)),showDrawer:t.handlerShowDrawer.bind(Object(h["a"])(t)),link:function(e,t,n){return Object(P["O"])(n.link,(function(t){return e[t]}))},collectInputs:t.collectInputs.bind(Object(h["a"])(t)),hideCollectInput:t.hideCollectInput.bind(Object(h["a"])(t))});case 4:e.next=8;break;case 6:e.prev=6,e.t0=e["catch"](1);case 8:return e.prev=8,i&&i(),e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[1,6,8,11]])})));return function(t,n,a){return e.apply(this,arguments)}}(),t.handleOk=function(){t.setState({showModal:!1})},t.handleCancel=function(){t.setState({showModal:!1})},t.handleShowModal=function(e,n,a){t.setState({currentObject:e,currentActionObject:n,currentActionParams:a,showModal:!0})},t.handlerShowDrawer=function(e,n,a){t.setState({currentObject:e,currentActionObject:n,currentActionParams:a,showDrawer:!0})},t.getDescription=function(){var n,a=t.getProps,r=a.adminConfig,i=a.model,c=r[i].detailLayout,o=void 0===c?{headerFields:[]}:c;if(e.isEmpty(t.detailObject))return null;var l=null===(n=o.headerFields||[])||void 0===n?void 0:n.map((function(e){var n,a;return[null!==(n=null===(a=Object(P["t"])(i,e))||void 0===a?void 0:a.displayName)&&void 0!==n?n:e,Object(P["k"])(e,t.detailObject)]}));return k.a.createElement(A["a"],{style:{marginBottom:4},size:"small",col:"2"},l.map((function(e){var t=Object(u["a"])(e,2),n=t[0],a=t[1];return k.a.createElement(B,{term:n},a)})))},t}return Object(f["a"])(a,[{key:"componentDidMount",value:function(){var t=this.getProps,n=t.schemas,a=t.adminConfig;e.isEmpty(n)||e.isEmpty(a)||this.init();var r=document.querySelector(".ant-layout.ant-layout-has-sider > .ant-layout");r&&(r.style.overflowX="unset"),document.body.scrollTop=0,document.documentElement.scrollTop=0}},{key:"componentDidUpdate",value:function(t){var n=function(t){var n=t.schemas,a=t.adminConfig;return!e.isEmpty(n)&&!e.isEmpty(a)},a=n(t),r=n(this.getProps);!a&&r&&this.init();var i=t.match.params.id,c=t.id,o=c||i;o&&o!==this.getProps.id&&this.init()}},{key:"componentWillUnmount",value:function(){var e=document.querySelector(".ant-layout.ant-layout-has-sider > .ant-layout");e&&(e.style.overflowX=null)}},{key:"detailObject",get:function(){var e,t,n=this.getProps,a=n.model,r=n.data,i=void 0===r?{}:r,c=n.id,o=(null===(e=i[a])||void 0===e?void 0:e.detail)||{};return null!==(t=o[c])&&void 0!==t?t:o}},{key:"getProps",get:function(){var e=this.props,t=e.data,n=e.schemas,a=e.adminConfig,r=e.dispatch,i=e.match,c=i.path,o=i.url,l=e.groupList,s=e.groupCount,u=e.id,d=e.model,p=e.custom,m=e.bsmSetting,f=e.currentUser,h=e.page;return{data:t,schemas:n,adminConfig:a,model:d,id:u,dispatch:r,url:o,path:c,groupList:l,groupCount:s,custom:p,key:h,bsmSetting:m,currentUser:f}}},{key:"getDetail",value:function(e){var t=this.getProps,n=t.dispatch,a=t.model,r=t.id,i=t.adminConfig,c=i[a]&&(i[a].detail||i[a].details);if("__index__"!==r&&c){var o,l=this.getDetailList(),s=l.detailList,u=void 0===s?[]:s,d=this.getProps.key,p=void 0===d?null===(o=u[0])||void 0===o?void 0:o.key:d,m=u.find((function(e){return e.key===p}));return n({type:"content/detail",payload:{model:a,id:r,fieldsType:"detailFields",wrapOptions:e,detail:m}}).then((function(){}))}return null}},{key:"collectInputs",value:function(e,t,n){this.setState({plainFormVisible:!0,plainFormFields:e,plainFormSubmit:t,plainFormCancel:n})}},{key:"hideCollectInput",value:function(){this.setState({plainFormVisible:!1,plainFormFields:[],plainFormSubmit:void 0,plainFormCancel:void 0})}},{key:"render",value:function(){var t,n,a=this,r=this.getProps,i=r.model,c=r.id,o=r.adminConfig,u=r.schemas,d=r.data,p=r.custom,m=r.currentUser;if(e.isEmpty(o)||e.isEmpty(m))return null;var f=this.state,h=f.showModal,v=f.showDrawer,b=f.currentActionObject,g=f.currentActionParams,y=f.currentObject,j=u[i]||{},O=e.get(d,"".concat(i,".detail.").concat(c),""),w=O[j.titleField]||"".concat(j.displayName,"\u8be6\u60c5"),x=o[i]||{},A=x.detail,L=x.detailLayout,B=void 0===L?{}:L,V=this.getDetailList(),K=V.tabList,q=V.detailList,R=this.getProps.key,G=void 0===R?null===(t=q[0])||void 0===t?void 0:t.key:R,z=this.state,W=z.plainFormVisible,Y=z.plainFormFields,J=z.plainFormCancel,X=z.plainFormSubmit,H=k.a.createElement(E["Fragment"],null,k.a.createElement(N["a"],{visible:h,handleOk:this.handleOk,handleCancel:this.handleCancel,currentActionObject:b,currentObject:y,currentActionParams:g,model:i,context:{refresh:function(){a.getDetail(),a.handleCancel()},close:function(){a.handleCancel()}}}),k.a.createElement(D["a"],{currentActionObject:b,currentObject:y,currentActionParams:g,visible:v,model:i,context:{hideDrawer:function(){a.setState({showDrawer:!1})}}})),Z=q.find((function(e){return e.key===G}))||A,Q=Z?k.a.createElement("div",{style:{width:0,flex:1}},k.a.createElement(S["a"],{model:i,id:c,detail:Z,key:G})):U;if((!o[i]||!A)&&!o[i].details)return null;var $=A,ee=$||{},te=ee.showNav,ne=k.a.createElement("div",{style:{display:"flex"}},te&&k.a.createElement("div",null,k.a.createElement("div",{style:{marginRight:24,overflowY:"auto",position:"sticky",top:0,maxHeight:"100vh"}},k.a.createElement(F["a"],null))),"__index__"!==c?Q:U);if(p)return ne;var ae=G&&(null===(n=K.find((function(e){return e.key===G})))||void 0===n?void 0:n.tab);return k.a.createElement(C["a"],{title:w,tabActiveKey:G,tabList:K,extra:this.getInlineActions(),onTabChange:function(e){return _["a"].replace("/content/".concat(i,"/detail/").concat(c,"/").concat(e))},content:this.getDescription(),onBack:_["a"].goBack,avatar:B.avatar&&{src:Object(P["v"])(O[B.avatar],{height:40,width:40})},tags:e(B.tags||{}).map((function(e,t){return k.a.createElement(T["c"],Object(s["a"])({value:O[t],field:j.fields.find((function(e){return e.name===t}))},e))})).value()},k.a.createElement(M["a"],null,w,ae&&" - ".concat(ae)||""),H,ne,k.a.createElement(l["a"],{title:"\u8bf7\u8f93\u5165\u53c2\u6570",width:"60%",footer:null,visible:W,onCancel:function(){return a.setState({plainFormVisible:!1})}},k.a.createElement(I["a"],{fields:Y,onSubmit:X,onCancel:J})))}}]),a}(E["Component"]),i.defaultProps={groupList:!1,groupCount:20},r=c))||r)||r);t["b"]=Object(w["n"])((function(e){var t=e.match.params,n=t.model,a=t.id,r=t.key,i=Object(o["a"])(e,["match"]);return k.a.createElement(V,Object(s["a"])({},i,{key:"".concat(n,"-").concat(a),page:r,id:a,model:n}))}))}).call(this,n("LvDl"))},Lafb:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o}));var a=n("jrin"),r=n("VoC+"),i=n("9Ndd"),c=n("jfUH");function o(t,n,o,l,s){var u=l.watchFields,d=l.parameters,p=d.targetField,m=d.mapping,f=s.model,h=s.schemas,v=s.adminConfig,b=h[f],g=b.fields.filter((function(e){return-1!==u.indexOf(e.name)&&"mref"===e.type})),y=b.fields.find((function(e){return e.name===p&&"bref"===e.type}));if(g&&y&&g.length===u.length){var j=u.map((function(e){return e===n?o:t.getFieldsValue([e])[e]})),O=j.filter((function(e){return void 0!==e}));if(!(O.length<=1)){var E=Object(r["a"])(j),k=[],w=h[y.ref];E.forEach((function(e){var t=Object(i["c"])(w,v[y.ref].formFields);u.forEach((function(n,a){var r=m[n];t[r]=e[a]})),k.push(t)}));var _=t.getFieldsValue([p])[p];if(k.length>0){var x=[];if(_&&_.length>0){var C=e.values(m);k.forEach((function(e){var t=!1,n=C.map((function(t){return e[t][Object(c["L"])(w.fields.find((function(e){return e.name===t})).ref)]})).join("_");_.every((function(e){var a=C.map((function(t){return e[t][Object(c["L"])(w.fields.find((function(e){return e.name===t})).ref)]})).join("_");return n!==a||(t=!0,x.push(e),!1)})),t||x.push(e)})),t.setFieldsValue(Object(a["a"])({},p,x))}else t.setFieldsValue(Object(a["a"])({},p,k))}else _&&_.length>0&&t.setFieldsValue(Object(a["a"])({},p,[]))}}}}).call(this,n("LvDl"))},UmlX:function(e,t,n){"use strict";(function(e){n("5RCp");var a,r,i,c,o=n("a82I"),l=(n("Ahcs"),n("k0dM")),s=(n("SePM"),n("PMX6")),u=(n("e+1C"),n("Nd5c")),d=(n("ER8q"),n("Ai5L")),p=n("0Owb"),m=(n("/pxP"),n("oqP9")),f=n("k1fw"),h=n("fWQN"),v=n("mtLc"),b=n("yKVA"),g=n("879j"),y=n("q1tI"),j=n.n(y),O=n("/MKj"),E=n("3i6F"),k=n("OFLC"),w=n("jfUH"),_=n("mmaM"),x=n("rQ+i"),C=n("wiuW");function S(e,t,n){if(t in C["e"]&&C["e"][t].includes(n)){var a=C["c"][t];return j.a.createElement(a,{model:n,detailObject:e})}return null}var F={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20},md:{span:19}}},A=(a=e.flow(Object(O["c"])((function(e){var t=e.content,n=t.data,a=t.adminConfig,r=t.schemas,i=e.bsmSetting,c=e.loading,o=e.user.currentUser;return{data:n,adminConfig:a,schemas:r,loading:c.models.content,bsmSetting:i,currentUser:o}})),Object(w["d"])((function(e){var t=e.model;return{getDisplayWidgetName:Object(E["l"])(t),onMobile:Object(w["kb"])()}}))),a((c=i=function(t){Object(b["a"])(a,t);var n=Object(g["a"])(a);function a(){var e;Object(h["a"])(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return e=n.call.apply(n,[this].concat(r)),e.state={previewImageUrl:void 0,previewImageVisible:!1},e.setPreviewImageVisible=function(t){e.setState({previewImageVisible:t})},e.changePreviewImageUrl=function(t){e.setState({previewImageUrl:t})},e}return Object(v["a"])(a,[{key:"model",get:function(){var e=this.props.model;return e}},{key:"schema",get:function(){return this.schemas[this.model]}},{key:"admin",get:function(){return this.admins[this.model]}},{key:"schemas",get:function(){var e=this.props.schemas;return e}},{key:"admins",get:function(){var e=this.props.adminConfig;return e}},{key:"detail",get:function(){var e=this.props,t=e.model,n=e.detail,a=void 0===n?{}:n,r=Object(w["p"])(t);if(a.fields)return Object(f["a"])(Object(f["a"])({},a),{},{fields:a.fields.filter((function(e){var t,n;return null===(t=null===(n=r[e.name||e])||void 0===n?void 0:n.read)||void 0===t||t}))});var i=Object(f["a"])({},a);return a.sections&&a.sections.forEach((function(e,t){i.sections[t].fields=e.fields.filter((function(e){var t,n;return null===(t=null===(n=r[e.name||e])||void 0===n?void 0:n.read)||void 0===t||t}))})),i}},{key:"nullOrDetailObject",get:function(){var e=this.props,t=e.data,n=e.id,a=t[this.model].detail;return null===a||void 0===a?void 0:a[n]}},{key:"detailObject",get:function(){var e,t,n=this.props,a=n.data,r=n.id,i=null===(e=a[this.model])||void 0===e?void 0:e.detail;return null!==(t=null===i||void 0===i?void 0:i[r])&&void 0!==t?t:i}},{key:"getExpandFields",value:function(){var e=this.props,t=e.model,n=e._getExpandFields,a=void 0===n?_["getExpandFields"]:n;return a(t)}},{key:"canRender",value:function(){var t=this.props.data,n=this.model,a=this.schemas,r=this.admin;return!(e.isEmpty(a)||e.isEmpty(r)||e.isEmpty(t)||e.isEmpty(t[n])||e.isEmpty(t[n].detail))}},{key:"renderField",value:function(e,t,n){var a,r,i=this.props.getDisplayWidgetName,c=this.model,o=this.schemas,l=this.changePreviewImageUrl,s=this.setPreviewImageVisible,h=this.admins,v=e.name,b=Object(w["j"])(c,v,o),g=h[this.model].display,y=g.find((function(e){return e.name===v})),O=e.widget,k=void 0===O?null===y||void 0===y?void 0:y.widget:O,_=e.params,x=void 0===_?null===y||void 0===y?void 0:y.params:_,C={};k||(k=i(e));var S=["multi-image","longtext"];S.includes(k)&&(null!==(a=this.detail)&&void 0!==a&&a.fields||"cell"===(null===n||void 0===n||null===(r=n.style)||void 0===r?void 0:r.widget))&&(C.isExpand=!0);var A=this.detailObject,P=Object(f["a"])(Object(f["a"])({},x),{},{field:b,model:v.includes(".")?Object(w["j"])(c,e.name.split(".").slice(0,-1).join("."),o).ref:c,Schemas:o,changePreviewImageUrl:l,setPreviewImageVisible:s,Admins:h,displayFields:y?[y]:[],fields:[b],displayField:e,instance:A},C);"bref"!==(null===b||void 0===b?void 0:b.type)||null!==v&&void 0!==v&&v.includes(".")||(k="table");var N=function(){return j.a.createElement(E["a"],{fields:{value:v},model:c,widgetName:k,record:A,widgetProps:P})},D=e.alias||(null===y||void 0===y?void 0:y.alias)||Object(w["l"])(o,v,c).map((function(e){return e.displayName})).join(""),T=function(){var e,n=N();if("table"===k)return n;switch(t){case"description":e=j.a.createElement(m["a"].Item,{label:D,key:b.name},n);break;default:e=j.a.createElement(u["a"],{key:b.name,style:{padding:"10px 10px"}},j.a.createElement(d["a"],Object(p["a"])({style:{fontWeight:"bold"}},F.labelCol),"".concat(D," :")),j.a.createElement(d["a"],F.wrapperCol,n));break}return e};return A&&T()}},{key:"renderSection",value:function(e){var t=this,n=e.title,a=void 0===n?"":n,r=e.fields,i=void 0===r?[]:r,c=e.description,u=e.style,d=void 0===u?"group":u,p=e.index,h=e.sectionStyle,v=void 0===h?{}:h,b=e.model,g=y["Fragment"],O={key:p};switch(d){case"group":g=s["a"],O=Object(f["a"])(Object(f["a"])({},O),{},{bordered:!1,title:a,style:{marginBottom:24},loading:!this.nullOrDetailObject});break;case"tab":g=l["a"].TabPane,O=Object(f["a"])(Object(f["a"])({},O),{},{tab:a});break;default:g=o["a"].Step,O=Object(f["a"])(Object(f["a"])({},O),{},{title:a,description:c});break}var E=v.widget,k=v.params,w=y["Fragment"],_={},x="";switch(E){case"descriptions":case"table":case"table-v":case"tiles":switch(w=m["a"],_=Object(f["a"])({column:{xs:1,sm:2,md:3,xl:4,xxl:6}},k),E){case"table-v":_.layout="vertical";case"table":_.bordered=!0;break;default:break}x="description";break;default:break}var C=function(e){return e.map((function(e){return t.renderField(e,x,v)}))};return j.a.createElement(g,O,j.a.createElement(w,_,C(i.filter((function(e){return"bref"!==e.type})))),S(this.detailObject,E,b),C(i.filter((function(e){return"bref"===e.type}))))}},{key:"renderDetail",value:function(t){var n=this,a=t.sections,r=t.style,i=t.fields,c=this.model,u=this.props.currentUser,d=function(t){return t.map((function(t){return e.isString(t)?{name:t}:t})).filter((function(e){var t=e.name;return Object(w["t"])(c,t)})).filter((function(e){var t=e.showIf;return!(t&&!Object(w["G"])(t,n.detailObject,n.schemas,n.model))})).filter((function(e){var t={fields:e,currentUser:u,model:c},n=Object(x["c"])(t);return n}))};if(a&&a.length){var p=y["Fragment"];"tab"===r?p=l["a"]:"step"===r&&(p=o["a"]);var m=j.a.createElement(p,null,a.map((function(t,a){var i,o=d(t.fields);return((null===t||void 0===t||null===(i=t.style)||void 0===i?void 0:i.widget)in C["c"]||!e.isEmpty(o))&&n.renderSection({title:t.title,fields:o,description:t.description,style:r,index:a,sectionStyle:t.style,model:c})})));return j.a.createElement(y["Fragment"],null,"group"===r?m:j.a.createElement(s["a"],{loading:!this.nullOrDetailObject,bordered:!1},m))}var f=d(i);return j.a.createElement(y["Fragment"],null,f.map((function(e){return n.renderField(e)})))}},{key:"render",value:function(){var e=this;if(!this.canRender()||!this.detailObject)return null;var t=this.state,n=t.previewImageUrl,a=t.previewImageVisible,r=j.a.createElement(k["a"],{url:n,visible:a,onClose:function(){return e.setState({previewImageVisible:!1})}}),i=this.props.onMobile;return j.a.createElement(y["Fragment"],null,r,j.a.createElement("div",{style:i?{marginLeft:-24,marginRight:-24}:{}},this.renderDetail(this.detail)))}}]),a}(y["Component"]),i.defaultProps={},r=c))||r);t["a"]=A}).call(this,n("LvDl"))},"VoC+":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("oBTY");function r(e){if(1===e.length)return e[0].map((function(e){return[e]}));var t=[],n=e[0],i=e[1];if(n.forEach((function(e){i.forEach((function(n){t.push([e,n])}))})),e.length>2){var c=e.splice(0,2),o=[t].concat(Object(a["a"])(c));t=r(o)}return t}},Z3Sq:function(e,t,n){e.exports={success:"success___1ltB-",error:"error___bK3jg"}},beBC:function(e,t,n){"use strict";n.r(t);var a,r=n("9og8"),i=n("fWQN"),c=n("mtLc"),o=n("w4Tj"),l=n("oZsa"),s=n("yKVA"),u=n("879j"),d=n("WmNS"),p=n.n(d),m=n("q1tI"),f=n.n(m),h=(n("F4L/"),n("iTJz")),v=(n("GNNt"),n("wEI+")),b=n("SA0R"),g=n.n(b),y=(n("yavW"),n("WuMn")),j=n("9Ndd"),O=n("2mwZ"),E=n("ASN+"),k=n("d76M"),w=(n("52nx"),n("7bDm")),_=n("jrin"),x="int",C="char",S="text",F="bool",A="fk",P="m2m",N="o2o",D="decimal",T="date",M="datetime",I="time",L="email",B="auto",U="float",V="ipaddr",K="positiveint",q="slug",R="url",G="uuid",z="bigint",W="smallint",Y="positivesmallint",J="image",X="file",H="object",Z="array",Q=[C,q,R,J,L,X],$=Object(_["a"])({},S,[Z,H]),ee=[[S,C,q,J,X,L,G,V,x,z,W,Y,K,D,U],[N,A,P]],te=(a={},Object(_["a"])(a,x,"\u6574\u6570"),Object(_["a"])(a,C,"\u5b57\u7b26\u4e32"),Object(_["a"])(a,S,"\u957f\u6587\u672c"),Object(_["a"])(a,F,"\u5e03\u5c14\u503c"),Object(_["a"])(a,A,"\u5f15\u7528"),Object(_["a"])(a,P,"\u591a\u5bf9\u591a"),Object(_["a"])(a,N,"\u4e00\u5bf9\u4e00"),Object(_["a"])(a,D,"\u5c0f\u6570"),Object(_["a"])(a,T,"\u65e5\u671f"),Object(_["a"])(a,M,"\u65e5\u671f\u65f6\u95f4"),Object(_["a"])(a,I,"\u65f6\u95f4"),Object(_["a"])(a,L,"\u7535\u5b50\u90ae\u4ef6"),Object(_["a"])(a,B,"\u81ea\u589e\u6574\u6570"),Object(_["a"])(a,U,"\u6d6e\u70b9\u6570"),Object(_["a"])(a,V,"ip\u5730\u5740"),Object(_["a"])(a,K,"\u975e\u8d1f\u6574\u6570"),Object(_["a"])(a,q,"\u7b80\u77ed\u6807\u8bc6"),Object(_["a"])(a,R,"URL"),Object(_["a"])(a,G,"\u552f\u4e00\u6807\u8bc6\u7b26"),Object(_["a"])(a,z,"\u5927\u6574\u6570"),Object(_["a"])(a,W,"\u5c0f\u6574\u6570"),Object(_["a"])(a,Y,"\u5c0f\u6b63\u6574\u6570"),Object(_["a"])(a,J,"\u56fe\u7247"),Object(_["a"])(a,X,"\u6587\u4ef6"),Object(_["a"])(a,H,"\u5bf9\u8c61"),Object(_["a"])(a,Z,"\u6570\u7ec4"),a),ne={validateTypeSelected:function(e){var t=e.name,n=e.value,a=e.initialValue,r=e.form;Q.includes(n)&&Q.includes(a)||a in $&&$[a].includes(n)||ee[0].includes(a)&&ee[1].includes(n)||(setTimeout((function(){r.resetFields([t])}),1e3),w["a"].warning({title:"\u4e0d\u5408\u6cd5\u7684\u5b57\u6bb5\u7c7b\u578b\u8f6c\u6362",content:"\u4e0d\u652f\u6301\u5c06\u201c".concat(te[a],"\u201d\u5b57\u6bb5\u7c7b\u578b\u8f6c\u6362\u4e3a\u201c").concat(te[n],"\u201d\u5b57\u6bb5\u7c7b\u578b")}))}},ae={fieldHandler:ne},re=n("1hG1"),ie=n("K/pY"),ce=n("fNJA"),oe=n("Lafb"),le=n("4WK3"),se=n("EBSl");function ue(){Object(se["p"])({type:se["d"],action:"add",name:"\u65b0\u5efa",rspType:se["j"],title:le["a"],component:le["b"],callback:le["d"]}),Object(se["p"])({type:se["d"],action:"link",name:"\u94fe\u63a5",rspType:se["i"],title:"\u94fe\u63a5"}),Object(se["p"])({type:se["d"],action:"info",name:"\u5f39\u7a97\u6d88\u606f",rspType:se["h"],title:"\u5f39\u7a97\u6d88\u606f"})}var de=n("gOIk");function pe(){Object(se["p"])({type:se["d"],action:"action",name:"\u4e91\u51fd\u6570",rspType:se["e"],description:"\u81ea\u5b9a\u4e49\u6a21\u578b\u7ea7\u4e91\u51fd\u6570\uff0c\u53ea\u80fd\u591f\u6307\u5b9a\u51fd\u6570\u540d\u3002",paramsDef:[{name:"action",type:"string"}]})}var me=n("LvDl"),fe=n.n(me),he=n("jfUH");function ve(){Object(se["p"])({type:se["c"],action:"link",name:"\u94fe\u63a5",rspType:se["i"],title:"\u94fe\u63a5"}),Object(se["p"])({type:se["c"],action:"info",name:"\u5f39\u7a97\u6d88\u606f",rspType:se["h"],title:"\u5f39\u7a97\u6d88\u606f"}),Object(se["p"])({type:se["c"],action:"action",name:"\u4e91\u51fd\u6570",rspType:se["e"],title:"\u4e91\u51fd\u6570"}),Object(se["p"])({type:se["c"],action:"delete",name:"\u5220\u9664",rspType:se["g"],title:"\u5220\u9664",func:function(e,t,n,a){var r=window.g_app._store.dispatch;return r({type:"content/delete",payload:{id:Object(he["K"])(e,t),model:t}}).then((function(){a.refresh()}))}}),Object(se["p"])({type:se["c"],action:"patch",name:"\u90e8\u5206\u66f4\u65b0",rspType:se["g"],title:"\u90e8\u5206\u66f4\u65b0",func:function(e,t,n,a){var r=window.g_app._store.dispatch,i=n.params.payload.fields,c=window.g_app._store.getState(),o=c.content.schemas,l=i.reduce((function(e,t){var n=e;return n[t.name]=t.value,n}),{});return fe.a.isEmpty(l)?null:r({type:"content/patch",payload:{model:t,id:Object(he["K"])(e,t),newValues:l,schema:o[t]}}).then((function(){a.refresh()}))}})}function be(){Object(se["p"])({type:se["d"],action:"export",name:"\u5bfc\u51fa",rspType:se["g"],title:"\u5bfc\u51fa",func:function(e,t,n){return n.exportData({exportKey:t.params})}})}function ge(){var e=window.g_app._store.dispatch;Object(se["p"])({type:se["b"],action:"export",name:"\u5bfc\u51fa",rspType:se["g"],title:"\u5bfc\u51fa",func:function(t,n,a,r){var i=a.params,c=i.choicesForField||Object(he["L"])(n),o=[];return c&&o.push({field:c,operator:"in",value:t.map((function(e){return Object(he["K"])(e,n)}))}),console.log("exporting excel with: ",i.model||n,o,i),e({type:"content/download",payload:{model:i.model||n,filters:o,exportKey:i}})}})}n("0zvD");var ye=n("DIQE"),je=n("Cnxa"),Oe=(n("eNCU"),n("pjJH")),Ee=(n("vmZS"),n("NjVP")),ke=n("tJVT"),we=n("oORW"),_e=n("3V3B"),xe=n("mmaM");function Ce(e){var t=e.username,n=e.is_active,a=e.handleOk,i=Object(m["useState"])(),c=Object(ke["a"])(i,2),o=c[0],l=c[1];function s(){return u.apply(this,arguments)}function u(){return u=Object(r["a"])(p.a.mark((function e(){return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(xe["setUserPassword"])({username:t,password:o,is_active:n});case 2:a();case 3:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}return f.a.createElement("div",null,f.a.createElement("div",{style:{width:400,margin:"auto"}},f.a.createElement(Ee["a"],{layout:"horizontal",labelCol:{span:4},wrapperCol:{span:19}},f.a.createElement(Ee["a"].Item,{label:"\u5bc6\u7801",labelAlign:"right",required:!0},f.a.createElement(we["a"],{value:o,onChange:function(e){return l(e)}}))),f.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:16}},f.a.createElement(Oe["a"],{type:"primary",onClick:s},"\u63d0\u4ea4"))))}var Se=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){var e;Object(i["a"])(this,n);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return e=t.call.apply(t,[this].concat(c)),e.state={groups:[]},e.onSubmit=Object(r["a"])(p.a.mark((function t(){var n,a,r,i,c;return p.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.props,a=n.username,r=n.handleOk,i=n.is_active,c=e.state.groups,t.next=4,Object(xe["setUserGroups"])({username:a,groups:c.map((function(e){return e.id})),is_active:i});case 4:r();case 5:case"end":return t.stop()}}),t)}))),e}return Object(c["a"])(n,[{key:"componentWillMount",value:function(){var e=Object(r["a"])(p.a.mark((function e(){var t,n,a,r;return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.props,n=t.username,a=t.is_active,e.next=3,Object(xe["getUserGroups"])({username:n,is_active:a});case 3:r=e.sent,this.setState({groups:r});case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"render",value:function(){var e=this,t=window.g_app._store.getState(),n=t.content.schemas,a=this.state.groups;return f.a.createElement("div",null,f.a.createElement("div",{style:{width:400,margin:"auto"}},f.a.createElement(Ee["a"],{layout:"horizontal",labelCol:{span:4},wrapperCol:{span:19}},f.a.createElement(Ee["a"].Item,{label:"\u89d2\u8272",required:!0},f.a.createElement(_e["a"],{field:n.member__user.fields.find((function(e){return"groups"===e.name})),onChange:function(t){return e.setState({groups:t})},value:a}))),f.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:16}},f.a.createElement(Oe["a"],{type:"primary",onClick:this.onSubmit},"\u63d0\u4ea4"))))}}]),n}(f.a.Component),Fe=n("fVK0"),Ae=n("9uep"),Pe=n("vbsh"),Ne=(n("T2oS"),n("W9HT")),De=(n("/zsF"),n("PArb")),Te=(n("Dvpn"),n("myml")),Me=(n("DZo9"),n("8z0m")),Ie=(n("+L6B"),n("2/Rp")),Le=(n("eE3J"),n("GSZB")),Be=n("oBTY"),Ue=n("k1fw"),Ve=(n("/xke"),n("TeRw")),Ke=(n("miYZ"),n("tsqr")),qe=n("wd/R"),Re=n.n(qe),Ge=n("/MKj");function ze(e,t){var n=e.split("\uff08");return n.length>=2&&e.endsWith("\uff09")?n[n.length-1].slice(0,-1):e in t?t[e]:null}var We=function(e){Object(s["a"])(a,e);var t=Object(u["a"])(a);function a(){var e;Object(i["a"])(this,a);for(var c=arguments.length,o=new Array(c),l=0;l<c;l++)o[l]=arguments[l];return e=t.call.apply(t,[this].concat(o)),e.state={uploadingText:"\u9009\u62e9\u6587\u4ef6",uploadingList:[],loading:!1,excelData:[],errors:[]},e.handleChange=function(t){var n=t.file,a=e.props.fetch;if("removed"===n.status?e.setState({uploadingList:[],excelData:[]}):e.setState({uploadingList:[n]}),"error"===n.status&&(console.error("\u4e0a\u4f20\u6587\u4ef6\u9519\u8bef\u4e86: ",n.response),w["a"].error({title:"\u5bfc\u5165\u6587\u4ef6\u65f6\u53d1\u751f\u672a\u77e5\u9519\u8bef",content:f.a.createElement(f.a.Fragment,null,f.a.createElement("p",null,"\u5bfc\u5165\u6587\u4ef6\u65f6\u4e2d\u53d1\u751f\u4e86\u5982\u4e0b\u9519\u8bef\uff0c\u8bf7\u53ca\u65f6\u8054\u7cfb\u7cfb\u7edf\u7ba1\u7406\u5458"),f.a.createElement("p",null,n.response))})),"done"===n.status){console.log("\u4e0a\u4f20\u72b6\u6001\u4e3aDone\u4e86: ",n.response);var r=n.response;"10000"===r.error_code?e.setState({errors:r.error_data}):"0"===r.error_code?(Ke["default"].success("\u5bfc\u5165\u6570\u636e\u6210\u529f"),a()):w["a"].error({title:"\u5bfc\u5165\u6587\u4ef6\u65f6\u53d1\u751f\u4ee3\u53f7\u4e3a\u201c".concat(r.error_code,"\u201d\u7684\u9519\u8bef"),content:f.a.createElement(f.a.Fragment,null,f.a.createElement("p",null,"\u5bfc\u5165\u6587\u4ef6\u65f6\u4e2d\u53d1\u751f\u4e86\u5982\u4e0b\u9519\u8bef\uff0c\u8bf7\u53ca\u65f6\u8054\u7cfb\u7cfb\u7edf\u7ba1\u7406\u5458"),f.a.createElement("p",null,"\u9519\u8bef\u8bf4\u660e\uff1a",r.error_message),f.a.createElement("p",null,"\u9519\u8bef\u6570\u636e\uff1a",r.error_data))})}},e.forEachHeader=function(t){var n=e.props,a=n.model,r=n.content.schemas;r[a].fields.forEach((function(e){Object(he["z"])(e)||e.primaryKey||(Object(he["D"])(e)?r[e.ref].fields.forEach((function(n){Object(he["B"])(n)||n.primaryKey||t([e,n])})):t([e]))}))},e.handleCancel=Object(r["a"])(p.a.mark((function t(){var n,a,r,i,c,o,l,s,u;return p.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.props,a=n.model,r=n.fetch,i=n.content.schemas,c=e.state.excelData,!fe.a.isEmpty(c)){t.next=5;break}return Ke["default"].error("\u5bfc\u5165\u5931\u8d25"),t.abrupt("return");case 5:if(o={},!fe.a.isEmpty(i[a])){t.next=9;break}return Ke["default"].info("\u6a21\u578b\u6ca1\u6709\u5b57\u6bb5"),t.abrupt("return");case 9:return e.forEachHeader((function(e){var t=fe.a.last(e);t&&t.choices&&(o[e.map((function(e){return e.name})).join(".")]=t.choices)})),l=Ke["default"].loading({content:"\u5bfc\u5165\u4e2d,\u8bf7\u52ff\u5173\u95ed\u7a97\u53e3",duration:0,key:"DataImport"}),e.setState({loading:!0}),s={},i[a].fields.forEach((function(e){s[e.displayName]=e.name})),u=c.map((function(e){var t={};return Object.keys(e).forEach((function(n){var r=ze(n,s);if(r){t[r]=e[n],o[r]&&o[r].forEach((function(a){e[n]===a[1]&&(t[r]=a[0])}));var c=Object(he["t"])(a,r,i);if(c&&"date"===c.type){var l=Re()(t[r]);l.isValid()?t[r]=l.format("YYYY-MM-DD"):delete t[r]}}})),t})).map((function(e){var t={};return Object.entries(e).forEach((function(e){var n=Object(ke["a"])(e,2),a=n[0],r=n[1];if(a.includes(".")){var i=a.split("."),c=Object(ke["a"])(i,2),o=c[0],l=c[1];o in t||(t[o]={}),t[o][l]=r}else t[a]=r})),t})),t.prev=15,t.next=18,Object(xe["createContent"])({model:a,values:u},{msgOption:!1});case 18:Ke["default"].success({content:"\u5bfc\u5165\u6210\u529f",key:"DataImport"}),r(),t.next=26;break;case 22:t.prev=22,t.t0=t["catch"](15),l(),Ve["default"].error({message:"\u5bfc\u5165\u5931\u8d25",description:t.t0.error_data.filter(fe.a.negate(fe.a.isEmpty)).map((function(e){return fe.a.map(e,(function(e,t){return"".concat(t,": ").concat(e.join("\uff0c"))})).join("")})).map((function(e,t){return f.a.createElement("div",null,t+2,"\uff1a",e)}))});case 26:return t.prev=26,e.setState({loading:!1,uploadingList:[],excelData:[]}),t.finish(26);case 29:case"end":return t.stop()}}),t,null,[[15,22,26,29]])}))),e.getExpandFields=function(){var t=e.props.model;return Object(xe["getExpandFields"])(t)},e.getCharCol=function(e){var t="",n=0,a=e;while(a>0)n=a%26+1,t=String.fromCharCode(n+64)+t,a=(a-n)/26;return"".concat(t,"1")},e.exportMesh=function(){var t=e.props,a=t.model,r=t.config,i=t.content.schemas;if(null!==r&&void 0!==r&&r.template)window.open(r.template,"__blank");else{var c=[];if(fe.a.isEmpty(i[a]))Ke["default"].info("\u6a21\u578b\u6ca1\u6709\u5b57\u6bb5");else{e.forEachHeader((function(e){c.push("".concat(e.map((function(e){return e.displayName})).join(""),"\uff08").concat(e.map((function(e){return e.name})).join("."),"\uff09"))}));var o=c.map((function(e){return{title:e,dataIndex:e,key:e}})),l=o.map((function(t,n){return{key:t.key,title:t.title,position:n>25?e.getCharCol(n):String.fromCharCode(65+n)+1}})).reduce((function(e,t){return Object(Ue["a"])(Object(Ue["a"])({},e),{},Object(_["a"])({},t.position,{key:t.key,v:t.title}))}),{}),s=Object.keys(l),u="".concat(s[0],":").concat(s[s.length-1]),d=o.map((function(){return{wpx:80}})),p={SheetNames:[a],Sheets:Object(_["a"])({},a,Object(Ue["a"])(Object(Ue["a"])({},l),{},{"!ref":u,"!cols":d}))};Promise.all([n.e(32),n.e(24)]).then(n.bind(null,"vSpB")).then((function(e){var t=e.XLSX.writeFile;t(p,"".concat(a,".xlsx"))}))}}},e.onImportExcel=function(t){var a=[],r=e.props.config;if(!fe.a.isEmpty(r))return e.setState({uploadingText:"\u91cd\u65b0\u9009\u62e9",errors:[]}),!0;var i=new FileReader;return i.readAsBinaryString(t),i.onload=function(t){var r=function(){return Ke["default"].error({content:"\u6587\u4ef6\u89e3\u91ca\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9",key:"uploadExcel"})};Promise.all([n.e(32),n.e(24)]).then(n.bind(null,"vSpB")).then((function(n){var i=n.XLSX,c=i.read,o=i.utils;if(t.target)try{var l=t.target.result,s=c(l,{type:"binary",cellDates:!0}),u=s.Sheets;Object.keys(u).forEach((function(e){a=a.concat(o.sheet_to_json(u[e]))})),e.setState({uploadingText:"\u91cd\u65b0\u9009\u62e9",excelData:a})}catch(d){r()}else r()})).catch(r)},!1},e}return Object(c["a"])(a,[{key:"render",value:function(){var e=this.state,t=e.uploadingText,n=e.uploadingList,a=e.loading,r=e.excelData,i=e.errors,c=this.props,o=c.config,l=c.model,s=c.superior,u="/basebone/".concat(l,"/import/file/"),d={import_config:JSON.stringify(o)};s&&(d.detail_id=s.id,d.detail_model=s.model,d.detail_field=s.field);var p=[{title:"\u884c\u53f7",dataIndex:"line",key:"line"}];return null!==o&&void 0!==o&&o.list_mapping&&p.push.apply(p,Object(Be["a"])(null===o||void 0===o?void 0:o.list_mapping.map((function(e){return{title:"\u5217".concat(e.column),dataIndex:["error",e.field],key:"error".concat(e.field),render:function(e){return null===e||void 0===e?void 0:e.join("\n")}}})))),f.a.createElement(f.a.Fragment,null,f.a.createElement(Ne["a"],{spinning:a},null!==o&&void 0!==o&&o.template||fe.a.isEmpty(o)?f.a.createElement("p",null,f.a.createElement("a",{onClick:this.exportMesh},"\u70b9\u51fb\u4e0b\u8f7d\u6a21\u677f"),"\u5e76\u6309\u6a21\u677f\u7f16\u8f91\u9700\u5bfc\u5165\u7684\u6570\u636e\u3002"):f.a.createElement(f.a.Fragment,null),f.a.createElement("b",null,"\u63d0\u793a\uff1a"),null!==o&&void 0!==o&&o.description?f.a.createElement("pre",null,o.description):f.a.createElement(f.a.Fragment,null,f.a.createElement("p",null,"1. \u5f53\u524d\u4ec5\u652f\u6301.xls\u4ee5\u53ca.xlsx\u683c\u5f0f\u7684Excel\u6587\u4ef6\u5bfc\u5165\u3002"),f.a.createElement("p",null,"2. \u6a21\u677f\u4e2d\u7684\u5b57\u6bb5\u5de6\u53f3\u987a\u5e8f\u53ef\u4ee5\u8c03\u6574\uff0c\u4f46\u4e0d\u8981\u4fee\u6539\u8868\u5934\uff0c\u4ee5\u514d\u5bfc\u5165\u65f6\u65e0\u6cd5\u8bc6\u522b\u6570\u636e\u3002"),f.a.createElement("p",null,"3. \u53ef\u5220\u9664\u6a21\u677f\u4e2d\u4e00\u4e9b\u975e\u5fc5\u586b\u7684\u5b57\u6bb5\u3002"),f.a.createElement("p",null,"4. \u6587\u4ef6\u4e2d\u7684\u6570\u636e\u5747\u4f5c\u4e3a\u65b0\u589e\u6570\u636e\u4fdd\u5b58\u5230\u7cfb\u7edf\u4e2d\u3002")),f.a.createElement(Me["a"],{name:"file",action:u,data:d,accept:".xlsx,.xls",beforeUpload:this.onImportExcel,fileList:n,withCredentials:!0,onChange:this.handleChange},f.a.createElement(Ie["a"],null,f.a.createElement(Le["a"],{type:"upload"}),t),"\xa0"),f.a.createElement("br",null),i.length>0&&f.a.createElement(f.a.Fragment,null,f.a.createElement("p",null,f.a.createElement("span",{style:{color:"red"}},"\u5bfc\u5165\u7684\u6570\u636e\u6709\u8bef\uff0c\u8bf7\u4fee\u6b63\u540e\u91cd\u65b0\u5bfc\u5165\uff0c\u9519\u8bef\u4fe1\u606f\u89c1\u4e0b\u8868\uff1a")),f.a.createElement(Te["a"],{dataSource:i,columns:p,size:"small",scroll:{y:200},pagination:!1})),fe.a.isEmpty(o)&&f.a.createElement(f.a.Fragment,null,f.a.createElement(De["a"],null),f.a.createElement("div",{style:{textAlign:"right"}},f.a.createElement(f.a.Fragment,null,f.a.createElement(Ie["a"],{type:"primary",disabled:0===r.length,onClick:this.handleCancel},f.a.createElement(Le["a"],{type:"upload"})," \u5f00\u59cb\u5bfc\u5165"))))))}}]),a}(m["Component"]),Ye=Object(Ge["c"])((function(e){var t=e.content;return{content:t}}))(We),Je=(n("Pwec"),n("CtXQ")),Xe=(n("2qtc"),n("kLXV")),He=(n("IzEo"),n("bx4M")),Ze=(n("Znn+"),n("ZTPi")),Qe=(n("g9YV"),n("wCAj")),$e=(n("OaEy"),n("2fM7")),et=(n("Mwp2"),n("VXEj")),tt=(n("sRBo"),n("kaz8")),nt=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){var e;Object(i["a"])(this,n);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return e=t.call.apply(t,[this].concat(c)),e.state={selectOption:[],checkBoxModels:[],allCheckBoxModels:[],subStep:!1,appData:void 0,loading:!1,modelData:void 0,checkBoxsAll:!0},e.handleSubmit=Object(r["a"])(p.a.mark((function t(){var n,a,i,c,o,l,s;return p.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.props.fetch,a=e.state,i=a.checkBoxModels,c=a.appData,o=a.loading,l=a.modelData,!fe.a.isEmpty(i)){t.next=5;break}return Ke["default"].info("\u8bf7\u9009\u62e9\u6a21\u578b"),t.abrupt("return");case 5:if(c){t.next=8;break}return Ke["default"].info("\u8bf7\u9009\u62e9\u6a21\u5757"),t.abrupt("return");case 8:return Ke["default"].loading({content:"\u5bfc\u5165\u4e2d,\u8bf7\u52ff\u5173\u95ed\u7a97\u53e3",duration:0,key:"ModelImport"}),o||e.setState({loading:!0}),t.prev=10,s=[],l.forEach(function(){var e=Object(r["a"])(p.a.mark((function e(t){return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:Object.keys(t).forEach((function(e){i.includes(e)&&s.push(t[e].metaModel)}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.next=15,Object(xe["createContent"])({model:"meta__model",values:s});case 15:return t.next=17,Object(xe["cloudFunc"])({model:"meta__model",functionName:"migrate"});case 17:l.forEach(function(){var e=Object(r["a"])(p.a.mark((function e(t){return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object.keys(t).forEach(function(){var e=Object(r["a"])(p.a.mark((function e(n){return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!i.includes(n)){e.next=3;break}return e.next=3,Object(xe["createContent"])({model:"".concat(c.name,"__").concat(n),values:t[n].data});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ke["default"].success({content:"\u5bfc\u5165\u6210\u529f",key:"ModelImport"}),t.next=24;break;case 21:t.prev=21,t.t0=t["catch"](10),Ke["default"].error({content:"\u5bfc\u5165\u5931\u8d25",key:"ModelImport"});case 24:return t.prev=24,e.handleClose(),e.setState({loading:!1}),n(),t.finish(24);case 29:case"end":return t.stop()}}),t,null,[[10,21,24,29]])}))),e.handleClose=function(){var t=e.props.closeModal;t(),e.setState({checkBoxModels:[],subStep:!1,appData:void 0})},e.handleAppChange=function(t){var n=e.state.modelData,a=[];n.forEach((function(e){return Object.keys(e).forEach((function(n){var r=e;r[n].metaModel.app=t.id,a.push(r)}))})),e.setState({appData:t,modelData:a})},e.onChangeAllCheckboxs=function(t){var n=e.state.allCheckBoxModels;e.setState({checkBoxModels:t.target.checked?n:[],checkBoxsAll:t.target.checked})},e.onChangeCheckboxs=function(t,n){var a=e.state,r=a.checkBoxModels,i=a.allCheckBoxModels,c=r||[];n?c.includes(t)||c.push(t):c=c.filter((function(e){return e!==t})),e.setState({checkBoxModels:c,checkBoxsAll:c.length===i.length})},e.modalFoot=function(){var t=e.state,n=t.subStep,a=t.checkBoxModels,r=t.loading;return n?[f.a.createElement(Ie["a"],{onClick:function(){return e.setState({subStep:!n})},disabled:r},"\u4e0a\u4e00\u6b65"),f.a.createElement(Ie["a"],{key:"submit",type:"primary",onClick:e.handleSubmit,loading:r},"\u5bfc\u5165")]:[f.a.createElement(Ie["a"],{onClick:function(){fe.a.isEmpty(a)?Ke["default"].info("\u8bf7\u9009\u62e9\u6a21\u578b"):e.setState({subStep:!n})},disabled:r},"\u9884\u89c8"),f.a.createElement(Ie["a"],{key:"submit",type:"primary",onClick:e.handleSubmit,loading:r},"\u5bfc\u5165")]},e}return Object(c["a"])(n,[{key:"componentWillMount",value:function(){var e=Object(r["a"])(p.a.mark((function e(){var t,n,a;return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.props.uploadData,e.next=3,Object(xe["queryContent"])({model:"meta__app"});case 3:n=e.sent,a=[],t.forEach((function(e){Object.keys(e).forEach((function(e){return a.push(e)}))})),this.setState({selectOption:n.list,modelData:t,allCheckBoxModels:a,checkBoxModels:a});case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"render",value:function(){var e=this,t=this.state,n=t.selectOption,a=t.checkBoxModels,r=t.subStep,i=t.appData,c=t.loading,o=t.modelData,l=t.checkBoxsAll;return f.a.createElement(f.a.Fragment,null,!fe.a.isEmpty(o)&&f.a.createElement(Xe["a"],{title:"\u5bfc\u5165",visible:!fe.a.isEmpty(o),onCancel:c?"":this.handleClose,maskClosable:!1,width:r?"70%":"50%",destroyOnClose:!0,footer:this.modalFoot()},f.a.createElement(Ne["a"],{spinning:c},f.a.createElement("div",null,!r&&f.a.createElement(f.a.Fragment,null,f.a.createElement(et["b"],{header:f.a.createElement(f.a.Fragment,null,"\u9009\u62e9\u6a21\u578b",f.a.createElement(tt["a"],{onChange:this.onChangeAllCheckboxs,checked:l,style:{float:"right"}},"\u5168\u9009")),bordered:!0,style:{width:"70%",margin:"auto"},size:"large"},f.a.createElement(tt["a"].Group,{style:{width:"100%"},value:a},o.map((function(t){return Object.keys(t).map((function(t){return f.a.createElement(et["b"].Item,null,f.a.createElement(tt["a"],{onChange:function(n){e.onChangeCheckboxs(t,n.target.checked)},value:t},t))}))})))),f.a.createElement("div",{style:{width:"100%",marginBottom:20,marginTop:30,textAlign:"center"}},"\u9009\u62e9\u6a21\u5757\uff1a",f.a.createElement($e["a"],{style:{paddingLeft:10,width:"62%"},onChange:this.handleAppChange,defaultValue:i},n.map((function(e){return f.a.createElement($e["a"].Option,{value:e},e.name)}))))),!fe.a.isEmpty(a)&&r&&f.a.createElement(Ze["a"],{tabPosition:"bottom"},o.map((function(e){return Object.keys(e).map((function(t){if(!a.includes(t))return null;var n=Object(Be["a"])(e[t].metaModel.fields.map((function(e){return{title:e.verbose_name,dataIndex:e.name,key:e.name,editable:!0}})));return f.a.createElement(Ze["a"].TabPane,{tab:t,key:t},f.a.createElement(He["a"],{bordered:!0,style:{marginBottom:-16,borderBottom:"none"}},f.a.createElement(Ze["a"],null,f.a.createElement(Ze["a"].TabPane,{tab:"\u7ed3\u6784",key:"\u7ed3\u6784"},f.a.createElement(Qe["a"],{columns:[{title:"\u5b57\u6bb5\u540d",dataIndex:"name",key:"name"},{title:"\u663e\u793a\u540d",dataIndex:"verbose_name",key:"verbose_name"},{title:"\u7c7b\u578b",dataIndex:"type",key:"type"}],dataSource:e[t].metaModel.fields,pagination:{pageSize:7}})),f.a.createElement(Ze["a"].TabPane,{tab:"\u6570\u636e",key:"\u6570\u636e"},f.a.createElement(Qe["a"],{columns:n,dataSource:e[t].data,pagination:{pageSize:7},bordered:!0})))))}))})))))))}}]),n}(m["Component"]),at=nt,rt=function(e){Object(s["a"])(a,e);var t=Object(u["a"])(a);function a(){var e;Object(i["a"])(this,a);for(var c=arguments.length,o=new Array(c),l=0;l<c;l++)o[l]=arguments[l];return e=t.call.apply(t,[this].concat(o)),e.state={uploadingList:[],uploadData:[]},e.handleChange=function(t){var n=t.file;e.setState({uploadingList:[{uid:n.uid,name:n.name}]})},e.onImportExcel=function(){var t=Object(r["a"])(p.a.mark((function t(a){var r,i,c,o,l,s,u,d;return p.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([n.e(32),n.e(24)]).then(n.bind(null,"vSpB"));case 2:if(r=t.sent,i=r.XLSX,c=r.pinyin,o=[],l=new FileReader,s=e.state.uploadData,l.readAsBinaryString(a),fe.a.isEmpty(s)||e.setState({uploadData:[]}),u=a.name.lastIndexOf("."),d=a.name.substring(u),[".xlsx",".xls",".csv"].includes(d)){t.next=16;break}return e.setState({uploadData:[]}),Ke["default"].error("\u4e0a\u4f20\u5931\u8d25"),t.abrupt("return");case 16:l.onload=function(t){try{var n=t.target.result,a=i.read(n,{type:"binary",cellDates:!0}),r=a.Sheets;Object.keys(r).forEach((function(e){if(r[e]["!ref"]){for(var t=[],n=[],a=[],l=c(e,{style:c.STYLE_NORMAL}).join(""),s=i.utils.decode_range(r[e]["!ref"]).e.c,u=0;u<=s;u+=1){var d="".concat(i.utils.encode_col(u),"1");if(r[e][d]&&"s"===r[e][d].t&&r[e][d].v.trim().length>0){var p=c(r[e][d].v,{style:c.STYLE_NORMAL}).join("");r[e][d].w=p,r[e][d].v=p,r[e][d].t=void 0,a.push(d)}}Object.keys(r[e]).forEach((function(t){var n="".concat(t.replace(/[0-9]+/g,""),"1");if(!["!ref","!margins"].includes(t)&&t!==n)if(r[e][n].t)if("n"===r[e][t].t){"d"!==r[e][n].t&&"s"!==r[e][n].t||(r[e][n].t="s");var a=Math.floor(r[e][t].v);a!==r[e][t].v&&(r[e][n].t="f")}else"d"===r[e][t].t?"d"!==r[e][n].t&&(r[e][n].t="s"):"s"===r[e][t].t&&(r[e][n].t="s");else r[e][n].t=r[e][t].t})),Object.keys(r[e]).forEach((function(t){var n="".concat(t.replace(/[0-9]+/g,""),"1");["!ref","!margins"].includes(t)||r[e][n].t||(r[e][n].t="s"),["!ref","!margins"].includes(t)||t===n||("s"===r[e][n].t&&(r[e][t].t=r[e][n].t,r[e][t].v="".concat(r[e][t].v)),"n"===r[e][n].t&&(r[e][t].v=Math.floor(r[e][t].v)))})),t=t.concat(i.utils.sheet_to_json(r[e])),a.forEach((function(t){"n"===r[e][t].t&&(r[e][t].t="int"),"f"===r[e][t].t&&(r[e][t].t="float"),"s"===r[e][t].t&&(r[e][t].t="text"),"d"===r[e][t].t&&(r[e][t].t="date"),n.push({name:r[e][t].v,type:r[e][t].t,verbose_name:r[e][t].h,null:!0})}));var m={name:l,table_name:e,verbose_name:l,fields:n};o.push(Object(_["a"])({},l,{metaModel:m,data:t}))}})),e.setState({uploadData:o}),Ke["default"].success("\u4e0a\u4f20\u6210\u529f")}catch(l){Ke["default"].error("\u4e0a\u4f20\u5931\u8d25")}};case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return Object(c["a"])(a,[{key:"render",value:function(){var e=this,t=this.state,n=t.uploadingList,a=t.uploadData,r=this.props.fetch;return f.a.createElement(f.a.Fragment,null,f.a.createElement(Me["a"],{name:"excel",action:"",accept:".xlsx,.xls,.csv",beforeUpload:this.onImportExcel,fileList:n,onChange:this.handleChange},f.a.createElement(Ie["a"],null,f.a.createElement(Je["a"],{type:"upload"}),"\u4e0a\u4f20Excel")),!fe.a.isEmpty(a)&&f.a.createElement(at,{uploadData:a,closeModal:function(){return e.setState({uploadingList:[],uploadData:[]})},fetch:r}))}}]),a}(m["Component"]),it=rt;function ct(e){var t=e.model;e.config;if(t)return"meta__model"===t?f.a.createElement(it,e):f.a.createElement(Ye,e)}var ot,lt,st=n("Utjr"),ut=Object(st["d"])((function(){return n.e(8).then(n.bind(null,"z2hv"))}),{loading:f.a.createElement(ye["a"],{active:!0})});function dt(){Object(se["p"])({type:se["c"],action:"intermediaryConfig",name:"\u4e2d\u95f4\u8868\u8bbe\u7f6e",rspType:se["j"],component:function(e){var t=e.currentObject,n=e.currentActionObject,a=e.context;return f.a.createElement(je["a"],{record:t,action:n.action,closeModal:function(){return a.refresh()}})},model:"meta__model",title:"\u4e2d\u95f4\u8868\u8bbe\u7f6e"}),Object(se["p"])({type:se["d"],action:"install_database",name:"\u589e\u52a0\u6570\u636e\u5e93",rspType:se["j"],component:function(e){var t=e.context.refresh;return f.a.createElement(ut,{appendMode:!0,onOk:t})},model:"db_tool__setting",title:"\u6570\u636e\u5e93\u5b89\u88c5\u5411\u5bfc",autoAdd:!0}),Object(se["p"])({type:se["c"],action:"setPassword",name:"\u91cd\u8bbe\u5bc6\u7801",rspType:se["j"],title:"\u91cd\u8bbe\u5bc6\u7801",model:function(e){var t=e.setting;return t.staff_model},permission:Fe["a"].SETTING_CUSTOM_STAFF,component:function(e){var t=e.currentObject,n=e.context.refresh,a=window.g_app._store.getState(),r=a.bsmSetting;return f.a.createElement(Ce,{username:t[r.staff_username],handleOk:n,is_active:t[r.staff_active]})},autoAdd:!0}),Object(se["p"])({type:se["c"],action:"setGroups",name:"\u8bbe\u7f6e\u89d2\u8272",rspType:se["j"],title:"\u8bbe\u7f6e\u89d2\u8272",model:function(e){var t=e.setting;return t.staff_model},permission:Fe["a"].SETTING_CUSTOM_STAFF,component:function(e){var t=e.currentObject,n=e.context.refresh,a=window.g_app._store.getState(),r=a.bsmSetting;return f.a.createElement(Se,{username:t[r.staff_username],handleOk:n,is_active:t[r.staff_active]})},autoAdd:!0}),Object(se["p"])({type:se["c"],action:"syncAccountStatus",name:"\u66f4\u65b0\u6709\u6548\u72b6\u6001",rspType:se["g"],title:"\u66f4\u65b0\u6709\u6548\u72b6\u6001",model:function(e){var t=e.setting;return t.staff_model},permission:Fe["a"].SETTING_CUSTOM_STAFF,func:function(){var e=Object(r["a"])(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=window.g_app._store.getState(),a=n.bsmSetting,e.next=3,Object(xe["upDateActive"])({username:t[a.staff_username],is_active:t[a.staff_active]});case 3:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),autoAdd:!0}),Object(se["p"])({type:se["d"],action:"syncWechatAccounts",name:"\u540c\u6b65\u4f01\u4e1a\u5fae\u4fe1\u7528\u6237",title:"\u540c\u6b65\u4f01\u4e1a\u5fae\u4fe1\u7528\u6237",rspType:se["e"],cloudFunc:"export_wechat_work_departmemt_user",model:"member__user",shouldShow:function(e){var t=e.setting;return"wechat"===t.third_party_provider},autoAdd:!0}),Object(se["p"])({type:se["d"],rspType:se["e"],action:"syncDingdingAccounts",name:"\u540c\u6b65\u9489\u9489\u7528\u6237",title:"\u540c\u6b65\u9489\u9489\u7528\u6237",cloudFunc:"export_dingding_departmemt_user",model:"member__user",shouldShow:function(e){var t=e.setting;return"dingding"===t.third_party_provider},autoAdd:!0}),Object(se["p"])({type:se["c"],rspType:se["f"],action:"pageConfig",name:"\u9875\u9762\u914d\u7f6e",title:"\u9875\u9762\u914d\u7f6e",model:"meta__model",component:function(e){var t=e.currentObject,n=e.context.hideDrawer,a="".concat(t.app_label,"__").concat(t.name).toLowerCase();return f.a.createElement(Ae["a"],{afterSubmit:n,modelName:a,key:a})},autoAdd:!0}),Object(se["p"])({type:se["d"],action:"sync_models",name:"\u4ece\u6570\u636e\u5e93\u540c\u6b65",model:"meta__model",rspType:se["e"],cloudFunc:"sync_models",callback:function(){var e=window.g_app._store.dispatch;return e({type:"content/getConfig"}).then((function(){e({type:"user/fetchCurrent"}),Object(Pe["d"])("bsm_config__menu",Pe["b"].afterUpdate)}))}})}function pt(e){var t=e.model,n=e.value,a=e.onChange,r=e.schemas,i=r&&t&&r[t].fields||[];return Object(m["useEffect"])((function(){ot=t,lt=t}),[]),Object(m["useEffect"])((function(){ot===t&&lt===t||a(""),lt=t}),[t]),f.a.createElement(y["a"],{onChange:a,value:n,allowClear:!0},i.map((function(e){return f.a.createElement(y["a"].Option,{key:e.name},e.name," (",e.displayName,")")})))}function mt(){Object(j["f"])("JSONCommonField",O["a"]),Object(j["f"])("License",E["a"]),Object(k["b"])("meta__field",ae),Object(j["f"])("PermissionSelect",re["a"]),Object(j["f"])("ModelSelect",ie["a"]),Object(j["f"])("FieldSelect",pt),Object(ce["c"])(ce["a"],"generate","\u751f\u6210\u6570\u636e",oe["a"]),Object(le["c"])(),ue(),Object(de["a"])(),pe(),ve(),be(),ge(),dt()}Object(se["p"])({type:se["d"],action:"excelImport",name:"\u5bfc\u5165",rspType:se["j"],title:"\u5bfc\u5165",permission:Fe["a"].SETTING_CUSTOM_STAFF,component:function(e){var t=e.model,n=e.currentActionParams,a=e.context,r=a.refresh,i=a.superior;return f.a.createElement(ct,{config:n,model:t,fetch:r,superior:i})},width:"50%"});var ft=n("0Owb"),ht=n("PpiC"),vt=n("Ty5D"),bt={get:function(e){return e._routeInternalComponent},has:function(e){return void 0!==e._routeInternalComponent},set:function(e,t){e._routeInternalComponent=t}},gt=function(e){var t=e.path,n=e.exact,a=e.strict,r=e.render,i=e.location,c=e.sensitive,o=Object(ht["a"])(e,["path","exact","strict","render","location","sensitive"]);return f.a.createElement(vt["d"],{path:t,exact:n,strict:a,location:i,sensitive:c,render:function(e){return r(Object(Ue["a"])(Object(Ue["a"])({},e),o))}})};function yt(e){if(bt.has(e))return bt.get(e);var t=e.Routes,n=t.length-1,a=function(e){var t=e.render,n=Object(ht["a"])(e,["render"]);return t(n)},r=function(){var e=t[n],r=a;a=function(t){return f.a.createElement(e,t,f.a.createElement(r,t))},n-=1};while(n>=0)r();var i=function(t){var n=t.render,r=Object(ht["a"])(t,["render"]);return f.a.createElement(gt,Object(ft["a"])({},r,{render:function(t){return f.a.createElement(a,Object(ft["a"])({},t,{route:e,render:n}))}}))};return bt.set(e,i),i}var jt=!1;function Ot(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e?f.a.createElement(vt["g"],n,e.map((function(e,n){if(e.redirect)return f.a.createElement(vt["c"],{key:e.key||n,from:e.path,to:e.redirect,exact:e.exact,strict:e.strict});var a=e.Routes?yt(e):gt;return f.a.createElement(a,{key:e.key||n,path:e.path,exact:e.exact,strict:e.strict,sensitive:e.sensitive,render:function(n){var a=n.location;jt&&(t={});var r=Ot(e.routes,t,{location:a});if(e.component){var i=e.component;return f.a.createElement(i,Object(ft["a"])({key:e.path},n,{route:e}),r)}return r}})}))):null}n("SePM");var Et,kt=n("PMX6"),wt={namespace:"bsmSetting",state:null!==(Et=window.$$settings)&&void 0!==Et?Et:{},effects:{getSettings:p.a.mark((function e(t,n){var a,r,i;return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=n.call,r=n.put,e.next=3,a(xe["getSettings"]);case 3:return i=e.sent,e.next=6,r({type:"changeSettings",payload:i});case 6:return e.next=8,r({type:"saveSettings",payload:i});case 8:case"end":return e.stop()}}),e)})),changeSettings:p.a.mark((function e(t,n){var a,r,i,c;return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.payload,r=n.put,i=Object.keys(a),c={},i.forEach((function(e){void 0!==a[e]&&(c[e]=a[e])})),e.next=7,r({type:"setting/changeDefaultSettings",payload:c});case 7:case"end":return e.stop()}}),e)}))},reducers:{saveSettings:function(e,t){var n=t.payload;return Object(Ue["a"])(Object(Ue["a"])({},e),n)}}},_t=n("txBY"),xt=n("9kvl"),Ct=Object(xt["a"])();window.g_app=Ct,Ct.$bsmRegisted||(Ct.$bsmRegisted=!0,Ct.model(wt),Ct.model(_t["b"]));var St=[{path:"/lightning",redirect:"/"},{path:"/",view:f.a.createElement(kt["a"],{loading:!0})},{path:"/account/settings",component:n.e(45).then(n.bind(null,"0tIf")),routes:[{path:"/account/settings",component:n.e(44).then(n.bind(null,"NmtZ"))}]},{path:"/dashboard/charts",component:Promise.all([n.e(19),n.e(41)]).then(n.bind(null,"lYqw"))},{path:"/puzzle/:puzzle",component:Promise.all([n.e(3),n.e(19),n.e(40),n.e(2),n.e(39)]).then(n.bind(null,"RWMg"))},{path:"/content/:model/map",component:n.e(47).then(n.bind(null,"Iw0d"))},{path:"/content/trigger_core__trigger/add",component:Promise.all([n.e(11),n.e(5),n.e(14)]).then(n.bind(null,"PsOX"))},{path:"/content/trigger_core__trigger/edit/:id",component:Promise.all([n.e(11),n.e(5),n.e(14)]).then(n.bind(null,"PsOX"))},{path:"/content/api_db__api/add",component:Promise.all([n.e(5),n.e(17)]).then(n.bind(null,"r7nV"))},{path:"/content/api_db__api/edit/:id",component:Promise.all([n.e(5),n.e(17)]).then(n.bind(null,"r7nV"))},{path:"/content/:model",component:Promise.all([n.e(3),n.e(2),n.e(4),n.e(12)]).then(n.bind(null,"zrVq"))},{path:"/content/:model/add",component:Promise.all([n.e(3),n.e(2),n.e(4),n.e(6)]).then(n.bind(null,"Xjaj"))},{path:"/content/:model/edit/:id",component:Promise.all([n.e(3),n.e(2),n.e(4),n.e(6)]).then(n.bind(null,"Xjaj"))},{path:"/content/:model/detail/:id",component:Promise.all([n.e(3),n.e(2),n.e(4),n.e(13)]).then(n.bind(null,"HELq"))},{path:"/content/:pModel/detail/:pId/:ref/add",component:Promise.all([n.e(3),n.e(2),n.e(4),n.e(6)]).then(n.bind(null,"Xjaj"))},{path:"/content/:pModel/detail/:pId/:ref/edit/:id",component:Promise.all([n.e(3),n.e(2),n.e(4),n.e(6)]).then(n.bind(null,"Xjaj"))},{path:"/content/:model/detail/:id/:key",component:Promise.all([n.e(3),n.e(2),n.e(4),n.e(13)]).then(n.bind(null,"HELq"))},{path:"/content/view/:model/:view",component:Promise.all([n.e(3),n.e(2),n.e(4),n.e(12)]).then(n.bind(null,"zrVq"))},{path:"/config/admin",component:n.e(72).then(n.bind(null,"VJ2P"))},{path:"/iframe/:url",component:n.e(73).then(n.bind(null,"KgJh"))},{component:n.e(48).then(n.bind(null,"pGWQ"))}].map((function(e){return Object(Ue["a"])(Object(Ue["a"])({},e),{},{exact:!0})})),Ft=function e(t){var n=t.path,a=t.component,r=t.redirect,i=t.routes,c=t.exact,o=t.view,l=void 0===o?null:o;return{component:l?function(){return l}:Object(st["d"])((function(){return a})),redirect:r,exact:c,path:n,routes:i&&i.map(e)}},At=[{path:"/user",component:n.e(50).then(n.bind(null,"Qs/n")),routes:[{path:"/user/login",component:n.e(43).then(n.bind(null,"iNMz"))},{path:"/user/register",component:n.e(49).then(n.bind(null,"uNUk"))},{path:"/user/qrcode_login",component:n.e(57).then(n.bind(null,"0+Vp"))},{path:"/user/install",component:n.e(8).then(n.bind(null,"z2hv"))}]},{path:"/login/qrcode_login",component:n.e(74).then(n.bind(null,"Bpwc"))},{path:"/",component:n.e(42).then(n.bind(null,"K3Pb")),routes:St}].map(Ft),Pt=function(){function e(t){Object(i["a"])(this,e),this.title=void 0,this.title=t}return Object(c["a"])(e,[{key:"renderTitle",value:function(){return this.title}}]),e}(),Nt=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){var e;Object(i["a"])(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return e=t.call.apply(t,[this].concat(r)),e.model=void 0,e.functionName=void 0,e.params=void 0,e}return Object(c["a"])(n,[{key:"successMessage",get:function(){return"".concat(this.title,"\u6267\u884c\u6210\u529f")}},{key:"errorMessage",get:function(){return"".concat(this.title,"\u6267\u884c\u5931\u8d25")}},{key:"onTrigger",value:function(){var e=Object(r["a"])(p.a.mark((function e(){var t;return p.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=Date.now(),Ke["default"].loading({content:"".concat(this.title,"\u6267\u884c\u4e2d"),key:t,duration:0}),e.prev=2,e.next=5,Object(xe["cloudFunction"])({model:this.model,functionName:this.functionName,params:this.params});case 5:Ke["default"].success({content:this.successMessage,key:t}),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](2),Ke["default"].error({content:this.errorMessage,key:t}),console.error(e.t0);case 12:case"end":return e.stop()}}),e,this,[[2,8]])})));function t(){return e.apply(this,arguments)}return t}()}]),n}(Pt);mt();var Dt=function(e){var t=e.context,n=void 0===t?Object(he["g"])():t;return f.a.createElement(he["b"].Provider,{value:n},f.a.createElement(h["a"],{prefixCls:"ant3",locale:g.a},f.a.createElement(v["a"],{locale:g.a},Ot(At))))},Tt=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){var e;Object(i["a"])(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return e=t.call.apply(t,[this].concat(r)),e.model="meta__model",e.functionName="migrate",e}return Object(c["a"])(n,[{key:"onTrigger",get:function(){var e=this,t=Object(he["bb"])();return Object(r["a"])(p.a.mark((function a(){return p.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(o["a"])(Object(l["a"])(n.prototype),"onTrigger",e).call(e);case 2:t({type:"content/getConfig"}).then((function(){return Object(Pe["d"])("bsm_config__menu",Pe["b"].afterUpdate)}));case 3:case"end":return a.stop()}}),a)})))}}]),n}(Nt),Mt=Object(he["g"])();Mt.tableAction("migrate",Tt);t["default"]=function(){return f.a.createElement(Dt,{context:Mt})}},fVK0:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a={CHANGE_ADMIN:"change_bsm_config__admin",CHANGE_SETTING:"change_bsm_config__setting",SETTING_CUSTOM_STAFF:"change_custom_staff__member"}},fmT3:function(e,t,n){e.exports={descriptionList:"descriptionList___3sgFN",title:"title___jo_Je",term:"term___O9ehC",detail:"detail___2YYjY",small:"small___17xaW",large:"large___1SsxZ",vertical:"vertical___2V3oj"}},gOIk:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var a=n("k1fw"),r=(n("eNCU"),n("pjJH")),i=(n("vmZS"),n("NjVP")),c=n("tJVT"),o=n("q1tI"),l=n.n(o),s=n("/MKj"),u=n("EBSl"),d=n("3V3B"),p=n("0SIm"),m=n("xNPh"),f=n("jfUH"),h=Object(s["c"])()((function(e){var t=Object(o["useState"])(),n=Object(c["a"])(t,2),a=n[0],s=n[1],u=e.field,m=e.refresh,h=e.dispatch,v=e.model,b=e.mode,g=e.widget,y=e.selectedRowIds,j=void 0===y?[]:y,O=e.groupBy,E=Object(f["t"])(v,u);function k(){var e=window.g_app._store.getState(),t=e.content.schemas;if(a){var n={};n[E.refField]=j;var r={newValues:n,model:E.ref,id:Object(f["K"])(a,E.ref),schema:t[E.ref]};"append"===b&&(r.appendModeFields=[E.refField]),h({type:"content/patch",payload:r}).then(m)}}var w=d["a"];"Cascader"===g&&(w=p["a"]);var _={field:E,onChange:s,value:a,groupBy:O};return l.a.createElement(i["a"],{labelCol:{span:5},wrapperCol:{span:19}},l.a.createElement(i["a"].Item,{label:E.displayName},l.a.createElement(w,_)),l.a.createElement(i["a"].Item,{wrapperCol:{offset:5}},l.a.createElement(r["a"],{type:"primary",onClick:k},"\u63d0\u4ea4")))}));function v(){Object(u["p"])({type:u["b"],action:"delete",name:"\u5220\u9664",rspType:u["g"],confirm:!0,func:function(e,t,n,a){var r=window.g_app._store.dispatch,i=e.map((function(e){return Object(f["K"])(e,t)}));return r({type:"content/batchAction",payload:{model:t,ids:i,action:"delete"}}).then((function(){a.refresh()}))}}),Object(u["p"])({type:u["b"],action:"action",name:"\u4e91\u51fd\u6570",rspType:u["e"],confirm:!0,paramsDef:[{name:"action",displayName:"\u4e91\u51fd\u6570\u540d",require:!0,type:"string"},{name:"payload",displayName:"\u53c2\u6570",type:"text",isJson:!0,widget:"JsonEditor",help:"\u53c2\u6570\u683c\u5f0f\u4e3aJSON object"}]}),Object(u["p"])({type:u["b"],action:"nowEdit",name:"\u66f4\u65b0",rspType:u["g"],confirm:!0,paramsDef:[{name:"fields",displayName:"\u8bbe\u7f6e\u5c5e\u6027\u503c",require:!0,default:[],widget:"FieldsSet",params:function(t){var n=t.model;return{model:n,fieldFilter:e.negate(f["B"])}}}],func:function(e,t,n,r){var i=window.g_app._store.dispatch,c=e.map((function(e){return Object(f["K"])(e,t)})),o=Object(a["a"])(Object(a["a"])({},Object(u["m"])(u["b"],n.action)),{},{params:n.params});return i({type:"content/batchAction",payload:{model:t,ids:c,action:"nowEdit",payload:o.params}}).then((function(){r.refresh()}))}}),Object(u["p"])({type:u["b"],action:"batchRefAdd",name:"\u5173\u8054\u521b\u5efa",rspType:u["j"],component:function(e){var t=e.model,n=e.currentObject,a=e.currentActionParams,r=e.context.refresh,i=n.map((function(e){return Object(f["K"])(e,t)})),c=a.field,o=Object(f["t"])(t,c),s=null===o||void 0===o?void 0:o.ref,u=Object(m["a"])(s),d={};return d[o.refField]=i,l.a.createElement(u,{model:s,onCreate:function(){r()},hiddenvalues:d,hiddenFields:d})},title:function(e){var t=e.currentActionObject,n=e.model,a=e.currentActionParams,r=a.field,i=Object(f["t"])(n,r);return"".concat(t.name).concat(i.displayName)},paramsDef:[{name:"field",type:"string",require:!0,displayName:"\u5b57\u6bb5",filter:[],widget:"FieldPicker",params:function(e){var t=e.model;return{model:t,fieldFilter:f["D"]}}}]}),Object(u["p"])({type:u["b"],action:"batchRefConnect",name:"\u5efa\u7acb\u5173\u8054",rspType:u["j"],component:function(e){var t=e.model,n=e.currentObject,a=e.currentActionParams,r=e.context.refresh,i=n.map((function(e){return Object(f["K"])(e,t)})),c=a.field,o=a.mode,s=void 0===o?"append":o,u=a.widget,d=void 0===u?"Select":u,p=a.groupBy;return l.a.createElement(h,{field:c,selectedRowIds:i,mode:s,model:t,widget:d,refresh:r,groupBy:p})},title:function(e){var t=e.currentActionObject,n=e.model,a=e.currentActionParams,r=a.field,i=Object(f["t"])(n,r);return"".concat(t.name).concat(i.displayName)},paramsDef:[{name:"mode",displayName:"\u6a21\u5f0f",type:"string",default:"append",require:!1,choices:[["append","\u6dfb\u52a0"],["replace","\u8986\u76d6"]]},{name:"field",displayName:"\u5b57\u6bb5",type:"string",require:!0,widget:"FieldPicker",params:function(e){var t=e.model;return{model:t,fieldFilter:f["D"]}}},{name:"widget",displayName:"\u7ec4\u4ef6",type:"string",require:!1,choices:[["Select","\u4e0b\u62c9\u9009\u62e9\u5668"],["Cascader","\u7ea7\u8054\u9009\u62e9\u5668"]]},{name:"groupBy",displayName:"\u5206\u7ec4\u5b57\u6bb5",type:"string",widget:"FieldPicker",require:!0,show:'${widget} === "Cascader" && ${field}',params:function(e){var t,n=e.model,a=e.values,r=void 0===a?{}:a;if(r.field){var i=Object(f["t"])(n,r.field);t=i.ref}return{model:t,fieldFilter:f["D"]}}}]})}}).call(this,n("LvDl"))},leA8:function(e,t,n){"use strict";(function(e){n("SePM");var a,r,i,c,o,l,s=n("PMX6"),u=(n("smr7"),n("DlTu")),d=(n("eNCU"),n("pjJH")),p=n("0Owb"),m=(n("GPKB"),n("mFAc")),f=(n("52nx"),n("7bDm")),h=n("k1fw"),v=n("oBTY"),b=n("fWQN"),g=n("mtLc"),y=n("tS8v"),j=n("yKVA"),O=n("879j"),E=(n("t6ct"),n("BGsl")),k=(n("eE3J"),n("GSZB")),w=n("q1tI"),_=n.n(w),x=n("Ty5D"),C=n("RLxJ"),S=n("/MKj"),F=n("jfUH"),A=n("txBY"),P=n("xNPh"),N=n("CD42"),D=n.n(N),T=function(e){var t=e.data,n=e.clickAdd,a=e.clickEdit,r=e.cilckDelete;return _.a.createElement("div",{className:D.a.container},_.a.createElement("span",null,t.title),_.a.createElement("div",{className:D.a.content},"parent"in t&&_.a.createElement("div",{className:D.a.content_box,onClick:function(e){n(t.key,e)}},_.a.createElement(k["a"],{type:"plus"})),_.a.createElement("div",{className:D.a.content_box,onClick:function(e){a(t.key,e)}},_.a.createElement(k["a"],{type:"edit"})),t.children.length<=0&&_.a.createElement("div",{className:D.a.content_box,onClick:function(e){r(t.key,e)}},_.a.createElement(k["a"],{type:"delete"}))))},M=E["a"].TreeNode,I=(a=Object(S["c"])((function(e){var t=e.user.currentUser;return{currentUser:t}})),r=Reflect.metadata("design:type",Function),i=Reflect.metadata("design:paramtypes",[void 0]),Object(x["n"])(c=a(c=Object(A["a"])(c=r(c=i((l=o=function(t){Object(j["a"])(a,t);var n=Object(O["a"])(a);function a(t){var r;return Object(b["a"])(this,a),r=n.call(this,t),r.getNavList=function(){var t=r.props.cacheAll,n=r.state.expandedKeys,a=r.getProps,i=a.model,c=a.adminConfig;if(c[i]&&c[i].detail){var o=c[i].detail.showNav;o&&t({model:i}).then((function(t){var a=r.props.match.params.id,c=r.parentField,o=Object(v["a"])(n),l=e.keyBy(t,Object(F["L"])(i)),s=l[a];if(s){var u=s[c];while(u)o.push(u),u=l[u][c]}r.setState({expandedKeys:e.uniq(o)})}))}},r.handleSelect=function(e){var t=r.props.match.params.model;e.length&&C["a"].push("/content/".concat(t,"/detail/").concat(e[0]))},r.onExpand=function(e){r.setState({expandedKeys:e,autoExpandParent:!1})},r.calcTreeData=function(){var t=Object(y["a"])(r),n=t.navList,a=r.getProps,i=a.model,c=a.adminConfig,o=a.schemas,l=a.groupList,s=a.groupCount;if(e.isEmpty(c)||!n.length)return[];var u=Object(y["a"])(r),d=u.parentField,p=o[i].titleField,m=n.map((function(e){return Object(h["a"])(Object(h["a"])({},e),{},{title:e[p],key:e[Object(F["L"])(i)],children:[]})})),f=m.map((function(e){if(e[d]){var t=m.find((function(t){return e[d]===t.key}));t&&(t.children=t.children.concat(e))}return e}));if(l){var v=f.reduce((function(e,t,n){var a=Math.floor(n/s);return n%s!==0||0===n?e[a].children=(e[a].children||[]).concat(t):e[a]={title:"".concat(n+1,"-").concat(s*a+1),key:"group:".concat(n+1,"-").concat(s*a+1),children:[t]},e}),[{title:"1-".concat(s),key:"group:1-".concat(s),children:[]}]);return v}return f.filter((function(e){return!e[d]}))},r.clickAdd=function(e,t){e?(t.stopPropagation(),r.setState({showModal:!0,title:"\u6dfb\u52a0",objectPk:void 0,nowObject:{parent:e}})):r.setState({showModal:!0,title:"\u6dfb\u52a0",objectPk:void 0,nowObject:{}})},r.cilckDelete=function(e,t){var n=r.getProps,a=n.model,i=n.dispatch;t.stopPropagation(),f["a"].confirm({title:"\u786e\u5b9a\u5220\u9664\uff1f",onOk:function(){i({type:"content/delete",payload:{id:e,model:a}}).then((function(){m["a"].success("\u5220\u9664\u6210\u529f"),r.getNavList()}))}})},r.clickEdit=function(e,t){t.stopPropagation(),r.setState({showModal:!0,title:"\u7f16\u8f91",objectPk:e,nowObject:void 0})},r.handleOk=function(){r.setState({showModal:!1})},r.handleCancel=function(){r.setState({showModal:!1})},r.treeNodesChildren=function(e){return e?_.a.createElement(T,{data:e,clickAdd:r.clickAdd,clickEdit:r.clickEdit,cilckDelete:r.cilckDelete}):null},r.renderTreeNodes=function(e){return e.map((function(e){return e.children?_.a.createElement(M,{title:r.treeNodesChildren(e),key:e.key},r.renderTreeNodes(e.children)):_.a.createElement(M,Object(p["a"])({key:e.key},e))}))},r.topadd=function(){return _.a.createElement("div",{onClick:function(){return r.clickAdd()}},_.a.createElement(d["a"],{icon:"plus",size:"small"},"\u6dfb\u52a0"))},r.state={expandedKeys:[],autoExpandParent:!0,showModal:!1,title:"",objectPk:"",nowObject:{parent:""}},r}return Object(g["a"])(a,[{key:"componentDidMount",value:function(){var t=this.getProps,n=t.schemas,a=t.adminConfig;e.isEmpty(n)||e.isEmpty(a)||this.getNavList()}},{key:"componentDidUpdate",value:function(t){var n=this.parentField,a=this.navList,r=this.state.expandedKeys,i=this.props.match.params.id,c=this.getProps.model,o=function(t){var n=t.schemas,a=t.adminConfig;return!e.isEmpty(n)&&!e.isEmpty(a)},l=o(t),s=o(this.getProps);if(!l&&s)this.getNavList();else if(i!==t.match.params.id){var u=Object(v["a"])(r),d=a.find((function(e){return Object(F["K"])(e,c)===i}));d&&function(){var e=d[n];while(e)u.push(e),e=a.find((function(t){return Object(F["K"])(t,c)===e}))[n]}(),this.setState({expandedKeys:e.uniq(u)}),window.scrollTo(0,0)}}},{key:"navList",get:function(){var e=this.props.all,t=this.getProps.model;return e[t]||[]}},{key:"parentField",get:function(){var e=this.getProps,t=e.model,n=e.adminConfig;return n[t].parentField||"parent"}},{key:"getProps",get:function(){var e=this.props,t=e.schemas,n=e.adminConfig,a=e.dispatch,r=e.match,i=r.params,c=i.model,o=i.id,l=r.path,s=r.url,u=e.groupList,d=e.groupCount;return{schemas:t,adminConfig:n,model:c,id:o,dispatch:a,url:s,path:l,groupList:u,groupCount:d}}},{key:"render",value:function(){var e=this,t=this.state,n=t.autoExpandParent,a=t.expandedKeys,r=t.showModal,i=t.title,c=t.objectPk,o=t.nowObject,l=this.props.all,d=this.getProps.model,p=Object(P["a"])(d),m=this.props.match.params.id;return _.a.createElement(s["a"],{bordered:!1},this.topadd(),d in l?_.a.createElement("div",{className:D.a.select},_.a.createElement(E["a"],{showLine:!0,onExpand:this.onExpand,expandedKeys:a,autoExpandParent:n,onSelect:this.handleSelect,selectedKeys:[m]},this.renderTreeNodes(this.calcTreeData()))):_.a.createElement(u["a"],null),_.a.createElement(f["a"],{title:i,width:"60%",destroyOnClose:!0,visible:r,closable:!0,keyboard:!0,onOk:this.handleOk,onCancel:this.handleCancel,footer:null},_.a.createElement(p,{model:d,objectid:c,hiddenvalues:o,onCreate:function(){e.handleCancel(),e.getNavList()},onUpdate:function(){e.handleCancel(),e.getNavList()}})))}}]),a}(w["Component"]),o.defaultProps={treeData:[]},c=l))||c)||c)||c)||c)||c);t["a"]=I}).call(this,n("LvDl"))},sC82:function(e,t,n){"use strict";var a=n("0Owb"),r=(n("e+1C"),n("Nd5c")),i=n("jrin"),c=n("PpiC"),o=n("q1tI"),l=n.n(o),s=n("TSYQ"),u=n.n(s),d=n("fmT3"),p=n.n(d),m=function(e){var t,n=e.className,o=e.title,s=e.col,d=void 0===s?3:s,m=e.layout,f=void 0===m?"horizontal":m,h=e.gutter,v=void 0===h?32:h,b=e.children,g=e.size,y=Object(c["a"])(e,["className","title","col","layout","gutter","children","size"]),j=u()(p.a.descriptionList,p.a[f],n,(t={},Object(i["a"])(t,p.a.small,"small"===g),Object(i["a"])(t,p.a.large,"large"===g),t)),O=d>4?4:d;return l.a.createElement("div",Object(a["a"])({className:j},y),o?l.a.createElement("div",{className:p.a.title},o):null,l.a.createElement(r["a"],{gutter:v},l.a.Children.map(b,(function(e){return e?l.a.cloneElement(e,{column:O}):e}))))},f=m,h=(n("ER8q"),n("Ai5L")),v={1:{xs:24},2:{xs:24,sm:12},3:{xs:24,sm:12,md:8},4:{xs:24,sm:12,md:6}},b=function(e){var t=e.term,n=e.column,r=e.children,i=Object(c["a"])(e,["term","column","children"]);return l.a.createElement(h["a"],Object(a["a"])({},v[n],i),t&&l.a.createElement("div",{className:p.a.term},t),null!==r&&void 0!==r&&l.a.createElement("div",{className:p.a.detail},r))};b.defaultProps={term:""};var g=b;f.Description=g;t["a"]=f}},0,[3,2,4,32,24]]);