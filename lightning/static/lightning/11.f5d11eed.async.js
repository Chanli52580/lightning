(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{JlTr:function(e,t,n){e.exports={header:"antd-pro-bsm-layouts-index-header",logo:"antd-pro-bsm-layouts-index-logo",menu:"antd-pro-bsm-layouts-index-menu",trigger:"antd-pro-bsm-layouts-index-trigger",right:"antd-pro-bsm-layouts-index-right",action:"antd-pro-bsm-layouts-index-action",search:"antd-pro-bsm-layouts-index-search",account:"antd-pro-bsm-layouts-index-account",avatar:"antd-pro-bsm-layouts-index-avatar",dark:"antd-pro-bsm-layouts-index-dark",name:"antd-pro-bsm-layouts-index-name"}},K3Pb:function(e,t,n){"use strict";n.r(t);n("fOrg");var a,r=n("+KLJ"),o=n("Y/ft"),i=n.n(o),c=n("gWZ8"),s=n.n(c),u=n("d6i3"),l=n.n(u),f=(n("+L6B"),n("2/Rp")),p=(n("/xke"),n("TeRw")),d=n("p0pE"),m=n.n(d),h=n("1l/V"),v=n.n(h),b=n("2Taf"),g=n.n(b),y=n("vZ4D"),w=n.n(y),E=n("MhPg"),k=n.n(E),C=n("l4Ni"),S=n.n(C),x=n("ujKo"),R=n.n(x),_=n("q1tI"),O=n.n(_),P=n("Hx5s"),V=n("3a4m"),D=n.n(V),M=n("55Ip"),N=n("MuoO"),j=n("HP82"),W=n("vbsh"),T=n("jfUH"),I=n("CVtM"),K=(n("2qtc"),n("kLXV")),U=(n("5NDa"),n("5rEg")),z=(n("miYZ"),n("tsqr")),F=(n("y8nQ"),n("Vl3Y")),$=n("tl1k"),q=n.n($);function H(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=R()(e);if(t){var r=R()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return S()(this,n)}}var L,A=F.a.Item,B=Object(N.connect)(function(e){return{currentUser:e.user.currentUser}})(a=F.a.create()(a=function(e){k()(n,e);var t=H(n);function n(){var e;g()(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).setBaseInfo=function(){var t=e.props,n=t.currentUser,a=t.form;Object.keys(a.getFieldsValue()).forEach(function(e){var t={};t[e]=n[e]||null,a.setFieldsValue(t)})},e.getViewDom=function(t){e.view=t},e.handleCancel=function(){(0,e.props.handleCancel)()},e.handleSubmit=v()(l.a.mark(function t(){var n,a,r,o,i,c,s;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.props,a=n.form,r=a.validateFields,o=a.getFieldsValue,i=n.currentUser.id,t.next=3,r(function(e){});case 3:return t.next=5,Object(j.cloudFunction)({model:"bsm_config__setting",functionName:"update_user_password",params:m()({id:i},o())});case 5:if("9000"!==(c=t.sent).error_code){t.next=9;break}return z.a.error(c.error_data),t.abrupt("return");case 9:"0"!==(s=c.error_code)&&"403"!==s||((0,e.props.handleOk)(),D.a.push("/user/login"));case 11:case"end":return t.stop()}},t)})),e}return w()(n,[{key:"componentDidMount",value:function(){this.setBaseInfo()}},{key:"render",value:function(){var e=this.props,t=e.form.getFieldDecorator,n=e.visible;return O.a.createElement(K.a,{visible:n,title:"密码设置",onOk:this.handleSubmit,onCancel:this.handleCancel},O.a.createElement("div",{className:q.a.baseView,ref:this.getViewDom},O.a.createElement("div",{className:q.a.left},O.a.createElement(F.a,{layout:"vertical",onSubmit:this.handleSubmit,hideRequiredMark:!0},O.a.createElement(A,{label:"旧密码"},t("oldPassWord",{rules:[{required:!0,message:"请输入旧密码!"}]})(O.a.createElement(U.a.Password,{placeholder:"请输入旧密码"}))),O.a.createElement(A,{label:"新密码"},t("newPassWord",{rules:[{required:!0,message:"请输入新密码!"}]})(O.a.createElement(U.a.Password,{placeholder:"请输入新密码"})))))))}}]),n}(_.Component))||a)||a,Q=(n("T2oS"),n("W9HT")),J=(n("Telt"),n("Tckk")),Y=(n("lUTK"),n("BvKs")),G=(n("Pwec"),n("CtXQ")),Z=n("Y2fQ"),X=n("fVK0"),ee=(n("qVdP"),n("jsC+")),te=n("TSYQ"),ne=n.n(te),ae=n("QyDn"),re=n.n(ae),oe=function(e){var t=e.overlayClassName,n=i()(e,["overlayClassName"]);return O.a.createElement(ee.a,Object.assign({overlayClassName:ne()(re.a.container,t)},n))},ie=n("JlTr"),ce=n.n(ie);function se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=R()(e);if(t){var r=R()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return S()(this,n)}}var ue,le=Object(N.connect)(function(e){return{currentUser:e.user.currentUser}})(L=function(e){k()(n,e);var t=se(n);function n(){var e;g()(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={visible:!1},e}return w()(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.onMenuClick,a=t.currentUser,r=t.theme,o=a.permissions,i=void 0===o?[]:o,c=this.state.visible,s=O.a.createElement(Y.a,{className:ce.a.menu,selectedKeys:[],onClick:function(t){n(t),e.setState({visible:!1})}},O.a.createElement(Y.a.Item,{key:"changePassword"},O.a.createElement(G.a,{type:"form"}),"修改密码"),O.a.createElement(Y.a.Divider,null),i.includes(X.a.CHANGE_SETTING)&&O.a.createElement(Y.a.Item,{key:"webSettings"},O.a.createElement(G.a,{type:"setting"}),O.a.createElement(Z.FormattedMessage,{id:"menu.account.webSettings",defaultMessage:"webSettings"})),i.includes(X.a.CHANGE_SETTING)&&O.a.createElement(Y.a.Divider,null),O.a.createElement(Y.a.Item,{key:"about"},O.a.createElement(G.a,{type:"info-circle"}),O.a.createElement(Z.FormattedMessage,{id:"menu.about",defaultMessage:"about"})),O.a.createElement(Y.a.Divider,null),O.a.createElement(Y.a.Item,{key:"logout"},O.a.createElement(G.a,{type:"logout"}),O.a.createElement(Z.FormattedMessage,{id:"menu.account.logout",defaultMessage:"logout"}))),u=ce.a.right;return"dark"===r&&(u="".concat(ce.a.right,"  ").concat(ce.a.dark)),O.a.createElement("div",{className:u},a.username?O.a.createElement(oe,{overlay:s,visible:c,onVisibleChange:function(t){return e.setState({visible:t})}},O.a.createElement("span",{className:"".concat(ce.a.action," ").concat(ce.a.account)},O.a.createElement(J.a,{size:"small",className:ce.a.avatar,src:a.avatar,alt:"avatar",icon:!a.avatar&&"user"}),O.a.createElement("span",{className:ce.a.name},a.nick_name||a.name||a.username),O.a.createElement(G.a,{type:c?"caret-up":"caret-down",style:{marginLeft:8,fontSize:16,color:"#595959"}}))):O.a.createElement(Q.a,{size:"small",style:{marginLeft:8,marginRight:24}}))}}]),n}(_.Component))||L,fe=n("53l0");function pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=R()(e);if(t){var r=R()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return S()(this,n)}}var de=Object(N.connect)(function(e){var t=e.content;return{release:t.release,build:t.build}})(ue=function(e){k()(n,e);var t=pe(n);function n(){var e;g()(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={passWordVisible:!1,aboutVisible:!1},e.handleMenuClick=function(t){var n=t.key,a=e.props.dispatch;"logout"===n&&a({type:"content/logout"}),"webSettings"===n&&D.a.push("/account/settings"),"changePassword"===n&&e.showPassWord(),"about"===n&&e.setState({aboutVisible:!0})},e.handleOkPassWord=function(){e.setState({passWordVisible:!1})},e.handleCancelPassWord=function(){e.setState({passWordVisible:!1})},e.showPassWord=function(){e.setState({passWordVisible:!0})},e}return w()(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.release,a=t.build,r=this.state,o=r.passWordVisible,i=r.aboutVisible;return O.a.createElement(O.a.Fragment,null,O.a.createElement(le,{onMenuClick:this.handleMenuClick}),O.a.createElement(B,{visible:o,handleCancel:this.handleCancelPassWord,handleOk:this.handleOkPassWord}),O.a.createElement(K.a,{title:"关于",visible:i,onOk:function(){e.setState({aboutVisible:!1})},onCancel:function(){e.setState({aboutVisible:!1})}},O.a.createElement("div",null,O.a.createElement("p",null,fe.f,"系统。由杰明科技荣誉出品。"),O.a.createElement("p",null,"发行版本号：",n),O.a.createElement("p",null,"前端构建版本：","NA"),O.a.createElement("p",null,"后端构建版本：",a))))}}]),n}(_.Component))||ue,me={adminConfig:function(){return"/config/admin"},chart:function(){return"/dashboard/charts"},puzzle:function(e){var t=e.puzzle;return"/puzzle/".concat(t)},list:function(e){var t=e.model;return{path:"/content/".concat(t),name:"".concat(Object(T.o)(t),"管理")}},detail:function(e){return"/content/".concat(e.model,"/detail/").concat(e.id||"__index__")},add:function(e){return"/content/".concat(e.model,"/add").concat(e.redirectPath?"?redirect_path=".concat(e.redirectPath):"")},auto:function(e){return e.path},iframe:function(e){return"/iframe/".concat(encodeURIComponent(e.path))},map:function(e){var t=e.model;return{path:"/content/".concat(t,"/map"),name:"".concat(Object(T.o)(t),"管理")}}},he={},ve={};var be=0;function ge(e){var t=e.icon,n=e.name,a=e.page,r=e.children,o=void 0===r?[]:r,c=e.params,s=i()(e,["icon","name","page","children","params"]),u="".concat(be+=1,"/");o.length||(u=me[a]?me[a](m()({},s,c)):"/exception/404");for(var l=t||u.icon||null,f=["outlined","filled","twoTone"],p=0;p<f.length;p+=1){var d="__".concat(f[p]);if(l&&l.endsWith(d)){l=O.a.createElement(G.a,{type:l.slice(0,-d.length),theme:"outlined"});break}}return{icon:l,name:n||u.name||"无名菜单",path:u.path||u,children:o.map(ge)}}function ye(e){be=0;var t=e.map(ge);return t.forEach(function(e){return function e(t,n,a){t.children.length||(he[t.path]=n,ve[t.path]=a.concat({breadcrumbName:t.name,path:t.path})),t.children.forEach(function(r){return e(r,n.concat(t.path),a.concat({breadcrumbName:t.name,path:t.path}))})}(e,[],[])}),t}function we(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=R()(e);if(t){var r=R()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return S()(this,n)}}var Ee=function(e,t,n,a){var r,o=arguments.length,i=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,a);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(o<3?r(i):o>3?r(t,n,i):r(t,n))||i);return o>3&&i&&Object.defineProperty(t,n,i),i},ke=function(e){var t={},n="";e.forEach(function e(a){n||0!==a.children.length||(n=a.path),a.children.forEach(function(n){t[n.path]=a.path,e(n)})});var a=[],r=location.pathname;for("/"===r&&(r=n);r in t;)r=t[r],a.push(r);return{openKeys:a,first:n}},Ce=function(e){k()(n,e);var t=we(n);function n(){var e;return g()(this,n),(e=t.apply(this,arguments)).state={visible:!0,passWordVisible:!1,aboutVisible:!1,openKeys:[],first:""},e.updateMenus=function(t){var n=ye(t);e.setState({menus:n}),e.setState(ke(n))},e.onOpenChange=function(t){var n=e.state,a=n.menus,r=void 0===a?[]:a,o=n.openKeys,i=t.find(function(e){return-1===o.indexOf(e)});if(void 0!==i){var c={};r.forEach(function e(t){t.children.forEach(function(n){c[n.path]=t.path,e(n)})});var s=t.filter(function(e){return t=i,c[e]!==c[t];var t}).concat([i]);e.setState({openKeys:s})}else e.setState({openKeys:t})},e}return w()(n,[{key:"componentDidMount",value:function(){var e=v()(l.a.mark(function e(){var t,n,a,r,o,i,c=this;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.props,n=t.dispatch,a=t.route,r=a.routes,o=a.path,i=a.authority,Promise.all([n(window.$userinfo&&window.$permissions?{type:"user/saveCurrentUser",payload:m()({},window.$userinfo,{permissions:window.$permissions.map(T.B)})}:{type:"user/fetchCurrent"}),n(window.$settings?{type:"bsmSetting/changeSettings",payload:window.$settings}:{type:"bsmSetting/getSettings"})]).then(function(){var e,t,n=c.props,a=n.user,r=n.bsmSetting;(null===a||void 0===a?void 0:null===(e=a.currentUser)||void 0===e?void 0:null===(t=e.permissions)||void 0===t?void 0:t.includes("can_web_setting__bsm_config"))&&null===(null===r||void 0===r?void 0:r.DB_TIMEZONE)&&p.a.warn({duration:null,placement:"bottomRight",message:"版本兼容性警告",description:"未设置时区，当前版本需要设置数据库时区",key:"timezone-warning",onClick:function(){D.a.push("/account/settings/website"),p.a.close("timezone-warning")},btn:O.a.createElement(f.a,{type:"primary"},"前往设置")})}),n({type:"setting/getSetting"}),v()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(window.$schemas&&window.$admins){e.next=3;break}return e.next=3,n({type:"content/getConfig"});case 3:window.$menus?c.updateMenus(window.$menus):Object(j.getMenus)().then(c.updateMenus);case 4:case"end":return e.stop()}},e)}))(),n({type:"menu/getMenuData",payload:{routes:r,path:o,authority:i}}),Object(W.c)("bsm_config__menu",[W.b.afterCreate,W.b.afterUpdate,W.b.afterDelete],function(){n({type:"user/fetchCurrent"}),Object(j.getMenus)().then(c.updateMenus)});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props,t=e.children,n=e.location.pathname,a=this.state,o=a.menus,c=a.openKeys,u=n.split("/").filter(function(e){return e}),l=[],f=u.map(function(e,t){return"/".concat(u.slice(0,t+1).join("/"))}).reverse().find(function(e){return e in ve});if(f){var p=[{breadcrumbName:"首页",path:"/"}].concat(s()(ve[f]));p=p.map(function(e){if(ve[f].length>1){var t=p.indexOf(e),n=p.length-1;if(0!==t&&t!==n){e.path;return i()(e,["path"])}}return e}),l.push.apply(l,s()(p))}var d={onOpenChange:this.onOpenChange,openKeys:c},m=this.props,h=m.logo,v=m.title,b=Object(T.v)(h,{mode:"lfit"}),g=O.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}},O.a.createElement(r.a,{message:"您没有任何菜单的权限，可以联系管理员给您配置角色",type:"warning"}));return O.a.createElement(P.c,{logo:b||fe.b,title:v||fe.f,fixSiderbar:!0,siderWidth:256,menuHeaderRender:function(e,t){return O.a.createElement(M.Link,{to:"/"},e,t)},menuItemRender:function(e,t){return e.isUrl||e.children||!e.path?t:O.a.createElement(M.Link,{to:e.path},t)},menuDataRender:function(e){return e.concat(o||[])},menuProps:d,breadcrumbRender:function(){return l},rightContentRender:function(){return O.a.createElement(de,null)},footerRender:function(){return I.a}},o&&0===o.length&&"/"===n?g:t)}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.location.pathname,a=t.first,r=t.menus,o=void 0===r?[]:r;return a&&"/"===n?(D.a.replace(a),ke(o)):null}}]),n}(_.Component);Ce=Ee([T.a,Object(N.connect)(function(e){var t=e.setting;return m()({},t)})],Ce);t.default=Ce},QyDn:function(e,t,n){e.exports={container:"antd-pro-components-header-dropdown-index-container"}},tl1k:function(e,t,n){e.exports={baseView:"antd-pro-bsm-business-pages-account-settings-base-view-baseView",left:"antd-pro-bsm-business-pages-account-settings-base-view-left",right:"antd-pro-bsm-business-pages-account-settings-base-view-right",avatar_title:"antd-pro-bsm-business-pages-account-settings-base-view-avatar_title",avatar:"antd-pro-bsm-business-pages-account-settings-base-view-avatar",button_view:"antd-pro-bsm-business-pages-account-settings-base-view-button_view"}}}]);