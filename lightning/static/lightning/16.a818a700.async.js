(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[16],{QtVZ:function(e,t,a){"use strict";var r=a("g09b"),n=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("QV15");var i=r(a("DAsn")),l=r(a("jehZ"));a("e+1C");var u=r(a("Nd5c"));a("uPNz");var o=r(a("Oedt"));a("4csm");var s=r(a("2Fwu"));a("eE3J");var d=r(a("GSZB"));a("ER8q");var c=r(a("Ai5L"));a("9kbU");var f=r(a("vbHR"));a("eNCU");var m=r(a("pjJH"));a("GPKB");var h,p,v=r(a("mFAc")),y=r(a("d6i3")),b=r(a("1l/V")),g=r(a("2Taf")),C=r(a("vZ4D")),k=r(a("MhPg")),E=r(a("l4Ni")),S=r(a("ujKo")),x=n(a("q1tI")),w=a("Hg0r"),D=r(a("w2z3")),R=r(a("mgQR")),V=a("Oix3"),M=a("mmaM"),j=r(a("SSXS"));function A(e){var t=F();return function(){var a,r=(0,S.default)(e);if(t){var n=(0,S.default)(this).constructor;a=Reflect.construct(r,arguments,n)}else a=r.apply(this,arguments);return(0,E.default)(this,a)}}function F(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var N={},P=function(e){var t=e.metrics,a=e.dimensions,r={title:e.name,model:e.model,fields:{},metrics:[],groupBy:"",filters:[]};t.forEach(function(e){var t={field:e.field,method:e.method,displayName:e.display_name,format:e.format},a={metric:e.name,geom:e.geom};r.metrics.push(a),r.fields[e.name]=t}),a.forEach(function(e){var t={field:e.field,displayName:e.display_name};e.method&&(t.method=e.method),r.fields[e.name]=t,"groupby"===e.name&&(r.groupBy=e.name),"legend"===e.name&&(r.legend=e.name)}),N[e.id]=r},q=function(e){e.forEach(function(e){P(e)})},B=(h=(0,w.connect)(function(e){var t=e.content.schemas,a=e.user.currentUser;return{schemas:t,currentUser:a}}),h(p=function(e){(0,k.default)(a,e);var t=A(a);function a(){var e;return(0,g.default)(this,a),e=t.call(this),e.state={formModalVisible:!1,chartAdminVisible:!1,charts:[],currentChart:void 0},e}return(0,C.default)(a,[{key:"componentDidMount",value:function(){var e=(0,b.default)(y.default.mark(function e(){var t,a;return y.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,M.queryContent)({model:"chart__chart",filters:[],orderBy:["id"],expandFields:["metrics","dimensions","chart_filters"]},1,1e3);case 2:t=e.sent,a=t.list,q(a),this.setState({charts:a});case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"onSubmitChart",value:function(e,t){var a=this.state.charts;"create"===e?(a.push(t),P(t)):a.forEach(function(e,r){e.id===t.id&&(a[r]=t,P(t))}),this.setState({charts:a}),this.setState({formModalVisible:!1})}},{key:"onEditChart",value:function(e){this.setState({currentChart:e,formModalVisible:!0})}},{key:"onDeleteChart",value:function(e){this.setState({currentChart:e})}},{key:"onChartAdmin",value:function(e){this.setState({currentChart:e,chartAdminVisible:!0})}},{key:"onSubmintChartGrou",value:function(){this.setState({chartAdminVisible:!1})}},{key:"handleModalCancel",value:function(){this.setState({formModalVisible:!1,chartAdminVisible:!1})}},{key:"addChart",value:function(){this.setState({currentChart:void 0,formModalVisible:!0})}},{key:"handleChartDelete",value:function(){var e=(0,b.default)(y.default.mark(function e(){var t,a,r,n;return y.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this.state,a=t.currentChart,r=t.charts,e.prev=1,e.next=4,(0,M.deleteContent)({model:"chart__chart",id:a.id});case 4:e.next=10;break;case 6:return e.prev=6,e.t0=e["catch"](1),v.default.error("\u5220\u9664\u5931\u8d25"),e.abrupt("return");case 10:n=r.map(function(e){return e.id}).indexOf(a.id),r.splice(n,1),this.setState({charts:r}),v.default.success("\u5220\u9664\u6210\u529f");case 14:case"end":return e.stop()}},e,this,[[1,6]])}));function t(){return e.apply(this,arguments)}return t}()},{key:"handelChartEdit",value:function(e){var t=this.state.charts,a=_.find(t,{id:e});a&&this.setState({formModalVisible:!0})}},{key:"renderChart",value:function(e){var t=this,a=x.default.createElement(f.default,null,x.default.createElement(f.default.Item,{key:"1"},x.default.createElement(m.default,{type:"default",size:"small",onClick:function(){t.onEditChart(e)},style:{marginRight:"5px"},icon:"form"},"\u56fe\u8868\u7f16\u8f91")),x.default.createElement(f.default.Item,{key:"2"},x.default.createElement(m.default,{type:"default",size:"small",style:{marginRight:"5px"},icon:"eye",onClick:function(){t.onChartAdmin(e)}},"\u56fe\u8868\u6743\u9650")));return x.default.createElement(c.default,{span:11,style:{backgroundColor:"white",marginRight:"30px",marginBottom:"30px",padding:"10px",minWidth:"500px"}},x.default.createElement(u.default,{type:"flex",justify:"space-between",style:{marginTop:"5px"}},x.default.createElement(c.default,{style:{marginLeft:"5px",fontSize:"1.2em"}},x.default.createElement("span",null,e.name)),x.default.createElement(c.default,{style:{marginRight:"5px"}},x.default.createElement("div",null,x.default.createElement(s.default,{overlay:a,onClick:function(e){return e.preventDefault()}},x.default.createElement(d.default,{type:"setting"})),x.default.createElement(o.default,{title:"\u786e\u8ba4\u5220\u9664\u56fe\u8868\u4e48?",onConfirm:function(){t.handleChartDelete()},okText:"\u5220\u9664",cancelText:"\u53d6\u6d88",key:"delete"},x.default.createElement(m.default,{onClick:function(){t.onDeleteChart(e)},style:{margin:5,border:0},icon:"delete"}))))),x.default.createElement(V.StatedChart,(0,l.default)({},N[e.id],{key:e.id,id:e.id})))}},{key:"render",value:function(){var e=this,t=this.props.schemas,a=this.state,r=a.formModalVisible,n=a.charts,l=a.currentChart,o=a.chartAdminVisible;return x.default.createElement("div",null,x.default.createElement(u.default,{type:"flex",justify:"start"},n.map(function(t){return e.renderChart(t)}),x.default.createElement(c.default,{span:11},x.default.createElement(m.default,{type:"dashed",style:{width:"100%",height:"540px"},onClick:function(){e.addChart()}},x.default.createElement("div",null,x.default.createElement(d.default,{type:"plus-circle",theme:"filled",style:{fontSize:"5em"}})),x.default.createElement("div",{style:{marginTop:"10px"}},"\u6dfb\u52a0\u56fe\u8868")))),x.default.createElement(i.default,{title:"".concat(l?"\u7f16\u8f91":"\u6dfb\u52a0","\u56fe\u8868"),placement:"right",width:800,onClose:function(){e.handleModalCancel()},visible:r,key:"form"},x.default.createElement(D.default,{key:l&&l.id,schemas:t,templates:j.default,initData:l,afterSubmit:function(t,a){e.onSubmitChart(t,a)}})),x.default.createElement(i.default,{title:"\u67e5\u770b\u6743\u9650\u8bbe\u7f6e",placement:"right",width:800,visible:o,key:"chartAdmin",onClose:function(){e.handleModalCancel()}},x.default.createElement(R.default,{key:l&&l.id,initData:l,afterSubmit:function(){e.onSubmintChartGrou()}})))}}]),a}(x.Component))||p),T=B;t.default=T},mgQR:function(e,t,a){"use strict";var r=a("tAuX"),n=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(a("jehZ"));a("eNCU");var l=n(a("pjJH"));a("vmZS");var u=n(a("NjVP")),o=n(a("d6i3")),s=n(a("1l/V")),d=n(a("2Taf")),c=n(a("vZ4D")),f=n(a("MhPg")),m=n(a("l4Ni")),h=n(a("ujKo")),p=r(a("q1tI")),v=a("mmaM"),y=n(a("8YRU"));function b(e){var t=g();return function(){var a,r=(0,h.default)(e);if(t){var n=(0,h.default)(this).constructor;a=Reflect.construct(r,arguments,n)}else a=r.apply(this,arguments);return(0,m.default)(this,a)}}function g(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var C={labelCol:{xs:{span:18},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:18}}},k=function(e){(0,f.default)(a,e);var t=b(a);function a(){var e;return(0,d.default)(this,a),e=t.call(this),e.state={submitting:!1,users:void 0,groups:void 0},e}return(0,c.default)(a,[{key:"componentDidMount",value:function(){var e=(0,s.default)(o.default.mark(function e(){var t,a,r,n,i,l,u,s;return o.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this.props.initData,a=void 0===t?{}:t,e.next=3,(0,v.queryContent)({model:"guardian__groupobjectpermission",expandFields:["group"],filters:[{field:"permission__codename",operator:"=",value:"view_chart"},{field:"content_type__app_label",operator:"=",value:"chart"},{field:"object_pk",operator:"=",value:a.id}]});case 3:return r=e.sent,n=r.list,e.next=7,(0,v.queryContent)({model:"guardian__userobjectpermission",expandFields:["user"],filters:[{field:"permission__codename",operator:"=",value:"view_chart"},{field:"content_type__app_label",operator:"=",value:"chart"},{field:"object_pk",operator:"=",value:a.id}]});case 7:i=e.sent,l=i.list,u=l.map(function(e){return e.user}),s=n.map(function(e){return e.group}),this.setState({users:u,groups:s});case 12:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"handleSubmit",value:function(){var e=(0,s.default)(o.default.mark(function e(t){var a,r,n,i;return o.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=this.props,r=a.initData,n=a.afterSubmit,i=_.cloneDeep(t),i.data_id=r.id,i.to_groups=i.to_groups.map(function(e){return e.id}),i.to_user=i.to_user.map(function(e){return e.id}),i.codename="chart.view_chart",e.next=8,(0,v.chartShowAdmin)(i);case 8:n();case 9:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleSubmitButtonClick",value:function(){var e=this,t=this.props.form;t.validateFields(function(t,a){t||e.handleSubmit(a)})}},{key:"handleReset",value:function(){var e=this.props.form;e.resetFields()}},{key:"renderGroups",value:function(){var e=this.props.form.getFieldDecorator,t=this.state.groups;return t?p.default.createElement(u.default.Item,{label:"\u4ec5\u6b64\u89d2\u8272\u53ef\u89c1"},e("to_groups",{initialValue:t})(p.default.createElement(y.default,{field:{displayName:"\u89d2\u8272",name:"group",ref:"auth__group",refField:"permissions",refTo:"id",required:!1,type:"mref"},style:{width:300}}))):null}},{key:"renderUser",value:function(){var e=this.props.form.getFieldDecorator,t=this.state.users;return t?p.default.createElement(u.default.Item,{label:"\u4ec5\u6b64\u7528\u6237\u53ef\u89c1"},e("to_user",{initialValue:t})(p.default.createElement(y.default,{field:{displayName:"\u7528\u6237",name:"user",ref:"member__user",refField:"user_permissions",refTo:"id",required:!1,type:"mref"},style:{width:300}}))):null}},{key:"render",value:function(){var e=this,t=this.state.submitting;return p.default.createElement(u.default,(0,i.default)({onSubmit:this.handleSubmit},C),this.renderGroups(),this.renderUser(),p.default.createElement(u.default.Item,null,p.default.createElement(l.default,{type:"primary",loading:t,onClick:function(){return e.handleSubmitButtonClick()}},"\u63d0\u4ea4"),p.default.createElement(l.default,{style:{left:10},onClick:function(){return e.handleReset()}},"\u91cd\u7f6e")))}}]),a}(p.Component),E=u.default.create({name:"chartGrou"})(k),S=E;t.default=S}}]);