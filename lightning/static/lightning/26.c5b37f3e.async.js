(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[26],{lYqw:function(e,t,a){"use strict";a.r(t),function(e){a("QV15");var n,r,i,s,l=a("DAsn"),c=a("0Owb"),o=(a("e+1C"),a("Nd5c")),u=(a("uPNz"),a("Oedt")),m=(a("4csm"),a("2Fwu")),d=(a("eE3J"),a("GSZB")),h=(a("ER8q"),a("Ai5L")),p=(a("9kbU"),a("vbHR")),f=(a("eNCU"),a("pjJH")),v=(a("GPKB"),a("mFAc")),y=a("9og8"),b=a("fWQN"),C=a("mtLc"),k=a("yKVA"),g=a("879j"),E=a("WmNS"),_=a.n(E),S=a("q1tI"),w=a.n(S),j=a("/MKj"),x=a("Oix3"),O=a("mmaM"),V=a("SSXS"),D=a("ZV/k"),M=a("zWss"),A={},N=function(e){var t=e.metrics,a=e.dimensions,n={title:e.name,model:e.model,fields:{},metrics:[],groupBy:"",filters:[]};t.forEach((function(e){var t={field:e.field,method:e.method,displayName:e.display_name,format:e.format},a={metric:e.name,geom:e.geom};n.metrics.push(a),n.fields[e.name]=t})),a.forEach((function(e){var t={field:e.field,displayName:e.display_name};e.method&&(t.method=e.method),n.fields[e.name]=t,"groupby"===e.name&&(n.groupBy=e.name),"legend"===e.name&&(n.legend=e.name)})),A[e.id]=n},F=function(e){e.forEach((function(e){N(e)}))},R=(n=Object(j["c"])((function(e){var t=e.content.schemas,a=e.user.currentUser;return{schemas:t,currentUser:a}})),r=Reflect.metadata("design:type",Function),i=Reflect.metadata("design:paramtypes",[]),n(s=r(s=i(s=function(t){Object(k["a"])(n,t);var a=Object(g["a"])(n);function n(){var e;return Object(b["a"])(this,n),e=a.call(this),e.state={formModalVisible:!1,chartAdminVisible:!1,charts:[],currentChart:void 0},e}return Object(C["a"])(n,[{key:"componentDidMount",value:function(){var e=Object(y["a"])(_.a.mark((function e(){var t,a;return _.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(O["queryContent"])({model:"chart__chart",filters:[],orderBy:["id"],expandFields:["metrics","dimensions","chart_filters"]},1,1e3);case 2:t=e.sent,a=t.list,F(a),this.setState({charts:a});case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"onSubmitChart",value:function(e,t){var a=this.state.charts;"create"===e?(a.push(t),N(t)):a.forEach((function(e,n){e.id===t.id&&(a[n]=t,N(t))})),this.setState({charts:a}),this.setState({formModalVisible:!1})}},{key:"onEditChart",value:function(e){this.setState({currentChart:e,formModalVisible:!0})}},{key:"onDeleteChart",value:function(e){this.setState({currentChart:e})}},{key:"onChartAdmin",value:function(e){this.setState({currentChart:e,chartAdminVisible:!0})}},{key:"onSubmintChartGrou",value:function(){this.setState({chartAdminVisible:!1})}},{key:"handleModalCancel",value:function(){this.setState({formModalVisible:!1,chartAdminVisible:!1})}},{key:"addChart",value:function(){this.setState({currentChart:void 0,formModalVisible:!0})}},{key:"handleChartDelete",value:function(){var e=Object(y["a"])(_.a.mark((function e(){var t,a,n,r;return _.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.state,a=t.currentChart,n=t.charts,e.prev=1,e.next=4,Object(O["deleteContent"])({model:"chart__chart",id:a.id});case 4:e.next=10;break;case 6:return e.prev=6,e.t0=e["catch"](1),v["a"].error("\u5220\u9664\u5931\u8d25"),e.abrupt("return");case 10:r=n.map((function(e){return e.id})).indexOf(a.id),n.splice(r,1),this.setState({charts:n}),v["a"].success("\u5220\u9664\u6210\u529f");case 14:case"end":return e.stop()}}),e,this,[[1,6]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"handelChartEdit",value:function(t){var a=this.state.charts,n=e.find(a,{id:t});n&&this.setState({formModalVisible:!0})}},{key:"renderChart",value:function(e){var t=this,a=w.a.createElement(p["a"],null,w.a.createElement(p["a"].Item,{key:"1"},w.a.createElement(f["a"],{type:"default",size:"small",onClick:function(){t.onEditChart(e)},style:{marginRight:"5px"},icon:"form"},"\u56fe\u8868\u7f16\u8f91")),w.a.createElement(p["a"].Item,{key:"2"},w.a.createElement(f["a"],{type:"default",size:"small",style:{marginRight:"5px"},icon:"eye",onClick:function(){t.onChartAdmin(e)}},"\u56fe\u8868\u6743\u9650")));return w.a.createElement(h["a"],{span:11,style:{backgroundColor:"white",marginRight:"30px",marginBottom:"30px",padding:"10px",minWidth:"500px"}},w.a.createElement(o["a"],{type:"flex",justify:"space-between",style:{marginTop:"5px"}},w.a.createElement(h["a"],{style:{marginLeft:"5px",fontSize:"1.2em"}},w.a.createElement("span",null,e.name)),w.a.createElement(h["a"],{style:{marginRight:"5px"}},w.a.createElement("div",null,w.a.createElement(m["a"],{overlay:a,onClick:function(e){return e.preventDefault()}},w.a.createElement(d["a"],{type:"setting"})),w.a.createElement(u["a"],{title:"\u786e\u8ba4\u5220\u9664\u56fe\u8868\u4e48?",onConfirm:function(){t.handleChartDelete()},okText:"\u5220\u9664",cancelText:"\u53d6\u6d88",key:"delete"},w.a.createElement(f["a"],{onClick:function(){t.onDeleteChart(e)},style:{margin:5,border:0},icon:"delete"}))))),w.a.createElement(x["a"],Object(c["a"])({},A[e.id],{key:e.id,id:e.id})))}},{key:"render",value:function(){var e=this,t=this.props.schemas,a=this.state,n=a.formModalVisible,r=a.charts,i=a.currentChart,s=a.chartAdminVisible;return w.a.createElement("div",null,w.a.createElement(o["a"],{type:"flex",justify:"start"},r.map((function(t){return e.renderChart(t)})),w.a.createElement(h["a"],{span:11},w.a.createElement(f["a"],{type:"dashed",style:{width:"100%",height:"540px"},onClick:function(){e.addChart()}},w.a.createElement("div",null,w.a.createElement(d["a"],{type:"plus-circle",theme:"filled",style:{fontSize:"5em"}})),w.a.createElement("div",{style:{marginTop:"10px"}},"\u6dfb\u52a0\u56fe\u8868")))),w.a.createElement(l["a"],{title:"".concat(i?"\u7f16\u8f91":"\u6dfb\u52a0","\u56fe\u8868"),placement:"right",width:800,onClose:function(){e.handleModalCancel()},visible:n,key:"form"},w.a.createElement(D["a"],{key:i&&i.id,schemas:t,templates:V["a"],initData:i,afterSubmit:function(t,a){e.onSubmitChart(t,a)}})),w.a.createElement(l["a"],{title:"\u67e5\u770b\u6743\u9650\u8bbe\u7f6e",placement:"right",width:800,visible:s,key:"chartAdmin",onClose:function(){e.handleModalCancel()}},w.a.createElement(M["a"],{key:i&&i.id,initData:i,afterSubmit:function(){e.onSubmintChartGrou()}})))}}]),n}(S["Component"]))||s)||s)||s);t["default"]=R}.call(this,a("LvDl"))},zWss:function(e,t,a){"use strict";(function(e){var n=a("0Owb"),r=(a("eNCU"),a("pjJH")),i=(a("vmZS"),a("NjVP")),s=a("9og8"),l=a("fWQN"),c=a("mtLc"),o=a("yKVA"),u=a("879j"),m=a("WmNS"),d=a.n(m),h=a("q1tI"),p=a.n(h),f=a("mmaM"),v=a("3V3B"),y={labelCol:{xs:{span:18},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:18}}},b=function(t){Object(o["a"])(m,t);var a=Object(u["a"])(m);function m(){var e;return Object(l["a"])(this,m),e=a.call(this),e.state={submitting:!1,users:void 0,groups:void 0},e}return Object(c["a"])(m,[{key:"componentDidMount",value:function(){var e=Object(s["a"])(d.a.mark((function e(){var t,a,n,r,i,s,l,c;return d.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.props.initData,a=void 0===t?{}:t,e.next=3,Object(f["queryContent"])({model:"guardian__groupobjectpermission",expandFields:["group"],filters:[{field:"permission__codename",operator:"=",value:"view_chart"},{field:"content_type__app_label",operator:"=",value:"chart"},{field:"object_pk",operator:"=",value:a.id}]});case 3:return n=e.sent,r=n.list,e.next=7,Object(f["queryContent"])({model:"guardian__userobjectpermission",expandFields:["user"],filters:[{field:"permission__codename",operator:"=",value:"view_chart"},{field:"content_type__app_label",operator:"=",value:"chart"},{field:"object_pk",operator:"=",value:a.id}]});case 7:i=e.sent,s=i.list,l=s.map((function(e){return e.user})),c=r.map((function(e){return e.group})),this.setState({users:l,groups:c});case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleSubmit",value:function(){var t=Object(s["a"])(d.a.mark((function t(a){var n,r,i,s;return d.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=this.props,r=n.initData,i=n.afterSubmit,s=e.cloneDeep(a),s.data_id=r.id,s.to_groups=s.to_groups.map((function(e){return e.id})),s.to_user=s.to_user.map((function(e){return e.id})),s.codename="chart.view_chart",t.next=8,Object(f["chartShowAdmin"])(s);case 8:i();case 9:case"end":return t.stop()}}),t,this)})));function a(e){return t.apply(this,arguments)}return a}()},{key:"handleSubmitButtonClick",value:function(){var e=this,t=this.props.form;t.validateFields((function(t,a){t||e.handleSubmit(a)}))}},{key:"handleReset",value:function(){var e=this.props.form;e.resetFields()}},{key:"renderGroups",value:function(){var e=this.props.form.getFieldDecorator,t=this.state.groups;return t?p.a.createElement(i["a"].Item,{label:"\u4ec5\u6b64\u89d2\u8272\u53ef\u89c1"},e("to_groups",{initialValue:t})(p.a.createElement(v["a"],{field:{displayName:"\u89d2\u8272",name:"group",ref:"auth__group",refField:"permissions",refTo:"id",required:!1,type:"mref"},style:{width:300}}))):null}},{key:"renderUser",value:function(){var e=this.props.form.getFieldDecorator,t=this.state.users;return t?p.a.createElement(i["a"].Item,{label:"\u4ec5\u6b64\u7528\u6237\u53ef\u89c1"},e("to_user",{initialValue:t})(p.a.createElement(v["a"],{field:{displayName:"\u7528\u6237",name:"user",ref:"member__user",refField:"user_permissions",refTo:"id",required:!1,type:"mref"},style:{width:300}}))):null}},{key:"render",value:function(){var e=this,t=this.state.submitting;return p.a.createElement(i["a"],Object(n["a"])({onSubmit:this.handleSubmit},y),this.renderGroups(),this.renderUser(),p.a.createElement(i["a"].Item,null,p.a.createElement(r["a"],{type:"primary",loading:t,onClick:function(){return e.handleSubmitButtonClick()}},"\u63d0\u4ea4"),p.a.createElement(r["a"],{style:{left:10},onClick:function(){return e.handleReset()}},"\u91cd\u7f6e")))}}]),m}(h["Component"]),C=i["a"].create({name:"chartGrou"})(b);t["a"]=C}).call(this,a("LvDl"))}}]);