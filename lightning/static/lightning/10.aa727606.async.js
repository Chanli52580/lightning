(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{RsOY:function(e,t,n){"use strict";(function(n){function a(e){return"object"!=typeof e||"toString"in e?e:Object.prototype.toString.call(e).slice(8,-1)}Object.defineProperty(t,"__esModule",{value:!0});var r="object"==typeof n&&!0;function l(e,t){if(!e){if(r)throw new Error("Invariant failed");throw new Error(t())}}t.invariant=l;var i=Object.prototype.hasOwnProperty,o=Array.prototype.splice,c=Object.prototype.toString;function u(e){return c.call(e).slice(8,-1)}var f=Object.assign||function(e,t){return s(t).forEach(function(n){i.call(t,n)&&(e[n]=t[n])}),e},s="function"==typeof Object.getOwnPropertySymbols?function(e){return Object.keys(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.keys(e)};function m(e){return Array.isArray(e)?f(e.constructor(e.length),e):"Map"===u(e)?new Map(e):"Set"===u(e)?new Set(e):e&&"object"==typeof e?f(Object.create(Object.getPrototypeOf(e)),e):e}var d=function(){function e(){this.commands=f({},p),this.update=this.update.bind(this),this.update.extend=this.extend=this.extend.bind(this),this.update.isEquals=function(e,t){return e===t},this.update.newContext=function(){return(new e).update}}return Object.defineProperty(e.prototype,"isEquals",{get:function(){return this.update.isEquals},set:function(e){this.update.isEquals=e},enumerable:!0,configurable:!0}),e.prototype.extend=function(e,t){this.commands[e]=t},e.prototype.update=function(e,t){var n=this,a="function"==typeof t?{$apply:t}:t;Array.isArray(e)&&Array.isArray(a)||l(!Array.isArray(a),function(){return"update(): You provided an invalid spec to update(). The spec may not contain an array except as the value of $set, $push, $unshift, $splice or any custom command allowing an array value."}),l("object"==typeof a&&null!==a,function(){return"update(): You provided an invalid spec to update(). The spec and every included key path must be plain objects containing one of the following commands: "+Object.keys(n.commands).join(", ")+"."});var r=e;return s(a).forEach(function(t){if(i.call(n.commands,t)){var l=e===r;r=n.commands[t](a[t],r,a,e),l&&n.isEquals(r,e)&&(r=e)}else{var o="Map"===u(e)?n.update(e.get(t),a[t]):n.update(e[t],a[t]),c="Map"===u(r)?r.get(t):r[t];n.isEquals(o,c)&&(void 0!==o||i.call(e,t))||(r===e&&(r=m(e)),"Map"===u(r)?r.set(t,o):r[t]=o)}}),r},e}();t.Context=d;var p={$push:function(e,t,n){return h(t,n,"$push"),e.length?t.concat(e):t},$unshift:function(e,t,n){return h(t,n,"$unshift"),e.length?e.concat(t):t},$splice:function(e,t,n,r){return function(e,t){l(Array.isArray(e),function(){return"Expected $splice target to be an array; got "+a(e)}),y(t.$splice)}(t,n),e.forEach(function(e){y(e),t===r&&e.length&&(t=m(r)),o.apply(t,e)}),t},$set:function(e,t,n){return function(e){l(1===Object.keys(e).length,function(){return"Cannot have more than one key in an object with $set"})}(n),e},$toggle:function(e,t){g(e,"$toggle");var n=e.length?m(t):t;return e.forEach(function(e){n[e]=!t[e]}),n},$unset:function(e,t,n,a){return g(e,"$unset"),e.forEach(function(e){Object.hasOwnProperty.call(t,e)&&(t===a&&(t=m(a)),delete t[e])}),t},$add:function(e,t,n,a){return E(t,"$add"),g(e,"$add"),"Map"===u(t)?e.forEach(function(e){var n=e[0],r=e[1];t===a&&t.get(n)!==r&&(t=m(a)),t.set(n,r)}):e.forEach(function(e){t!==a||t.has(e)||(t=m(a)),t.add(e)}),t},$remove:function(e,t,n,a){return E(t,"$remove"),g(e,"$remove"),e.forEach(function(e){t===a&&t.has(e)&&(t=m(a)),t.delete(e)}),t},$merge:function(e,t,n,r){var i,o;return i=t,l((o=e)&&"object"==typeof o,function(){return"update(): $merge expects a spec of type 'object'; got "+a(o)}),l(i&&"object"==typeof i,function(){return"update(): $merge expects a target of type 'object'; got "+a(i)}),s(e).forEach(function(n){e[n]!==t[n]&&(t===r&&(t=m(r)),t[n]=e[n])}),t},$apply:function(e,t){var n;return l("function"==typeof(n=e),function(){return"update(): expected spec of $apply to be a function; got "+a(n)+"."}),e(t)}},v=new d;function h(e,t,n){l(Array.isArray(e),function(){return"update(): expected target of "+a(n)+" to be an array; got "+a(e)+"."}),g(t[n],n)}function g(e,t){l(Array.isArray(e),function(){return"update(): expected spec of "+a(t)+" to be an array; got "+a(e)+". Did you forget to wrap your parameter in an array?"})}function y(e){l(Array.isArray(e),function(){return"update(): expected spec of $splice to be an array of arrays; got "+a(e)+". Did you forget to wrap your parameters in an array?"})}function E(e,t){var n=u(e);l("Map"===n||"Set"===n,function(){return"update(): "+a(t)+" expects a target of type Set or Map; got "+a(n)})}t.isEquals=v.update.isEquals,t.extend=v.extend,t.default=v.update,t.default.default=e.exports=f(t.default,t)}).call(this,n("Q2Ig"))},SWtE:function(e,t,n){},"U/ol":function(e,t,n){e.exports={divider:"antd-pro-bsm-pages-config-editor-inline-actions-editor-divider"}},fscj:function(e,t,n){},yPhJ:function(e,t,n){"use strict";n.r(t);n("IzEo");var a=n("bx4M"),r=(n("+L6B"),n("2/Rp")),l=n("p0pE"),i=n.n(l),o=n("qIgq"),c=n.n(o),u=n("q1tI"),f=n.n(u),s=n("MuoO"),m=n("jfUH"),d=(n("sRBo"),n("kaz8")),p=(n("7Kak"),n("9yH6")),v=(n("y8nQ"),n("Vl3Y")),h=(n("5NDa"),n("5rEg")),g=(n("miYZ"),n("tsqr")),y=n("gWZ8"),E=n.n(y),b=(n("fu2T"),n("gK9i")),C=n("LvDl"),O=n.n(C),w={version:"v2",name:"",file_type:"csv",merge_bref:!1,fields:[],collapseActiveKey:[]};var S=function(e){var t=e.modelName,n=e.adminConfig,r=e.schemas,l=Object(u.useState)(_.cloneDeep(n[t].exportable)||w),o=c()(l,2),s=o[0],m=o[1],y=Object(u.useState)("success"),O=c()(y,2),S=O[0],D=O[1],j=Object(u.useState)(s.collapseActiveKey||[]),k=c()(j,2),F=k[0],N=k[1],x=Object(u.useState)([]),I=c()(x,2),A=I[0],P=I[1],T=Object(u.useState)([]),$=c()(T,2),R=$[0],V=$[1],M=Object(u.useState)([]),L=c()(M,2),Y=L[0],W=L[1],q=b.a.Panel;function K(e,t){var n=E()(s.fields||[]);t?n.includes(e)||n.push(e):n=n.filter(function(t){return t!==e}),m(i()({},s,{fields:n}))}function B(e,t){var n=F||[];e.length>0?n.includes(t)||n.push(t):n=n.filter(function(e){return e!==t}),N(n)}Object(u.useEffect)(function(){var e=[],n=[],a=[];r[t].fields.forEach(function(t){if("ref"===t.type){var l=t,i=[];r[t.ref].fields.forEach(function(e){"mref"!==e.type&&"ref"!==e.type&&"bref"!==e.type&&i.push({displayName:e.displayName,name:e.name})}),n.push({parenField:l,fieldxs:i})}else if("bref"===t.type||"mref"===t.type){var o=t,c=[],u=[];r[t.ref]&&r[t.ref].fields.forEach(function(e){if("mref"!==e.type&&"bref"!==e.type&&"ref"!==e.type)c.push({displayName:e.displayName,name:e.name});else if("ref"===e.type){var t=e,n=[];r[e.ref].fields.forEach(function(e){"mref"!==e.type&&"bref"!==e.type&&"ref"!==e.type&&n.push({displayName:e.displayName,name:e.name})}),u.push({shildParenField:t,shildDieldxs:n})}}),a.push({parenField:o,fieldxs:c,shildRefFiledsData:u})}else e.push({displayName:t.displayName,name:t.name})}),P(e),V(n),W(a)},[]);var G={background:"white",border:0};return[f.a.createElement(v.a,{labelCol:{xs:{span:18},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:18}}},f.a.createElement(v.a.Item,{label:"名称：",required:!0,validateStatus:S},f.a.createElement(h.a,{placeholder:"请输入导出按钮的名称",onChange:function(e){var t=e.target.value;""===t&&D("error"),m(i()({},s,{name:t}))},value:s.name})),f.a.createElement(v.a.Item,{label:"格式："},f.a.createElement(p.a.Group,{value:s.file_type,onChange:function(e){var t=e.target.value;m(i()({},s,{file_type:t}))}},f.a.createElement(p.a,{value:"csv"},"CSV"))),f.a.createElement(v.a.Item,{label:"合并子项："},f.a.createElement(p.a.Group,{value:s.merge_bref||!1,onChange:function(e){var t=e.target.value;m(i()({},s,{merge_bref:t}))}},f.a.createElement(p.a,{value:!0},"是"),f.a.createElement(p.a,{value:!1},"否")),f.a.createElement("br",null),"合并子项会把多条子项的数据拼接成一条来显示。"),f.a.createElement(v.a.Item,null,f.a.createElement(a.a,{bordered:!1,title:"导出字段：",style:{marginLeft:50,width:800}},f.a.createElement("div",{style:{marginLeft:70}},f.a.createElement(d.a.Group,{value:s.fields},A.map(function(e){return f.a.createElement(d.a,{onChange:function(t){K(e.name,t.target.checked)},style:{marginLeft:8},value:e.name},e.displayName)})),R.map(function(e){var t=e.parenField,n=e.fieldxs;return f.a.createElement(b.a,{style:{border:0},defaultActiveKey:s.collapseActiveKey},f.a.createElement(q,{header:"".concat(t.displayName,"(父项)"),key:t.displayName,style:G},f.a.createElement(d.a.Group,{value:s.fields,onChange:function(e){B(e,t.displayName)}},n.map(function(e){return f.a.createElement(d.a,{onChange:function(e){var t=e.target;K(t.value,t.checked)},value:"".concat(t.name,".").concat(e.name),style:{marginLeft:8}},"".concat(t.displayName,".").concat(e.displayName))}))))}),Y&&Y.map(function(e){var t=e.parenField,n=e.fieldxs,a=e.shildRefFiledsData;return f.a.createElement(b.a,{style:{border:0},defaultActiveKey:s.collapseActiveKey},f.a.createElement(q,{header:"".concat(t.displayName,"(子项)"),key:t.displayName,style:G},f.a.createElement(d.a.Group,{value:s.fields,onChange:function(e){B(e,t.displayName)}},n.map(function(e){return f.a.createElement(d.a,{onChange:function(e){var t=e.target;K(t.value,t.checked)},value:"".concat(t.name,".").concat(e.name),style:{marginLeft:8}},"".concat(t.displayName,".").concat(e.displayName))})),a&&a.map(function(e){var n=e.shildParenField,a=e.shildDieldxs;return f.a.createElement(b.a,{style:{border:0,marginLeft:20},defaultActiveKey:s.collapseActiveKey},f.a.createElement(q,{header:"".concat(t.displayName,".").concat(n.displayName,"(父项)"),key:"".concat(t.displayName,".").concat(n.displayName),style:G},f.a.createElement(d.a.Group,{value:s.fields,onChange:function(e){B(e,"".concat(t.displayName,".").concat(n.displayName))}},a.map(function(e){return f.a.createElement(d.a,{onChange:function(e){var t=e.target;K(t.value,t.checked)},value:"".concat(t.name,".").concat(n.name,".").concat(e.name),style:{marginLeft:8}},"".concat(t.displayName,".").concat(n.displayName,".").concat(e.displayName))}))))})))}))))),s,function(){m(n[t].exportable||w)},function(){return s.collapseActiveKey=F,m(s),!!Object(C.isEmpty)(s.fields)||!!s.name||(D("error"),g.a.error("请输入导出配置的名称"),!1)}]},D=(n("/zsF"),n("PArb")),j=(n("2qtc"),n("kLXV")),k=(n("nRaC"),n("5RzL")),F=n("RsOY"),N=n.n(F),x=n("4b23"),I=n.n(x),A=(n("OaEy"),n("2fM7")),P=(n("g9YV"),n("wCAj")),T=(n("Pwec"),n("CtXQ")),$=n("jehZ"),R=n.n($),V=n("Y/ft"),M=n.n(V),L=n("jA2l"),Y=n("jkD3"),W=n("kvAW"),q=n("qJlv"),K=n("wiuW");n("SWtE");var B=function(e){var t=e.modelName,n=e.onChange,a=e.value,r=Object(m.O)(),l=Object(u.useState)([]),i=c()(l,2),o=i[0],s=i[1];return f.a.createElement(k.a,{treeExpandedKeys:o,onTreeExpand:s,treeDefaultExpandAll:!0,onChange:function(e){return n(e.map(function(e){return e.value}))},value:a&&a.map(function(e){return{label:(n=e,Object(m.l)(r,n,t).map(function(e){return e.displayName}).join(".")),value:e};var n}),showCheckedStrategy:k.a.SHOW_ALL,treeNodeLabelProp:"displayName",treeCheckable:!0,treeCheckStrictly:!0,style:{width:"100%"}},function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return r[t].fields.map(function(t){var a=t.ref,r=n.map(function(e){return e.name}).join("."),l=[].concat(E()(n),[t]),i=l.map(function(e){return e.name}).join("."),c=l.map(function(e){return e.displayName}).join(".");return f.a.createElement(k.a.TreeNode,{displayName:c,title:t.displayName,value:i,key:i},(!n.length||o.includes(r))&&a&&e(a,l))})}(t))},G=-1,z=-1;function H(e,t,n){var a=e;return n.forEach(function(e,n){n<t&&(a+=e)}),a}function U(e){var t=e.isOver,n=e.connectDragSource,a=e.connectDropTarget,r=(e.moveRow,M()(e,["isOver","connectDragSource","connectDropTarget","moveRow"])),l=i()({},r.style,{cursor:"move"}),o=r.className;return t&&((r.sectionindex>z||z===r.sectionindex&&r.index>G)&&(o+=" drop-item-over-downward"),(r.sectionindex<z||z===r.sectionindex&&r.index<G)&&(o+=" drop-item-over-upward")),n(a(f.a.createElement("tr",R()({},r,{className:o,style:l}))))}var J={beginDrag:function(e){return G=e.index,z=e.sectionindex,{index:e.index,sectionindex:e.sectionindex}}},Z={drop:function(e,t){var n=t.getItem(),a=n.index,r=n.sectionindex,l=e.index,i=e.sectionindex;r===i&&a===l||e.moveRow(a,l,r,i)}},Q=function(e){return Object(L.a)(e,Z,function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver()}})(Object(Y.a)(e,J,function(e){return{connectDragSource:e.dragSource()}})(U))},X=function(e){return Object(L.a)(e,{drop:function(e,t){var n=t.getItem(),a=n.index,r=n.sectionindex,l=e.sectionindex;r!==l&&e.addRow(a,r,l)}},function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver()}})(function(e){var t=e.connectDropTarget,n=e.isOver,a=e.sectionindex,r=n&&z!==a;return t(f.a.createElement("div",{style:{display:"flex",alignItems:"center",marginRight:18,color:"#1890ff"}},"加入本组: ",f.a.createElement(T.a,{type:r?"fullscreen-exit":"plus",style:{fontSize:20}})))})};function ee(e){var t=e.setData,n=e.allData,r=e.sections,l=e.addAndDeleteView,o=e.styleView,c=e.cardTitle,u=e.footer,s=e.columns,m=e.expandedRowRender,d=e.tableTitle,p=e.setSections,v=e.key,h=void 0===v?I()(5):v,g=e.sectionStyle,y=e.detailStyle,E=e.addAndWidget,b=X(h),C={body:{row:Q(h)}};function O(e,a,l,i){var o=H(e,l,r),c=H(a,i,r),u=n[o];t(N()(n,{$splice:[[o,1],[c,0,u]]})),p&&l!==i&&p(N()(r,{$splice:[[l,1,r[l]-1],[i,1,r[i]+1]]}))}function w(e,a,l){var i=H(e,a,r),o=n[i];t(N()(n,{$splice:[[i,1],[H(0,l,r),0,o]]})),p(N()(r,{$splice:[[a,1,r[a]-1],[l,1,r[l]+1]]}))}return f.a.createElement(W.a,{backend:q.a},f.a.createElement(a.a,{title:c,bodyStyle:{padding:0},extra:o&&o()},r.map(function(t,o){var c,p,v,h,S,D=(v=o,h=0,S=0,r.forEach(function(e,t){t<v&&(h+=e),t===v&&(S=e)}),null===n||void 0===n?void 0:n.slice(h,h+S));return f.a.createElement(a.a,{title:d&&d(o),bodyStyle:{padding:0},extra:!!l&&f.a.createElement("div",{style:{display:"flex",alignItems:"center"}},_.isEmpty(D)&&!(g&&(null===(c=g[o])||void 0===c?void 0:c.widget)in K.c)&&f.a.createElement(b,{addRow:w,sectionindex:o}),l(o)),bordered:l},f.a.createElement("div",{className:"container"},"default"!==y&&g&&(null===(p=g[o])||void 0===p?void 0:p.widget)in K.c||f.a.createElement(P.a,R()({},e,{dataSource:D,components:C,onRow:function(e,t){return{index:t,moveRow:O,sectionindex:o}},footer:function(){return u(o)},columns:function(e){return s.map(function(t){var n=i()({},t);if(n.render){var a=n.render;n.render=function(t,n,r){return a(t,n,r,e)}}return n})}(o),expandedRowRender:m&&function(e){return function(t,n,a,r){return m(t,n,a,r,e)}}(o)})),f.a.createElement("div",{style:{marginBottom:14,minHeight:32}},f.a.createElement("div",{className:"content"},E&&E(o)))))})))}function te(e){var t=e.onChange,n=e.value,a=e.layouts,r=void 0===a?{}:a;return f.a.createElement("div",null,"排列方式 :   ",f.a.createElement(p.a.Group,{value:n,onChange:function(e){return t(e.target.value)}},f.a.createElement(p.a,{value:"default"},"默认"),_.map(r,function(e,t){return f.a.createElement(p.a,{value:t},e)})))}function ne(e,t){return e.toLowerCase().includes(t.toLowerCase())}function ae(e){var t=e.modelName,n=e.schemas,a=e.fieldDisabled,r=M()(e,["modelName","schemas","fieldDisabled"]),l=Object(u.useState)([]),i=c()(l,2),o=i[0],s=i[1],m=Object(u.useState)(!1),d=c()(m,2),p=d[0],h=d[1];var g=f.a.createElement(v.a.Item,{label:"选择字段",labelCol:{span:6},wrapperCol:{span:18}},f.a.createElement(B,{modelName:t,value:o,onChange:s})),y=f.a.createElement("div",null,f.a.createElement(v.a.Item,{label:"选择字段",labelCol:{span:6},wrapperCol:{span:18}},f.a.createElement(A.a,{mode:"multiple",defaultValue:[],value:o,onChange:s,style:{minWidth:160},filterOption:function(e,t){var n=t.props,a=n.value,r=n.children;return ne(a,e)||ne(r,e)}},n[t].fields.map(function(e){return f.a.createElement(A.a.Option,{value:e.name,key:e.name,disabled:a&&a(e)},e.displayName)})))),E=r.expand;return[f.a.createElement(j.a,{title:"添加字段",visible:p,onOk:function(){h(!1),r.onOk&&r.onOk()},onCancel:function(){return h(!1)},afterClose:function(){h(!1),s([])},okText:"确认",cancelText:"取消"},E?g:y),o,function(){h(!0)}]}var re=function(e){var t=e.sections,n=void 0===t?[{}]:t,a=e.setData,r=e.columns,l=e.footer,i=e.expandedRowRender,o=e.hiddenAdd,c=void 0!==o&&o,u=e.addAndDeleteView,s=e.styleView,m=e.title,d=e.modalView,p=e.allData,v=e.tableTitle,h=e.setSections,g=e.sectionStyle,y=e.style,E=e.addAndWidget;return[f.a.createElement("div",null,d,f.a.createElement(ee,{modalView:d,columns:r,expandedRowRender:i,sections:n,allData:p,setData:a,size:"middle",bordered:!0,pagination:!1,footer:l,styleView:s,addAndDeleteView:u,hiddenAdd:c,cardTitle:m,tableTitle:v,setSections:h,sectionStyle:g,detailStyle:y,addAndWidget:E})),n]},le=n("MU2A"),ie=n("HP82"),oe=n("8YRU");var ce=function(e){var t=e.groupsValue,n=e.groupsOnChange,a=e.userValue,r=e.userOnChange,l=e.staffModelFields,i=e.staffModel,o=e.defauldGroupValue,c=void 0===o?{}:o;return Object(u.useEffect)(function(){O.a.isEmpty(c.groups)||Object(ie.queryContent)({model:"auth__group",filters:[{field:"id",operator:"in",value:c.groups}]}).then(function(e){var t=e.list;n(t)})},[]),f.a.createElement(f.a.Fragment,null,f.a.createElement(v.a.Item,{label:"仅指定角色可见"},f.a.createElement(oe.a,{value:t,field:{displayName:"角色",name:"group",ref:"auth__group",refField:"permissions",refTo:"id",required:!1,type:"mref"},onChange:n})),!O.a.isEmpty(l)&&i&&f.a.createElement(v.a.Item,{label:"该字段值为当前用户时可见"},f.a.createElement(A.a,{style:{width:"100%"},placeholder:"未选择",value:a,onChange:r},l.map(function(e){return f.a.createElement(A.a.Option,{key:e.name},e.displayName)}))))},ue=n("U/ol"),fe=n.n(ue),se=function(e){return e.name?e:{name:e}};function me(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{id:0},a=n.id,r=n.title,l=void 0===r?"":r,i=[];return t[e].fields.forEach(function(e){if("bref"!==e.type){var t=a?"".concat(a,".").concat(e.name):e.name,n={id:t,pId:a,value:t,title:"".concat(l?"".concat(l,"."):"").concat(e.displayName)};e.ref&&(n.fieldRef=e.ref),i.push(n)}}),i}var de,pe=function(e){var t=e.modelName,n=e.adminConfig,a=e.schemas,l=e.bsmSetting,o=Object(u.useState)([]),s=c()(o,2),m=s[0],d=s[1],p=Object(u.useState)(!1),h=c()(p,2),g=h[0],y=h[1],b=Object(u.useState)([]),C=c()(b,2),w=C[0],S=C[1],D=function(e){var t=e.modelName,n=e.schemas,a=e.adminConfig,r=e.bsmSetting.staff_model,l=function(){var e;return(null===(e=a[t].filter)||void 0===e?void 0:e.map(se))||[]},o=Object(u.useState)(l),s=c()(o,2),m=s[0],d=s[1],p=Object(u.useState)([]),h=c()(p,2),g=h[0],y=h[1];return Object(u.useEffect)(function(){if(r){var e=[];n[t].fields.forEach(function(t){t.ref===r&&e.push(t)}),y(e)}},[]),[function(e){var n,l;if(void 0===e)return null;var i=m[e];return f.a.createElement(v.a,{labelCol:{span:6},wrapperCol:{span:8}},f.a.createElement("div",{className:fe.a.divider,style:{marginBottom:16}},"权限设置"),f.a.createElement(ce,{groupsValue:null!==(n=null===(l=i.groups)||void 0===l?void 0:l.filter(function(e){return!("number"==typeof e)}))&&void 0!==n?n:[],groupsOnChange:function(t){var n=O.a.cloneDeep(m);n[e].groups=t,d(E()(n))},userValue:i.userField,userOnChange:function(t){var n=O.a.cloneDeep(m);n[e].userField=t,d(E()(n))},staffModelFields:g,staffModel:r,defauldGroupValue:a[t].filter[e]}))},m,function(){return d(l())},function(){return O.a.cloneDeep(m).map(function(e){var t=i()({},e);return O.a.isEmpty(e.groups)||(t.groups=t.groups.filter(function(e){return e}).map(function(e){return e.id||e})),e.id||(t.id=I()(6)),t})},{handleTitleChange:function(e,t){var n=O.a.cloneDeep(m);n[e].name=t,d(n)},handleAdd:function(){d([].concat(E()(m),[{}]))},setFilters:d}]}({modelName:t,schemas:a,adminConfig:n,bsmSetting:l}),_=c()(D,5),F=_[0],x=_[1],A=_[2],P=_[3],T=_[4].setFilters,$=re({allData:x,setData:T,title:"筛选字段",sections:[x.length||0],columns:[{title:"字段",key:"name",render:function(e,n,a){return f.a.createElement(le.a,{value:e.name||e,onChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,t){T(N()(x,{$splice:[[e,1,{name:t}]]}))}.apply(void 0,[a].concat(t))},model:t,layer:2})}},{title:"操作",key:"operation",render:function(e,t,n){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return e=n,(t=E()(x)).splice(e,1),void T(t);var e,t}},"删除"))}}],footer:function(){return f.a.createElement("div",null,f.a.createElement(r.a,{onClick:function(){return y(!0)}},"添加字段"))},expandedRowRender:function(e,t){return F(t)}}),R=c()($,1)[0];Object(u.useEffect)(function(){var e=me(t,a);e.forEach(function(t){t.fieldRef&&e.push.apply(e,E()(me(t.fieldRef,a,t)))}),d(e)},[]);var V=f.a.createElement(k.a,{treeDataSimpleMode:!0,style:{width:"100%"},value:w,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"请选择",onChange:S,multiple:!0,treeData:m.map(function(e){return N()(e,{disabled:{$set:x.some(function(t){return t.name===e.value})}})}),filterTreeNode:function(e,t){var n=t.props;return["title","value"].some(function(t){return n[t].toLowerCase().includes(e.toLowerCase())})}});return[f.a.createElement(f.a.Fragment,null,f.a.createElement(j.a,{title:"添加字段",visible:g,onOk:function(){var e;e=w,T([].concat(E()(x),E()(e.map(se)))),y(!1)},onCancel:function(){return y(!1)},afterClose:function(){y(!1),S([])},okText:"确认",cancelText:"取消"},V),R),x,A,P]},ve=n("eHn4"),he=n.n(ve),ge=(n("+BJd"),n("mr32")),ye=(n("BoS7"),n("Sdc0")),Ee=n("VW+w"),be=n("Wd+Q"),Ce=(n("fscj"),[{label:"magenta",value:"magenta"},{label:"red",value:"red"},{label:"orange",value:"orange"},{label:"gold",value:"gold"},{label:"lime",value:"lime"},{label:"green",value:"green"},{label:"cyan",value:"cyan"},{label:"blue",value:"blue"},{label:"purple",value:"purple"}]),Oe=[{label:"YYYY-MM-DD HH:mm:ss",value:"YYYY-MM-DD HH:mm:ss"},{label:"YYYY年MM月DD日",value:"YYYY年MM月DD日"},{label:"YYYY/MM/DD",value:"YYYY/MM/DD"}],we=[{label:"longText",value:"长文本"},{label:"richText",value:"富文本"},{label:"jsonText",value:"JSON"}],Se={labelCol:{span:4},wrapperCol:{span:10}};function De(e){var t=e;return t.params||(t.params={}),"tag"!==t.widget||t.params.tagSetting||(t.params.tagSetting={}),t}function je(e){var t=e.modelName,n=e.adminConfig,a=e.schemas,r=e.bsmSetting.staff_model,l=n[t].display.map(De),o=Object(u.useState)(l),s=c()(o,2),m=s[0],d=s[1],p=Object(u.useState)([]),g=c()(p,2),y=g[0],b=g[1],C=Object(u.useState)(n[t].sortable?n[t].sortable:[]),O=c()(C,2),w=O[0],S=O[1],D=Object(be.e)(),j=Object(be.f)();function k(e,t){var n=_.cloneDeep(m);return t?n[e].alias=t:delete n[e].alias,d(n),n}Object(u.useEffect)(function(){if(r){var e=[];a[t].fields.forEach(function(t){t.ref===r&&e.push(t)}),b(e)}},[]);return[function(e){var l,i,o,u,s,p;if(void 0===e)return null;var g=m[e],b=a[t].fields.find(function(e){var t;return e.name===g.name||e.name===(null===(t=g.fields)||void 0===t?void 0:t.value)}),C=[];b&&D[b.type]&&(C=D[b.type]);var O=g.name,F=g.type;"combo"===F&&(C=be.b);var N=[];return"mref"===(null===b||void 0===b?void 0:b.type)&&a[b.ref].fields.forEach(function(e){["string","image","file"].includes(e.type)&&N.push({label:e.name,value:e.displayName})}),f.a.createElement(v.a,R()({},Se,{name:"basic"}),f.a.createElement(v.a.Item,{label:"列名"},f.a.createElement(h.a,{allowClear:!0,value:g.alias,placeholder:g.name&&Object(Ee.displayPreprocess)([_.cloneDeep(g)],t,a)[0].alias,onChange:function(t){return k(e,t.target.value)}})),!F&&f.a.createElement(v.a.Item,{label:"开启排序"},f.a.createElement(ye.a,{defaultChecked:!1,checked:w.includes(O),onChange:function(e){var t=_.cloneDeep(w);if(!0===e)t.push(O),S(t);else{var n=t.filter(function(e){return e!==O});S(n)}}})),"combo"!==F&&!_.isEmpty(C)&&f.a.createElement(v.a.Item,{label:"选择组件"},f.a.createElement(A.a,{showSearch:!0,style:{width:200},placeholder:"请选择要显示的组件",optionFilterProp:"children",value:g.widget?g.widget:null,onChange:function(n){return function(e,n){var r=_.cloneDeep(m),l=r[n];if(l.params={},l.name){var i=a[t].fields.find(function(e){return e.name===l.name});"tag"===e&&(l.params.tagSetting={}),"timeStamp"===e&&(l.params.timeFormat=Oe[0].value),l.fields={value:i.name}}l.widget=e,d(r)}(n,e)}},!b||_.uniq(C.concat(b.choices?["tag"]:[])).map(function(e){return f.a.createElement(A.a.Option,{value:e},j[e]||e)}))),"combo"===F&&!_.isEmpty(C)&&f.a.createElement(v.a.Item,{label:"选择模板组件"},f.a.createElement(A.a,{showSearch:!0,style:{width:200},placeholder:"请选择要显示的组件",optionFilterProp:"children",value:g.widget?g.widget:null,onChange:function(t){var n=_.cloneDeep(m),a=n[e];a.params={},a.widget=t,d(n)}},b||_.uniq(C).map(function(e){return f.a.createElement(A.a.Option,{value:e},j[e]||e)}))),g.widget&&"timeStamp"===g.widget&&f.a.createElement(v.a.Item,{label:"配置时间格式"},f.a.createElement("div",{onMouseDown:function(e){return e.preventDefault(),!1}},f.a.createElement(A.a,{style:{width:240},placeholder:"请配置时间格式",value:g.params.timeFormat,onChange:function(t){var n=_.cloneDeep(m);n[e].params.timeFormat=t,d(n)}},Oe.map(function(e){return f.a.createElement(A.a.Option,{value:e.value},e.label)})))),g.widget&&"timeStamp"===g.widget&&f.a.createElement(v.a.Item,{label:"自定义时间格式"},f.a.createElement(h.a,{style:{flex:"auto",width:"50%"},value:g.params.customFormat,onChange:function(t){var n=_.cloneDeep(m);n[e].params.customFormat=t.target.value,d(n)}})),g.widget&&"tag"===g.widget&&f.a.createElement(v.a.Item,{label:"配置颜色"},b.choices.map(function(t){var n=c()(t,2),a=n[0],r=n[1],l=g.params.tagSetting[a];return f.a.createElement("div",null,f.a.createElement(ge.a,{color:l},r),f.a.createElement(A.a,{showSearch:!0,style:{width:200},placeholder:"请配置颜色",value:l,onChange:function(t){var n=_.cloneDeep(m);n[e].params.tagSetting[a]=t,d(n)}},Ce.map(function(e){return f.a.createElement(A.a.Option,{className:"tagSetting".concat(e.value),value:e.value},e.label)})))})),g.widget&&"longtext"===g.widget&&f.a.createElement(v.a.Item,{label:"配置字段类型"},f.a.createElement("div",{onMouseDown:function(e){return e.preventDefault(),!1}},f.a.createElement(A.a,{style:{width:240},placeholder:"请配置字段类型",value:g.params.textType?we.filter(function(e){return e.label===g.params.textType}).map(function(e){return e.label}):null,onChange:function(t){var n=_.cloneDeep(m);n[e].params.textType=t,d(n)}},we.map(function(e){return f.a.createElement(A.a.Option,{value:e.label},e.value)})))),g.widget&&"textimg"===g.widget&&f.a.createElement(f.a.Fragment,null,f.a.createElement(v.a.Item,{label:"标题字段"},f.a.createElement(A.a,{style:{width:240},placeholder:"请配置标题字段",value:null===(l=g.fields)||void 0===l?void 0:l.title,onChange:function(t){if(t){var n=_.cloneDeep(m);n[e].fields.title=t,d(n)}}},a[t].fields.map(function(e){return f.a.createElement(A.a.Option,{value:e.name}," ",e.displayName)}))),f.a.createElement(v.a.Item,{label:"图片字段"},f.a.createElement(A.a,{style:{width:240},placeholder:"请配置图片字段",value:null===(i=g.fields)||void 0===i?void 0:i.avatar,onChange:function(t){if(t){var n=_.cloneDeep(m);n[e].fields.avatar=t,d(n)}}},a[t].fields.map(function(e){return f.a.createElement(A.a.Option,{value:e.name}," ",e.displayName)}))),f.a.createElement(v.a.Item,{label:"内容字段"},f.a.createElement(A.a,{style:{width:240},placeholder:"请配置内容字段",value:null===(o=g.fields)||void 0===o?void 0:o.text,onChange:function(t){if(t){var n=_.cloneDeep(m);n[e].fields.text=t,d(n)}}},a[t].fields.map(function(e){return f.a.createElement(A.a.Option,{value:e.name}," ",e.displayName)})))),g.widget&&"urlImg"===g.widget&&"mref"===b.type&&f.a.createElement(v.a.Item,{label:"图片字段",help:"该字段存储图片的URL"},f.a.createElement("div",{onMouseDown:function(e){return e.preventDefault(),!1}},f.a.createElement(A.a,{style:{width:240},placeholder:"请配置图片字段",value:null===(u=g.params)||void 0===u?void 0:u.urlImgName,onChange:function(t){var n=_.cloneDeep(m);n[e].params.urlImgName=t,d(n)}},N.map(function(e){return f.a.createElement(A.a.Option,{value:e.label},e.value)})))),f.a.createElement("div",{className:fe.a.divider,style:{marginBottom:16}},"权限设置"),f.a.createElement(ce,{groupsValue:null!==(s=null===(p=g.groups)||void 0===p?void 0:p.filter(function(e){return!("number"==typeof e)}))&&void 0!==s?s:[],groupsOnChange:function(t){var n=_.cloneDeep(m);n[e].groups=t,d(E()(n))},userValue:g.userField,userOnChange:function(t){var n=_.cloneDeep(m);n[e].userField=t,d(E()(n))},staffModelFields:y,staffModel:r,defauldGroupValue:n[t].display[e]}))},m,function(){d(n[t].display)},w,function(){return _.cloneDeep(m).map(function(e){var t=i()({},e);return _.isEmpty(e.groups)||(t.groups=t.groups.filter(function(e){return e}).map(function(e){return e.id||e})),e.id||(t.id=I()(6)),t})},{handleFieldChange:function(e,t){var n=_.cloneDeep(m);n[e]={name:t},d(n)},handleAliasChange:k,handleFieldDelete:function(e){var t=_.cloneDeep(m);t.splice(e,1),d(t)},handleFieldAdd:function(){var e=[].concat(E()(m),[{params:{}}]);return d(e),e},setDisplay:d,handletemp:function(){d([].concat(E()(m),[{type:"combo",fields:{},params:{}}]))}}]}var ke,_e=(de={},he()(de,"v1",function(e){var t=e.modelName,n=e.adminConfig,a=e.schemas,l=e.bsmSetting,i=Object(u.useState)(!1),o=c()(i,2),s=o[0],m=o[1],d=Object(u.useState)(0),p=c()(d,2),v=p[0],g=p[1],y=je({modelName:t,adminConfig:n,schemas:a,FieldIndex:v,bsmSetting:l}),E=c()(y,6),b=E[0],C=E[1],O=E[2],w=E[3],S=E[4],k=E[5],F=k.handleFieldChange,N=k.handleAliasChange,x=k.handleFieldDelete,I=k.handleFieldAdd,A=k.setDisplay,T=k.handletemp;return[f.a.createElement(f.a.Fragment,null,f.a.createElement(j.a,{title:f.a.createElement("span",null,!C[v]||C[v].name,"字段配置"),width:"60%",visible:s,closable:!0,onOk:function(){return m(!1)},onCancel:function(){return m(!1)}},b(v)),f.a.createElement(P.a,{dataSource:C,size:"middle",bordered:!0,pagination:!1,columns:[{title:"字段",key:"name",render:function(e,n,a){return f.a.createElement(le.a,{value:e.name,onChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return F.apply(void 0,[a].concat(t))},model:t,disabled:"combo"===e.type})}},{title:"列名",key:"alias",render:function(e,n,r){return f.a.createElement(h.a,{allowClear:!0,value:e.alias,placeholder:e.name&&Object(Ee.displayPreprocess)([_.cloneDeep(e)],t,a)[0].alias,onChange:function(e){return N(r,e.target.value)}})}},{title:"操作",key:"operation",render:function(e,t,n){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return g(n),m(!0),void(C[v].inplaceEdit||(C[v].inplaceEdit=!1))}},"更多"),f.a.createElement(D.a,{type:"vertical"}),f.a.createElement("a",{onClick:function(){return x(n)}},"删除"),n>0&&f.a.createElement(f.a.Fragment,null,f.a.createElement(D.a,{type:"vertical"}),f.a.createElement("a",{onClick:function(){return e=n,t=_.cloneDeep(C),a=e-1,r=[t[e],t[a]],t[a]=r[0],t[e]=r[1],void A(t);var e,t,a,r}},"上移")),n<C.length-1&&f.a.createElement(f.a.Fragment,null,f.a.createElement(D.a,{type:"vertical"}),f.a.createElement("a",{onClick:function(){return e=n,t=_.cloneDeep(C),a=e+1,r=[t[e],t[a]],t[a]=r[0],t[e]=r[1],void A(t);var e,t,a,r}},"下移")))}}],footer:function(){return f.a.createElement("div",null,f.a.createElement(r.a,{onClick:I},"添加一列"),f.a.createElement(r.a,{style:{margin:5},onClick:T},"添加组合字段"))}})),C,O,w,S]}),he()(de,"v2",function(e){var t=e.modelName,n=e.adminConfig,a=e.schemas,l=e.bsmSetting,i=je({modelName:t,adminConfig:n,schemas:a,bsmSetting:l}),o=c()(i,6),u=o[0],s=o[1],m=o[2],d=o[3],p=o[4],v=o[5],h=v.handleFieldChange,g=v.handleFieldDelete,y=v.handleFieldAdd,E=v.setDisplay,b=v.handletemp,C=re({allData:s,setData:E,title:"列表字段",sections:[s.length||0],setSections:function(e){E(e[0].fields)},columns:[{title:"字段",key:"name",render:function(e,n,a){return f.a.createElement(le.a,{value:e.name,onChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return h.apply(void 0,[a].concat(t))},model:t,disabled:"combo"===e.type})}},{title:"操作",key:"operation",render:function(e,t,n){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return g(n)}},"删除"))}}],footer:function(){return f.a.createElement("div",null,f.a.createElement(r.a,{onClick:y},"添加一列"),f.a.createElement(r.a,{style:{margin:5},onClick:b},"添加组合字段"))},expandedRowRender:function(e,t){return u(t)}});return[c()(C,1)[0],s,m,d,p]}),de).v2,Fe=(n("Znn+"),n("ZTPi")),Ne=n("556t"),xe=n("O/S9"),Ie=n("9Ndd"),Ae=["ref","mref","bref"];function Pe(e){var t={action:e,title:Ne.a[e],params:{},showIf:[],groups:[],id:I()(6)};return["partEdit","nowEdit"].includes(e)&&(t.params.fields=[]),"partEdit"===e&&(t.params.editFields=[]),["refEdit","refDetail"].includes(e)&&(t.showInModal=!0),t}function Te(e){var t=e.modelName,n=e.schemas,a=e.adminConfig,l=e.bsmSetting.staff_model,o=Object(u.useState)(a[t].inlineActions),s=c()(o,2),m=s[0],d=s[1],p=Object(u.useState)([]),g=c()(p,2),y=g[0],b=g[1];function C(e,t){var n=_.cloneDeep(m);n[e].title=t,d(n)}function O(e,t,n){var a=_.cloneDeep(m);a[e].params[t]=n,d(a)}return Object(u.useEffect)(function(){var e=_.cloneDeep(a[t].inlineActions);if(e.forEach(function(e){_.isObject(e.showIf)&&!_.isArray(e.showIf)&&(e.showIf=[e.showIf])}),l){var r=[];n[t].fields.forEach(function(e){e.ref===l&&r.push(e)}),b(r)}var i=new Set;(a[t].inlineActions||[]).forEach(function(e){_.isEmpty(e.groups)||e.groups.forEach(function(e){return i.add(e)})}),d(e)},[]),[function(e){var i,o;if(void 0===e)return null;var c=m[e];return f.a.createElement(v.a,{labelCol:{span:6},wrapperCol:{span:8}},f.a.createElement(v.a.Item,{label:"操作类型"},f.a.createElement(A.a,{value:c.action,onChange:function(t){return function(e,t){var n=_.cloneDeep(m);n[e]=Pe(t),d(n)}(e,t)}},_.map(Ne.a,function(e,t){return f.a.createElement(A.a.Option,{value:t},e)}))),f.a.createElement(v.a.Item,{label:"操作名称"},f.a.createElement(h.a,{value:c.title,onChange:function(t){return C(e,t.target.value)}})),"action"===c.action&&f.a.createElement(f.a.Fragment,null,f.a.createElement(v.a.Item,{label:"函数名"},f.a.createElement(h.a,{value:c.params.action,onChange:function(t){return O(e,"action",t.target.value)}})),f.a.createElement(v.a.Item,{label:"请求体"},f.a.createElement(h.a.TextArea,{defaultValue:JSON.stringify(c.params.payload),autosize:{minRows:5},onChange:function(t){try{O(e,"payload",JSON.parse(t.target.value))}catch(e){}}}))),"info"===c.action&&f.a.createElement(f.a.Fragment,null,f.a.createElement(v.a.Item,{label:"标题"},f.a.createElement(h.a,{value:c.params.title,onChange:function(t){return O(e,"title",t.target.value)}})),f.a.createElement(v.a.Item,{label:"正文"},f.a.createElement(h.a,{value:c.params.content,onChange:function(t){return O(e,"content",t.target.value)}}))),"link"===c.action&&f.a.createElement(f.a.Fragment,null,f.a.createElement(v.a.Item,{label:"网址"},f.a.createElement(h.a,{value:c.params.link,onChange:function(t){return O(e,"link",t.target.value)}}))),Ne.b.includes(c.action)&&f.a.createElement(f.a.Fragment,null,f.a.createElement(v.a.Item,{label:"关联字段"},f.a.createElement(le.a,{value:c.params.field||c.field,onChange:function(t){var n=_.cloneDeep(m);n[e].params.field=t,d(n)},layer:1,fieldFilter:function(e){return"refAdd"===c.action?["mref","bref"].includes(e.type):"ref"===e.type},model:t})),"refAdd"!==c.action&&f.a.createElement(v.a.Item,{label:"弹窗显示"},f.a.createElement(ye.a,{checked:c.showInModal,onChange:function(t){var n=_.cloneDeep(m);n[e].showInModal=t,d(n)}}))),["partEdit","nowEdit"].includes(c.action)&&f.a.createElement(f.a.Fragment,null,"partEdit"===c.action&&f.a.createElement(v.a.Item,{label:"可编辑字段"},f.a.createElement(A.a,{mode:"multiple",style:{width:"100%"},placeholder:"请添加可编辑字段",value:c.params.editFields,onChange:function(t){var n=_.cloneDeep(m);n[e].params.editFields=t,d(E()(n))}},n[t].fields.map(function(e){return f.a.createElement(A.a.Option,{key:e.name},e.displayName)}))),f.a.createElement(v.a.Item,{label:"设置属性值",wrapperCol:{span:10}},f.a.createElement("div",null,(c.params.fields||[]).map(function(a,r){var l=Ie.a.TextInput,i={};if(a.name){var o=n[t].fields.find(function(e){return e.name===a.name});if(!o)return null;i.field=o,l=Ie.a[Ie.d[o.type]]}return f.a.createElement("div",{style:{display:"flex"}},f.a.createElement("div",{style:{marginRight:8}},f.a.createElement(le.a,{value:a.name,onChange:function(t){var n=_.cloneDeep(m);n[e].params.fields[r].name=t,n[e].params.fields[r].value=void 0,d(n)},fieldDisable:function(e){return c.params.fields.map(function(e){return e.name}).includes(e.name)},fieldFilter:function(e){return!Ae.includes(e.type)&&!e.primaryKey},model:t})),f.a.createElement("div",{style:{marginRight:8}},f.a.createElement(l,R()({value:a.value,onChange:function(t){var n=_.cloneDeep(m);n[e].params.fields[r].value=t,d(n)}},i))),f.a.createElement("div",null,f.a.createElement("a",{onClick:function(){var t=_.cloneDeep(m);t[e].params.fields=t[e].params.fields.filter(function(e,t){return t!==r}),d(t)},style:{marginLeft:8}},f.a.createElement(T.a,{type:"delete",style:{fontSize:20}}))))})),f.a.createElement("div",null,f.a.createElement(r.a,{type:"dashed",style:{width:"100%"},onClick:function(){var t=_.cloneDeep(m);t[e].params.fields.push({}),d(t)}},f.a.createElement(T.a,{type:"plus"}))))),f.a.createElement("div",{className:fe.a.divider,style:{marginBottom:16}},"权限设置"),f.a.createElement(ce,{groupsValue:null!==(i=null===(o=c.groups)||void 0===o?void 0:o.filter(function(e){return!("number"==typeof e)}))&&void 0!==i?i:[],groupsOnChange:function(t){var n=_.cloneDeep(m);n[e].groups=t,d(E()(n))},userValue:c.userField,userOnChange:function(t){var n=_.cloneDeep(m);n[e].userField=t,d(E()(n))},staffModelFields:y,staffModel:l,defauldGroupValue:a[t].inlineActions[e]}),f.a.createElement(v.a.Item,{label:"满足条件显示",wrapperCol:{span:15}},f.a.createElement("div",null,f.a.createElement(xe.a,{fields:n[t].fields,value:c.showIf||[],onChange:function(t){var n=_.cloneDeep(m);n[e].showIf=t,d(n)},disabledField:function(e){return c.showIf.map(function(e){return e.field}).filter(function(e){return e}).includes(e.name)}}))))},m,function(){d(a[t].inlineActions)},function(){return _.cloneDeep(m).filter(function(e){var t=!!e.action;return Ne.b.includes(e.action)&&(t=t&&!(!e.params.field&&!e.field)),t}).map(function(e){var t,n,a=i()({},e);return["partEdit","nowEdit"].includes(e.action)&&(a.params.fields=null===(t=a.params.fields)||void 0===t?void 0:t.filter(function(e){return e.name&&void 0!==e.value}),a.showIf=null===(n=a.showIf)||void 0===n?void 0:n.filter(function(e){return e.field&&e.operator&&void 0!==e.value})),_.isEmpty(e.groups)||(a.groups=a.groups.filter(function(e){return e}).map(function(e){return e.id||e})),e.id||(a.id=I()(6)),a})},{handleParamsChange:O,handleTitleChange:C,handleDelete:function(e){var t=_.cloneDeep(m);t.splice(e,1),d(t)},handleAdd:function(){d([].concat(E()(m),[{}]))},setInlineActions:d,addActions:function(e){var t=e.map(Pe);d([].concat(E()(m),E()(t)))}}]}var $e=(ke={},he()(ke,"v1",function(e){var t=e.modelName,n=e.schemas,r=e.adminConfig,l=e.bsmSetting,i=Object(u.useState)(String(0)),o=c()(i,2),s=o[0],m=o[1],d=Te({modelName:t,schemas:n,adminConfig:r,bsmSetting:l}),p=c()(d,5),v=p[0],h=p[1],g=p[2],y=p[3],E=p[4],b=E.handleAdd,C=E.handleDelete;return[f.a.createElement(a.a,{title:"操作项",type:"inner"},f.a.createElement(Fe.a,{tabBarStyle:{minWidth:48},activeKey:s,tabPosition:"left",type:"editable-card",onChange:m,onEdit:function(e,t){switch(t){case"add":b();break;case"remove":C(e)}}},h.map(function(e,t){return f.a.createElement(Fe.a.TabPane,{tab:e.title,key:t},v(t))}))),h,g,y]}),he()(ke,"v2",function(e){var t=e.modelName,n=e.adminConfig,a=Te({modelName:t,schemas:e.schemas,adminConfig:n,bsmSetting:e.bsmSetting}),l=c()(a,5),i=l[0],o=l[1],s=l[2],m=l[3],d=l[4],p=Object(u.useState)([]),h=c()(p,2),g=h[0],y=h[1],E=Object(u.useState)(!1),b=c()(E,2),C=b[0],O=b[1],w=d.addActions,S=d.handleDelete,D=d.setInlineActions,k=re({allData:o,setData:D,sections:[o.length||0],title:"操作项",setSections:function(e){D(e[0].fields)},columns:[{title:"操作项",key:"name",render:function(e){return e.title||Ne.a[e.action]}},{title:"操作",key:"operation",render:function(e,t,n){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return S(n)}},"删除"))}}],footer:function(){return f.a.createElement(r.a,{onClick:function(){return O(!0)}},"添加操作项")},expandedRowRender:function(e,t){return i(t)}}),_=c()(k,1)[0],F=f.a.createElement("div",null,f.a.createElement(v.a.Item,{label:"选择类型",labelCol:{span:6},wrapperCol:{span:18}},f.a.createElement(A.a,{mode:"multiple",defaultValue:[],value:g,onChange:y,style:{minWidth:160}},Object.keys(Ne.a).map(function(e,t){return f.a.createElement(A.a.Option,{value:e,key:"".concat(e,"__").concat(t+1)},Ne.a[e])}))));return[f.a.createElement(f.a.Fragment,null,f.a.createElement(j.a,{title:"添加操作项",visible:C,onOk:function(){w(g),O(!1)},onCancel:function(){return O(!1)},afterClose:function(){O(!1),y([])},okText:"确认",cancelText:"取消"},F),_),o,s,m]}),ke).v2,Re=n("EBSl"),Ve=n("xNPh");var Me,Le=Object(s.connect)(function(e){return{schemas:e.content.schemas}})(function(e){var t=e.schemas,n=e.model,a=e.onChange,l=e.fieldFilter,i=e.value,o=void 0===i?[]:i;if(!O.a.isArray(o))return null;var c=Ie.a.TextInput,u={};return f.a.createElement(f.a.Fragment,null,o.map(function(e,r){if(e.name){var i=t[n].fields.find(function(t){return t.name===e.name});c=Ie.a[Ie.d[i.type]]}return f.a.createElement("div",null,f.a.createElement("div",{style:{display:"flex"}},f.a.createElement("div",{style:{marginRight:8}},f.a.createElement(le.a,{value:e.name,fieldFilter:l,onChange:function(e){var t=O.a.cloneDeep(o);t[r].name=e,t[r].value&&(t[r].value=void 0),a(t)},model:n})),f.a.createElement("div",{style:{marginRight:8}},f.a.createElement(c,R()({onChange:function(e){var t=O.a.cloneDeep(o);t[r].value=e,a(t)},value:e.value},u))),f.a.createElement("a",{onClick:function(){return function(e){var t=O.a.cloneDeep(o);t.splice(e,1),a(t)}(r)},style:{marginLeft:8}},f.a.createElement(T.a,{type:"delete",style:{fontSize:20}}))))}),f.a.createElement(r.a,{type:"dashed",style:{width:354},onClick:function(){var e=O.a.cloneDeep(o);e.push({}),a(e)}},f.a.createElement(T.a,{type:"plus"})))}),Ye="Form_winght_new",We=["choices","default","displayName","editable","help","maxDigits","maxLength","name","precision","primaryKey","readonly","ref","refField","refTo","required","type","validators"],qe=Object(Ve.a)();function Ke(e){return O.a.pick(e,We)}function Be(e){var t=e.paramsDef,n=void 0===t?[]:t,a=e.onChange,r=e.model,l=e.values,o=he()({},Ye,{fields:n.map(Ke)}),c=he()({},Ye,{formFields:n.map(function(e){return function(e,t){var n=t.model,a=t.values,r=i()({},O.a.omit(e,We),{name:e.name}),l=r.params;return l&&"function"==typeof l&&(r.params=l({model:n,values:a})),r}(e,{model:r,values:l})})});return f.a.createElement(qe,{hideCard:!0,model:Ye,schemas:o,admins:c,showButtons:!1,object:l,onValuesChange:a})}Object(Ie.e)("FieldsSet",Le,"字段配置器");var Ge=Re.a.ACTION_TYPE_BATCH;function ze(e){return{action:e,name:Ge[e].name,params:{},groups:[]}}function He(e){var t=e.modelName,n=e.schemas,a=e.adminConfig,r=e.bsmSetting.staff_model,l=Object(u.useState)(a[t].actions),o=c()(l,2),s=o[0],m=void 0===s?[]:s,d=o[1],p=Object(u.useState)([]),g=c()(p,2),y=g[0],b=g[1];function C(e,t){var n=O.a.cloneDeep(m);n[e].name=t,d(n)}Object(u.useEffect)(function(){if(r){var e=[];n[t].fields.forEach(function(t){t.ref===r&&e.push(t)}),b(e)}},[]);return[function(e){var n,l,i;if(void 0===e)return null;var o=m[e];return f.a.createElement(v.a,{labelCol:{span:6},wrapperCol:{span:8}},f.a.createElement(v.a.Item,{label:"批量操作类型"},f.a.createElement(A.a,{value:o.action,onChange:function(t){return function(e,t){var n=O.a.cloneDeep(m);n[e].action=t,n[e].name=Ge[t].name,n[e].params={},d(n)}(e,t)}},Object.keys(Ge).map(function(e){return f.a.createElement(A.a.Option,{value:e},Ge[e].name)}))),f.a.createElement(v.a.Item,{label:"批量操作名称"},f.a.createElement(h.a,{value:o.name,onChange:function(t){return C(e,t.target.value)}})),f.a.createElement(Be,{paramsDef:Ge[o.action].paramsDef,model:t,values:o.params,onChange:function(t,n){var a=E()(m);a[e].params[t]=n,d(a)}}),f.a.createElement("div",{className:fe.a.divider,style:{marginBottom:16}},"权限设置"),f.a.createElement(ce,{groupsValue:null!==(n=null===(l=o.groups)||void 0===l?void 0:l.filter(function(e){return!("number"==typeof e)}))&&void 0!==n?n:[],groupsOnChange:function(t){var n=O.a.cloneDeep(m);n[e].groups=t,d(E()(n))},userValue:o.userField,userOnChange:function(t){var n=O.a.cloneDeep(m);n[e].userField=t,d(E()(n))},staffModelFields:y,staffModel:r,defauldGroupValue:null===(i=a[t].actions)||void 0===i?void 0:i[e]}))},m,function(){d(a[t].actions)},function(){return O.a.cloneDeep(m).map(function(e){var t=i()({},e);return O.a.isEmpty(e.groups)||(t.groups=t.groups.filter(function(e){return e}).map(function(e){return e.id||e})),e.id||(t.id=I()(6)),t})},{handleTitleChange:C,handleDelete:function(e){var t=O.a.cloneDeep(m);t.splice(e,1),d(t)},handleAdd:function(){d([].concat(E()(m),[{}]))},setActions:d,addActions:function(e){var t=e.map(ze);d([].concat(E()(m),E()(t)))}}]}var Ue=(Me={},he()(Me,"v1",function(e){var t=e.modelName,n=e.schemas,r=e.adminConfig,l=e.bsmSetting,i=Object(u.useState)(String(0)),o=c()(i,2),s=o[0],m=o[1],d=He({modelName:t,schemas:n,adminConfig:r,bsmSetting:l}),p=c()(d,5),v=p[0],h=p[1],g=p[2],y=p[3],E=p[4],b=E.handleAdd,C=E.handleDelete;return[f.a.createElement(a.a,{title:"批量操作",type:"inner"},f.a.createElement(Fe.a,{tabBarStyle:{minWidth:48},activeKey:s,tabPosition:"left",type:"editable-card",onChange:m,onEdit:function(e,t){switch(t){case"add":b();break;case"remove":C(e)}}},h.map(function(e,t){return f.a.createElement(Fe.a.TabPane,{tab:e.name,key:t},v(t))}))),h,g,y]}),he()(Me,"v2",function(e){var t=e.modelName,n=e.adminConfig,a=He({modelName:t,schemas:e.schemas,adminConfig:n,bsmSetting:e.bsmSetting}),l=c()(a,5),i=l[0],o=l[1],s=l[2],m=l[3],d=l[4],p=Object(u.useState)([]),h=c()(p,2),g=h[0],y=h[1],E=Object(u.useState)(!1),b=c()(E,2),C=b[0],O=b[1],w=d.addActions,S=d.handleDelete,D=d.setActions,k=re({allData:o,setData:D,sections:[o.length||0],title:"批量操作",setSections:function(e){D(e[0].fields)},columns:[{title:"批量操作",key:"name",render:function(e){return e.name||Ge[e.action].name}},{title:"操作",key:"operation",render:function(e,t,n){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return S(n)}},"删除"))}}],footer:function(){return f.a.createElement(r.a,{onClick:function(){return O(!0)}},"添加操作项")},expandedRowRender:function(e,t){return i(t)}}),_=c()(k,1)[0],F=f.a.createElement("div",null,f.a.createElement(v.a.Item,{label:"选择类型",labelCol:{span:6},wrapperCol:{span:18}},f.a.createElement(A.a,{mode:"multiple",defaultValue:[],value:g,onChange:y,style:{minWidth:160}},Object.keys(Ge).map(function(e,t){return f.a.createElement(A.a.Option,{value:e,key:"".concat(e,"__").concat(t+1)},Ge[e].name)}))));return[f.a.createElement(f.a.Fragment,null,f.a.createElement(j.a,{title:"添加操作项",visible:C,onOk:function(){w(g),O(!1)},onCancel:function(){return O(!1)},afterClose:function(){O(!1),y([])},okText:"确认",cancelText:"取消"},F),_),o,s,m]}),Me).v2;var Je=function(e){var t=e.modelName,n=e.schemas,r=e.adminConfig,l=e.bsmSetting,i=pe({modelName:t,schemas:n,adminConfig:r,bsmSetting:l}),o=c()(i,4),s=o[0],m=o[1],d=o[2],h=o[3],g=_e({modelName:t,schemas:n,adminConfig:r,bsmSetting:l}),y=c()(g,5),E=y[0],b=y[1],C=y[2],O=y[3],w=y[4],S=$e({modelName:t,schemas:n,adminConfig:r,bsmSetting:l}),j=c()(S,4),k=j[0],_=j[1],F=j[2],N=j[3],x=Ue({modelName:t,schemas:n,adminConfig:r,bsmSetting:l}),I=c()(x,4),A=I[0],P=I[1],T=I[2],$=I[3],R=Object(u.useState)(r[t].filterLayout||"default"),V=c()(R,2),M=V[0],L=V[1],Y={display:b,filter:m,inlineActions:_,actions:P,sortable:O,filterLayout:M};return[f.a.createElement(f.a.Fragment,null,E,f.a.createElement(D.a,null),s,f.a.createElement("div",null,f.a.createElement(a.a,{type:"inner"},f.a.createElement(v.a,{layout:"inline"},f.a.createElement(v.a.Item,{label:"位置"},f.a.createElement(p.a.Group,{value:M,onChange:function(e){return L(e.target.value)}},f.a.createElement(p.a,{value:"default"},"顶部"),f.a.createElement(p.a,{value:"drawer"},"侧拉")))))),f.a.createElement(D.a,null),k,f.a.createElement(D.a,null),A),Y,function(){C(),F(),T(),d()},function(){var e=N();Y.inlineActions=e;var t=$();Y.actions=t;var n=w();Y.display=n;var a=h();return Y.filter=a,Y}]},Ze=(n("giR+"),n("fyUT")),Qe=n("d6i3"),Xe=n.n(Qe),et=n("1l/V"),tt=n.n(et),nt={group:"分组",tab:"标签",step:"分步"};var at,rt,lt=function(e){var t=e.schemas,n=e.modelName,a=e.adminConfig,l=e.formFields,i="default",o=[];a[n].formLayout&&(i=a[n].formLayout.style||i,o=_.cloneDeep(a[n].formLayout.sections));var s=Object(u.useState)(i),m=c()(s,2),d=m[0],g=m[1],y=Object(u.useState)(o),b=c()(y,2),C=b[0],O=b[1];return[f.a.createElement(v.a,{layout:"inline"},f.a.createElement(v.a.Item,{label:"排列方式"},f.a.createElement(p.a.Group,{value:d,onChange:function(e){return g(e.target.value)}},f.a.createElement(p.a,{value:"default"},"默认"),_.map(nt,function(e,t){return f.a.createElement(p.a,{value:t},e)}))),"default"!==d&&f.a.createElement(f.a.Fragment,null,f.a.createElement(P.a,{style:{marginTop:24},size:"middle",bordered:!0,dataSource:C,pagination:!1,columns:[{title:"".concat(nt[d],"名称"),key:"title",render:function(e,t,n){return f.a.createElement(h.a,{value:e.title,onChange:function(e){return t=n,a=e.target.value,(r=_.cloneDeep(C))[t].title=a,void O(r);var t,a,r}})}},{title:"所含字段",key:"fields",render:function(e,a,r){return f.a.createElement(A.a,{mode:"multiple",value:e.fields,onChange:function(e){return t=r,n=e,(a=_.cloneDeep(C))[t].fields=n,void O(a);var t,n,a}},l.filter(function(e){return e.name}).map(function(a){return f.a.createElement(A.a.Option,{value:a.name,disabled:C.map(function(e){return e.fields}).flat().includes(a.name)&&!(e.fields||[]).includes(a.name)},t[n].fields.find(function(e){return e.name===a.name}).displayName)}))}},{title:"操作",key:"option",render:function(e,t,n){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return e=n,(t=_.cloneDeep(C)).splice(e,1),void O(t);var e,t}},"删除"),n>0&&f.a.createElement(f.a.Fragment,null,f.a.createElement(D.a,{type:"vertical"}),f.a.createElement("a",{onClick:function(){return e=n,t=_.cloneDeep(C),a=e-1,r=[t[e],t[a]],t[a]=r[0],t[e]=r[1],void O(t);var e,t,a,r}},"上移")),n<C.length-1&&f.a.createElement(f.a.Fragment,null,f.a.createElement(D.a,{type:"vertical"}),f.a.createElement("a",{onClick:function(){return e=n,t=_.cloneDeep(C),a=e+1,r=[t[e],t[a]],t[a]=r[0],t[e]=r[1],void O(t);var e,t,a,r}},"下移")))}}],footer:function(){return f.a.createElement(r.a,{onClick:function(){return O([].concat(E()(C),[{}]))}},"添加",nt[d])}}))),"default"===d?void 0:{style:d,sections:C},function(){g(i),O(o)}]},it={group:"分组",tab:"标签",step:"分步"};function ot(e){var t=e.schemas,n=e.modelName,a=e.adminConfig,r=e.bsmSetting.staff_model,l=Object(u.useState)(_.cloneDeep(a[n].formFields)),o=c()(l,2),s=o[0],p=o[1],h=Object(u.useState)([]),g=c()(h,2),y=g[0],b=g[1],C=Object(u.useState)(!1),O=c()(C,2),w=O[0],S=O[1],D=t[n].fields,j=Object(Ie.g)(),k=Object(Ie.f)(),F={};function N(e){return{name:e,params:{}}}function x(e,t){var n=_.cloneDeep(s);n[e]={name:t,params:{}},p(n)}function P(e,t,n){var a=_.cloneDeep(s);a[e][n]=t,p(a)}function T(e,t,n){var a=_.cloneDeep(s);a[e].params[t]=n,p(a)}return Object(u.useEffect)(function(){if(r){var e=[];t[n].fields.forEach(function(t){t.ref===r&&e.push(t)}),b(e)}!function(e,t){var n=[],a=[];e.forEach(function(e,t){var r=e;r.showIf&&(_.isArray(r.showIf)?r.showIf:[r.showIf]).forEach(function(e,r){if(_.isObject(e.value)){var l=D.find(function(t){return t.name===e.field}),i=new Promise(function(a){Object(ie.queryContent)({model:l.ref,filters:[{field:Object(m.D)(l.ref),operator:"in",value:e.value}]}).then(function(e){var l=e.list;n.push([t,r,l]),a()})});a.push(i)}})});var r=e;_.isEmpty(a)?t&&t(r):Promise.all(a).then(function(){n.forEach(function(e){var t=c()(e,3),n=t[0],a=t[1],l=t[2];r[n].showIf[a].value=l}),p(r),t&&t(r)})}(s,function(e){return function(e,t){var a=[],r=[];e.forEach(function(e,t){e.choicesFilter&&e.choicesFilter.forEach(function(l,i){if(_.isArray(l.value)){var o=Object(m.t)(n,"".concat(e.name,".").concat(l.field)),c=new Promise((u=tt()(Xe.a.mark(function e(n){return Xe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Object(ie.queryContent)({model:o.ref,filters:[{field:Object(m.D)(o.ref),operator:"in",value:l.value}]}).then(function(e){var r=e.list;a.push([t,i,r]),n()});case 1:case"end":return e.stop()}},e)})),function(e){return u.apply(this,arguments)}));r.push(c)}var u})});var l=_.cloneDeep(e);_.isEmpty(r)?t&&t(l):Promise.all(r).then(function(){a.forEach(function(e){var t=c()(e,3),n=t[0],a=t[1],r=t[2];l[n].choicesFilter[a].value=r}),p(l),t&&t(l)})}(e,function(){return S(!0)})})},[]),[function(e){var l,i;if(void 0===e)return null;var o=s[e];if(!o.name)return null;var c=D.find(function(e){return e.name===o.name}),u=o.name&&Object(Ee.formFieldsPreprocess)([_.cloneDeep(o)],[_.cloneDeep(c)])[0].widget;return f.a.createElement(v.a,{labelCol:{span:5},wrapperCol:{span:19}},f.a.createElement(v.a.Item,{label:"字段"},f.a.createElement(A.a,{value:o.name,onChange:function(t){return x(e,t)},showSearch:!0,filterOption:function(e,t){var n=t.props,a=n.value,r=n.children,l=e.toLowerCase();return a.replace(/_/g,"").toLowerCase().includes(l)||r.toLowerCase().includes(l)}},D.map(function(e){return f.a.createElement(A.a.Option,{value:e.name,disabled:s.map(function(e){return e.name}).includes(e.name)&&e.name!==o.name},e.displayName)}))),o.name&&f.a.createElement(v.a.Item,{label:"组件"},f.a.createElement(A.a,{value:o.widget||null,onChange:function(a){return function(e,a){var r=_.cloneDeep(s);if(a){r[e].widget=a;var l=t[n].fields.find(function(t){return t.name===r[e].name});if(["TreeSelect","Cascader"].includes(a)){var i=t[l.ref].fields.find(function(e){return"ref"===e.type&&e.ref===l.ref});i&&(r[e].params.parent=i.name)}if(["Gallery"].includes(a)){var o=t[l.ref].fields.find(function(e){return["string","text","image","file"].includes(e.type)});o&&(r[e].params.urlField=o.name)}}else delete r[e].widget;p(r)}(e,a)}},f.a.createElement(A.a.Option,{value:null},"默认（",j[Ie.d[c.type]]||Ie.d[c.type],"）"),_.uniq(k[c.type].concat(c.choices?["Select"]:[])).map(function(e){return f.a.createElement(A.a.Option,{value:e,disabled:F[e]},j[e]||e)}))),["TreeSelect","Cascader"].includes(u)&&f.a.createElement(v.a.Item,{label:"父级字段",help:"这个字段用于指向父级记录"},f.a.createElement(A.a,{value:o.params.parent,onChange:function(t){return T(e,"parent",t)}},t[c.ref].fields.filter(function(e){return"ref"===e.type&&e.ref===c.ref}).map(function(e){return f.a.createElement(A.a.Option,{value:e.name},e.displayName)}))),["GroupCascader"].includes(u)&&f.a.createElement(v.a.Item,{label:"分组字段",required:!0},f.a.createElement(le.a,{value:o.params.groupBy,model:c.ref,onChange:function(t){return T(e,"groupBy",t)},fieldFilter:function(e){return"ref"===e.type}})),["Gallery"].includes(u)&&f.a.createElement(v.a.Item,{label:"图片地址字段",help:"这个字段用于存放图片链接地址"},f.a.createElement(A.a,{value:o.params.urlField,onChange:function(t){return T(e,"urlField",t)}},t[c.ref].fields.filter(function(e){return["string","text","image","file"].includes(e.type)}).map(function(e){return f.a.createElement(A.a.Option,{value:e.name},e.displayName)}))),[("InlineForm"===u||"InnerTable"===u||"Select"===u&&"mref"===c.type)&&f.a.createElement(v.a.Item,{label:"允许新增"},f.a.createElement(d.a,{checked:o.params.canAdd,onChange:function(t){return T(e,"canAdd",t.target.checked)}}))],"Select"===u&&["ref","mref"].includes(c.type)&&f.a.createElement(v.a.Item,{label:"选项个数",help:"下拉选择框选择时显示的个数"},f.a.createElement(Ze.a,{min:1,placeholder:"默认为7",value:o.params.optionSize,onChange:function(t){return T(e,"optionSize",t)}})),f.a.createElement("div",{className:fe.a.divider,style:{marginBottom:16}},"权限设置"),f.a.createElement(ce,{groupsValue:null!==(l=null===(i=o.groups)||void 0===i?void 0:i.filter(function(e){return!("number"==typeof e)}))&&void 0!==l?l:[],groupsOnChange:function(t){var n=_.cloneDeep(s);n[e].groups=t,p(E()(n))},userValue:o.userField,userOnChange:function(t){var n=_.cloneDeep(s);n[e].userField=t,p(E()(n))},staffModelFields:y,staffModel:r,defauldGroupValue:a[n].formFields[e]}),f.a.createElement(v.a.Item,{label:"满足条件显示"},f.a.createElement(xe.a,{fields:D,onChange:function(t){return P(e,t,"showIf")},value:o.showIf,disabledField:function(e){return o.showIf.filter(function(e){return e.field}).map(function(e){return e.field}).includes(e.name)}})),[!_.isEmpty(c)&&["ref","mref"].includes(c.type)&&f.a.createElement(v.a.Item,{label:"过滤条件："},f.a.createElement(xe.a,{fields:t[n].fields,onChange:function(t){return P(e,t,"choicesFilter")},value:o.choicesFilter,disabledFilte:o.choicesFilter}))])},s,function(){p(a[n].formFields)},function(){return!0},function(){return _.cloneDeep(s).filter(function(e){return e.name}).map(function(e){var t=e;return t.showIf&&(t.showIf=t.showIf.filter(function(e){return e.field&&e.operator&&void 0!==e.value}).map(function(e){var t=i()({},e);if(_.isObject(t.value)){var n=D.find(function(t){return t.name===e.field});_.isArray(t.value)&&(t.value=t.value.map(function(e){return Object(m.C)(e,n.ref)}))}return t}),t.choicesFilter&&(t.choicesFilter=t.choicesFilter.filter(function(e){return e.field&&e.operator&&void 0!==e.value}).map(function(t){var a=i()({},t);if(_.isObject(a.value)){var r=Object(m.t)(n,"".concat(e.name,".").concat(t.field));_.isArray(a.value)&&(a.value=a.value.map(function(e){return Object(m.C)(e,r.ref)}))}return a}))),_.isEmpty(e.groups)||(t.groups=t.groups.filter(function(e){return e}).map(function(e){return e.id||e})),e.id||(t.id=I()(6)),t})},{handleAdd:function(){p([].concat(E()(s),[{params:{}}]))},handleDelete:function(e){var t=_.cloneDeep(s);t.splice(e,1),p(t)},setFormFields:p,changeFieldName:x,addFields:function(e){var t=e.map(N);p([].concat(E()(s),E()(t)))},getField:N},w]}var ct=(at={},he()(at,"v1",function(e){var t=e.schemas,n=e.modelName,r=e.adminConfig,l=e.bsmSetting,i=Object(u.useState)(String(0)),o=c()(i,2),s=o[0],m=o[1],d=ot({schemas:t,modelName:n,adminConfig:r,bsmSetting:l}),p=c()(d,6),v=p[0],h=p[1],g=p[2],y=p[3],E=p[4],b=p[5],C=lt({modelName:n,schemas:t,adminConfig:r,formFields:h}),O=c()(C,3),w=O[0],S=O[1],j=O[2],k=b.handleAdd,_=b.handleDelete,F=t[n].fields;return[f.a.createElement(f.a.Fragment,null,f.a.createElement(a.a,{title:"表单字段",type:"inner"},f.a.createElement(Fe.a,{tabBarStyle:{minWidth:48},activeKey:s,tabPosition:"left",type:"editable-card",onChange:m,onEdit:function(e,t){switch(t){case"add":k(),m(String(h.length));break;case"remove":_(e)}}},h.map(function(e,t){var n=F.find(function(t){return t.name===e.name});return f.a.createElement(Fe.a.TabPane,{tab:(n||{}).displayName||"字段".concat(t+1),key:t,closable:!n||!n.required||h.filter(function(t){return t.name===e.name}).length>=2},v(t))}))),f.a.createElement(D.a,null),w),h,function(){g(),j()},y,E,S]}),he()(at,"v2",function(e){var t,n=e.modelName,a=e.adminConfig,l=e.schemas,i=e.bsmSetting,o=ot({schemas:l,modelName:n,adminConfig:a,bsmSetting:i}),s=c()(o,7),m=s[0],d=s[1],p=s[2],v=s[3],g=s[4],y=s[5],b=s[6],C=Object(u.useState)([d.length]),O=c()(C,2),w=O[0],S=O[1],D=Object(u.useState)([]),j=c()(D,2),k=j[0],F=j[1],x=y.handleDelete,I=y.setFormFields,A=y.changeFieldName,P=y.getField,$=ae({modelName:n,schemas:l,onOk:function(){return function(e){var t=0,n=e.length+w[rt];w.forEach(function(e,n){n<=rt&&(t+=e)});var a=e.map(P),r=N()(d,{$splice:[[t,0].concat(E()(a))]});I(r),S(N()(w,{$splice:[[rt,1,n]]}))}(M)},fieldDisabled:function(e){return d.map(function(e){return e.name}).includes(e.name)},expand:!1}),R=c()($,3),V=R[0],M=R[1],L=R[2],Y=a[n].formLayout,W=Object(u.useState)((null===Y||void 0===Y?void 0:Y.style)||"default"),q=c()(W,2),K=q[0],B=q[1];function G(e){B(e),"default"===e&&(S([d.length]),F([k[0]]))}var z=re({sections:w,setSections:S,allData:d,setData:I,title:"表单字段",modalView:V,columns:[{title:"字段",key:"name",render:function(e,t,a,r){return f.a.createElement(le.a,{value:e.name,onChange:function(e){return function(e,t,n){A(H(e,t,w),n)}(a,r,e)},model:n})}},{title:"操作",key:"operation",render:function(e,t,n,a){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return function(e,t){x(H(e,t,w)),S(N()(w,{$splice:[[t,1,w[t]-1]]}))}(n,a)}},"删除"))}}],footer:function(e){return f.a.createElement(r.a,{onClick:function(){rt=e,L()}},"添加字段")},expandedRowRender:function(e,t,n,a,r){return m(H(t,r,w))},addAndDeleteView:"default"!==K?function(e){return 0!==e&&f.a.createElement(r.a,{icon:"delete",onClick:function(){return function(e){var t=w.reduce(function(t,n,a){return a<e?t+n:t},0);I(N()(d,{$splice:[[t,w[e]]]})),S(N()(w,{$splice:[[e,1]]})),F(N()(k,{$splice:[[e,1]]}))}(e)}},"删除")}:null,addAndWidget:function(e){return"default"!==K&&f.a.createElement("div",null,f.a.createElement(r.a,{type:"dashed",onClick:function(){return function(e){var t=_.cloneDeep(w);t.splice(e,0,0),S(t),F(N()(k,{$splice:[[e,0,null]]}))}(e+1)},block:!0},f.a.createElement(T.a,{type:"plus"})))},styleView:function(){return f.a.createElement(te,{onChange:G,value:K,layouts:it})},tableTitle:function(e){return"default"!==K&&f.a.createElement("div",null,"".concat(it[K],"名称"),"  ",f.a.createElement(h.a,{style:{width:100},value:k[e],onChange:function(t){return function(e,t){F(N()(k,{$splice:[[e,1,t]]}))}(e,t.target.value)},placeholder:"第".concat(e+1,"组")}))}}),U=c()(z,1)[0];function J(){if(Y&&"default"!==Y.style&&!_.isEmpty(Y.sections)){var e=[],t=[],n=[];Y.sections.forEach(function(a){var r=[];a.fields.forEach(function(e){var t=d.find(function(t){return t.name===e});t&&r.push(t)}),n.push.apply(n,r),t.push(r.length),a.title&&e.push(a.title)}),I(n),S(t),F(e)}}if(Object(u.useEffect)(function(){b&&J()},[b]),"default"!==K){t={style:K,sections:[]};var Z=0;w.forEach(function(e,n){e&&(t.sections.push({title:k[n],fields:d.slice(Z,Z+e).map(function(e){return e.name})}),Z+=e)})}else t=void 0;return[U,d,function(){p(),J()},v,g,t]}),at).v2;var ut=function(e){var t=e.modelName,n=e.schemas,r=e.adminConfig,l=e.bsmSetting,i=ct({modelName:t,schemas:n,adminConfig:r,bsmSetting:l}),o=c()(i,6),s=o[0],m=o[1],d=o[2],h=o[3],g=o[4],y=o[5],E=Object(u.useState)(r[t].modalForm),b=c()(E,2),C=b[0],O=b[1],w={formFields:m,formLayout:y,modalForm:C};return[f.a.createElement(f.a.Fragment,null,s,f.a.createElement(a.a,{title:"基本设置",type:"inner"},f.a.createElement(v.a,{layout:"inline"},f.a.createElement(v.a.Item,{label:"表单界面"},f.a.createElement(p.a.Group,{value:C,onChange:function(e){return O(e.target.value)}},f.a.createElement(p.a,{value:!0},"弹窗编辑"),f.a.createElement(p.a,{value:!1},"新页面编辑")))))),w,function(){d()},function(){var e=g();return w.formFields=e,w},function(){return h()}]},ft=n("Ty5D"),st=(n("qVdP"),n("jsC+")),mt=(n("lUTK"),n("BvKs"));function dt(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];throw Error("[Immer] minified error nr: "+e+(n.length?" "+n.map(function(e){return"'"+e+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function pt(e){return!!e&&!!e[tn]}function vt(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);return!t||t===Object.prototype}(e)||Array.isArray(e)||!!e[en]||!!e.constructor[en]||Ot(e)||wt(e))}function ht(e,t,n){void 0===n&&(n=!1),0===gt(e)?(n?Object.keys:nn)(e).forEach(function(a){n&&"symbol"==typeof a||t(a,e[a],e)}):e.forEach(function(n,a){return t(a,n,e)})}function gt(e){var t=e[tn];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:Ot(e)?2:wt(e)?3:0}function yt(e,t){return 2===gt(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Et(e,t){return 2===gt(e)?e.get(t):e[t]}function bt(e,t,n){var a=gt(e);2===a?e.set(t,n):3===a?(e.delete(t),e.add(n)):e[t]=n}function Ct(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function Ot(e){return Jt&&e instanceof Map}function wt(e){return Zt&&e instanceof Set}function St(e){return e.o||e.t}function Dt(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=an(e);delete t[tn];for(var n=nn(t),a=0;a<n.length;a++){var r=n[a],l=t[r];!1===l.writable&&(l.writable=!0,l.configurable=!0),(l.get||l.set)&&(t[r]={configurable:!0,writable:!0,enumerable:l.enumerable,value:e[r]})}return Object.create(Object.getPrototypeOf(e),t)}function jt(e,t){_t(e)||pt(e)||!vt(e)||(gt(e)>1&&(e.set=e.add=e.clear=e.delete=kt),Object.freeze(e),t&&ht(e,function(e,t){return jt(t,!0)},!0))}function kt(){dt(2)}function _t(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function Ft(e){var t=rn[e];return t||dt(18,e),t}function Nt(){return Ht}function xt(e,t){t&&(Ft("Patches"),e.u=[],e.s=[],e.v=t)}function It(e){At(e),e.p.forEach(Tt),e.p=null}function At(e){e===Ht&&(Ht=e.l)}function Pt(e){return Ht={p:[],l:Ht,h:e,m:!0,_:0}}function Tt(e){var t=e[tn];0===t.i||1===t.i?t.j():t.g=!0}function $t(e,t){t._=t.p.length;var n=t.p[0],a=void 0!==e&&e!==n;return t.h.O||Ft("ES5").S(t,e,a),a?(n[tn].P&&(It(t),dt(4)),vt(e)&&(e=Rt(t,e),t.l||Mt(t,e)),t.u&&Ft("Patches").M(n[tn],e,t.u,t.s)):e=Rt(t,n,[]),It(t),t.u&&t.v(t.u,t.s),e!==Xt?e:void 0}function Rt(e,t,n){if(_t(t))return t;var a=t[tn];if(!a)return ht(t,function(r,l){return Vt(e,a,t,r,l,n)},!0),t;if(a.A!==e)return t;if(!a.P)return Mt(e,a.t,!0),a.t;if(!a.I){a.I=!0,a.A._--;var r=4===a.i||5===a.i?a.o=Dt(a.k):a.o;ht(3===a.i?new Set(r):r,function(t,l){return Vt(e,a,r,t,l,n)}),Mt(e,r,!1),n&&e.u&&Ft("Patches").R(a,n,e.u,e.s)}return a.o}function Vt(e,t,n,a,r,l){if(pt(r)){var i=Rt(e,r,l&&t&&3!==t.i&&!yt(t.D,a)?l.concat(a):void 0);if(bt(n,a,i),!pt(i))return;e.m=!1}if(vt(r)&&!_t(r)){if(!e.h.N&&e._<1)return;Rt(e,r),t&&t.A.l||Mt(e,r)}}function Mt(e,t,n){void 0===n&&(n=!1),e.h.N&&e.m&&jt(t,n)}function Lt(e,t){var n=e[tn];return(n?St(n):e)[t]}function Yt(e,t){if(t in e)for(var n=Object.getPrototypeOf(e);n;){var a=Object.getOwnPropertyDescriptor(n,t);if(a)return a;n=Object.getPrototypeOf(n)}}function Wt(e){e.P||(e.P=!0,e.l&&Wt(e.l))}function qt(e){e.o||(e.o=Dt(e.t))}function Kt(e,t,n){var a=Ot(t)?Ft("MapSet").T(t,n):wt(t)?Ft("MapSet").F(t,n):e.O?function(e,t){var n=Array.isArray(e),a={i:n?1:0,A:t?t.A:Nt(),P:!1,I:!1,D:{},l:t,t:e,k:null,o:null,j:null,C:!1},r=a,l=ln;n&&(r=[a],l=on);var i=Proxy.revocable(r,l),o=i.revoke,c=i.proxy;return a.k=c,a.j=o,c}(t,n):Ft("ES5").J(t,n);return(n?n.A:Nt()).p.push(a),a}function Bt(e){return pt(e)||dt(22,e),function e(t){if(!vt(t))return t;var n,a=t[tn],r=gt(t);if(a){if(!a.P&&(a.i<4||!Ft("ES5").K(a)))return a.t;a.I=!0,n=Gt(t,r),a.I=!1}else n=Gt(t,r);return ht(n,function(t,r){a&&Et(a.t,t)===r||bt(n,t,e(r))}),3===r?new Set(n):n}(e)}function Gt(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return Dt(e)}var zt,Ht,Ut="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),Jt="undefined"!=typeof Map,Zt="undefined"!=typeof Set,Qt="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,Xt=Ut?Symbol.for("immer-nothing"):((zt={})["immer-nothing"]=!0,zt),en=Ut?Symbol.for("immer-draftable"):"__$immer_draftable",tn=Ut?Symbol.for("immer-state"):"__$immer_state",nn=("undefined"!=typeof Symbol&&Symbol.iterator,"undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames),an=Object.getOwnPropertyDescriptors||function(e){var t={};return nn(e).forEach(function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)}),t},rn={},ln={get:function(e,t){if(t===tn)return e;var n=St(e);if(!yt(n,t))return function(e,t,n){var a,r=Yt(t,n);return r?"value"in r?r.value:null===(a=r.get)||void 0===a?void 0:a.call(e.k):void 0}(e,n,t);var a=n[t];return e.I||!vt(a)?a:a===Lt(e.t,t)?(qt(e),e.o[t]=Kt(e.A.h,a,e)):a},has:function(e,t){return t in St(e)},ownKeys:function(e){return Reflect.ownKeys(St(e))},set:function(e,t,n){var a=Yt(St(e),t);if(null==a?void 0:a.set)return a.set.call(e.k,n),!0;if(!e.P){var r=Lt(St(e),t),l=null==r?void 0:r[tn];if(l&&l.t===n)return e.o[t]=n,e.D[t]=!1,!0;if(Ct(n,r)&&(void 0!==n||yt(e.t,t)))return!0;qt(e),Wt(e)}return e.o[t]=n,e.D[t]=!0,!0},deleteProperty:function(e,t){return void 0!==Lt(e.t,t)||t in e.t?(e.D[t]=!1,qt(e),Wt(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var n=St(e),a=Reflect.getOwnPropertyDescriptor(n,t);return a?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:a.enumerable,value:n[t]}:a},defineProperty:function(){dt(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){dt(12)}},on={};ht(ln,function(e,t){on[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),on.deleteProperty=function(e,t){return ln.deleteProperty.call(this,e[0],t)},on.set=function(e,t,n){return ln.set.call(this,e[0],t,n,e[0])};var cn,un,fn=new(function(){function e(e){this.O=Qt,this.N=!1,"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),this.produce=this.produce.bind(this),this.produceWithPatches=this.produceWithPatches.bind(this)}var t=e.prototype;return t.produce=function(e,t,n){if("function"==typeof e&&"function"!=typeof t){var a=t;t=e;var r=this;return function(e){var n=this;void 0===e&&(e=a);for(var l=arguments.length,i=Array(l>1?l-1:0),o=1;o<l;o++)i[o-1]=arguments[o];return r.produce(e,function(e){var a;return(a=t).call.apply(a,[n,e].concat(i))})}}var l;if("function"!=typeof t&&dt(6),void 0!==n&&"function"!=typeof n&&dt(7),vt(e)){var i=Pt(this),o=Kt(this,e,void 0),c=!0;try{l=t(o),c=!1}finally{c?It(i):At(i)}return"undefined"!=typeof Promise&&l instanceof Promise?l.then(function(e){return xt(i,n),$t(e,i)},function(e){throw It(i),e}):(xt(i,n),$t(l,i))}if(!e||"object"!=typeof e){if((l=t(e))===Xt)return;return void 0===l&&(l=e),this.N&&jt(l,!0),l}dt(21,e)},t.produceWithPatches=function(e,t){var n,a,r=this;return"function"==typeof e?function(t){for(var n=arguments.length,a=Array(n>1?n-1:0),l=1;l<n;l++)a[l-1]=arguments[l];return r.produceWithPatches(t,function(t){return e.apply(void 0,[t].concat(a))})}:[this.produce(e,t,function(e,t){n=e,a=t}),n,a]},t.createDraft=function(e){vt(e)||dt(8),pt(e)&&(e=Bt(e));var t=Pt(this),n=Kt(this,e,void 0);return n[tn].C=!0,At(t),n},t.finishDraft=function(e,t){var n=(e&&e[tn]).A;return xt(n,t),$t(void 0,n)},t.setAutoFreeze=function(e){this.N=e},t.setUseProxies=function(e){e&&!Qt&&dt(20),this.O=e},t.applyPatches=function(e,t){var n;for(n=t.length-1;n>=0;n--){var a=t[n];if(0===a.path.length&&"replace"===a.op){e=a.value;break}}var r=Ft("Patches").$;return pt(e)?r(e,t):this.produce(e,function(e){return r(e,t.slice(n+1))})},e}()),sn=fn.produce,mn=(fn.produceWithPatches.bind(fn),fn.setAutoFreeze.bind(fn),fn.setUseProxies.bind(fn),fn.applyPatches.bind(fn),fn.createDraft.bind(fn),fn.finishDraft.bind(fn),sn),dn={group:"分组"};function pn(e){return e&&(null===e||void 0===e?void 0:e.map(function(e){return _.isString(e)?{name:e}:e}))}function vn(e){var t,n=e.modelName,a=e.detailValue,l=e.schemas,i=e.useLayout,o=void 0!==i&&i,s=e.style,d=void 0===s?"group":s,g=e.bsmSetting.staff_model,y=[],b=[];a&&(y=null!==(t=(_.cloneDeep(a.sections)||[]).map(function(e){var t=e;return t.fields=pn(t.fields),t}))&&void 0!==t?t:[],b=pn(_.cloneDeep(a.fields))||y.filter(function(e){return!_.isEmpty(e.fields)}).reduce(function(e,t){return e.concat(t.fields)},[]));var C=Object(u.useState)(y),O=c()(C,2),w=O[0],S=O[1],j=Object(u.useState)(b),k=c()(j,2),F=k[0],N=k[1],x=Object(u.useState)([]),I=c()(x,2),T=I[0],$=I[1];function R(e,t,n){var a=_.cloneDeep(F);a[e][n]=t,N(a)}Object(u.useEffect)(function(){var e,t,a=[],r=[];if(g){var i=[];l[n].fields.forEach(function(e){e.ref===g&&i.push(e)}),$(i)}var o=null===(e=_.cloneDeep(F))||void 0===e?void 0:e.filter(function(e){return Object(m.t)(n,e.name)});o.forEach(function(e,t){var l=e;l.showIf&&l.showIf.forEach(function(e,l){var i=e;if(_.isArray(i.value)){var o=Object(m.t)(n,i.field),c=new Promise(function(e){Object(ie.queryContent)({model:o.ref,filters:[{field:Object(m.D)(o.ref),operator:"in",value:i.value}]}).then(function(n){var r=n.list;a.push([t,l,r]),e()})});r.push(c)}})});var u=null===(t=_.cloneDeep(w))||void 0===t?void 0:t.map(function(e){var t=e;return t.fields&&(t.fields=t.fields.filter(function(e){return o.map(function(e){return e.name}).includes(e.name)})),t});Promise.all(r).then(function(){a.forEach(function(e){var t=c()(e,3),n=t[0],a=t[1],r=t[2];o[n].showIf[a].value=r})}),N(o),S(u)},[]);var V=function(e,t){N(mn(F,function(n){t?n[e].alias=t:delete n[e].alias}))},M={handleDisPlayName:V,handleFieldChange:R,deleteField:function(e){var t=_.cloneDeep(F);t.splice(e,1);var n=(_.cloneDeep(w)||[]).map(function(e){var n,a=e;return a.fields&&(a.fields=null===(n=a.fields)||void 0===n?void 0:n.filter(function(e){return t.map(function(e){return e.name}).includes(e.name)})),a});S(n),N(t)},addField:function(){N([].concat(E()(F),[{}]))},reset:function(){S(y),N(b)},setFields:N,getField:function(e){return{name:e}}};return[function(e){var t,r;if(void 0===e)return null;var i=F[e];return f.a.createElement(v.a,{labelCol:{span:5},wrapperCol:{span:19}},f.a.createElement(v.a.Item,{label:"显示名"},f.a.createElement(h.a,{allowClear:!0,value:i.alias,onChange:function(t){return V(e,t.target.value)},placeholder:i.name&&Object(Ee.displayPreprocess)([_.cloneDeep(i)],n,l)[0].alias})),f.a.createElement("div",{className:fe.a.divider,style:{marginBottom:16}},"权限设置"),f.a.createElement(ce,{groupsValue:null!==(t=null===(r=i.groups)||void 0===r?void 0:r.filter(function(e){return!("number"==typeof e)}))&&void 0!==t?t:[],groupsOnChange:function(t){var n=_.cloneDeep(F);n[e].groups=t,N(E()(n))},userValue:i.userField,userOnChange:function(t){var n=_.cloneDeep(F);n[e].userField=t,N(E()(n))},staffModelFields:T,staffModel:g,defauldGroupValue:a.fields[e]}),f.a.createElement(v.a.Item,{label:"满足条件显示"},f.a.createElement(xe.a,{fields:l[n].fields,onChange:function(t){return R(e,t,"showIf")},value:i.showIf,disabledField:function(e){return i.showIf.filter(function(e){return e.field}).map(function(e){return e.field}).includes(e.name)}})))},o&&f.a.createElement(v.a,{layout:"inline"},"default"!==d&&f.a.createElement(f.a.Fragment,null,f.a.createElement(P.a,{style:{marginTop:24},size:"middle",bordered:!0,dataSource:w,pagination:!1,columns:[{title:"".concat(dn[d],"名称"),key:"title",render:function(e,t,n){return f.a.createElement(h.a,{value:e.title,onChange:function(e){return t=n,a=e.target.value,(r=_.cloneDeep(w))[t].title=a,void S(r);var t,a,r}})}},{title:"所含字段",key:"fields",render:function(e,t,a){var r;return f.a.createElement(A.a,{mode:"multiple",value:null===(r=e.fields)||void 0===r?void 0:r.map(function(e){return e.name}),onChange:function(e){var t,n,r;t=a,n=e,(r=_.cloneDeep(w))[t].fields=n.map(function(e){return F.find(function(t){return t.name===e})}),S(r)}},F.filter(function(e){return e.name}).map(function(t){var a;return f.a.createElement(A.a.Option,{value:t.name,key:t.name,disabled:w.map(function(e){var t;return null===(t=e.fields)||void 0===t?void 0:t.map(function(e){return e.name})}).flat().includes(t.name)&&!(e.fields||[]).map(function(e){return e.name}).includes(t.name)},null===(a=l[n].fields.find(function(e){return e.name===t.name}))||void 0===a?void 0:a.displayName)}))}},{title:"显示风格",key:"style.widget",render:function(e,t,n){return f.a.createElement(p.a.Group,{value:e.style&&e.style.widget||"cell",onChange:function(e){return t=n,a=e.target.value,(r=_.cloneDeep(w))[t].style||(r[t].style={}),r[t].style.widget=a,void S(r);var t,a,r}},f.a.createElement(p.a,{value:"cell"},"列表"),f.a.createElement(p.a,{value:"table"},"表格"))}},{title:"操作",key:"option",render:function(e,t,n){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return e=n,(t=_.cloneDeep(w)).splice(e,1),void S(t);var e,t}},"删除"),n>0&&f.a.createElement(f.a.Fragment,null,f.a.createElement(D.a,{type:"vertical"}),f.a.createElement("a",{onClick:function(){return e=n,t=_.cloneDeep(w),a=e-1,r=[t[e],t[a]],t[a]=r[0],t[e]=r[1],void S(t);var e,t,a,r}},"上移")),n<w.length-1&&f.a.createElement(f.a.Fragment,null,f.a.createElement(D.a,{type:"vertical"}),f.a.createElement("a",{onClick:function(){return e=n,t=_.cloneDeep(w),a=e+1,r=[t[e],t[a]],t[a]=r[0],t[e]=r[1],void S(t);var e,t,a,r}},"下移")))}}],footer:function(){return f.a.createElement(r.a,{onClick:function(){return S([].concat(E()(w),[{}]))}},"添加",dn[d])}}))),F,w,M]}var hn=(cn={},he()(cn,"v1",function(e){var t=e.modelName,n=e.adminConfig,r=e.schemas,l=e.bsmSetting,i="default";n[t].detail&&(i=n[t].detail.style||i);var o=Object(u.useState)(i),s=c()(o,2),m=s[0],d=s[1],h=Object(u.useState)(String(0)),g=c()(h,2),y=g[0],E=g[1],b=vn({modelName:t,adminConfig:n,schemas:r,useLayout:!0,style:m,bsmSetting:l}),C=c()(b,5),O=C[0],w=C[1],S=C[2],j=C[3],k=C[4],F=k.deleteField,N=k.addField,x=k.check,I=k.detailReset;function A(){N(),E(String(S.length))}var P={style:m,sections:"default"!==m&&j,fields:"default"===m&&S},T=f.a.createElement(Fe.a,{tabBarStyle:{minWidth:48},activeKey:y,tabPosition:"left",type:"editable-card",onChange:E,onEdit:function(e,t){({add:A,remove:function(){return F(e)}})[t]()}},S.map(function(e,n){var a=r[t].fields.find(function(t){return t.name===e.name});return f.a.createElement(Fe.a.TabPane,{tab:(a||{}).displayName||"字段".concat(n+1),key:n,closable:!a||!a.required||S.filter(function(t){return t.name===e.name}).length>=2},O(n))}));return[f.a.createElement(f.a.Fragment,null,f.a.createElement(a.a,{title:"详情字段",type:"inner"},T),f.a.createElement(D.a,null),f.a.createElement(v.a,{layout:"inline"},f.a.createElement(v.a.Item,{label:"排列方式"},f.a.createElement(p.a.Group,{value:m,onChange:function(e){return d(e.target.value)}},f.a.createElement(p.a,{value:"default"},"默认"),_.map(dn,function(e,t){return f.a.createElement(p.a,{value:t},e)}))))),w,P,function(){I(),d(i)},x]}),he()(cn,"v2",function(e){var t,n,a=e.schemas,l=e.modelName,o=e.detailValue,s=e.bsmSetting,m=e.onChange,d=[],p=[],v=[];"default"===(null===o||void 0===o?void 0:o.style)||_.isEmpty(null===o||void 0===o?void 0:o.sections)?d=[(null===o||void 0===o?void 0:null===(t=o.fields)||void 0===t?void 0:t.length)||0]:null===o||void 0===o||null===(n=o.sections)||void 0===n||n.forEach(function(e){e.fields&&d.push(e.fields.length),p.push(e.title),v.push(e.style)});var g=Object(u.useState)(d),y=c()(g,2),b=y[0],C=y[1],O=Object(u.useState)(p),w=c()(O,2),S=w[0],D=w[1],j=Object(u.useState)(v),k=c()(j,2),F=k[0],x=k[1],I="group",P=vn({modelName:l,detailValue:o,schemas:a,style:I,bsmSetting:s}),$=c()(P,5),R=$[0],V=$[2],M=$[4],L=M.deleteField,Y=M.setFields,W=M.getField,q=M.handleFieldChange,B=ae({modelName:l,schemas:a,onOk:function(){return function(e){var t=0,n=e.length+b[un];b.forEach(function(e,n){n<=un&&(t+=e)});var a=e.map(W),r=N()(V,{$splice:[[t,0].concat(E()(a))]});Y(r),C(N()(b,{$splice:[[un,1,n]]}))}(U)},fieldDisabled:function(e){return V.map(function(e){return e.name}).includes(e.name)},expand:!0}),G=c()(B,3),z=G[0],U=G[1],J=G[2],Z=re({sectionStyle:F,style:I,sections:b,setSections:C,allData:V,setData:Y,modalView:z,columns:[{title:"字段",key:"name",render:function(e,t,n,a){return f.a.createElement(le.a,{value:e.name,onChange:function(e){return function(e,t,n){q(H(e,t,b),n,"name")}(n,a,e)},model:l})}},{title:"操作",key:"operation",render:function(e,t,n,a){return f.a.createElement(f.a.Fragment,null,f.a.createElement("a",{onClick:function(){return function(e,t){L(H(e,t,b)),C(N()(b,{$splice:[[t,1,b[t]-1]]}))}(n,a)}},"删除"))}}],footer:function(e){return f.a.createElement(r.a,{onClick:function(){un=e,J()}},"添加字段")},expandedRowRender:function(e,t,n,a,r){return R(H(t,r,b))},addAndDeleteView:function(e){var t;return f.a.createElement("div",null,"卡片类型：",f.a.createElement(A.a,{value:(null===(t=F[e])||void 0===t?void 0:t.widget)||"cell",onChange:function(t){return function(e,t){if(t in K.c){var n=b.reduce(function(t,n,a){return a<e?t+n:t},0),a=_.cloneDeep(b);a[e]=0,Y(N()(V,{$splice:[[n,b[e]]]})),C(a)}x(N()(F,{$splice:[[e,1,{widget:t}]]}))}(e,t)},style:{minWidth:120,maxWidth:200}},f.a.createElement(A.a.Option,{value:"cell"},"字段列表"),f.a.createElement(A.a.Option,{value:"tiles"},"字段平铺"),f.a.createElement(A.a.Option,{value:"table"},"字段表格"),f.a.createElement(A.a.Option,{value:"table-v"},"垂直字段表格"),Object.keys(K.e).map(function(e){return K.e[e].includes(l)&&f.a.createElement(A.a.Option,{value:e},K.d[e])})),0!==e&&f.a.createElement(r.a,{icon:"delete",onClick:function(){return function(e){var t=b.reduce(function(t,n,a){return a<e?t+n:t},0);Y(N()(V,{$splice:[[t,b[e]]]})),C(N()(b,{$splice:[[e,1]]})),D(N()(S,{$splice:[[e,1]]})),x(N()(F,{$splice:[[e,1]]}))}(e)}},"删除"))},addAndWidget:function(e){return f.a.createElement("div",null,f.a.createElement(st.a,{overlay:f.a.createElement(mt.a,{onClick:function(t){return function(e,t){var n=_.cloneDeep(b);n.splice(e,0,0),C(n);var a=_.cloneDeep(F);a.splice(e,0,{widget:t}),x(a),D(N()(S,{$splice:[[e,0,null]]}))}(e+1,t.key)}},f.a.createElement(mt.a.Item,{key:"cell"},"字段列表"),f.a.createElement(mt.a.Item,{key:"tiles"},"字段平铺"),f.a.createElement(mt.a.Item,{key:"table"},"字段表格"),f.a.createElement(mt.a.Item,{key:"table-v"},"垂直字段表格"),Object.keys(K.e).map(function(e){return K.e[e].includes(l)&&f.a.createElement(mt.a.Item,{key:e},K.d[e])})),trigger:["click"]},f.a.createElement(r.a,{type:"dashed",block:!0},f.a.createElement(T.a,{type:"plus"}))))},tableTitle:function(e){return f.a.createElement("div",null,"".concat(dn.group,"名称"),"  ",f.a.createElement(h.a,{style:{width:100},value:S[e],onChange:function(t){return function(e,t){D(N()(S,{$splice:[[e,1,t]]}))}(e,t.target.value)},placeholder:"第".concat(e+1,"组")}))}}),Q=c()(Z,1)[0],X=i()({},o,{style:I,fields:!1}),ee=0;return X.sections=[],b.forEach(function(e,t){X.sections.push({title:S[t],fields:V.slice(ee,ee+e),style:F[t]}),ee+=e}),Object(u.useEffect)(function(){m(X)},[b,S,F,I,V]),Q}),cn).v2;var gn=_.debounce(function(e,t){e(t)},100);function yn(e){var t,n=e.modelName,a=e.adminConfig,r=e.schemas,l=e.bsmSetting,o=Object(ft.n)().params.key,s=function(){return E()(a[n].details||[])},d=Object(u.useState)(s),p=c()(d,2),v=p[0],g=p[1],y=Object(u.useState)(),b=c()(y,2),C=b[0],O=b[1],w=Object(u.useState)(),S=c()(w,2),D=S[0],k=S[1],F=Object(u.useState)(o||(null===(t=v[0])||void 0===t?void 0:t.key)),N=c()(F,2),x=N[0],A=N[1];return[f.a.createElement("div",null,f.a.createElement(j.a,{title:"添加标签",visible:C,okButtonProps:{disabled:!D},destroyOnClose:!0,onOk:function(){var e=v,t=I()(6);e.push({key:t,sections:[],title:D,style:"group"}),g(e),A(t),O(!1)},onCancel:function(){return O(!1)}},f.a.createElement("span",null,"标签名称："),f.a.createElement(h.a,{onChange:function(e){return gn(k,e.target.value)},style:{width:300}})),f.a.createElement(Fe.a,{type:"editable-card",activeKey:x,onChange:function(e){return A(e)},onEdit:function(e,t){if("add"===t&&O(!0),"remove"===t){var n,a,r=v.filter(function(t,n){return t.key!==e||((a=n-1)<0&&(a=0),!1)});e===x&&A(null===(n=r[a])||void 0===n?void 0:n.key),g(r)}}},v.map(function(e,t){return f.a.createElement(Fe.a.TabPane,{tab:e.title||"详情".concat(t+1),key:e.key,closable:1!==v.length},f.a.createElement(hn,{modelName:n,schemas:r,detailValue:e,bsmSetting:l,onChange:function(e){var n=v;n[t]=e,g(n)}}))}))),void 0,v,function(){g(s())},function(){return v.map(function(e){return function(e){var t=e;function a(e){return e.map(function(e){return _.isString(e)?{name:e}:e}).filter(function(e){return e.name}).map(function(e){var t=i()({},e);return t.showIf&&(t.showIf=Object(m.y)(e.showIf,n)),_.isEmpty(e.groups)||(t.groups=t.groups.filter(function(e){return e}).map(function(e){return e.id||e})),e.id||(t.id=I()(6)),t})}return"default"!==e.style&&e.sections?t.sections=t.sections.filter(function(e){var t;return(null===(t=e.style)||void 0===t?void 0:t.widget)in K.c||!_.isEmpty(e.fields)}).map(function(e){var t,n=e;return(null===(t=e.style)||void 0===t?void 0:t.widget)in K.c?n.fields=[]:n.fields=a(n.fields),n}):t.fields=a(t.fields),t}(e)})}]}var En=function(e){var t=e.modelName,n=e.schemas,r=e.adminConfig,l=yn({modelName:t,schemas:n,adminConfig:r,bsmSetting:e.bsmSetting}),i=c()(l,5),o=i[0],s=i[1],m=i[2],d=i[3],h=i[4],g=Object(u.useState)(r[t].modalDetail),y=c()(g,2),E=y[0],b=y[1],C={detail:void 0,details:m,modalDetail:E};return[f.a.createElement(f.a.Fragment,null,o,f.a.createElement(a.a,{title:"基本设置",type:"inner"},f.a.createElement(v.a,{layout:"inline"},f.a.createElement(v.a.Item,{label:"详情界面"},f.a.createElement(p.a.Group,{value:!!E,onChange:function(e){return b(e.target.value)}},f.a.createElement(p.a,{value:!0},"弹窗"),f.a.createElement(p.a,{value:!1},"新页面"))))),s),C,function(){d()},function(){var e=h();return C.details=e,C}]};var bn=Object(s.connect)(function(e){return{bsmSetting:e.bsmSetting}})(Object(m.d)(function(e){var t=e.schemas,n=e.modelName,l=e.adminWithoutDefault,o=e.updateAdmin,s=e.afterSubmit,m=e.defaultTab,d=void 0===m?"list":m,p=e.bsmSetting;if(!t[n])return null;var v=Je({modelName:n,schemas:t,adminConfig:l,bsmSetting:p}),h=c()(v,4),g=h[0],y=h[1],E=h[2],b=h[3],C=ut({modelName:n,schemas:t,adminConfig:l,bsmSetting:p}),O=c()(C,5),w=O[0],D=O[1],j=O[2],k=O[3],F=O[4],N=En({modelName:n,schemas:t,adminConfig:l,bsmSetting:p}),x=c()(N,4),I=x[0],A=x[1],P=x[2],T=x[3],$=S({modelName:n,schemas:t,adminConfig:l}),R=c()($,4),V=R[0],M=R[1],L=R[2],Y=R[3],W=i()({},l[n],{exportable:M},y,D,A),q={list:function(){return g},form:function(){return w},detail:function(){return I},export:function(){return V}},K=Object(u.useState)(d),B=c()(K,2),G=B[0],z=B[1];return f.a.createElement(a.a,{activeTabKey:G,tabList:[{key:"list",tab:"列表页设置"},{key:"form",tab:"表单设置"},{key:"detail",tab:"详情页设置"},{key:"export",tab:"导出设置"}],onTabChange:z,actions:[f.a.createElement("div",{style:{textAlign:"left",marginTop:12,marginBottom:12}},f.a.createElement(r.a,{onClick:function(){if(F()&&Y()){_.mapValues(b(),function(e,t){W[t]=e}),_.mapValues(k(),function(e,t){W[t]=e}),_.mapValues(T(),function(e,t){W[t]=e});var e=_.cloneDeep(W);o({model:n,config:e}),s&&s({model:n,config:e})}},type:"primary",style:{marginLeft:24}},"更新"),f.a.createElement(r.a,{onClick:function(){L(),E(),j(),P()},style:{marginLeft:24}},"重置"))]},q[G]())}));t.default=bn}}]);